{"config":{"lang":["ja"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u4ecb\u7ecd \u672c\u6587\u6863\u4e3a\u70b8\u6bdb\u6846\u67b6 v2 \u7248\u672c\uff0c\u5982\u9700\u67e5\u770b v1 \u7248\u672c\uff0c \u70b9\u6211 \u3002 \u63d0\u793a \u7f16\u5199\u6587\u6863\u9700\u8981\u8f83\u5927\u7cbe\u529b\uff0c\u4f60\u4e5f\u53ef\u4ee5\u53c2\u4e0e\u5230\u672c\u6587\u6863\u7684\u5efa\u8bbe\u4e2d\u6765\uff0c\u6bd4\u5982\u627e\u9519\u5b57\uff0c\u589e\u52a0\u6216\u66f4\u6b63\u5185\u5bb9\uff0c\u6bcf\u9875\u6587\u6863\u53ef\u76f4\u63a5\u70b9\u51fb\u53f3\u4e0a\u65b9\u94c5\u7b14\u56fe\u6807\u76f4\u63a5\u8df3\u8f6c\u81f3 GitHub \u8fdb\u884c\u7f16\u8f91\uff0c\u7f16\u8f91\u540e\u81ea\u52a8 Fork \u5e76\u751f\u6210 Pull Request\uff0c\u4ee5\u6b64\u6765\u8d21\u732e\u6b64\u6587\u6863\uff01 \u70b8\u6bdb\u6846\u67b6\u4f7f\u7528 PHP \u7f16\u5199\uff0c\u91c7\u7528 Swoole \u6269\u5c55\u4e3a\u57fa\u7840\uff0c\u4e3b\u8981\u9762\u5411 API \u670d\u52a1\uff0c\u804a\u5929\u673a\u5668\u4eba\uff08OneBot \u6807\u51c6\u7684\u673a\u5668\u4eba\u5bf9\u63a5\uff09\uff0c\u5305\u542b WebSocket\u3001HTTP \u7b49\u76d1\u542c\u548c\u8bf7\u6c42\u5e93\uff0c\u7528\u6237\u4ee3\u7801\u91c7\u7528\u6a21\u5757\u5316\u5904\u7406\uff0c\u4f7f\u7528\u6ce8\u89e3\u53ef\u4ee5\u65b9\u4fbf\u5730\u7f16\u5199\u5404\u7c7b\u529f\u80fd\u3002 \u6846\u67b6\u4e3b\u8981\u7528\u9014\u4e3a HTTP/WS \u670d\u52a1\u5668\uff0c\u673a\u5668\u4eba\u642d\u5efa\u6846\u67b6\u3002\u5c24\u5176\u5bf9\u4e8e\u804a\u5929\u673a\u5668\u4eba\u6d88\u606f\u5904\u7406\u8f83\u4e3a\u65b9\u4fbf\u548c\u5168\u9762\uff0c\u63d0\u4f9b\u4e86\u4f17\u591a\u4f1a\u8bdd\u673a\u5236\u548c\u5185\u90e8\u8c03\u7528\u673a\u5236\uff0c\u53ef\u4ee5\u4ee5\u5404\u79cd\u65b9\u5f0f\u8bbe\u8ba1\u4f60\u81ea\u5df1\u7684\u6a21\u5757\u3002 \u5728 HTTP \u548c WebSocket \u670d\u52a1\u5668\u4e0a\uff0cPHP \u7684\u6269\u5c55 Swoole \u63d0\u4f9b\u4e86\u9ad8\u6027\u80fd\u7684\u652f\u6301\uff0c\u4f7f\u5176\u6548\u7387\u53ef\u5ab2\u7f8e nginx \u9759\u6001\u7f51\u9875\u5904\u7406\u7684\u6548\u7387\u3002 \u6b64\u5916\uff0cQQ \u673a\u5668\u4eba\u65b9\u9762\u6b64\u6846\u67b6\u57fa\u4e8e OneBot \u6807\u51c6\u7684\u53cd\u5411 WebSocket \u8fde\u63a5\uff0c\u6bd4\u4f20\u7edf HTTP \u901a\u4fe1\u66f4\u5feb\u3002 1 2 3 4 5 6 7 8 9 10 11 12 /** * @CQCommand(\"\u4f60\u597d\") */ public function hello() { ctx()->reply(\"\u4f60\u597d\uff0c\u6211\u662f\u70b8\u6bdb\uff01\"); } /** * @RequestMapping(\"/index\") */ public function index() { return \"<h1>hello!</h1>\"; } \u5f00\u59cb\u524d \u9996\u5148\uff0c\u4f60\u9700\u8981\u4e86\u89e3\u4f60\u9700\u8981\u77e5\u9053\u54ea\u4e9b\u4e8b\u60c5\u624d\u80fd\u5f00\u59cb\u7740\u624b\u4f7f\u7528\u6846\u67b6\uff1a Linux \u547d\u4ee4\u884c\uff08\u4f1a\u8dd1 Linux \u7a0b\u5e8f\uff09 php 7.2+ \u5f00\u53d1\u73af\u5883\uff08\u9879\u76ee\u4f1a\u6301\u7eed\u652f\u6301\u6700\u65b0\u7684 PHP \u7248\u672c\uff09 OneBot \u673a\u5668\u4eba\u804a\u5929\u63a5\u53e3\u6807\u51c6 \u9700\u8981\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u672c\u6559\u7a0b\u4e2d\u6240\u6d89\u53ca\u7684\u5185\u5bb9\u5747\u4e3a\u5c3d\u53ef\u80fd\u7ffb\u8bd1\u4e3a\u767d\u8bdd\u7684\u65b9\u5f0f\u8fdb\u884c\u63cf\u8ff0\uff0c\u4f46\u5bf9\u4e8e\u6846\u67b6\u7684\u7ec4\u4ef6\u6216\u4e8b\u4ef6\u7b49\u9700\u8981\u5355\u72ec\u62c6\u5206\u8bf4\u660e\u6587\u6863\u7684\u90e8\u5206\u5219\u9700\u8981\u8db3\u591f\u8be6\u7ec6\uff0c\u6240\u4ee5\u672c\u6559\u7a0b\u63d0\u4f9b\u4e00\u4e2a\u5feb\u901f\u4e0a\u624b\u7684\u6559\u7a0b\uff0c\u5e76\u4e14\u4f1a\u5c06\u6700\u5178\u578b\u7684\u5b89\u88c5\u65b9\u5f0f\u5199\u5230\u5feb\u901f\u6559\u7a0b\u7bc7\u3002 \u6587\u6863\u63d0\u793a \u6b64\u6587\u6863\u91c7\u7528 MkDocs \u9a71\u52a8\uff0c\u6587\u6863\u7684\u641c\u7d22\u7ec4\u4ef6\u539f\u751f\u4e0d\u652f\u6301\u4e2d\u6587\u641c\u7d22\uff0c\u4e14\u5206\u8bcd\u5f88\u96be\u63a7\u5236\uff0c\u6240\u4ee5\u641c\u7d22\u4f53\u9a8c\u4f1a\u5927\u6253\u6298\u6263\uff0c\u656c\u8bf7\u8c05\u89e3\uff01\u641c\u4e0d\u5230\u4e0d\u662f\u6ca1\u8fd9\u4e2a\u4e1c\u897f\uff0c\u5efa\u8bae\u8fd9\u79cd\u60c5\u51b5\u53ef\u4ee5\u81ea\u884c\u7ffb\u9605\u76ee\u5f55\u67e5\u770b\uff01 \u6846\u67b6\u7279\u8272 \u652f\u6301MySQL\u6570\u636e\u5e93\uff08\u8fde\u63a5\u6c60\uff09\uff0c\u81ea\u5e26\u67e5\u8be2\u7f13\u5b58\u63d0\u9ad8\u591a\u67e5\u8be2\u65f6\u7684\u6548\u7387 Websocket \u670d\u52a1\u5668\u3001HTTP \u670d\u52a1\u5668\u517c\u5bb9\u8fd0\u884c\uff0c\u4e00\u4e2a\u6846\u67b6\u591a\u4e2a\u7528\u5904 \u652f\u6301\u547d\u4ee4\u3001\u81ea\u7136\u8bed\u8a00\u5904\u7406\u7b49\u591a\u79cd\u63d2\u4ef6\u5f62\u5f0f \u652f\u6301\u591a\u4e2a\u673a\u5668\u4eba\u8d26\u53f7\u8d1f\u8f7d\u5747\u8861 \u534f\u7a0b + TaskWorker \u8fdb\u7a0b\u91cd\u5ea6\u4efb\u52a1\u5904\u7406\u673a\u5236\uff0c\u4fdd\u8bc1\u9ad8\u6548\uff0c\u5355\u4e2a\u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4\u4e3a 0.1 ms \u5de6\u53f3 \u6a21\u5757\u5206\u79bb\u548c\u81ea\u7531\u7ec4\u5408\uff0c\u53ef\u6839\u636e\u81ea\u8eab\u9700\u6c42\u81ea\u5df1\u5efa\u7acb\u6a21\u5757\u5185\u7684\u76ee\u5f55\u7ed3\u6784\u548c\u4ee3\u7801\u7ed3\u6784 \u7075\u6d3b\u7684\u6ce8\u91ca\u6ce8\u89e3\u6ce8\u518c\u4e8b\u4ef6\u65b9\u5f0f\uff0c\u5f25\u8865 PHP \u8bed\u8a00\u7f3a\u5c11\u6ce8\u89e3\u7684\u9057\u61be \u6587\u6863\u4e3b\u9898 \u4e3b\u9898 \u9ed8\u8ba4\u6a21\u5f0f \u6697\u9ed1\u6a21\u5f0f var buttons = document.querySelectorAll(\"button[data-md-color-scheme]\"); buttons.forEach(function(button) { button.addEventListener(\"click\", function() { var attr = this.getAttribute(\"data-md-color-scheme\"); setCookie(\"_theme\", attr); document.body.setAttribute(\"data-md-color-scheme\", attr); var name = document.querySelector(\"#__code_0 code span:nth-child(7)\"); name.textContent = attr; }) }) \u4e3b\u8272\u8c03 red pink purple deep purple indigo blue light blue cyan teal green light green lime yellow amber orange deep orange brown grey blue grey black white \u8f85\u8272\u8c03 red pink purple deep purple indigo blue light blue cyan teal green light green lime yellow amber orange deep orange var buttons = document.querySelectorAll(\"button[data-md-color-primary]\") buttons.forEach(function(button) { button.addEventListener(\"click\", function() { var attr = this.getAttribute(\"data-md-color-primary\") setCookie(\"_primary_color\", attr) document.body.setAttribute(\"data-md-color-primary\", attr) var name = document.querySelector(\"#__code_2 code span:nth-child(7)\") name.textContent = attr.replace(\"-\", \" \") }) }) var buttons2 = document.querySelectorAll(\"button[data-md-color-accent]\") buttons2.forEach(function(button) { button.addEventListener(\"click\", function() { var attr = this.getAttribute(\"data-md-color-accent\") setCookie(\"_accent_color\", attr) document.body.setAttribute(\"data-md-color-accent\", attr) var name = document.querySelector(\"#__code_3 code span:nth-child(7)\") name.textContent = attr.replace(\"-\", \" \") }) })","title":"\u4ecb\u7ecd"},{"location":"#_1","text":"\u672c\u6587\u6863\u4e3a\u70b8\u6bdb\u6846\u67b6 v2 \u7248\u672c\uff0c\u5982\u9700\u67e5\u770b v1 \u7248\u672c\uff0c \u70b9\u6211 \u3002 \u63d0\u793a \u7f16\u5199\u6587\u6863\u9700\u8981\u8f83\u5927\u7cbe\u529b\uff0c\u4f60\u4e5f\u53ef\u4ee5\u53c2\u4e0e\u5230\u672c\u6587\u6863\u7684\u5efa\u8bbe\u4e2d\u6765\uff0c\u6bd4\u5982\u627e\u9519\u5b57\uff0c\u589e\u52a0\u6216\u66f4\u6b63\u5185\u5bb9\uff0c\u6bcf\u9875\u6587\u6863\u53ef\u76f4\u63a5\u70b9\u51fb\u53f3\u4e0a\u65b9\u94c5\u7b14\u56fe\u6807\u76f4\u63a5\u8df3\u8f6c\u81f3 GitHub \u8fdb\u884c\u7f16\u8f91\uff0c\u7f16\u8f91\u540e\u81ea\u52a8 Fork \u5e76\u751f\u6210 Pull Request\uff0c\u4ee5\u6b64\u6765\u8d21\u732e\u6b64\u6587\u6863\uff01 \u70b8\u6bdb\u6846\u67b6\u4f7f\u7528 PHP \u7f16\u5199\uff0c\u91c7\u7528 Swoole \u6269\u5c55\u4e3a\u57fa\u7840\uff0c\u4e3b\u8981\u9762\u5411 API \u670d\u52a1\uff0c\u804a\u5929\u673a\u5668\u4eba\uff08OneBot \u6807\u51c6\u7684\u673a\u5668\u4eba\u5bf9\u63a5\uff09\uff0c\u5305\u542b WebSocket\u3001HTTP \u7b49\u76d1\u542c\u548c\u8bf7\u6c42\u5e93\uff0c\u7528\u6237\u4ee3\u7801\u91c7\u7528\u6a21\u5757\u5316\u5904\u7406\uff0c\u4f7f\u7528\u6ce8\u89e3\u53ef\u4ee5\u65b9\u4fbf\u5730\u7f16\u5199\u5404\u7c7b\u529f\u80fd\u3002 \u6846\u67b6\u4e3b\u8981\u7528\u9014\u4e3a HTTP/WS \u670d\u52a1\u5668\uff0c\u673a\u5668\u4eba\u642d\u5efa\u6846\u67b6\u3002\u5c24\u5176\u5bf9\u4e8e\u804a\u5929\u673a\u5668\u4eba\u6d88\u606f\u5904\u7406\u8f83\u4e3a\u65b9\u4fbf\u548c\u5168\u9762\uff0c\u63d0\u4f9b\u4e86\u4f17\u591a\u4f1a\u8bdd\u673a\u5236\u548c\u5185\u90e8\u8c03\u7528\u673a\u5236\uff0c\u53ef\u4ee5\u4ee5\u5404\u79cd\u65b9\u5f0f\u8bbe\u8ba1\u4f60\u81ea\u5df1\u7684\u6a21\u5757\u3002 \u5728 HTTP \u548c WebSocket \u670d\u52a1\u5668\u4e0a\uff0cPHP \u7684\u6269\u5c55 Swoole \u63d0\u4f9b\u4e86\u9ad8\u6027\u80fd\u7684\u652f\u6301\uff0c\u4f7f\u5176\u6548\u7387\u53ef\u5ab2\u7f8e nginx \u9759\u6001\u7f51\u9875\u5904\u7406\u7684\u6548\u7387\u3002 \u6b64\u5916\uff0cQQ \u673a\u5668\u4eba\u65b9\u9762\u6b64\u6846\u67b6\u57fa\u4e8e OneBot \u6807\u51c6\u7684\u53cd\u5411 WebSocket \u8fde\u63a5\uff0c\u6bd4\u4f20\u7edf HTTP \u901a\u4fe1\u66f4\u5feb\u3002 1 2 3 4 5 6 7 8 9 10 11 12 /** * @CQCommand(\"\u4f60\u597d\") */ public function hello() { ctx()->reply(\"\u4f60\u597d\uff0c\u6211\u662f\u70b8\u6bdb\uff01\"); } /** * @RequestMapping(\"/index\") */ public function index() { return \"<h1>hello!</h1>\"; }","title":"\u4ecb\u7ecd"},{"location":"#_2","text":"\u9996\u5148\uff0c\u4f60\u9700\u8981\u4e86\u89e3\u4f60\u9700\u8981\u77e5\u9053\u54ea\u4e9b\u4e8b\u60c5\u624d\u80fd\u5f00\u59cb\u7740\u624b\u4f7f\u7528\u6846\u67b6\uff1a Linux \u547d\u4ee4\u884c\uff08\u4f1a\u8dd1 Linux \u7a0b\u5e8f\uff09 php 7.2+ \u5f00\u53d1\u73af\u5883\uff08\u9879\u76ee\u4f1a\u6301\u7eed\u652f\u6301\u6700\u65b0\u7684 PHP \u7248\u672c\uff09 OneBot \u673a\u5668\u4eba\u804a\u5929\u63a5\u53e3\u6807\u51c6 \u9700\u8981\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u672c\u6559\u7a0b\u4e2d\u6240\u6d89\u53ca\u7684\u5185\u5bb9\u5747\u4e3a\u5c3d\u53ef\u80fd\u7ffb\u8bd1\u4e3a\u767d\u8bdd\u7684\u65b9\u5f0f\u8fdb\u884c\u63cf\u8ff0\uff0c\u4f46\u5bf9\u4e8e\u6846\u67b6\u7684\u7ec4\u4ef6\u6216\u4e8b\u4ef6\u7b49\u9700\u8981\u5355\u72ec\u62c6\u5206\u8bf4\u660e\u6587\u6863\u7684\u90e8\u5206\u5219\u9700\u8981\u8db3\u591f\u8be6\u7ec6\uff0c\u6240\u4ee5\u672c\u6559\u7a0b\u63d0\u4f9b\u4e00\u4e2a\u5feb\u901f\u4e0a\u624b\u7684\u6559\u7a0b\uff0c\u5e76\u4e14\u4f1a\u5c06\u6700\u5178\u578b\u7684\u5b89\u88c5\u65b9\u5f0f\u5199\u5230\u5feb\u901f\u6559\u7a0b\u7bc7\u3002 \u6587\u6863\u63d0\u793a \u6b64\u6587\u6863\u91c7\u7528 MkDocs \u9a71\u52a8\uff0c\u6587\u6863\u7684\u641c\u7d22\u7ec4\u4ef6\u539f\u751f\u4e0d\u652f\u6301\u4e2d\u6587\u641c\u7d22\uff0c\u4e14\u5206\u8bcd\u5f88\u96be\u63a7\u5236\uff0c\u6240\u4ee5\u641c\u7d22\u4f53\u9a8c\u4f1a\u5927\u6253\u6298\u6263\uff0c\u656c\u8bf7\u8c05\u89e3\uff01\u641c\u4e0d\u5230\u4e0d\u662f\u6ca1\u8fd9\u4e2a\u4e1c\u897f\uff0c\u5efa\u8bae\u8fd9\u79cd\u60c5\u51b5\u53ef\u4ee5\u81ea\u884c\u7ffb\u9605\u76ee\u5f55\u67e5\u770b\uff01","title":"\u5f00\u59cb\u524d"},{"location":"#_3","text":"\u652f\u6301MySQL\u6570\u636e\u5e93\uff08\u8fde\u63a5\u6c60\uff09\uff0c\u81ea\u5e26\u67e5\u8be2\u7f13\u5b58\u63d0\u9ad8\u591a\u67e5\u8be2\u65f6\u7684\u6548\u7387 Websocket \u670d\u52a1\u5668\u3001HTTP \u670d\u52a1\u5668\u517c\u5bb9\u8fd0\u884c\uff0c\u4e00\u4e2a\u6846\u67b6\u591a\u4e2a\u7528\u5904 \u652f\u6301\u547d\u4ee4\u3001\u81ea\u7136\u8bed\u8a00\u5904\u7406\u7b49\u591a\u79cd\u63d2\u4ef6\u5f62\u5f0f \u652f\u6301\u591a\u4e2a\u673a\u5668\u4eba\u8d26\u53f7\u8d1f\u8f7d\u5747\u8861 \u534f\u7a0b + TaskWorker \u8fdb\u7a0b\u91cd\u5ea6\u4efb\u52a1\u5904\u7406\u673a\u5236\uff0c\u4fdd\u8bc1\u9ad8\u6548\uff0c\u5355\u4e2a\u8bf7\u6c42\u54cd\u5e94\u65f6\u95f4\u4e3a 0.1 ms \u5de6\u53f3 \u6a21\u5757\u5206\u79bb\u548c\u81ea\u7531\u7ec4\u5408\uff0c\u53ef\u6839\u636e\u81ea\u8eab\u9700\u6c42\u81ea\u5df1\u5efa\u7acb\u6a21\u5757\u5185\u7684\u76ee\u5f55\u7ed3\u6784\u548c\u4ee3\u7801\u7ed3\u6784 \u7075\u6d3b\u7684\u6ce8\u91ca\u6ce8\u89e3\u6ce8\u518c\u4e8b\u4ef6\u65b9\u5f0f\uff0c\u5f25\u8865 PHP \u8bed\u8a00\u7f3a\u5c11\u6ce8\u89e3\u7684\u9057\u61be","title":"\u6846\u67b6\u7279\u8272"},{"location":"#_4","text":"","title":"\u6587\u6863\u4e3b\u9898"},{"location":"#_5","text":"\u9ed8\u8ba4\u6a21\u5f0f \u6697\u9ed1\u6a21\u5f0f var buttons = document.querySelectorAll(\"button[data-md-color-scheme]\"); buttons.forEach(function(button) { button.addEventListener(\"click\", function() { var attr = this.getAttribute(\"data-md-color-scheme\"); setCookie(\"_theme\", attr); document.body.setAttribute(\"data-md-color-scheme\", attr); var name = document.querySelector(\"#__code_0 code span:nth-child(7)\"); name.textContent = attr; }) })","title":"\u4e3b\u9898"},{"location":"#_6","text":"red pink purple deep purple indigo blue light blue cyan teal green light green lime yellow amber orange deep orange brown grey blue grey black white","title":"\u4e3b\u8272\u8c03"},{"location":"#_7","text":"red pink purple deep purple indigo blue light blue cyan teal green light green lime yellow amber orange deep orange var buttons = document.querySelectorAll(\"button[data-md-color-primary]\") buttons.forEach(function(button) { button.addEventListener(\"click\", function() { var attr = this.getAttribute(\"data-md-color-primary\") setCookie(\"_primary_color\", attr) document.body.setAttribute(\"data-md-color-primary\", attr) var name = document.querySelector(\"#__code_2 code span:nth-child(7)\") name.textContent = attr.replace(\"-\", \" \") }) }) var buttons2 = document.querySelectorAll(\"button[data-md-color-accent]\") buttons2.forEach(function(button) { button.addEventListener(\"click\", function() { var attr = this.getAttribute(\"data-md-color-accent\") setCookie(\"_accent_color\", attr) document.body.setAttribute(\"data-md-color-accent\", attr) var name = document.querySelector(\"#__code_3 code span:nth-child(7)\") name.textContent = attr.replace(\"-\", \" \") }) })","title":"\u8f85\u8272\u8c03"},{"location":"advanced/","text":"\u8fdb\u9636\u5f00\u53d1 \u5728\u672c\u7ae0\uff0c\u4e0b\u9762\u7684\u90e8\u5206\u5c06\u8be6\u7ec6\u8bf4\u660e\u4e00\u4e9b\u5177\u4f53\u7684\u6848\u4f8b\u548c\u81ea\u5b9a\u4e49\u6846\u67b6\u7684\u64cd\u4f5c\u3002 \u5982\u4f55\u81ea\u5b9a\u4e49\u4fee\u6539\u6846\u67b6\u672c\u8eab\uff1f- \u6846\u67b6\u542f\u52a8\u65b9\u5f0f \u5982\u4f55\u63a5\u5165\u4e00\u4e2a\u81ea\u5df1\u7684 WebSocket \u5ba2\u6237\u7aef\uff1f- \u63a5\u5165 WebSocket \u5ba2\u6237\u7aef \u6846\u67b6\u5230\u5e95\u662f\u600e\u4e48\u5de5\u4f5c\u7684\uff1f- \u6846\u67b6\u7ed3\u6784\u5256\u6790 \u66f4\u591a\u8fdb\u9636\u6559\u7a0b\u656c\u8bf7\u671f\u5f85....\uff08\u6216\u8005\u4f60\u53ef\u4ee5\u9009\u62e9\u63d0 Issue \u5230\u6846\u67b6 GitHub\uff0c\u6709\u9700\u6c42\u5c31\u5199\u5165\u6587\u6863\uff09","title":"\u8fdb\u9636\u5f00\u53d1"},{"location":"advanced/#_1","text":"\u5728\u672c\u7ae0\uff0c\u4e0b\u9762\u7684\u90e8\u5206\u5c06\u8be6\u7ec6\u8bf4\u660e\u4e00\u4e9b\u5177\u4f53\u7684\u6848\u4f8b\u548c\u81ea\u5b9a\u4e49\u6846\u67b6\u7684\u64cd\u4f5c\u3002 \u5982\u4f55\u81ea\u5b9a\u4e49\u4fee\u6539\u6846\u67b6\u672c\u8eab\uff1f- \u6846\u67b6\u542f\u52a8\u65b9\u5f0f \u5982\u4f55\u63a5\u5165\u4e00\u4e2a\u81ea\u5df1\u7684 WebSocket \u5ba2\u6237\u7aef\uff1f- \u63a5\u5165 WebSocket \u5ba2\u6237\u7aef \u6846\u67b6\u5230\u5e95\u662f\u600e\u4e48\u5de5\u4f5c\u7684\uff1f- \u6846\u67b6\u7ed3\u6784\u5256\u6790 \u66f4\u591a\u8fdb\u9636\u6559\u7a0b\u656c\u8bf7\u671f\u5f85....\uff08\u6216\u8005\u4f60\u53ef\u4ee5\u9009\u62e9\u63d0 Issue \u5230\u6846\u67b6 GitHub\uff0c\u6709\u9700\u6c42\u5c31\u5199\u5165\u6587\u6863\uff09","title":"\u8fdb\u9636\u5f00\u53d1"},{"location":"advanced/connect-ws-client/","text":"\u63a5\u5165 WebSocket \u5ba2\u6237\u7aef \u70b8\u6bdb\u6846\u67b6\u5176\u5b9e\u4ece\u672c\u8d28\u4e0a\u8bb2\uff0c\u5c31\u662f\u4e00\u4e2a HTTP + WebSocket \u670d\u52a1\u5668\uff0c\u6240\u4ee5\u6846\u67b6\u4e5f\u652f\u6301\u5bf9\u63a5\u5176\u4ed6\u4efb\u4f55 HTTP \u5ba2\u6237\u7aef\u548c WebSocket \u5ba2\u6237\u7aef\uff0c\u5b9e\u9645\u4e0a\u70b8\u6bdb\u6846\u67b6\u975e\u5e38\u9002\u5408\u7528 WebSocket \u505a\u5728\u7ebf\u7684 IM \u804a\u5929\u901a\u8baf\uff0c\u4e5f\u53ef\u4ee5\u65b9\u4fbf\u5730\u8fdb\u884c WS \u901a\u4fe1\u3002\u8fd9\u91cc\u4e3b\u8981\u8bf4\u660e\u5982\u4f55\u5bf9\u63a5\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 WebSocket \u5ba2\u6237\u7aef\u3002 \u7c7b\u578b\u6307\u5b9a \u7531\u4e8e WebSocket \u8fde\u63a5\u90fd\u5177\u6709\u540c\u6837\u7684\u6027\u8d28\uff0c\u6ca1\u6709\u72b6\u6001\uff0c\u6240\u4ee5\u5728\u5efa\u7acb WebSocket \u8fde\u63a5\u7684\u65f6\u5019\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u8868\u660e\u81ea\u5df1\u7684\u8eab\u4efd\u548c\u7c7b\u578b\u3002\u6307\u5b9a\u5ba2\u6237\u7aef\u8fde\u63a5\u7c7b\u578b\u7684\u65b9\u5f0f\u6709\u4e24\u79cd\uff1a GET \u53c2\u6570\u4f20\u9012\uff0c\u5728\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u52a0\u4e0a GET \u53c2\u6570 type \u5373\u53ef\u3002\u6bd4\u5982 js \u4e2d WebSocket \u5efa\u7acb\u65f6\u5730\u5740\u5199\uff1a ws://127.0.0.1:20001/?type=foo \uff0c\u8fd9\u65f6\u4f20\u5165\u7684\u8fde\u63a5\u5c31\u662f foo \u7c7b\u578b\u3002 Header \u4f20\u9012\uff0c\u7528\u6237\u9700\u8981\u5728\u5efa\u7acb\u8fde\u63a5\u65f6\u6307\u5b9a HTTP \u7684\u5934\u90e8\u4fe1\u606f X-Client-Role \uff0c\u4f8b\u5982 X-Client-Role: foo \uff0c\u8fd9\u65f6\u4f20\u5165\u7684\u8fde\u63a5\u5c31\u662f foo \u7c7b\u578b\u3002 \u4ee5\u4e0a\u4e24\u79cd\u65b9\u5f0f\uff0c Header \u65b9\u5f0f\u6bd4 GET \u65b9\u5f0f\u4f18\u5148\u7ea7\u8981\u9ad8\uff0c\u5982\u679c\u4e24\u8005\u5747\u6ca1\u6709\u6307\u5b9a\uff0c\u6846\u67b6\u4f1a\u5c06\u6b64\u8fde\u63a5\u5f53\u4f5c default \u7c7b\u578b\u63a5\u5165\u3002 \u63d0\u793a \u5bf9\u4e8e\u5bf9\u63a5 OneBot \u6807\u51c6\u7684\u673a\u5668\u4eba\u5ba2\u6237\u7aef\uff0c\u53ea\u8981\u7b26\u5408 OneBot \u6807\u51c6\uff0c\u5373 X-Client-Role \u4f1a\u81ea\u52a8\u5e26\u4e0a universal \u3001 qq \u7b49\u5b57\u6837\uff0c\u5c31\u4f1a\u81ea\u52a8\u6807\u8bb0\u4e3a qq \u7c7b\u578b\u3002 \u903b\u8f91\u7f16\u5199 \u4f20\u5165\u8fde\u63a5\u540e\uff0c\u6211\u4eec\u5c31\u80fd\u901a\u8fc7\u6ce8\u89e3\u4e8b\u4ef6\u7ed1\u5b9a\u6765\u505a\u6211\u4eec\u81ea\u5df1\u60f3\u505a\u7684\u4e8b\u60c5\u4e86\uff01\u6bd4\u5982\u4e0b\u65b9\u662f\u4f20\u5165\u7c7b\u578b\u4e3a foo \u8fde\u63a5\u8981\u505a\u7684\u4e8b\u60c5 1 2 3 4 5 6 7 8 9 10 11 12 <?php namespace Module\\Example ; use ZM\\Annotation\\Swoole\\OnOpenEvent ; use ZM\\Console\\Console ; use ZM\\ConnectionManager\\ConnectionObject ; class Hello { /** * @OnOpenEvent(\"foo\") */ public function onFooConnect ( ConnectionObject $conn ) { Console :: info ( $conn -> getName () . \" \u5df2\u8fde\u63a5\uff01\" ); } \u4ee5\u4e0a\u4f5c\u7528\u5c31\u662f\u5728\u7ec8\u7aef\u8f93\u51fa foo \u5df2\u8fde\u63a5\uff01 \u8fd9\u4e2a\u63d0\u793a\u7684\u3002\u5173\u4e8e ConnectionObject \u5bf9\u8c61\uff0c\u89c1\u4e0b\u65b9\u3002 WS \u8fde\u63a5\u5bf9\u8c61 \u5bf9\u4e8e\u6bcf\u4e00\u4e2a WebSocket \u8fde\u63a5\uff0c\u6846\u67b6\u5185\u90fd\u6709\u4e00\u4e2a\u4e13\u5c5e\u7684\u64cd\u4f5c\u7c7b\uff0c\u6709\u83b7\u53d6\u7c7b\u578b\u540d\u79f0\u3001\u4fdd\u5b58\u94fe\u63a5\u53c2\u6570\u548c\u5c5e\u6027\u4ee5\u53ca\u83b7\u53d6\u6587\u4ef6\u6807\u8bc6\u7b26\u7b49\u529f\u80fd\u3002 getFd() \u83b7\u53d6\u6587\u4ef6\u6807\u793a\u7b26\uff0c\u7528\u4e8e\u53d1\u9001\u6d88\u606f\u3001\u63a5\u6536\u6d88\u606f\u7b49\u3002\u8fd9\u4e2a\u53c2\u6570\u83b7\u53d6\u7684 fd \u662f Swoole \u6307\u5b9a\u7684\uff0c\u7528\u4e8e\u53d1\u9001\u4fe1\u606f\u7b49\u3002 1 2 $fd = $conn->getFd(); server()->send($fd, \"hello world\"); WebSocket \u662f\u5168\u53cc\u5de5\u7684\uff0c\u6240\u4ee5\u53d1\u9001\u548c\u63a5\u6536\u5176\u5b9e\u662f\u4e92\u4e0d\u5e72\u6270\u7684\uff0c\u4f60\u53ef\u4ee5\u4e0d\u4ec5\u4ec5\u5728 WebSocket \u76f8\u5173\u7684\u4e0a\u4e0b\u6587\u4e2d\uff0c\u8fd8\u53ef\u4ee5\u6bd4\u5982\u5728 HTTP \u6216\u8005\u673a\u5668\u4eba\u4e0a\u4e0b\u6587\u4e2d\u7ed9\u522b\u7684 WebSocket \u5ba2\u6237\u7aef\u53d1\u8bf7\u6c42\u3002 getName() \u83b7\u53d6\u8fde\u63a5\u5bf9\u8c61\u7ed1\u5b9a\u7684\u8fde\u63a5\u7c7b\u578b\uff0c\u4f8b\u5982\u4e0a\u65b9\u63d0\u5230\u7684 foo \u3001 default \u7b49\u3002 1 Console::info(\"\u5f53\u524d\u8fde\u63a5\u7c7b\u578b\uff1a\".$conn->getName()); //\u5f53\u524d\u8fde\u63a5\u7c7b\u578b\uff1afoo setName() \u6539\u53d8\u8fde\u63a5\u5bf9\u8c61\u7ed1\u5b9a\u7684\u8fde\u63a5\u7c7b\u578b\uff0c\u4f8b\u5982\u4ece foo \u6539\u4e3a bar \u3002 1 2 3 $s = $conn->getName(); // foo $conn->setName(\"bar\"); $s = $conn->getName(); // bar getOptions() \u83b7\u53d6\u6b64\u8fde\u63a5\u5b58\u50a8\u7684\u6240\u6709\u53c2\u6570\uff0c\u4ee5\u6570\u7ec4\u5f62\u5f0f\u3002\u5b58\u50a8\u5185\u5bb9\u89c1\u4e0b\u65b9 setOption() \u3002 \u683c\u5f0f\uff1a [\"\u53c2\u65701\" => {\u53c2\u65701\u7684\u503c}, \"\u53c2\u65702\" => {\u53c2\u65702\u7684\u503c}] getOption() \u83b7\u53d6\u6b64\u8fde\u63a5\u5b58\u50a8\u7684\u53c2\u6570\uff0c\u83b7\u53d6\u6307\u5b9a\u540d\u79f0\u7684\uff0c\u6b64\u65b9\u6cd5\u62e5\u6709\u4e00\u4e2a\u53c2\u6570 $key \uff0c\u6307\u5b9a\u5373\u53ef\u83b7\u53d6\u3002 \u5982\u679c\u6ca1\u6709\u5bf9\u5e94\u53c2\u6570\uff0c\u5219\u8fd4\u56de null \u3002 \u6211\u4eec\u5728\u524d\u9762\u7684\u673a\u5668\u4eba\u90e8\u5206\u77e5\u9053\uff0c\u6846\u67b6\u4e3b\u8981\u662f\u7528\u4e8e\u673a\u5668\u4eba\u7684\u8fde\u63a5\uff0c\u90a3\u4e48\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u5728\u8fde\u63a5\u540e\uff0c\u6bd4\u5982\u6211\u4eec\u60f3\u77e5\u9053\u8fd9\u4e2a\u673a\u5668\u4eba\u7684 WS \u8fde\u63a5\u5bf9\u5e94\u7684\u662f\u54ea\u4e2a QQ \u53f7\u7684\u673a\u5668\u4eba\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528 getOption(\"connect_id\") \u6765\u83b7\u53d6\u3002\u8fd9\u4e2a connect_id \u662f OneBot \u6807\u51c6\u7684\u5ba2\u6237\u7aef\u63a5\u5165\u540e\u81ea\u52a8\u586b\u5165\u7684\u4e00\u4e2a\u53c2\u6570\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u60f3\u5728\u673a\u5668\u4eba\u63a5\u5165\u540e\u6253\u51fa\u63a5\u5165\u673a\u5668\u4eba\u7684 QQ \u53f7\uff1a 1 2 3 4 5 6 /** * @OnOpenEvent(\"qq\") */ public function onQQConnect($conn) { Console::success(\"\u673a\u5668\u4eba \".$conn->getOption(\"connect_id\").\" \u5df2\u8fde\u63a5\uff01\"); // \u673a\u5668\u4eba 123456 \u5df2\u8fde\u63a5\uff01 } setOption() \u8bbe\u7f6e\u8fde\u63a5\u5b58\u50a8\u7684\u53c2\u6570\u3002\u53c2\u6570\uff1a setOption($key, $value) \u3002 $key \u9650\u5b9a\u4e3a connect_id \u4e00\u79cd\u3002\uff08\u56e0\u4e3a\u76ee\u524d\u6709\u4e86 LightCache\uff0c\u6240\u4ee5\u8fd9\u91cc\u6682\u65f6\u4e0d\u63d0\u4f9b\u522b\u7684 key \u8bbe\u5b9a\uff09 1 $conn->setOption(\"connect_id\", \"asdasdasd\"); // $value \u6700\u957f\u957f\u5ea6\u4e3a 29 \u53d1\u9001\u5230 WebSocket \u5ba2\u6237\u7aef \u5f88\u7b80\u5355\uff0c\u4ece\u4e0a\u9762\u83b7\u53d6\u5230 fd \u540e\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u5f0f\u5c31\u53ef\u4ee5\u4e86\uff5e 1 server()->push($conn->getFd(), \"hello\"); // \u7b2c\u4e8c\u4e2a\u4e3a string \u7c7b\u578b\u7684\u53c2\u6570 \u4ece\u5ba2\u6237\u7aef\u63a5\u6536 \u63a5\u6536\u6d88\u606f\u5fc5\u987b\u4ece @OnMessageEvent \u6ce8\u89e3\u4e8b\u4ef6\u4e0b\u63a5\u6536\uff0c\u4f7f\u7528\u4e0a\u4e0b\u6587 ctx()->getFrame() \u83b7\u53d6\u6d88\u606f\u5e27\u3002 \u4ece\u8fd9\u91cc\u83b7\u53d6\u7684 Frame \u5bf9\u8c61\uff0c\u89c1 Swoole \u6587\u6863 - Frame \u3002 Frame \u5bf9\u8c61\u6709\u56db\u4e2a\u53c2\u6570\uff1a $frame->fd \uff1a\u83b7\u53d6\u53d1\u6765\u5e27\u7684 fd $frame->data \uff1a\u6570\u636e\u672c\u4f53 $frame->opcode \uff1a\u6570\u636e\u7c7b\u578b int \u503c\uff0c\u89c1 Swoole \u6587\u6863 - \u6570\u636e\u5e27\u7c7b\u578b $frame->finish \uff1a\u662f\u5426\u53d1\u9001\u5b8c\u6bd5\uff0cbool \u4e0b\u9762\u4ee5\u63a5\u6536\u4e00\u4e2a json \u5b57\u7b26\u4e32\u4e3a\u4f8b\uff0c\u5e76\u8fdb\u884c\u540e\u7eed\u7684\u89e3\u6790\uff1a 1 2 3 4 5 6 7 8 9 /** * @OnMessageEvent(\"foo\") */ public function onMessage() { $frame = ctx()->getFrame(); $json_str = $frame->data; // \u5047\u8bbe\u4f20\u5165\u7684\u662f {\"key1\":\"value1\",\"k2\":\"v2\"} $json = json_decode($json_str, true); Console::info(\"key1 \u7684\u503c\u662f:\" . $json[\"key1\"]); } \u5173\u95ed\u8fde\u63a5 1 server()->close($conn->getFd());","title":"\u63a5\u5165 WebSocket \u5ba2\u6237\u7aef"},{"location":"advanced/connect-ws-client/#websocket","text":"\u70b8\u6bdb\u6846\u67b6\u5176\u5b9e\u4ece\u672c\u8d28\u4e0a\u8bb2\uff0c\u5c31\u662f\u4e00\u4e2a HTTP + WebSocket \u670d\u52a1\u5668\uff0c\u6240\u4ee5\u6846\u67b6\u4e5f\u652f\u6301\u5bf9\u63a5\u5176\u4ed6\u4efb\u4f55 HTTP \u5ba2\u6237\u7aef\u548c WebSocket \u5ba2\u6237\u7aef\uff0c\u5b9e\u9645\u4e0a\u70b8\u6bdb\u6846\u67b6\u975e\u5e38\u9002\u5408\u7528 WebSocket \u505a\u5728\u7ebf\u7684 IM \u804a\u5929\u901a\u8baf\uff0c\u4e5f\u53ef\u4ee5\u65b9\u4fbf\u5730\u8fdb\u884c WS \u901a\u4fe1\u3002\u8fd9\u91cc\u4e3b\u8981\u8bf4\u660e\u5982\u4f55\u5bf9\u63a5\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 WebSocket \u5ba2\u6237\u7aef\u3002","title":"\u63a5\u5165 WebSocket \u5ba2\u6237\u7aef"},{"location":"advanced/connect-ws-client/#_1","text":"\u7531\u4e8e WebSocket \u8fde\u63a5\u90fd\u5177\u6709\u540c\u6837\u7684\u6027\u8d28\uff0c\u6ca1\u6709\u72b6\u6001\uff0c\u6240\u4ee5\u5728\u5efa\u7acb WebSocket \u8fde\u63a5\u7684\u65f6\u5019\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u8868\u660e\u81ea\u5df1\u7684\u8eab\u4efd\u548c\u7c7b\u578b\u3002\u6307\u5b9a\u5ba2\u6237\u7aef\u8fde\u63a5\u7c7b\u578b\u7684\u65b9\u5f0f\u6709\u4e24\u79cd\uff1a GET \u53c2\u6570\u4f20\u9012\uff0c\u5728\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u52a0\u4e0a GET \u53c2\u6570 type \u5373\u53ef\u3002\u6bd4\u5982 js \u4e2d WebSocket \u5efa\u7acb\u65f6\u5730\u5740\u5199\uff1a ws://127.0.0.1:20001/?type=foo \uff0c\u8fd9\u65f6\u4f20\u5165\u7684\u8fde\u63a5\u5c31\u662f foo \u7c7b\u578b\u3002 Header \u4f20\u9012\uff0c\u7528\u6237\u9700\u8981\u5728\u5efa\u7acb\u8fde\u63a5\u65f6\u6307\u5b9a HTTP \u7684\u5934\u90e8\u4fe1\u606f X-Client-Role \uff0c\u4f8b\u5982 X-Client-Role: foo \uff0c\u8fd9\u65f6\u4f20\u5165\u7684\u8fde\u63a5\u5c31\u662f foo \u7c7b\u578b\u3002 \u4ee5\u4e0a\u4e24\u79cd\u65b9\u5f0f\uff0c Header \u65b9\u5f0f\u6bd4 GET \u65b9\u5f0f\u4f18\u5148\u7ea7\u8981\u9ad8\uff0c\u5982\u679c\u4e24\u8005\u5747\u6ca1\u6709\u6307\u5b9a\uff0c\u6846\u67b6\u4f1a\u5c06\u6b64\u8fde\u63a5\u5f53\u4f5c default \u7c7b\u578b\u63a5\u5165\u3002 \u63d0\u793a \u5bf9\u4e8e\u5bf9\u63a5 OneBot \u6807\u51c6\u7684\u673a\u5668\u4eba\u5ba2\u6237\u7aef\uff0c\u53ea\u8981\u7b26\u5408 OneBot \u6807\u51c6\uff0c\u5373 X-Client-Role \u4f1a\u81ea\u52a8\u5e26\u4e0a universal \u3001 qq \u7b49\u5b57\u6837\uff0c\u5c31\u4f1a\u81ea\u52a8\u6807\u8bb0\u4e3a qq \u7c7b\u578b\u3002","title":"\u7c7b\u578b\u6307\u5b9a"},{"location":"advanced/connect-ws-client/#_2","text":"\u4f20\u5165\u8fde\u63a5\u540e\uff0c\u6211\u4eec\u5c31\u80fd\u901a\u8fc7\u6ce8\u89e3\u4e8b\u4ef6\u7ed1\u5b9a\u6765\u505a\u6211\u4eec\u81ea\u5df1\u60f3\u505a\u7684\u4e8b\u60c5\u4e86\uff01\u6bd4\u5982\u4e0b\u65b9\u662f\u4f20\u5165\u7c7b\u578b\u4e3a foo \u8fde\u63a5\u8981\u505a\u7684\u4e8b\u60c5 1 2 3 4 5 6 7 8 9 10 11 12 <?php namespace Module\\Example ; use ZM\\Annotation\\Swoole\\OnOpenEvent ; use ZM\\Console\\Console ; use ZM\\ConnectionManager\\ConnectionObject ; class Hello { /** * @OnOpenEvent(\"foo\") */ public function onFooConnect ( ConnectionObject $conn ) { Console :: info ( $conn -> getName () . \" \u5df2\u8fde\u63a5\uff01\" ); } \u4ee5\u4e0a\u4f5c\u7528\u5c31\u662f\u5728\u7ec8\u7aef\u8f93\u51fa foo \u5df2\u8fde\u63a5\uff01 \u8fd9\u4e2a\u63d0\u793a\u7684\u3002\u5173\u4e8e ConnectionObject \u5bf9\u8c61\uff0c\u89c1\u4e0b\u65b9\u3002","title":"\u903b\u8f91\u7f16\u5199"},{"location":"advanced/connect-ws-client/#ws","text":"\u5bf9\u4e8e\u6bcf\u4e00\u4e2a WebSocket \u8fde\u63a5\uff0c\u6846\u67b6\u5185\u90fd\u6709\u4e00\u4e2a\u4e13\u5c5e\u7684\u64cd\u4f5c\u7c7b\uff0c\u6709\u83b7\u53d6\u7c7b\u578b\u540d\u79f0\u3001\u4fdd\u5b58\u94fe\u63a5\u53c2\u6570\u548c\u5c5e\u6027\u4ee5\u53ca\u83b7\u53d6\u6587\u4ef6\u6807\u8bc6\u7b26\u7b49\u529f\u80fd\u3002","title":"WS \u8fde\u63a5\u5bf9\u8c61"},{"location":"advanced/connect-ws-client/#getfd","text":"\u83b7\u53d6\u6587\u4ef6\u6807\u793a\u7b26\uff0c\u7528\u4e8e\u53d1\u9001\u6d88\u606f\u3001\u63a5\u6536\u6d88\u606f\u7b49\u3002\u8fd9\u4e2a\u53c2\u6570\u83b7\u53d6\u7684 fd \u662f Swoole \u6307\u5b9a\u7684\uff0c\u7528\u4e8e\u53d1\u9001\u4fe1\u606f\u7b49\u3002 1 2 $fd = $conn->getFd(); server()->send($fd, \"hello world\"); WebSocket \u662f\u5168\u53cc\u5de5\u7684\uff0c\u6240\u4ee5\u53d1\u9001\u548c\u63a5\u6536\u5176\u5b9e\u662f\u4e92\u4e0d\u5e72\u6270\u7684\uff0c\u4f60\u53ef\u4ee5\u4e0d\u4ec5\u4ec5\u5728 WebSocket \u76f8\u5173\u7684\u4e0a\u4e0b\u6587\u4e2d\uff0c\u8fd8\u53ef\u4ee5\u6bd4\u5982\u5728 HTTP \u6216\u8005\u673a\u5668\u4eba\u4e0a\u4e0b\u6587\u4e2d\u7ed9\u522b\u7684 WebSocket \u5ba2\u6237\u7aef\u53d1\u8bf7\u6c42\u3002","title":"getFd()"},{"location":"advanced/connect-ws-client/#getname","text":"\u83b7\u53d6\u8fde\u63a5\u5bf9\u8c61\u7ed1\u5b9a\u7684\u8fde\u63a5\u7c7b\u578b\uff0c\u4f8b\u5982\u4e0a\u65b9\u63d0\u5230\u7684 foo \u3001 default \u7b49\u3002 1 Console::info(\"\u5f53\u524d\u8fde\u63a5\u7c7b\u578b\uff1a\".$conn->getName()); //\u5f53\u524d\u8fde\u63a5\u7c7b\u578b\uff1afoo","title":"getName()"},{"location":"advanced/connect-ws-client/#setname","text":"\u6539\u53d8\u8fde\u63a5\u5bf9\u8c61\u7ed1\u5b9a\u7684\u8fde\u63a5\u7c7b\u578b\uff0c\u4f8b\u5982\u4ece foo \u6539\u4e3a bar \u3002 1 2 3 $s = $conn->getName(); // foo $conn->setName(\"bar\"); $s = $conn->getName(); // bar","title":"setName()"},{"location":"advanced/connect-ws-client/#getoptions","text":"\u83b7\u53d6\u6b64\u8fde\u63a5\u5b58\u50a8\u7684\u6240\u6709\u53c2\u6570\uff0c\u4ee5\u6570\u7ec4\u5f62\u5f0f\u3002\u5b58\u50a8\u5185\u5bb9\u89c1\u4e0b\u65b9 setOption() \u3002 \u683c\u5f0f\uff1a [\"\u53c2\u65701\" => {\u53c2\u65701\u7684\u503c}, \"\u53c2\u65702\" => {\u53c2\u65702\u7684\u503c}]","title":"getOptions()"},{"location":"advanced/connect-ws-client/#getoption","text":"\u83b7\u53d6\u6b64\u8fde\u63a5\u5b58\u50a8\u7684\u53c2\u6570\uff0c\u83b7\u53d6\u6307\u5b9a\u540d\u79f0\u7684\uff0c\u6b64\u65b9\u6cd5\u62e5\u6709\u4e00\u4e2a\u53c2\u6570 $key \uff0c\u6307\u5b9a\u5373\u53ef\u83b7\u53d6\u3002 \u5982\u679c\u6ca1\u6709\u5bf9\u5e94\u53c2\u6570\uff0c\u5219\u8fd4\u56de null \u3002 \u6211\u4eec\u5728\u524d\u9762\u7684\u673a\u5668\u4eba\u90e8\u5206\u77e5\u9053\uff0c\u6846\u67b6\u4e3b\u8981\u662f\u7528\u4e8e\u673a\u5668\u4eba\u7684\u8fde\u63a5\uff0c\u90a3\u4e48\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u5728\u8fde\u63a5\u540e\uff0c\u6bd4\u5982\u6211\u4eec\u60f3\u77e5\u9053\u8fd9\u4e2a\u673a\u5668\u4eba\u7684 WS \u8fde\u63a5\u5bf9\u5e94\u7684\u662f\u54ea\u4e2a QQ \u53f7\u7684\u673a\u5668\u4eba\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u7528 getOption(\"connect_id\") \u6765\u83b7\u53d6\u3002\u8fd9\u4e2a connect_id \u662f OneBot \u6807\u51c6\u7684\u5ba2\u6237\u7aef\u63a5\u5165\u540e\u81ea\u52a8\u586b\u5165\u7684\u4e00\u4e2a\u53c2\u6570\u3002\u4f8b\u5982\uff0c\u6211\u4eec\u60f3\u5728\u673a\u5668\u4eba\u63a5\u5165\u540e\u6253\u51fa\u63a5\u5165\u673a\u5668\u4eba\u7684 QQ \u53f7\uff1a 1 2 3 4 5 6 /** * @OnOpenEvent(\"qq\") */ public function onQQConnect($conn) { Console::success(\"\u673a\u5668\u4eba \".$conn->getOption(\"connect_id\").\" \u5df2\u8fde\u63a5\uff01\"); // \u673a\u5668\u4eba 123456 \u5df2\u8fde\u63a5\uff01 }","title":"getOption()"},{"location":"advanced/connect-ws-client/#setoption","text":"\u8bbe\u7f6e\u8fde\u63a5\u5b58\u50a8\u7684\u53c2\u6570\u3002\u53c2\u6570\uff1a setOption($key, $value) \u3002 $key \u9650\u5b9a\u4e3a connect_id \u4e00\u79cd\u3002\uff08\u56e0\u4e3a\u76ee\u524d\u6709\u4e86 LightCache\uff0c\u6240\u4ee5\u8fd9\u91cc\u6682\u65f6\u4e0d\u63d0\u4f9b\u522b\u7684 key \u8bbe\u5b9a\uff09 1 $conn->setOption(\"connect_id\", \"asdasdasd\"); // $value \u6700\u957f\u957f\u5ea6\u4e3a 29","title":"setOption()"},{"location":"advanced/connect-ws-client/#websocket_1","text":"\u5f88\u7b80\u5355\uff0c\u4ece\u4e0a\u9762\u83b7\u53d6\u5230 fd \u540e\u4f7f\u7528\u4e0b\u9762\u7684\u65b9\u5f0f\u5c31\u53ef\u4ee5\u4e86\uff5e 1 server()->push($conn->getFd(), \"hello\"); // \u7b2c\u4e8c\u4e2a\u4e3a string \u7c7b\u578b\u7684\u53c2\u6570","title":"\u53d1\u9001\u5230 WebSocket \u5ba2\u6237\u7aef"},{"location":"advanced/connect-ws-client/#_3","text":"\u63a5\u6536\u6d88\u606f\u5fc5\u987b\u4ece @OnMessageEvent \u6ce8\u89e3\u4e8b\u4ef6\u4e0b\u63a5\u6536\uff0c\u4f7f\u7528\u4e0a\u4e0b\u6587 ctx()->getFrame() \u83b7\u53d6\u6d88\u606f\u5e27\u3002 \u4ece\u8fd9\u91cc\u83b7\u53d6\u7684 Frame \u5bf9\u8c61\uff0c\u89c1 Swoole \u6587\u6863 - Frame \u3002 Frame \u5bf9\u8c61\u6709\u56db\u4e2a\u53c2\u6570\uff1a $frame->fd \uff1a\u83b7\u53d6\u53d1\u6765\u5e27\u7684 fd $frame->data \uff1a\u6570\u636e\u672c\u4f53 $frame->opcode \uff1a\u6570\u636e\u7c7b\u578b int \u503c\uff0c\u89c1 Swoole \u6587\u6863 - \u6570\u636e\u5e27\u7c7b\u578b $frame->finish \uff1a\u662f\u5426\u53d1\u9001\u5b8c\u6bd5\uff0cbool \u4e0b\u9762\u4ee5\u63a5\u6536\u4e00\u4e2a json \u5b57\u7b26\u4e32\u4e3a\u4f8b\uff0c\u5e76\u8fdb\u884c\u540e\u7eed\u7684\u89e3\u6790\uff1a 1 2 3 4 5 6 7 8 9 /** * @OnMessageEvent(\"foo\") */ public function onMessage() { $frame = ctx()->getFrame(); $json_str = $frame->data; // \u5047\u8bbe\u4f20\u5165\u7684\u662f {\"key1\":\"value1\",\"k2\":\"v2\"} $json = json_decode($json_str, true); Console::info(\"key1 \u7684\u503c\u662f:\" . $json[\"key1\"]); }","title":"\u4ece\u5ba2\u6237\u7aef\u63a5\u6536"},{"location":"advanced/connect-ws-client/#_4","text":"1 server()->close($conn->getFd());","title":"\u5173\u95ed\u8fde\u63a5"},{"location":"advanced/custom-start/","text":"\u6846\u67b6\u9ad8\u7ea7\u542f\u52a8 \u6846\u67b6\u4e0b\u8f7d\u65b9\u5f0f \u4ece\u524d\u9762\u7684\u51e0\u7ae0\u4e2d\uff0c\u6211\u4eec\u4e86\u89e3\u5230\u6846\u67b6\u6709\u591a\u79cd\u4e0b\u8f7d\u5230\u672c\u5730\u7684\u65b9\u5f0f\u3002 Composer \u4f9d\u8d56\u6a21\u5f0f Starter \u4ece\u6a21\u677f\u521b\u5efa\u6a21\u5f0f \u6e90\u7801\u6a21\u5f0f Composer \u4f9d\u8d56\u6a21\u5f0f \u4ece Composer \u4f9d\u8d56\u52a0\u8f7d\u6846\u67b6\u662f\u4e00\u79cd\u62c9\u53d6\u6846\u67b6\u7684\u65b9\u5f0f\uff0c\u8fd9\u79cd\u65b9\u5f0f\u7684\u4f18\u70b9\u5728\u4e8e\uff0c\u4f60\u53ef\u4ee5\u76f4\u89c2\u5730\u611f\u53d7\u5230\u662f\u5982\u4f55\u4f7f\u7528\u6846\u67b6\u4ece\u96f6\u5f00\u59cb\u4e00\u4e2a\u5b8c\u6574\u7684\u9879\u76ee\u7684\u8fc7\u7a0b\u3002 \u4ece Composer \u4f9d\u8d56\u7684\u542f\u52a8\u6b65\u9aa4\uff1a 1 2 3 4 5 6 7 8 9 mkdir my-bot # \u65b0\u5efa\u4e00\u4e2a\u7a7a\u7684\u6587\u4ef6\u5939 cd my-bot/ composer require zhamao/framework # \u4ece composer \u62c9\u53d6\u540e\u4f1a\u81ea\u52a8\u90e8\u7f72 autoload \u548c composer.json \u7b49\u5185\u5bb9 # \u4f7f\u7528\u547d\u4ee4\u521d\u59cb\u5316\u6846\u67b6 vendor/bin/start init # \u542f\u52a8\u6846\u67b6 vendor/bin/start server \u6ce8\u610f\uff1a\u4f7f\u7528 init \u547d\u4ee4\u65f6\uff0c\u4f1a\u7ed9\u5f53\u524d\u76ee\u5f55\u89e3\u538b\u4ee5\u4e0b\u6587\u4ef6\uff1a 1 2 3 4 5 6 7 8 9 10 $extract_files = [ \"/config/global.php\", // \u5168\u5c40\u914d\u7f6e\u6587\u4ef6 \"/.gitignore\", // git \u6392\u9664\u6587\u4ef6 \"/config/file_header.json\", // HTTP \u6587\u4ef6\u5934 \"/config/console_color.json\", // \u7ec8\u7aef\u989c\u8272\u4e3b\u9898\u6587\u4ef6 \"/config/motd.txt\", // \u6846\u67b6\u542f\u52a8\u65f6\u81ea\u5b9a\u4e49\u7684 motd \"/src/Module/Example/Hello.php\", // \u6846\u67b6\u81ea\u5e26\u7684\u793a\u4f8b\u6a21\u5757 \"/src/Module/Middleware/TimerMiddleware.php\", // \u6846\u67b6\u81ea\u5e26\u7684\u51fd\u6570\u8fd0\u884c\u65f6\u95f4\u76d1\u63a7\u4e2d\u95f4\u4ef6 \"/src/Custom/global_function.php\" // \u7528\u6237\u53ef\u5728\u8fd9\u91cc\u81ea\u5b9a\u4e49\u7f16\u5199\u81ea\u5df1\u7684\u5168\u5c40\u51fd\u6570 ]; \u7ecf\u8fc7 init \u89e3\u538b\u8fd9\u4e9b\u6587\u4ef6\u540e\uff0c\u4f60\u7684\u6846\u67b6\u5c31\u80fd\u6b63\u5e38\u8fd0\u884c\u4e14\u5f00\u59cb\u7f16\u5199\u4ee3\u7801\u4e86\uff01 Starter \u6a21\u677f\u6a21\u5f0f \u4ece\u6a21\u677f\u65b0\u5efa\u5176\u5b9e\u539f\u7406\u548c Composer \u4f9d\u8d56\u6a21\u5f0f\u5b8c\u5168\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u4f7f\u7528\u6a21\u677f\u4ed3\u5e93\u65b0\u5efa\u7684\u9879\u76ee\uff0c\u4f7f\u7528 Composer \u81ea\u5e26\u7684 create-project \u65b9\u5f0f\u521b\u5efa\u7684\u3002starter \u4e5f\u662f\u4e00\u4e2a GitHub \u9879\u76ee\uff0c\u89c1 \u5730\u5740 \u3002 1 2 3 composer create-project zhamao/framework-starter my-bot/ # my-bot \u662f\u4f60\u81ea\u5b9a\u4e49\u7684\u6587\u4ef6\u5939\u540d\u79f0\uff0c\u548c\u4e0a\u65b9\u76f8\u540c cd my-bot vendor/bin/start server # \u542f\u52a8\u6846\u67b6 Starter \u6a21\u5f0f\u76f8\u5f53\u4e8e\u76f4\u63a5\u4ece GitHub \u62c9\u53d6 zhamao-framework-starter \u9879\u76ee\uff0c\u7136\u540e\u6267\u884c composer update \u3002 \u90a3\u548c Composer \u4f9d\u8d56\u6a21\u5f0f\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f\u6ca1\u533a\u522b\uff01\u6784\u5efa\u51fa\u6765\u7684\u6846\u67b6\u548c\u6587\u4ef6\u662f\u4e00\u6a21\u4e00\u6837\u7684\uff01\u4f7f\u7528 Composer \u4f9d\u8d56\u6a21\u5f0f\uff0c\u4f7f\u7528 init \u547d\u4ee4\u540e\uff0c\u6587\u4ef6\u4f1a\u548c zhamao-framework-starter \u4ed3\u5e93\u62c9\u53d6\u56de\u6765\u7684\u6a21\u677f\u4e00\u6a21\u4e00\u6837\uff01\uff08\u6216\u8005\u6362\u53e5\u8bdd\u8bf4\uff0c\u8fd9\u4e2a\u4ed3\u5e93\u5c31\u662f\u4f7f\u7528 init \u547d\u4ee4\u751f\u6210\u7684\u6587\u4ef6\u7684\uff09 \u90a3\u4f7f\u7528\u54ea\u79cd\u597d\u5462\uff1f\u770b\u4f60\u81ea\u5df1\uff01\u5982\u679c\u4f60\u60f3\u7ed9\u4f60\u81ea\u5df1\u7684\u5df2\u6709\u9879\u76ee\u5957\u4e0a\u70b8\u6bdb\u6846\u67b6\uff0c\u90a3\u4e48\u5c31\u63a8\u8350\u4f7f\u7528 Composer \u4f9d\u8d56\u6a21\u5f0f\uff0c\u5982\u679c\u662f\u4ece 0 \u5f00\u59cb\u7f16\u5199\u6846\u67b6\u6a21\u5757\uff0c\u5219\u63a8\u8350\u4f7f\u7528\u6a21\u677f\u6a21\u5f0f\u3002 \u6e90\u7801\u6a21\u5f0f \u6e90\u7801\u6a21\u5f0f\u548c\u4ee5\u4e0a\u4e24\u79cd\u65b9\u6848\u90fd\u4e0d\u4e00\u6837\uff0c\u6e90\u7801\u6a21\u5f0f\u5141\u8bb8\u4f60\u5bf9\u6846\u67b6\u672c\u8eab\u8fdb\u884c\u4e00\u7cfb\u5217\u4fee\u6539\uff0c\u6846\u67b6\u672c\u4f53\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\u3002 Composer \u4f9d\u8d56\u6a21\u5f0f\uff08\u4ee5\u53ca\u6a21\u677f\u6a21\u5f0f\uff09\u548c\u6e90\u7801\u6a21\u5f0f\u7684\u533a\u522b\u662f\uff1a \u4f9d\u8d56\u6a21\u5f0f\u548c\u6a21\u677f\u6a21\u5f0f\u662f\u901a\u8fc7 library \u65b9\u5f0f\u5f15\u5165\u6846\u67b6\u7684\uff0c\u6846\u67b6\u672c\u8eab\u4f1a\u653e\u5728 composer \u7684 vendor/ \u76ee\u5f55\u4e0b\uff0c\u4ece composer \u5f15\u5165\u7684 library \u76f8\u5f53\u4e8e\u5b50\u96c6\uff0cvendor \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u6700\u597d\u4e0d\u8981\u624b\u52a8\u4fee\u6539\uff08\u5e94\u8be5\u90fd\u77e5\u9053\u5427\uff09\uff0c\u6240\u4ee5\u6846\u67b6\u672c\u8eab\u4e5f\u53ea\u662f\u52a0\u8f7d\u4e86\u8fdb\u6765\u3002 \u6e90\u7801\u6a21\u5f0f\u76f8\u5f53\u4e8e\u76f4\u63a5\u4ece\u6846\u67b6\u6e90\u7801\u76ee\u5f55\u8fd0\u884c\u6846\u67b6\u548c\u6a21\u5757\uff0c\u6846\u67b6\u6e90\u7801\u90fd\u5728 src/ZM \u76ee\u5f55\u4e0b\uff0c\u9ed8\u8ba4\u7684\u793a\u4f8b\u6a21\u5757\u90fd\u5728 src/Module \u4e0b\uff0c\u662f\u540c\u7ea7\u76ee\u5f55\u3002\u800c\u6b64\u65f6\u7684 vendor/ \u76ee\u5f55\u53ea\u5305\u542b\u4e86\u6846\u67b6\u4f9d\u8d56\u7684\u5916\u90e8\u7ec4\u4ef6\uff0c\u4f8b\u5982\u6ce8\u89e3\u89e3\u6790\u5668\u548c psysh \u7b49\u3002 \u6e90\u7801\u6a21\u5f0f\u53ef\u4ee5\u65b9\u4fbf\u5730\u8c03\u8bd5\u548c\u4fee\u6539\u6846\u67b6\u672c\u8eab\uff0c\u62c9\u53d6\u65b9\u5f0f\u5f88\u7b80\u5355\uff0c\u7528 git clone \u6216\u4ece GitHub \u4e0b\u8f7d\u6700\u65b0\u7248\u7684\u6e90\u7801\u5305\u89e3\u538b\u5373\u53ef\u3002 1 2 3 4 5 git clone https://github.com/zhamao-robot/zhamao-framework.git cd zhamao-framework/ bin/start server # \u7b2c\u4e00\u6b21\u8fd0\u884c\u65f6\u4f1a\u63d0\u793a\u4e00\u4e2a\u201c\u6846\u67b6\u6e90\u7801\u6a21\u5f0f\u9700\u8981\u5728autoload\u6587\u4ef6\u4e2d\u6dfb\u52a0Module\u76ee\u5f55\u4e3a\u81ea\u52a8\u52a0\u8f7d\u201d composer update # \u66f4\u65b0 autoload \u6587\u4ef6\uff0c\u5e94\u7528\u521a\u624d\u4e0a\u4e00\u6b65\u6dfb\u52a0\u7684 `src/Module` \u6587\u4ef6\u5939\u4e0b\u7684\u6a21\u5757\u81ea\u52a8\u52a0\u8f7d bin/start server # \u901a\u8fc7\u6e90\u7801\u6a21\u5f0f\u542f\u52a8\u6846\u67b6 \u6846\u67b6\u542f\u52a8\u53c2\u6570 \u6846\u67b6\u542f\u52a8\u65f6\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u6307\u5b9a\u542f\u52a8\u53c2\u6570\u3002 --debug-mode \uff1a\u542f\u7528\u8c03\u8bd5\u6a21\u5f0f\uff0c\u8c03\u8bd5\u6a21\u5f0f\u7684\u4f5c\u7528\u662f\u5173\u95ed\u4e00\u952e\u534f\u7a0b\u5316\u548c\u7ec8\u7aef\u4ea4\u4e92\uff0c\u51cf\u5c11 Swoole \u672c\u8eab\u5bf9\u4ee3\u7801\u903b\u8f91\u7684\u5e72\u6270\uff08\u6bd4\u5982\u6267\u884c shell_exec() \u62a5\u9519\u7684\u8bdd\u53ef\u4ee5\u5f00\u542f\u8fd9\u4e2a\u8fdb\u884c\u8c03\u8bd5\uff09\u3002 --log-{mode} \uff1a\u8bbe\u7f6e log \u7b49\u7ea7\u3002\u652f\u6301 --log-debug \uff0c --log-verbose \uff0c --log-info \uff0c --log-warning \uff0c --log-error \u3002 --log-theme \uff1a\u8bbe\u7f6e\u7ec8\u7aef\u4fe1\u606f\u7684\u4e3b\u9898\u3002\u8fd9\u4e2a\u9009\u9879\u9002\u7528\u4e8e\u591a\u79cd\u7ec8\u7aef\u4fe1\u606f\u663e\u793a\u7684\u517c\u5bb9\uff0c\u4f8b\u5982\u767d\u8272\u7ec8\u7aef\u548c\u4e0d\u652f\u6301\u989c\u8272\u7684\u7ec8\u7aef\u3002\u8be6\u89c1 Console - \u4e3b\u9898\u8bbe\u7f6e \u3002 --disable-coroutine \uff1a\u5173\u95ed\u4e00\u952e\u534f\u7a0b\u5316\u3002 --remote-terminal \uff1a\u5f00\u542f nc \u8fdc\u7a0b\u7ec8\u7aef\uff0c\u914d\u7f6e\u6587\u4ef6\u4f7f\u7528\u5168\u5c40\u4e2d\u7684 remote_terminal \u9879\u3002\u4e5f\u53ef\u4ee5\u5728\u5168\u5c40\u914d\u7f6e\u4e2d\u5e38\u5f00\u542f\uff08status \u8bbe\u7f6e\u4e3a true\uff09\u3002 --daemon \uff1a\u4ee5\u5b88\u62a4\u8fdb\u7a0b\u65b9\u5f0f\u8fd0\u884c\u6846\u67b6\uff0c\u6b64\u53c2\u6570\u5c06\u76f4\u63a5\u5728\u8f93\u51fa motd \u540e\u5c06\u8fdb\u7a0b\u6302\u5230 init \u4e0b\u8fd0\u884c\uff0c\u540e\u53f0\u5e38\u9a7b\u3002 --watch \uff1a\u76d1\u63a7 src/ \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u53d8\u5316\uff0c\u6709\u53d8\u5316\u5219\u81ea\u52a8\u91cd\u65b0\u8f7d\u5165\u4ee3\u7801\u3002\u5f00\u542f\u76d1\u63a7\u9700\u8981\u5b89\u88c5 PHP \u6269\u5c55\uff1ainotify\u3002\u4f7f\u7528 pecl \u5c31\u53ef\u4ee5\u5b89\u88c5\uff1a pecl install inotify \u3002\uff08\u6ce8\uff1a\u4e0d\u652f\u6301 WSL \u548c macOS\uff09 --env \uff1a\u8bbe\u7f6e\u8fd0\u884c\u73af\u5883\uff0c\u8bbe\u7f6e\u8fd0\u884c\u73af\u5883\u540e\u5c06\u4f18\u5148\u52a0\u8f7d\u6307\u5b9a\u73af\u5883\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u652f\u6301 --env=production \uff0c --env=staging \uff0c --env=development \uff0c\u89c1 \u57fa\u672c\u914d\u7f6e \u3002 --worker-num \uff1a\u6307\u5b9a\u8fd0\u884c\u7684\u5de5\u4f5c\u8fdb\u7a0b\u6570\u91cf\uff08\u5e76\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\uff0c\u6846\u67b6\u9ed8\u8ba4\u4e3a CPU \u6838\u5fc3\u6570\uff09\uff0c\u4f8b\u5982 --worker-num=8 \u3002 --task-worker-num \uff1a\u542f\u7528 TaskWorker \u8fdb\u7a0b\u5e76\u6307\u5b9a\u6570\u91cf\u3002 --show-php-ver \uff1a\u5728\u542f\u52a8\u65f6\u663e\u793a Swoole \u548c PHP \u7684\u7248\u672c\u3002 \u5b88\u62a4\u8fdb\u7a0b\u64cd\u4f5c\u547d\u4ee4 \u5b88\u62a4\u8fdb\u7a0b\u5728 2.2.0 \u7248\u672c\u5f00\u59cb\uff0c\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u884c\u5feb\u901f\u64cd\u4f5c\uff0c\u5982\u91cd\u542f\u3001\u505c\u6b62\u3001\u67e5\u770b\u72b6\u6001\u7b49\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u7684\u5b88\u62a4\u8fdb\u7a0b\u64cd\u4f5c\u547d\u4ee4\u662f\u6307 \u4f7f\u7528 --daemon \u65b9\u5f0f\u542f\u52a8\u7684\u6846\u67b6 \uff0c\u5982\u4f7f\u7528 Docker\u3001screen\u3001tmux\u3001systemd \u7b49\u65b9\u5f0f\u6302\u540e\u53f0\u8dd1\u5219\u6b64\u547d\u4ee4\u4e0d\u53ef\u7528\uff01 1 2 3 vendor/bin/start daemon:status # \u67e5\u770b\u5b88\u62a4\u8fdb\u7a0b\u7684\u72b6\u6001 vendor/bin/start daemon:reload # \u91cd\u8f7d\u6846\u67b6 vendor/bin/start daemon:stop # \u505c\u6b62\u8fd0\u884c\u5b88\u62a4\u8fdb\u7a0b\u7684\u6846\u67b6 \u72ec\u7acb\u542f\u52a8\u5176\u4ed6\u7ec4\u4ef6 \u6846\u67b6\u9ed8\u8ba4\u4e0d\u6b62\u542f\u52a8\u6846\u67b6\u7684 server \u547d\u4ee4\uff0c\u8fd8\u6709 init \u547d\u4ee4\u548c simple-http-server \u547d\u4ee4\u3002 init \u547d\u4ee4\u5728\u4e0a\u65b9 Composer \u4f9d\u8d56\u6a21\u5f0f\u4e2d\u63d0\u5230\u8fc7\uff0c\u5c31\u662f\u521d\u59cb\u5316\u5404\u4e2a\u6587\u4ef6\u7684\u3002 \u72ec\u7acb HTTP \u6587\u4ef6\u670d\u52a1\u5668 \u5982\u679c\u4f60\u53ea\u9700\u8981\u4e00\u4e2a\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\uff0c\u7c7b\u4f3c Nginx\uff0c\u90a3\u4e48\u6846\u67b6\u4e5f\u652f\u6301\u3002 1 vendor/bin/start simple-http-server your-web-dir/ --host = 0 .0.0.0 --port = 8080 your-web-dir \u662f\u5fc5\u586b\u7684\u53c2\u6570\u3002 --host \u548c --port \u662f\u53ef\u9009\u53c2\u6570\uff0c\u5982\u679c\u4e0d\u586b\uff0c\u5219\u9ed8\u8ba4\u4f7f\u7528 global.php \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u914d\u7f6e\u3002 \u68c0\u67e5\u914d\u7f6e\u662f\u5426\u66f4\u65b0 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff08\u975e\u6e90\u7801\u6a21\u5f0f\uff09\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4 vendor/bin/start check:config \u6765\u68c0\u67e5\u4f60\u7684\u914d\u7f6e\u6587\u4ef6\u662f\u5426\u9700\u8981\u66f4\u65b0\u90e8\u5206\u6bb5\u843d\u3002 systemd \u914d\u7f6e\u6587\u4ef6\u751f\u6210\u5668 \u6846\u67b6\u652f\u6301\u751f\u6210 systemd \u914d\u7f6e\u6587\u4ef6 zhamao.service \uff0c\u751f\u6210\u540e\u5c06\u6587\u4ef6\u653e\u5165 /etc/systemd/system \u540e\u8f93\u5165 systemctl enable zhamao.service \u5373\u53ef\u3002 \u547d\u4ee4\uff1a vendor/bin/start systemd:generate \u6ce8\u610f\uff0csystemd \u542f\u52a8\u7684\u5b88\u62a4\u8fdb\u7a0b\u6a21\u5f0f\u548c\u4f7f\u7528\u53c2\u6570 --daemon \u4e0d\u4e00\u6837\uff0c\u8bf7\u52ff\u540c\u65f6\u6df7\u7528\uff0c\u76f4\u63a5\u4f7f\u7528\u4e0a\u8ff0\u547d\u4ee4\u751f\u6210\u7684\u914d\u7f6e\u6587\u4ef6\u5373\u53ef\u6b63\u5e38\u4f7f\u7528\uff01","title":"\u6846\u67b6\u542f\u52a8\u6a21\u5f0f"},{"location":"advanced/custom-start/#_1","text":"","title":"\u6846\u67b6\u9ad8\u7ea7\u542f\u52a8"},{"location":"advanced/custom-start/#_2","text":"\u4ece\u524d\u9762\u7684\u51e0\u7ae0\u4e2d\uff0c\u6211\u4eec\u4e86\u89e3\u5230\u6846\u67b6\u6709\u591a\u79cd\u4e0b\u8f7d\u5230\u672c\u5730\u7684\u65b9\u5f0f\u3002 Composer \u4f9d\u8d56\u6a21\u5f0f Starter \u4ece\u6a21\u677f\u521b\u5efa\u6a21\u5f0f \u6e90\u7801\u6a21\u5f0f","title":"\u6846\u67b6\u4e0b\u8f7d\u65b9\u5f0f"},{"location":"advanced/custom-start/#composer","text":"\u4ece Composer \u4f9d\u8d56\u52a0\u8f7d\u6846\u67b6\u662f\u4e00\u79cd\u62c9\u53d6\u6846\u67b6\u7684\u65b9\u5f0f\uff0c\u8fd9\u79cd\u65b9\u5f0f\u7684\u4f18\u70b9\u5728\u4e8e\uff0c\u4f60\u53ef\u4ee5\u76f4\u89c2\u5730\u611f\u53d7\u5230\u662f\u5982\u4f55\u4f7f\u7528\u6846\u67b6\u4ece\u96f6\u5f00\u59cb\u4e00\u4e2a\u5b8c\u6574\u7684\u9879\u76ee\u7684\u8fc7\u7a0b\u3002 \u4ece Composer \u4f9d\u8d56\u7684\u542f\u52a8\u6b65\u9aa4\uff1a 1 2 3 4 5 6 7 8 9 mkdir my-bot # \u65b0\u5efa\u4e00\u4e2a\u7a7a\u7684\u6587\u4ef6\u5939 cd my-bot/ composer require zhamao/framework # \u4ece composer \u62c9\u53d6\u540e\u4f1a\u81ea\u52a8\u90e8\u7f72 autoload \u548c composer.json \u7b49\u5185\u5bb9 # \u4f7f\u7528\u547d\u4ee4\u521d\u59cb\u5316\u6846\u67b6 vendor/bin/start init # \u542f\u52a8\u6846\u67b6 vendor/bin/start server \u6ce8\u610f\uff1a\u4f7f\u7528 init \u547d\u4ee4\u65f6\uff0c\u4f1a\u7ed9\u5f53\u524d\u76ee\u5f55\u89e3\u538b\u4ee5\u4e0b\u6587\u4ef6\uff1a 1 2 3 4 5 6 7 8 9 10 $extract_files = [ \"/config/global.php\", // \u5168\u5c40\u914d\u7f6e\u6587\u4ef6 \"/.gitignore\", // git \u6392\u9664\u6587\u4ef6 \"/config/file_header.json\", // HTTP \u6587\u4ef6\u5934 \"/config/console_color.json\", // \u7ec8\u7aef\u989c\u8272\u4e3b\u9898\u6587\u4ef6 \"/config/motd.txt\", // \u6846\u67b6\u542f\u52a8\u65f6\u81ea\u5b9a\u4e49\u7684 motd \"/src/Module/Example/Hello.php\", // \u6846\u67b6\u81ea\u5e26\u7684\u793a\u4f8b\u6a21\u5757 \"/src/Module/Middleware/TimerMiddleware.php\", // \u6846\u67b6\u81ea\u5e26\u7684\u51fd\u6570\u8fd0\u884c\u65f6\u95f4\u76d1\u63a7\u4e2d\u95f4\u4ef6 \"/src/Custom/global_function.php\" // \u7528\u6237\u53ef\u5728\u8fd9\u91cc\u81ea\u5b9a\u4e49\u7f16\u5199\u81ea\u5df1\u7684\u5168\u5c40\u51fd\u6570 ]; \u7ecf\u8fc7 init \u89e3\u538b\u8fd9\u4e9b\u6587\u4ef6\u540e\uff0c\u4f60\u7684\u6846\u67b6\u5c31\u80fd\u6b63\u5e38\u8fd0\u884c\u4e14\u5f00\u59cb\u7f16\u5199\u4ee3\u7801\u4e86\uff01","title":"Composer \u4f9d\u8d56\u6a21\u5f0f"},{"location":"advanced/custom-start/#starter","text":"\u4ece\u6a21\u677f\u65b0\u5efa\u5176\u5b9e\u539f\u7406\u548c Composer \u4f9d\u8d56\u6a21\u5f0f\u5b8c\u5168\u4e00\u6837\uff0c\u53ea\u4e0d\u8fc7\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u4f7f\u7528\u6a21\u677f\u4ed3\u5e93\u65b0\u5efa\u7684\u9879\u76ee\uff0c\u4f7f\u7528 Composer \u81ea\u5e26\u7684 create-project \u65b9\u5f0f\u521b\u5efa\u7684\u3002starter \u4e5f\u662f\u4e00\u4e2a GitHub \u9879\u76ee\uff0c\u89c1 \u5730\u5740 \u3002 1 2 3 composer create-project zhamao/framework-starter my-bot/ # my-bot \u662f\u4f60\u81ea\u5b9a\u4e49\u7684\u6587\u4ef6\u5939\u540d\u79f0\uff0c\u548c\u4e0a\u65b9\u76f8\u540c cd my-bot vendor/bin/start server # \u542f\u52a8\u6846\u67b6 Starter \u6a21\u5f0f\u76f8\u5f53\u4e8e\u76f4\u63a5\u4ece GitHub \u62c9\u53d6 zhamao-framework-starter \u9879\u76ee\uff0c\u7136\u540e\u6267\u884c composer update \u3002 \u90a3\u548c Composer \u4f9d\u8d56\u6a21\u5f0f\u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f\u6ca1\u533a\u522b\uff01\u6784\u5efa\u51fa\u6765\u7684\u6846\u67b6\u548c\u6587\u4ef6\u662f\u4e00\u6a21\u4e00\u6837\u7684\uff01\u4f7f\u7528 Composer \u4f9d\u8d56\u6a21\u5f0f\uff0c\u4f7f\u7528 init \u547d\u4ee4\u540e\uff0c\u6587\u4ef6\u4f1a\u548c zhamao-framework-starter \u4ed3\u5e93\u62c9\u53d6\u56de\u6765\u7684\u6a21\u677f\u4e00\u6a21\u4e00\u6837\uff01\uff08\u6216\u8005\u6362\u53e5\u8bdd\u8bf4\uff0c\u8fd9\u4e2a\u4ed3\u5e93\u5c31\u662f\u4f7f\u7528 init \u547d\u4ee4\u751f\u6210\u7684\u6587\u4ef6\u7684\uff09 \u90a3\u4f7f\u7528\u54ea\u79cd\u597d\u5462\uff1f\u770b\u4f60\u81ea\u5df1\uff01\u5982\u679c\u4f60\u60f3\u7ed9\u4f60\u81ea\u5df1\u7684\u5df2\u6709\u9879\u76ee\u5957\u4e0a\u70b8\u6bdb\u6846\u67b6\uff0c\u90a3\u4e48\u5c31\u63a8\u8350\u4f7f\u7528 Composer \u4f9d\u8d56\u6a21\u5f0f\uff0c\u5982\u679c\u662f\u4ece 0 \u5f00\u59cb\u7f16\u5199\u6846\u67b6\u6a21\u5757\uff0c\u5219\u63a8\u8350\u4f7f\u7528\u6a21\u677f\u6a21\u5f0f\u3002","title":"Starter \u6a21\u677f\u6a21\u5f0f"},{"location":"advanced/custom-start/#_3","text":"\u6e90\u7801\u6a21\u5f0f\u548c\u4ee5\u4e0a\u4e24\u79cd\u65b9\u6848\u90fd\u4e0d\u4e00\u6837\uff0c\u6e90\u7801\u6a21\u5f0f\u5141\u8bb8\u4f60\u5bf9\u6846\u67b6\u672c\u8eab\u8fdb\u884c\u4e00\u7cfb\u5217\u4fee\u6539\uff0c\u6846\u67b6\u672c\u4f53\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\u3002 Composer \u4f9d\u8d56\u6a21\u5f0f\uff08\u4ee5\u53ca\u6a21\u677f\u6a21\u5f0f\uff09\u548c\u6e90\u7801\u6a21\u5f0f\u7684\u533a\u522b\u662f\uff1a \u4f9d\u8d56\u6a21\u5f0f\u548c\u6a21\u677f\u6a21\u5f0f\u662f\u901a\u8fc7 library \u65b9\u5f0f\u5f15\u5165\u6846\u67b6\u7684\uff0c\u6846\u67b6\u672c\u8eab\u4f1a\u653e\u5728 composer \u7684 vendor/ \u76ee\u5f55\u4e0b\uff0c\u4ece composer \u5f15\u5165\u7684 library \u76f8\u5f53\u4e8e\u5b50\u96c6\uff0cvendor \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u6700\u597d\u4e0d\u8981\u624b\u52a8\u4fee\u6539\uff08\u5e94\u8be5\u90fd\u77e5\u9053\u5427\uff09\uff0c\u6240\u4ee5\u6846\u67b6\u672c\u8eab\u4e5f\u53ea\u662f\u52a0\u8f7d\u4e86\u8fdb\u6765\u3002 \u6e90\u7801\u6a21\u5f0f\u76f8\u5f53\u4e8e\u76f4\u63a5\u4ece\u6846\u67b6\u6e90\u7801\u76ee\u5f55\u8fd0\u884c\u6846\u67b6\u548c\u6a21\u5757\uff0c\u6846\u67b6\u6e90\u7801\u90fd\u5728 src/ZM \u76ee\u5f55\u4e0b\uff0c\u9ed8\u8ba4\u7684\u793a\u4f8b\u6a21\u5757\u90fd\u5728 src/Module \u4e0b\uff0c\u662f\u540c\u7ea7\u76ee\u5f55\u3002\u800c\u6b64\u65f6\u7684 vendor/ \u76ee\u5f55\u53ea\u5305\u542b\u4e86\u6846\u67b6\u4f9d\u8d56\u7684\u5916\u90e8\u7ec4\u4ef6\uff0c\u4f8b\u5982\u6ce8\u89e3\u89e3\u6790\u5668\u548c psysh \u7b49\u3002 \u6e90\u7801\u6a21\u5f0f\u53ef\u4ee5\u65b9\u4fbf\u5730\u8c03\u8bd5\u548c\u4fee\u6539\u6846\u67b6\u672c\u8eab\uff0c\u62c9\u53d6\u65b9\u5f0f\u5f88\u7b80\u5355\uff0c\u7528 git clone \u6216\u4ece GitHub \u4e0b\u8f7d\u6700\u65b0\u7248\u7684\u6e90\u7801\u5305\u89e3\u538b\u5373\u53ef\u3002 1 2 3 4 5 git clone https://github.com/zhamao-robot/zhamao-framework.git cd zhamao-framework/ bin/start server # \u7b2c\u4e00\u6b21\u8fd0\u884c\u65f6\u4f1a\u63d0\u793a\u4e00\u4e2a\u201c\u6846\u67b6\u6e90\u7801\u6a21\u5f0f\u9700\u8981\u5728autoload\u6587\u4ef6\u4e2d\u6dfb\u52a0Module\u76ee\u5f55\u4e3a\u81ea\u52a8\u52a0\u8f7d\u201d composer update # \u66f4\u65b0 autoload \u6587\u4ef6\uff0c\u5e94\u7528\u521a\u624d\u4e0a\u4e00\u6b65\u6dfb\u52a0\u7684 `src/Module` \u6587\u4ef6\u5939\u4e0b\u7684\u6a21\u5757\u81ea\u52a8\u52a0\u8f7d bin/start server # \u901a\u8fc7\u6e90\u7801\u6a21\u5f0f\u542f\u52a8\u6846\u67b6","title":"\u6e90\u7801\u6a21\u5f0f"},{"location":"advanced/custom-start/#_4","text":"\u6846\u67b6\u542f\u52a8\u65f6\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\u6307\u5b9a\u542f\u52a8\u53c2\u6570\u3002 --debug-mode \uff1a\u542f\u7528\u8c03\u8bd5\u6a21\u5f0f\uff0c\u8c03\u8bd5\u6a21\u5f0f\u7684\u4f5c\u7528\u662f\u5173\u95ed\u4e00\u952e\u534f\u7a0b\u5316\u548c\u7ec8\u7aef\u4ea4\u4e92\uff0c\u51cf\u5c11 Swoole \u672c\u8eab\u5bf9\u4ee3\u7801\u903b\u8f91\u7684\u5e72\u6270\uff08\u6bd4\u5982\u6267\u884c shell_exec() \u62a5\u9519\u7684\u8bdd\u53ef\u4ee5\u5f00\u542f\u8fd9\u4e2a\u8fdb\u884c\u8c03\u8bd5\uff09\u3002 --log-{mode} \uff1a\u8bbe\u7f6e log \u7b49\u7ea7\u3002\u652f\u6301 --log-debug \uff0c --log-verbose \uff0c --log-info \uff0c --log-warning \uff0c --log-error \u3002 --log-theme \uff1a\u8bbe\u7f6e\u7ec8\u7aef\u4fe1\u606f\u7684\u4e3b\u9898\u3002\u8fd9\u4e2a\u9009\u9879\u9002\u7528\u4e8e\u591a\u79cd\u7ec8\u7aef\u4fe1\u606f\u663e\u793a\u7684\u517c\u5bb9\uff0c\u4f8b\u5982\u767d\u8272\u7ec8\u7aef\u548c\u4e0d\u652f\u6301\u989c\u8272\u7684\u7ec8\u7aef\u3002\u8be6\u89c1 Console - \u4e3b\u9898\u8bbe\u7f6e \u3002 --disable-coroutine \uff1a\u5173\u95ed\u4e00\u952e\u534f\u7a0b\u5316\u3002 --remote-terminal \uff1a\u5f00\u542f nc \u8fdc\u7a0b\u7ec8\u7aef\uff0c\u914d\u7f6e\u6587\u4ef6\u4f7f\u7528\u5168\u5c40\u4e2d\u7684 remote_terminal \u9879\u3002\u4e5f\u53ef\u4ee5\u5728\u5168\u5c40\u914d\u7f6e\u4e2d\u5e38\u5f00\u542f\uff08status \u8bbe\u7f6e\u4e3a true\uff09\u3002 --daemon \uff1a\u4ee5\u5b88\u62a4\u8fdb\u7a0b\u65b9\u5f0f\u8fd0\u884c\u6846\u67b6\uff0c\u6b64\u53c2\u6570\u5c06\u76f4\u63a5\u5728\u8f93\u51fa motd \u540e\u5c06\u8fdb\u7a0b\u6302\u5230 init \u4e0b\u8fd0\u884c\uff0c\u540e\u53f0\u5e38\u9a7b\u3002 --watch \uff1a\u76d1\u63a7 src/ \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u53d8\u5316\uff0c\u6709\u53d8\u5316\u5219\u81ea\u52a8\u91cd\u65b0\u8f7d\u5165\u4ee3\u7801\u3002\u5f00\u542f\u76d1\u63a7\u9700\u8981\u5b89\u88c5 PHP \u6269\u5c55\uff1ainotify\u3002\u4f7f\u7528 pecl \u5c31\u53ef\u4ee5\u5b89\u88c5\uff1a pecl install inotify \u3002\uff08\u6ce8\uff1a\u4e0d\u652f\u6301 WSL \u548c macOS\uff09 --env \uff1a\u8bbe\u7f6e\u8fd0\u884c\u73af\u5883\uff0c\u8bbe\u7f6e\u8fd0\u884c\u73af\u5883\u540e\u5c06\u4f18\u5148\u52a0\u8f7d\u6307\u5b9a\u73af\u5883\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u652f\u6301 --env=production \uff0c --env=staging \uff0c --env=development \uff0c\u89c1 \u57fa\u672c\u914d\u7f6e \u3002 --worker-num \uff1a\u6307\u5b9a\u8fd0\u884c\u7684\u5de5\u4f5c\u8fdb\u7a0b\u6570\u91cf\uff08\u5e76\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\uff0c\u6846\u67b6\u9ed8\u8ba4\u4e3a CPU \u6838\u5fc3\u6570\uff09\uff0c\u4f8b\u5982 --worker-num=8 \u3002 --task-worker-num \uff1a\u542f\u7528 TaskWorker \u8fdb\u7a0b\u5e76\u6307\u5b9a\u6570\u91cf\u3002 --show-php-ver \uff1a\u5728\u542f\u52a8\u65f6\u663e\u793a Swoole \u548c PHP \u7684\u7248\u672c\u3002","title":"\u6846\u67b6\u542f\u52a8\u53c2\u6570"},{"location":"advanced/custom-start/#_5","text":"\u5b88\u62a4\u8fdb\u7a0b\u5728 2.2.0 \u7248\u672c\u5f00\u59cb\uff0c\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4\u884c\u5feb\u901f\u64cd\u4f5c\uff0c\u5982\u91cd\u542f\u3001\u505c\u6b62\u3001\u67e5\u770b\u72b6\u6001\u7b49\u3002 \u6ce8\u610f\uff0c\u8fd9\u91cc\u7684\u5b88\u62a4\u8fdb\u7a0b\u64cd\u4f5c\u547d\u4ee4\u662f\u6307 \u4f7f\u7528 --daemon \u65b9\u5f0f\u542f\u52a8\u7684\u6846\u67b6 \uff0c\u5982\u4f7f\u7528 Docker\u3001screen\u3001tmux\u3001systemd \u7b49\u65b9\u5f0f\u6302\u540e\u53f0\u8dd1\u5219\u6b64\u547d\u4ee4\u4e0d\u53ef\u7528\uff01 1 2 3 vendor/bin/start daemon:status # \u67e5\u770b\u5b88\u62a4\u8fdb\u7a0b\u7684\u72b6\u6001 vendor/bin/start daemon:reload # \u91cd\u8f7d\u6846\u67b6 vendor/bin/start daemon:stop # \u505c\u6b62\u8fd0\u884c\u5b88\u62a4\u8fdb\u7a0b\u7684\u6846\u67b6","title":"\u5b88\u62a4\u8fdb\u7a0b\u64cd\u4f5c\u547d\u4ee4"},{"location":"advanced/custom-start/#_6","text":"\u6846\u67b6\u9ed8\u8ba4\u4e0d\u6b62\u542f\u52a8\u6846\u67b6\u7684 server \u547d\u4ee4\uff0c\u8fd8\u6709 init \u547d\u4ee4\u548c simple-http-server \u547d\u4ee4\u3002 init \u547d\u4ee4\u5728\u4e0a\u65b9 Composer \u4f9d\u8d56\u6a21\u5f0f\u4e2d\u63d0\u5230\u8fc7\uff0c\u5c31\u662f\u521d\u59cb\u5316\u5404\u4e2a\u6587\u4ef6\u7684\u3002","title":"\u72ec\u7acb\u542f\u52a8\u5176\u4ed6\u7ec4\u4ef6"},{"location":"advanced/custom-start/#http","text":"\u5982\u679c\u4f60\u53ea\u9700\u8981\u4e00\u4e2a\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\uff0c\u7c7b\u4f3c Nginx\uff0c\u90a3\u4e48\u6846\u67b6\u4e5f\u652f\u6301\u3002 1 vendor/bin/start simple-http-server your-web-dir/ --host = 0 .0.0.0 --port = 8080 your-web-dir \u662f\u5fc5\u586b\u7684\u53c2\u6570\u3002 --host \u548c --port \u662f\u53ef\u9009\u53c2\u6570\uff0c\u5982\u679c\u4e0d\u586b\uff0c\u5219\u9ed8\u8ba4\u4f7f\u7528 global.php \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u914d\u7f6e\u3002","title":"\u72ec\u7acb HTTP \u6587\u4ef6\u670d\u52a1\u5668"},{"location":"advanced/custom-start/#_7","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff08\u975e\u6e90\u7801\u6a21\u5f0f\uff09\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4 vendor/bin/start check:config \u6765\u68c0\u67e5\u4f60\u7684\u914d\u7f6e\u6587\u4ef6\u662f\u5426\u9700\u8981\u66f4\u65b0\u90e8\u5206\u6bb5\u843d\u3002","title":"\u68c0\u67e5\u914d\u7f6e\u662f\u5426\u66f4\u65b0"},{"location":"advanced/custom-start/#systemd","text":"\u6846\u67b6\u652f\u6301\u751f\u6210 systemd \u914d\u7f6e\u6587\u4ef6 zhamao.service \uff0c\u751f\u6210\u540e\u5c06\u6587\u4ef6\u653e\u5165 /etc/systemd/system \u540e\u8f93\u5165 systemctl enable zhamao.service \u5373\u53ef\u3002 \u547d\u4ee4\uff1a vendor/bin/start systemd:generate \u6ce8\u610f\uff0csystemd \u542f\u52a8\u7684\u5b88\u62a4\u8fdb\u7a0b\u6a21\u5f0f\u548c\u4f7f\u7528\u53c2\u6570 --daemon \u4e0d\u4e00\u6837\uff0c\u8bf7\u52ff\u540c\u65f6\u6df7\u7528\uff0c\u76f4\u63a5\u4f7f\u7528\u4e0a\u8ff0\u547d\u4ee4\u751f\u6210\u7684\u914d\u7f6e\u6587\u4ef6\u5373\u53ef\u6b63\u5e38\u4f7f\u7528\uff01","title":"systemd \u914d\u7f6e\u6587\u4ef6\u751f\u6210\u5668"},{"location":"advanced/framework-structure/","text":"\u6846\u67b6\u5256\u6790 \u6846\u67b6\u8fd0\u884c\u603b\u7ed3\u6784\u56fe","title":"\u6846\u67b6\u5256\u6790"},{"location":"advanced/framework-structure/#_1","text":"","title":"\u6846\u67b6\u5256\u6790"},{"location":"advanced/framework-structure/#_2","text":"","title":"\u6846\u67b6\u8fd0\u884c\u603b\u7ed3\u6784\u56fe"},{"location":"advanced/inside-class/","text":"\u5185\u90e8\u7c7b\u6587\u4ef6\u624b\u518c \u8fd9\u4e2a\u7ae0\u8282\u5199\u660e\u4e86\u5728\u6846\u67b6\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u6d89\u53ca\u5230\u7684\u6846\u67b6\u5185\u90e8\u6216 Swoole\u3001\u5176\u4ed6 composer \u4f9d\u8d56\u7ec4\u4ef6\u7684\u5185\u90e8\u7c7b\uff0c\u8fd9\u91cc\u4f1a\u6839\u636e\u7c7b\u7684\u547d\u540d\u7a7a\u95f4\u4e00\u4e00\u8bf4\u660e\u3002 Swoole\\Http\\Request \u6b64\u7c7b\u662f Swoole \u5185\u90e8\u7684\u4e00\u4e2a\u7c7b\uff0c\u4e00\u822c\u5728\u6536\u5230 HTTP \u8bf7\u6c42\u65f6\uff0c\u5728 @RequestMapping \u6216 @OnRequestEvent() \u4e24\u4e2a\u6ce8\u89e3\u4e0b\u53ef\u7528\uff0c\u7528\u4f5c\u83b7\u53d6 GET\u3001POST\u53c2\u6570\uff0c\u4e0a\u4f20\u5230\u540e\u7aef\u7684\u6587\u4ef6\u3001Cookies \u7b49\u3002\u8be6\u89c1 Swoole \u6587\u6863 - Request \u3002 \u5c5e\u6027 $fd \uff1a\u83b7\u53d6\u5f53\u524d\u8fde\u63a5\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26 ID\u3002 $header \uff1a HTTP \u8bf7\u6c42\u7684\u5934\u90e8\u4fe1\u606f\u3002\u7c7b\u578b\u4e3a\u6570\u7ec4\uff0c\u6240\u6709 key \u5747\u4e3a\u5c0f\u5199\u3002 $server \uff1a HTTP \u8bf7\u6c42\u76f8\u5173\u7684\u670d\u52a1\u5668\u4fe1\u606f\u3002 $cookie \uff1a\u83b7\u53d6 Cookies\u3002 $get \uff1a\u83b7\u53d6 GET \u53c2\u6570\u3002 $post \uff1a\u83b7\u53d6 POST \u53c2\u6570\u3002 $files \uff1a\u83b7\u53d6\u4e0a\u4f20\u7684\u6587\u4ef6\u4fe1\u606f \u65b9\u6cd5 rawContent() \uff1a\u83b7\u53d6 POST \u5305\u539f\u59cb\u4e8c\u8fdb\u5236\u5185\u5bb9\uff0c\u76f8\u5f53\u4e8e\u539f\u751f PHP \u7684 file_get_contents(\"php://input\"); \u3002 getData() \uff1a\u83b7\u53d6\u5b8c\u6574\u7684\u539f\u59cb Http \u8bf7\u6c42\u62a5\u6587\u3002\u5305\u62ec Http Header \u548c Http Body \u793a\u4f8b 1 TODO\uff1a\u5148\u653e\u4e00\u653e\u3002 ZM\\Entity\\MatchObject \u6b64\u7c7b\u662f\u8c03\u7528\u65b9\u6cd5 MessageUtil::matchCommand() \u8fd4\u56de\u7684\u5bf9\u8c61\u4f53\uff0c\u542b\u6709\u5339\u914d\u6210\u529f\u4e0e\u5426\u548c\u5339\u914d\u5230\u7684\u6ce8\u89e3\u76f8\u5173\u7684\u4fe1\u606f\u3002 \u5c5e\u6027 $match \uff1a bool \u7c7b\u578b\uff0c\u8fd4\u56de\u5339\u914d\u662f\u5426\u6210\u529f $object \uff1a CQCommand \u6ce8\u89e3\u7c7b\uff0c\u5982\u679c\u5339\u914d\u6210\u529f\u5219\u8fd4\u56de\u5bf9\u5e94\u7684 @CQCommand \u4fe1\u606f match \uff1a array \u7c7b\u578b\uff0c\u5982\u679c\u5339\u914d\u6210\u529f\u5219\u8fd4\u56de\u5339\u914d\u5230\u7684\u53c2\u6570 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // \u5047\u8bbe\u6211\u6709\u4e00\u4e2a\u6ce8\u89e3\u4e8b\u4ef6 @CQCommand(match=\"\u4f60\u597d\")\uff0c\u7ed1\u5b9a\u7684\u51fd\u6570\u662f \\Module\\Example\\Hello \u4e0b\u7684 hello123() $obj = MessageUtil::matchCommand(\"\u4f60\u597d \u6211\u53eb\u987a\u6e9c \u6211\u4eca\u5e74\u4e8c\u5341\u516b\", ctx()->getData()); /* \u4ee5\u4e0b\u662f\u8fd4\u56de\u4fe1\u606f\uff0c\u4ec5\u4f9b\u53c2\u8003 $obj->match ==> true $obj->object ==> \\ZM\\Annotation\\CQ\\CQCommand: ( match: \"\u4f60\u597d\", pattern: \"\", regex: \"\", start_with: \"\", end_with: \"\", keyword: \"\", alias: [], message_type: \"\", user_id: 0, group_id: 0, discuss_id: 0, level: 20, method: \"hello123\", class: \\Module\\Example\\Hello::class ) $obj->match ==> [ \"\u6211\u53eb\u987a\u6e9c\", \"\u6211\u4eca\u5e74\u4e8c\u5341\u516b\" ] */","title":"\u5185\u90e8\u7c7b\u6587\u4ef6\u624b\u518c"},{"location":"advanced/inside-class/#_1","text":"\u8fd9\u4e2a\u7ae0\u8282\u5199\u660e\u4e86\u5728\u6846\u67b6\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u53ef\u80fd\u6d89\u53ca\u5230\u7684\u6846\u67b6\u5185\u90e8\u6216 Swoole\u3001\u5176\u4ed6 composer \u4f9d\u8d56\u7ec4\u4ef6\u7684\u5185\u90e8\u7c7b\uff0c\u8fd9\u91cc\u4f1a\u6839\u636e\u7c7b\u7684\u547d\u540d\u7a7a\u95f4\u4e00\u4e00\u8bf4\u660e\u3002","title":"\u5185\u90e8\u7c7b\u6587\u4ef6\u624b\u518c"},{"location":"advanced/inside-class/#swoolehttprequest","text":"\u6b64\u7c7b\u662f Swoole \u5185\u90e8\u7684\u4e00\u4e2a\u7c7b\uff0c\u4e00\u822c\u5728\u6536\u5230 HTTP \u8bf7\u6c42\u65f6\uff0c\u5728 @RequestMapping \u6216 @OnRequestEvent() \u4e24\u4e2a\u6ce8\u89e3\u4e0b\u53ef\u7528\uff0c\u7528\u4f5c\u83b7\u53d6 GET\u3001POST\u53c2\u6570\uff0c\u4e0a\u4f20\u5230\u540e\u7aef\u7684\u6587\u4ef6\u3001Cookies \u7b49\u3002\u8be6\u89c1 Swoole \u6587\u6863 - Request \u3002","title":"Swoole\\Http\\Request"},{"location":"advanced/inside-class/#_2","text":"$fd \uff1a\u83b7\u53d6\u5f53\u524d\u8fde\u63a5\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26 ID\u3002 $header \uff1a HTTP \u8bf7\u6c42\u7684\u5934\u90e8\u4fe1\u606f\u3002\u7c7b\u578b\u4e3a\u6570\u7ec4\uff0c\u6240\u6709 key \u5747\u4e3a\u5c0f\u5199\u3002 $server \uff1a HTTP \u8bf7\u6c42\u76f8\u5173\u7684\u670d\u52a1\u5668\u4fe1\u606f\u3002 $cookie \uff1a\u83b7\u53d6 Cookies\u3002 $get \uff1a\u83b7\u53d6 GET \u53c2\u6570\u3002 $post \uff1a\u83b7\u53d6 POST \u53c2\u6570\u3002 $files \uff1a\u83b7\u53d6\u4e0a\u4f20\u7684\u6587\u4ef6\u4fe1\u606f","title":"\u5c5e\u6027"},{"location":"advanced/inside-class/#_3","text":"rawContent() \uff1a\u83b7\u53d6 POST \u5305\u539f\u59cb\u4e8c\u8fdb\u5236\u5185\u5bb9\uff0c\u76f8\u5f53\u4e8e\u539f\u751f PHP \u7684 file_get_contents(\"php://input\"); \u3002 getData() \uff1a\u83b7\u53d6\u5b8c\u6574\u7684\u539f\u59cb Http \u8bf7\u6c42\u62a5\u6587\u3002\u5305\u62ec Http Header \u548c Http Body","title":"\u65b9\u6cd5"},{"location":"advanced/inside-class/#_4","text":"1 TODO\uff1a\u5148\u653e\u4e00\u653e\u3002","title":"\u793a\u4f8b"},{"location":"advanced/inside-class/#zmentitymatchobject","text":"\u6b64\u7c7b\u662f\u8c03\u7528\u65b9\u6cd5 MessageUtil::matchCommand() \u8fd4\u56de\u7684\u5bf9\u8c61\u4f53\uff0c\u542b\u6709\u5339\u914d\u6210\u529f\u4e0e\u5426\u548c\u5339\u914d\u5230\u7684\u6ce8\u89e3\u76f8\u5173\u7684\u4fe1\u606f\u3002","title":"ZM\\Entity\\MatchObject"},{"location":"advanced/inside-class/#_5","text":"$match \uff1a bool \u7c7b\u578b\uff0c\u8fd4\u56de\u5339\u914d\u662f\u5426\u6210\u529f $object \uff1a CQCommand \u6ce8\u89e3\u7c7b\uff0c\u5982\u679c\u5339\u914d\u6210\u529f\u5219\u8fd4\u56de\u5bf9\u5e94\u7684 @CQCommand \u4fe1\u606f match \uff1a array \u7c7b\u578b\uff0c\u5982\u679c\u5339\u914d\u6210\u529f\u5219\u8fd4\u56de\u5339\u914d\u5230\u7684\u53c2\u6570 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 // \u5047\u8bbe\u6211\u6709\u4e00\u4e2a\u6ce8\u89e3\u4e8b\u4ef6 @CQCommand(match=\"\u4f60\u597d\")\uff0c\u7ed1\u5b9a\u7684\u51fd\u6570\u662f \\Module\\Example\\Hello \u4e0b\u7684 hello123() $obj = MessageUtil::matchCommand(\"\u4f60\u597d \u6211\u53eb\u987a\u6e9c \u6211\u4eca\u5e74\u4e8c\u5341\u516b\", ctx()->getData()); /* \u4ee5\u4e0b\u662f\u8fd4\u56de\u4fe1\u606f\uff0c\u4ec5\u4f9b\u53c2\u8003 $obj->match ==> true $obj->object ==> \\ZM\\Annotation\\CQ\\CQCommand: ( match: \"\u4f60\u597d\", pattern: \"\", regex: \"\", start_with: \"\", end_with: \"\", keyword: \"\", alias: [], message_type: \"\", user_id: 0, group_id: 0, discuss_id: 0, level: 20, method: \"hello123\", class: \\Module\\Example\\Hello::class ) $obj->match ==> [ \"\u6211\u53eb\u987a\u6e9c\", \"\u6211\u4eca\u5e74\u4e8c\u5341\u516b\" ] */","title":"\u5c5e\u6027"},{"location":"advanced/manually-install/","text":"\u624b\u52a8\u90e8\u7f72\u73af\u5883\u6559\u7a0b TODO: \u8fd8\u6ca1\u5199","title":"\u624b\u52a8\u5b89\u88c5\u73af\u5883"},{"location":"advanced/manually-install/#_1","text":"TODO: \u8fd8\u6ca1\u5199","title":"\u624b\u52a8\u90e8\u7f72\u73af\u5883\u6559\u7a0b"},{"location":"advanced/multi-process/","text":"\u6846\u67b6\u591a\u8fdb\u7a0b \u9996\u5148\u5bf9\u4e8e\u591a\u8fdb\u7a0b\u6982\u5ff5\uff0c\u5bf9\u4e8e\u4f20\u7edf PHP \u7a0b\u5e8f\u5458\u53ef\u80fd\u6bd4\u8f83\u964c\u751f\uff0c\u552f\u4e00\u63a5\u89e6\u5230\u7684\u5730\u65b9\u53ef\u80fd\u5c31\u662f php-fpm \u7b49\u4e00\u4e9b\u65b9\u5f0f\u5904\u7406\u65f6\u95f4\u957f\u7684\u8bf7\u6c42\u65f6\u5f00\u8fdb\u7a0b\u53bb\u6267\u884c\u3002\u5173\u4e8e\u591a\u8fdb\u7a0b\uff0c\u6211\u89c9\u5f97\u5ed6\u96ea\u5cf0\u7684 Python \u591a\u8fdb\u7a0b\u8fd9\u6bb5\u8bb2\u7684\u4e0d\u9519\uff1a Unix/Linux \u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u4e86\u4e00\u4e2a fork() \u7cfb\u7edf\u8c03\u7528\uff0c\u5b83\u975e\u5e38\u7279\u6b8a\u3002\u666e\u901a\u7684\u51fd\u6570\u8c03\u7528\uff0c\u8c03\u7528\u4e00\u6b21\uff0c\u8fd4\u56de\u4e00\u6b21\uff0c\u4f46\u662f fork() \u8c03\u7528\u4e00\u6b21\uff0c\u8fd4\u56de\u4e24\u6b21\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u81ea\u52a8\u628a\u5f53\u524d\u8fdb\u7a0b\uff08\u79f0\u4e3a\u7236\u8fdb\u7a0b\uff09\u590d\u5236\u4e86\u4e00\u4efd\uff08\u79f0\u4e3a\u5b50\u8fdb\u7a0b\uff09\uff0c\u7136\u540e\uff0c\u5206\u522b\u5728\u7236\u8fdb\u7a0b\u548c\u5b50\u8fdb\u7a0b\u5185\u8fd4\u56de\u3002 \u8fd9\u91cc\u9762\u7684\u91cd\u70b9\u5728\u4e8e\uff0c\u591a\u8fdb\u7a0b\u7684\u521b\u5efa\uff0c\u662f\u7236\u8fdb\u7a0b\u7684\u590d\u5236\uff0c\u7136\u540e\u4e24\u4e2a\u8fdb\u7a0b\u63a5\u4e0b\u6765\u8fd0\u884c\u7684\u4ee3\u7801\u548c\u5b58\u7684\u5185\u5bb9\u5c31\u5206\u9053\u626c\u9573\u4e86\u3002 PHP \u4e5f\u662f\u5982\u6b64\uff0c\u6846\u67b6\u7684\u591a\u8fdb\u7a0b\u53c8\u662f\u600e\u4e48\u4e00\u56de\u4e8b\u5462\uff1f\u4e3a\u4ec0\u4e48\u8981\u91c7\u7528\u591a\u8fdb\u7a0b\u5462\uff1f \u4f5c\u7528 \u4f7f\u7528\u8fc7\u6846\u67b6\u7684\u4f60\u4e00\u5b9a\u77e5\u9053\uff0c\u6846\u67b6\u662f\u4ee5\u547d\u4ee4\u884c\u65b9\u5f0f\u8fd0\u884c PHP \u7684\uff0c\u800c\u547d\u4ee4\u884c\u65b9\u5f0f\u8fd0\u884c PHP\uff0c\u5c31\u4ee3\u8868\u8981\u5e38\u9a7b\u5185\u5b58\uff0c\u5c31\u50cf Python\u3001Node.js \u4e00\u6837\u3002\u800c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bd4\u5982 Python \u7684 Flask \u4e3a\u5355\u7ebf\u7a0b\u5355\u8fdb\u7a0b\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u8bf4\u540c\u65f6\u53ea\u80fd\u5904\u7406\u4e00\u4e2a Web \u8bf7\u6c42\u3002\u4f46\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0c\u6bd4\u5982 Node.js\uff0c\u63d0\u4f9b\u7684\u90fd\u662f\u5f02\u6b65 I/O\uff0c\u8fd9\u4e5f\u5c31\u662f\u8bf4\u660e\u5b83\u5728 Web \u5904\u7406\u8bf7\u6c42\u4e0a\uff0c\u53ef\u540c\u65f6\u627f\u63a5\u7684 I/O \u5bc6\u96c6\u578b\u8bf7\u6c42\u4f1a\u66f4\u591a\u4e00\u4e9b\uff0c\u8fd9\u6837\u5728\u5bf9\u4e00\u822c\u7684 Web \u5e94\u7528\u4e2d I/O \u5bc6\u96c6\u578b\u573a\u666f\u975e\u5e38\u6709\u7528\uff0c\u800c\u4e14\u5f80\u5f80\u53ea\u9700\u8981\u5355\u8fdb\u7a0b\u4e5f\u53ef\u4ee5\u627f\u8f7d\u4e0a\u4e07\u7684\u5e76\u53d1\u8bf7\u6c42\u3002 \u5728\u70b8\u6bdb\u6846\u67b6\u4e2d\uff0c\u56e0\u4e3a\u6846\u67b6\u57fa\u4e8e Swoole \u6784\u5efa\uff0c\u6240\u4ee5\u5929\u7136\u652f\u6301\u534f\u7a0b\uff0c\u800c\u534f\u7a0b\u5c31\u662f\u9488\u5bf9 I/O \u64cd\u4f5c\u8fdb\u884c\u4e00\u4e2a\u8c03\u5ea6\uff0c\u7c7b\u4f3c\u5f02\u6b65\u7684 Node.js\uff0c\u6240\u4ee5\u9488\u5bf9\u9879\u76ee\u4e2d\u5b58\u5728\u592a\u591a\u7684 SQL \u8bed\u53e5\u6267\u884c\u3001\u6587\u4ef6\u8bfb\u5199\u7684\u8bdd\uff0c\u70b8\u6bdb\u6846\u67b6\u76f4\u63a5\u4e0a\u624b\uff0c\u65e0\u9700\u505a\u4efb\u4f55\u4fee\u6539\uff0c\u4e5f\u53ef\u4ee5\u8fbe\u5230\u5f88\u597d\u7684\u6027\u80fd\u3002 \u4f46\u662f \uff0cCPU \u5bc6\u96c6\u578b\u7684\u5e94\u7528\u600e\u4e48\u529e\u5462\uff1f\u5047\u8bbe\u6211\u7684 Web \u5e94\u7528\u6709\u5927\u91cf\u7684\u6392\u5e8f\u3001md5 \u8fd0\u7b97\u600e\u4e48\u529e\u5462\uff1f\u8fd9\u6837\u7684\u963b\u585e\uff0c\u5047\u8bbe\u662f\u4e00\u4e2a\u8d85\u7ea7\u5927\u7684 for \u5faa\u73af\u6216\u8005\u662f\u8981\u6267\u884c\u5f88\u957f\u65f6\u95f4\u7684 while \u5faa\u73af\uff0cCPU \u4e00\u76f4\u5728\u88ab\u5360\u7528\u3002\u591a\u8fdb\u7a0b\u5c31\u662f\u9488\u5bf9 CPU \u5bc6\u96c6\u578b\u7684\u5e94\u7528\u8bf4 yes \u7684\u4e00\u4e2a\u65b9\u6848\u3002 \u6211\u4eec\u5047\u8bbe\u73b0\u5728\u6709 3 \u4e2a\u8bf7\u6c42\u540c\u65f6\u8bbf\u95ee\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0a\u9762\u7684\u6d41\u7a0b\u9700\u8981\u6267\u884c 3 \u904d\u3002\u800c\u5982\u679c\u6211\u4eec\u53ea\u6709\u4e00\u4e2a\u8fdb\u7a0b\u7684\u8bdd\uff0c\u6700\u540e\u4e00\u4e2a\u8bf7\u6c42\u9700\u8981\u7b49\u5f85\u7684\u65f6\u95f4\u4e3a 2*3+5*3=21 \u79d2\uff0c\u975e\u5e38\u8017\u65f6\u3002 \u800c\u5982\u679c\u6709\u4e24\u4e2a\u8fdb\u7a0b\u5904\u7406 3 \u4e2a\u8bf7\u6c42\uff0c\u5219\u6700\u540e\u4e00\u4e2a\u5b8c\u6210\u7684\u8bf7\u6c42\u5c31\u7f29\u77ed\u4e86\uff0c 2+5+2+5=14 \u79d2\u3002 \u6240\u4ee5\u5982\u679c\u8981\u5145\u5206\u5229\u7528\u4f60\u7684\u670d\u52a1\u5668\u6216\u8005\u4e2a\u4eba\u7535\u8111\u7684\u591a\u6838 CPU \u8d44\u6e90\uff0c\u5c31\u8981\u8bbe\u7f6e\u591a\u4e2a\u8fdb\u7a0b\u6765\u5904\u7406\u3002\u4e00\u4e2a\u8fdb\u7a0b\u53ea\u80fd\u5728\u4e00\u4e2a CPU \u4e0a\u8fd0\u884c\uff0c\u800c\u8bbe\u7f6e\u4e86\u591a\u8fdb\u7a0b\u540e\uff0c\u5c31\u53ef\u4ee5\u8ba9\u591a\u6838 CPU \u5145\u5206\u8fd0\u884c\u591a\u4e2a\u8fdb\u7a0b\uff0c\u6240\u4ee5\u6211\u4eec\u7ed9\u6846\u67b6\u8bbe\u7f6e\u591a\u8fdb\u7a0b\u7684\u63a8\u8350\u6570\u503c\u4e3a\u7b49\u540c\u4e8e CPU \u7684\u6838\u5fc3\u6570\u3002 \u4e3a\u4ec0\u4e48\u4e0d\u662f\u591a\u7ebf\u7a0b \u56e0\u4e3a\u4f17\u6240\u5468\u77e5\uff0cPHP \u5bf9\u7ebf\u7a0b\u7684\u652f\u6301\u6bd4\u8f83\u4e0d\u597d\uff0c\u800c ZTS \u7248\u672c\u7684 PHP \u53c8\u4f1a\u5f71\u54cd\u4f20\u7edf\u7684 Web \u7aef PHP \u7684\u6027\u80fd\uff0c\u518d\u52a0\u4e0a Linux \u5bf9\u7ebf\u7a0b\u7684\u5207\u6362\u6548\u7387\u548c\u591a\u8fdb\u7a0b\u5207\u6362\u7684\u6548\u7387\u5dee\u4e0d\u591a\uff0c\u591a\u7ebf\u7a0b\u5bb9\u6613\u9020\u6210\u6570\u636e\u8bfb\u5199\u4e0d\u5b89\u5168\u7b49\u95ee\u9898\uff0c\u6545 Swoole \u4f7f\u7528\u7684\u662f\u591a\u8fdb\u7a0b\u6a21\u578b\u3002 \u6846\u67b6\u8fdb\u7a0b\u6a21\u578b \u4e0a\u56fe\u4e2d\uff0c\u6a2a\u5411\u7684\u65f6\u95f4\u7247\u53ef\u4ee5\u7406\u89e3\u4e3a\u5e76\u884c\u6267\u884c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u5728\u591a\u4e2a CPU \u5185\u53ef\u80fd\u540c\u65f6\u5728\u6267\u884c\u3002 \u8fdb\u7a0b\u95f4\u9694\u79bb \u4f17\u6240\u5468\u77e5\uff0c\u8fdb\u7a0b\u662f\u7a0b\u5e8f\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e2a\u8fb9\u754c\uff0c\u548c\u81ea\u5df1\u6709\u5173\u7684\u4e00\u5207\u53d8\u91cf\u3001\u5185\u5bb9\u548c\u4ee3\u7801\u90fd\u5728\u81ea\u5df1\u7684\u8fdb\u7a0b\u5185\uff0c\u4e0d\u540c\u8fdb\u7a0b\u4e4b\u95f4\u5982\u679c\u4e0d\u4f7f\u7528\u7ba1\u9053\u7b49\u65b9\u5f0f\uff0c\u662f\u4e0d\u53ef\u4ee5\u4e92\u76f8\u8bbf\u95ee\u7684\u3002\u800c\u52a0\u4e0a\u5f00\u59cb\u63cf\u8ff0\u7684\uff0c\u521b\u5efa\u5b50\u8fdb\u7a0b\u662f\u4e00\u4e2a\u590d\u5236\u81ea\u8eab\u7684\u8fc7\u7a0b\uff0c\u6240\u4ee5\u4e5f\u5c31\u4f1a\u6709\u5982\u4e0b\u56fe\u7684\u60c5\u51b5\uff1a \u6211\u4eec\u4ee5\u9759\u6001\u7c7b\u4e3a\u4f8b\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u7684\u5168\u5c40\u53d8\u91cf\u3002\u8fd9\u91cc\u5c31\u4f1a\u51fa\u73b0\uff0c\u540c\u4e00\u4e2a\u9759\u6001\u53d8\u91cf\u5728\u591a\u4e2a\u8fdb\u7a0b\u4e2d\u5b8c\u5168\u4e0d\u540c\u7684\u503c\u7684\u7ed3\u679c\u3002\u6b64\u540e\uff0c\u6211\u4eec\u5c06\u4f1a\u5728 Worker \u8fdb\u7a0b\u4e2d\u6267\u884c\u7528\u6237\u7684\u4ee3\u7801\uff0c\u5982\u679c\u8bbe\u7f6e Worker \u6570\u91cf\u4ec5\u4e3a 1 \u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u7b80\u5355\u8bb8\u591a\u4e86\uff0c\u4f60\u8fd8\u662f\u53ef\u4ee5\u4f7f\u7528\u5168\u5c40\u53d8\u91cf\u6216\u9759\u6001\u7c7b\u6765\u5b58\u50a8\u4f60\u60f3\u8981\u7684\u5185\u5bb9\u800c\u4e0d\u7528\u62c5\u5fc3\u8fd9\u79cd\u591a\u4e2a\u8fdb\u7a0b\u53d8\u91cf\u9694\u79bb\u7684\u60c5\u51b5\uff08\u56e0\u4e3a\u7528\u6237\u7684 Web \u8bf7\u6c42\u5904\u7406\u7684\u4ee3\u7801\u53ea\u4f1a\u5728\u4e00\u4e2a Worker \u8fdb\u7a0b\u4e2d\u6267\u884c\uff09\u3002\u5982\u679c\u50cf\u4e0a\u56fe\u4e00\u6837\u8bbe\u7f6e\u4e86\u591a\u4e2a Worker\uff0c\u5219\u7528\u6237\u8fc7\u6765\u7684\u6bd4\u5982 HTTP \u8bf7\u6c42\u5c31\u6709\u53ef\u80fd\u51fa\u73b0\u5728\u4e0d\u540c\u7684 Worker \u8fdb\u7a0b\u4e2d\uff0c\u7ed9\u5168\u5c40\u53d8\u91cf\u8bbe\u503c\u5c31\u4e00\u5b9a\u4f1a\u9020\u6210\u4e0d\u540c\u6b65\u7684\u95ee\u9898\u3002\u8fd9\u65f6\u6211\u4eec\u5c31\u4e0d\u53ef\u4ee5\u4f7f\u7528\u5168\u5c40\u53d8\u91cf\u505a\u6570\u636e\u540c\u6b65\uff08\u6ce8\u610f\uff0c\u6211\u8bf4\u7684\u662f\u6570\u636e\u540c\u6b65\uff09\u3002 \u8de8\u8fdb\u7a0b\u540c\u6b65 \u8de8\u8fdb\u7a0b\u540c\u6b65\u65b9\u6848\u4e2d\uff0c\u6846\u67b6\u7ed9\u51fa\u4e86\u5f88\u591a\u79cd\u89e3\u51b3\u65b9\u6848\u3002 MySQL \u6570\u636e\u5e93 Redis LightCache \u8f7b\u91cf\u7f13\u5b58\uff08\u5171\u4eab\u5185\u5b58\uff09 WorkerCache \u5927\u7f13\u5b58 ZMAtomic \u8de8\u8fdb\u7a0b\u539f\u5b50\u8ba1\u6570\u5668 \u4e0b\u9762\u7684\u8868\u683c\u6211\u5c06\u5217\u51fa\u4e0b\u65b9\u7684\u7279\u70b9\u548c\u5404\u81ea\u7684\u4f18\u7f3a\u70b9\uff1a \u7c7b\u578b \u7528\u9014 \u4f18\u70b9 \u7f3a\u70b9 MySQL \u5927\u578b\u7684\u4f20\u7edf\u7684\u5173\u7cfb\u5f0f\u6570\u636e\u90fd\u53ef\u4ee5\u7528\u6570\u636e\u5e93\uff0c\u4f60\u61c2\u7684 \u5c31\u662f\u6570\u636e\u5e93\u7684\u4f18\u70b9 \u548c\u6570\u636e\u5e93\u4e0d\u5728\u540c\u4e00\u53f0\u670d\u52a1\u5668\u7684\u8bdd\u7f51\u7edc\u5ef6\u8fdf\u4f1a\u8f83\u5927\uff0c\u6570\u636e\u83b7\u53d6\u6548\u7387\u4e0d\u9ad8 Redis \u4f20\u7edf\u7684 key-value \u6570\u636e\u5e93 \u6570\u636e\u65e0\u540c\u6b65\u7b49\u95ee\u9898\uff0c\u6027\u80fd\u9ad8 \u6709\u7f51\u7edc\u901a\u4fe1\u5ef6\u8fdf LightCache \u6846\u67b6\u5c01\u88c5\u7684\u8de8\u8fdb\u7a0b\u7684 key-value \u5b58\u50a8\u6a21\u578b \u6027\u80fd\u5f3a\u608d\uff0c\u65e0 I/O \u548c\u7f51\u7edc\u901a\u4fe1 \u9700\u8981\u63d0\u524d\u5206\u914d\u6700\u5927\u5185\u5b58\u5927\u5c0f\uff0c\u6700\u5927\u5355\u4e2a\u503c\u957f\u5ea6\u5927\u5c0f\uff0c\u4e0d\u7075\u6d3b WorkerCache \u6846\u67b6\u5c01\u88c5\u7684\u57fa\u4e8e\u8fdb\u7a0b\u7684 key-value \u5b58\u50a8\u6a21\u578b\uff0c\u7c7b\u4f3c Redis \u65e0\u9700\u63d0\u524d\u5206\u914d\u6700\u5927\u5185\u5b58\u5927\u5c0f\uff0c\u53d7\u9650\u4e8e PHP memory_limit \u89c1 WorkerCache \u7684\u8bf4\u660e WorkerCache \u7684\u8bf4\u660e \u5bf9\u4e8e WorkerCache \u6765\u8bf4\uff0c\u5176\u5b9e\u662f\u6bd4\u8f83\u7279\u6b8a\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u3002\u5177\u4f53\u6765\u8bf4\u5c31\u662f\uff0cWorkerCache \u7684\u539f\u7406\u5c31\u662f\u5c06\u53d8\u91cf\u6307\u5b9a\u7684\u5b58\u5230\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\uff0c\u5982\u679c\u662f\u672c\u8fdb\u7a0b\u8bfb\u5199\u7684\u8bdd\u76f4\u63a5\u76f8\u5f53\u4e8e\u6539\u4e00\u4e0b\u5168\u5c40\u53d8\u91cf\uff0c\u5982\u679c\u662f\u5176\u4ed6\u8fdb\u7a0b\u8bfb\u5199\u7684\u8bdd\uff0c\u5219\u4f9d\u9760\u8fdb\u7a0b\u95f4\u901a\u4fe1\u3002 \u6240\u4ee5\u7f3a\u70b9\u4e5f\u663e\u800c\u6613\u89c1\uff0c\u5982\u679c\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u4e0d\u662f\u547d\u4e2d\u4e86 WorkerCache \u5b58\u50a8\u6240\u5728\u7684\u8fdb\u7a0b\u7684\u8bdd\uff0c\u5219\u4e00\u76f4\u4f1a\u4f7f\u7528\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u5f71\u54cd\u4e00\u5b9a\u7684\u6548\u7387\u3002","title":"\u6846\u67b6\u591a\u8fdb\u7a0b"},{"location":"advanced/multi-process/#_1","text":"\u9996\u5148\u5bf9\u4e8e\u591a\u8fdb\u7a0b\u6982\u5ff5\uff0c\u5bf9\u4e8e\u4f20\u7edf PHP \u7a0b\u5e8f\u5458\u53ef\u80fd\u6bd4\u8f83\u964c\u751f\uff0c\u552f\u4e00\u63a5\u89e6\u5230\u7684\u5730\u65b9\u53ef\u80fd\u5c31\u662f php-fpm \u7b49\u4e00\u4e9b\u65b9\u5f0f\u5904\u7406\u65f6\u95f4\u957f\u7684\u8bf7\u6c42\u65f6\u5f00\u8fdb\u7a0b\u53bb\u6267\u884c\u3002\u5173\u4e8e\u591a\u8fdb\u7a0b\uff0c\u6211\u89c9\u5f97\u5ed6\u96ea\u5cf0\u7684 Python \u591a\u8fdb\u7a0b\u8fd9\u6bb5\u8bb2\u7684\u4e0d\u9519\uff1a Unix/Linux \u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u4e86\u4e00\u4e2a fork() \u7cfb\u7edf\u8c03\u7528\uff0c\u5b83\u975e\u5e38\u7279\u6b8a\u3002\u666e\u901a\u7684\u51fd\u6570\u8c03\u7528\uff0c\u8c03\u7528\u4e00\u6b21\uff0c\u8fd4\u56de\u4e00\u6b21\uff0c\u4f46\u662f fork() \u8c03\u7528\u4e00\u6b21\uff0c\u8fd4\u56de\u4e24\u6b21\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u81ea\u52a8\u628a\u5f53\u524d\u8fdb\u7a0b\uff08\u79f0\u4e3a\u7236\u8fdb\u7a0b\uff09\u590d\u5236\u4e86\u4e00\u4efd\uff08\u79f0\u4e3a\u5b50\u8fdb\u7a0b\uff09\uff0c\u7136\u540e\uff0c\u5206\u522b\u5728\u7236\u8fdb\u7a0b\u548c\u5b50\u8fdb\u7a0b\u5185\u8fd4\u56de\u3002 \u8fd9\u91cc\u9762\u7684\u91cd\u70b9\u5728\u4e8e\uff0c\u591a\u8fdb\u7a0b\u7684\u521b\u5efa\uff0c\u662f\u7236\u8fdb\u7a0b\u7684\u590d\u5236\uff0c\u7136\u540e\u4e24\u4e2a\u8fdb\u7a0b\u63a5\u4e0b\u6765\u8fd0\u884c\u7684\u4ee3\u7801\u548c\u5b58\u7684\u5185\u5bb9\u5c31\u5206\u9053\u626c\u9573\u4e86\u3002 PHP \u4e5f\u662f\u5982\u6b64\uff0c\u6846\u67b6\u7684\u591a\u8fdb\u7a0b\u53c8\u662f\u600e\u4e48\u4e00\u56de\u4e8b\u5462\uff1f\u4e3a\u4ec0\u4e48\u8981\u91c7\u7528\u591a\u8fdb\u7a0b\u5462\uff1f","title":"\u6846\u67b6\u591a\u8fdb\u7a0b"},{"location":"advanced/multi-process/#_2","text":"\u4f7f\u7528\u8fc7\u6846\u67b6\u7684\u4f60\u4e00\u5b9a\u77e5\u9053\uff0c\u6846\u67b6\u662f\u4ee5\u547d\u4ee4\u884c\u65b9\u5f0f\u8fd0\u884c PHP \u7684\uff0c\u800c\u547d\u4ee4\u884c\u65b9\u5f0f\u8fd0\u884c PHP\uff0c\u5c31\u4ee3\u8868\u8981\u5e38\u9a7b\u5185\u5b58\uff0c\u5c31\u50cf Python\u3001Node.js \u4e00\u6837\u3002\u800c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6bd4\u5982 Python \u7684 Flask \u4e3a\u5355\u7ebf\u7a0b\u5355\u8fdb\u7a0b\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u8bf4\u540c\u65f6\u53ea\u80fd\u5904\u7406\u4e00\u4e2a Web \u8bf7\u6c42\u3002\u4f46\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0c\u6bd4\u5982 Node.js\uff0c\u63d0\u4f9b\u7684\u90fd\u662f\u5f02\u6b65 I/O\uff0c\u8fd9\u4e5f\u5c31\u662f\u8bf4\u660e\u5b83\u5728 Web \u5904\u7406\u8bf7\u6c42\u4e0a\uff0c\u53ef\u540c\u65f6\u627f\u63a5\u7684 I/O \u5bc6\u96c6\u578b\u8bf7\u6c42\u4f1a\u66f4\u591a\u4e00\u4e9b\uff0c\u8fd9\u6837\u5728\u5bf9\u4e00\u822c\u7684 Web \u5e94\u7528\u4e2d I/O \u5bc6\u96c6\u578b\u573a\u666f\u975e\u5e38\u6709\u7528\uff0c\u800c\u4e14\u5f80\u5f80\u53ea\u9700\u8981\u5355\u8fdb\u7a0b\u4e5f\u53ef\u4ee5\u627f\u8f7d\u4e0a\u4e07\u7684\u5e76\u53d1\u8bf7\u6c42\u3002 \u5728\u70b8\u6bdb\u6846\u67b6\u4e2d\uff0c\u56e0\u4e3a\u6846\u67b6\u57fa\u4e8e Swoole \u6784\u5efa\uff0c\u6240\u4ee5\u5929\u7136\u652f\u6301\u534f\u7a0b\uff0c\u800c\u534f\u7a0b\u5c31\u662f\u9488\u5bf9 I/O \u64cd\u4f5c\u8fdb\u884c\u4e00\u4e2a\u8c03\u5ea6\uff0c\u7c7b\u4f3c\u5f02\u6b65\u7684 Node.js\uff0c\u6240\u4ee5\u9488\u5bf9\u9879\u76ee\u4e2d\u5b58\u5728\u592a\u591a\u7684 SQL \u8bed\u53e5\u6267\u884c\u3001\u6587\u4ef6\u8bfb\u5199\u7684\u8bdd\uff0c\u70b8\u6bdb\u6846\u67b6\u76f4\u63a5\u4e0a\u624b\uff0c\u65e0\u9700\u505a\u4efb\u4f55\u4fee\u6539\uff0c\u4e5f\u53ef\u4ee5\u8fbe\u5230\u5f88\u597d\u7684\u6027\u80fd\u3002 \u4f46\u662f \uff0cCPU \u5bc6\u96c6\u578b\u7684\u5e94\u7528\u600e\u4e48\u529e\u5462\uff1f\u5047\u8bbe\u6211\u7684 Web \u5e94\u7528\u6709\u5927\u91cf\u7684\u6392\u5e8f\u3001md5 \u8fd0\u7b97\u600e\u4e48\u529e\u5462\uff1f\u8fd9\u6837\u7684\u963b\u585e\uff0c\u5047\u8bbe\u662f\u4e00\u4e2a\u8d85\u7ea7\u5927\u7684 for \u5faa\u73af\u6216\u8005\u662f\u8981\u6267\u884c\u5f88\u957f\u65f6\u95f4\u7684 while \u5faa\u73af\uff0cCPU \u4e00\u76f4\u5728\u88ab\u5360\u7528\u3002\u591a\u8fdb\u7a0b\u5c31\u662f\u9488\u5bf9 CPU \u5bc6\u96c6\u578b\u7684\u5e94\u7528\u8bf4 yes \u7684\u4e00\u4e2a\u65b9\u6848\u3002 \u6211\u4eec\u5047\u8bbe\u73b0\u5728\u6709 3 \u4e2a\u8bf7\u6c42\u540c\u65f6\u8bbf\u95ee\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0a\u9762\u7684\u6d41\u7a0b\u9700\u8981\u6267\u884c 3 \u904d\u3002\u800c\u5982\u679c\u6211\u4eec\u53ea\u6709\u4e00\u4e2a\u8fdb\u7a0b\u7684\u8bdd\uff0c\u6700\u540e\u4e00\u4e2a\u8bf7\u6c42\u9700\u8981\u7b49\u5f85\u7684\u65f6\u95f4\u4e3a 2*3+5*3=21 \u79d2\uff0c\u975e\u5e38\u8017\u65f6\u3002 \u800c\u5982\u679c\u6709\u4e24\u4e2a\u8fdb\u7a0b\u5904\u7406 3 \u4e2a\u8bf7\u6c42\uff0c\u5219\u6700\u540e\u4e00\u4e2a\u5b8c\u6210\u7684\u8bf7\u6c42\u5c31\u7f29\u77ed\u4e86\uff0c 2+5+2+5=14 \u79d2\u3002 \u6240\u4ee5\u5982\u679c\u8981\u5145\u5206\u5229\u7528\u4f60\u7684\u670d\u52a1\u5668\u6216\u8005\u4e2a\u4eba\u7535\u8111\u7684\u591a\u6838 CPU \u8d44\u6e90\uff0c\u5c31\u8981\u8bbe\u7f6e\u591a\u4e2a\u8fdb\u7a0b\u6765\u5904\u7406\u3002\u4e00\u4e2a\u8fdb\u7a0b\u53ea\u80fd\u5728\u4e00\u4e2a CPU \u4e0a\u8fd0\u884c\uff0c\u800c\u8bbe\u7f6e\u4e86\u591a\u8fdb\u7a0b\u540e\uff0c\u5c31\u53ef\u4ee5\u8ba9\u591a\u6838 CPU \u5145\u5206\u8fd0\u884c\u591a\u4e2a\u8fdb\u7a0b\uff0c\u6240\u4ee5\u6211\u4eec\u7ed9\u6846\u67b6\u8bbe\u7f6e\u591a\u8fdb\u7a0b\u7684\u63a8\u8350\u6570\u503c\u4e3a\u7b49\u540c\u4e8e CPU \u7684\u6838\u5fc3\u6570\u3002","title":"\u4f5c\u7528"},{"location":"advanced/multi-process/#_3","text":"\u56e0\u4e3a\u4f17\u6240\u5468\u77e5\uff0cPHP \u5bf9\u7ebf\u7a0b\u7684\u652f\u6301\u6bd4\u8f83\u4e0d\u597d\uff0c\u800c ZTS \u7248\u672c\u7684 PHP \u53c8\u4f1a\u5f71\u54cd\u4f20\u7edf\u7684 Web \u7aef PHP \u7684\u6027\u80fd\uff0c\u518d\u52a0\u4e0a Linux \u5bf9\u7ebf\u7a0b\u7684\u5207\u6362\u6548\u7387\u548c\u591a\u8fdb\u7a0b\u5207\u6362\u7684\u6548\u7387\u5dee\u4e0d\u591a\uff0c\u591a\u7ebf\u7a0b\u5bb9\u6613\u9020\u6210\u6570\u636e\u8bfb\u5199\u4e0d\u5b89\u5168\u7b49\u95ee\u9898\uff0c\u6545 Swoole \u4f7f\u7528\u7684\u662f\u591a\u8fdb\u7a0b\u6a21\u578b\u3002","title":"\u4e3a\u4ec0\u4e48\u4e0d\u662f\u591a\u7ebf\u7a0b"},{"location":"advanced/multi-process/#_4","text":"\u4e0a\u56fe\u4e2d\uff0c\u6a2a\u5411\u7684\u65f6\u95f4\u7247\u53ef\u4ee5\u7406\u89e3\u4e3a\u5e76\u884c\u6267\u884c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u5728\u591a\u4e2a CPU \u5185\u53ef\u80fd\u540c\u65f6\u5728\u6267\u884c\u3002","title":"\u6846\u67b6\u8fdb\u7a0b\u6a21\u578b"},{"location":"advanced/multi-process/#_5","text":"\u4f17\u6240\u5468\u77e5\uff0c\u8fdb\u7a0b\u662f\u7a0b\u5e8f\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u4e00\u4e2a\u8fb9\u754c\uff0c\u548c\u81ea\u5df1\u6709\u5173\u7684\u4e00\u5207\u53d8\u91cf\u3001\u5185\u5bb9\u548c\u4ee3\u7801\u90fd\u5728\u81ea\u5df1\u7684\u8fdb\u7a0b\u5185\uff0c\u4e0d\u540c\u8fdb\u7a0b\u4e4b\u95f4\u5982\u679c\u4e0d\u4f7f\u7528\u7ba1\u9053\u7b49\u65b9\u5f0f\uff0c\u662f\u4e0d\u53ef\u4ee5\u4e92\u76f8\u8bbf\u95ee\u7684\u3002\u800c\u52a0\u4e0a\u5f00\u59cb\u63cf\u8ff0\u7684\uff0c\u521b\u5efa\u5b50\u8fdb\u7a0b\u662f\u4e00\u4e2a\u590d\u5236\u81ea\u8eab\u7684\u8fc7\u7a0b\uff0c\u6240\u4ee5\u4e5f\u5c31\u4f1a\u6709\u5982\u4e0b\u56fe\u7684\u60c5\u51b5\uff1a \u6211\u4eec\u4ee5\u9759\u6001\u7c7b\u4e3a\u4f8b\uff0c\u8bbe\u7f6e\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u7684\u5168\u5c40\u53d8\u91cf\u3002\u8fd9\u91cc\u5c31\u4f1a\u51fa\u73b0\uff0c\u540c\u4e00\u4e2a\u9759\u6001\u53d8\u91cf\u5728\u591a\u4e2a\u8fdb\u7a0b\u4e2d\u5b8c\u5168\u4e0d\u540c\u7684\u503c\u7684\u7ed3\u679c\u3002\u6b64\u540e\uff0c\u6211\u4eec\u5c06\u4f1a\u5728 Worker \u8fdb\u7a0b\u4e2d\u6267\u884c\u7528\u6237\u7684\u4ee3\u7801\uff0c\u5982\u679c\u8bbe\u7f6e Worker \u6570\u91cf\u4ec5\u4e3a 1 \u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u7b80\u5355\u8bb8\u591a\u4e86\uff0c\u4f60\u8fd8\u662f\u53ef\u4ee5\u4f7f\u7528\u5168\u5c40\u53d8\u91cf\u6216\u9759\u6001\u7c7b\u6765\u5b58\u50a8\u4f60\u60f3\u8981\u7684\u5185\u5bb9\u800c\u4e0d\u7528\u62c5\u5fc3\u8fd9\u79cd\u591a\u4e2a\u8fdb\u7a0b\u53d8\u91cf\u9694\u79bb\u7684\u60c5\u51b5\uff08\u56e0\u4e3a\u7528\u6237\u7684 Web \u8bf7\u6c42\u5904\u7406\u7684\u4ee3\u7801\u53ea\u4f1a\u5728\u4e00\u4e2a Worker \u8fdb\u7a0b\u4e2d\u6267\u884c\uff09\u3002\u5982\u679c\u50cf\u4e0a\u56fe\u4e00\u6837\u8bbe\u7f6e\u4e86\u591a\u4e2a Worker\uff0c\u5219\u7528\u6237\u8fc7\u6765\u7684\u6bd4\u5982 HTTP \u8bf7\u6c42\u5c31\u6709\u53ef\u80fd\u51fa\u73b0\u5728\u4e0d\u540c\u7684 Worker \u8fdb\u7a0b\u4e2d\uff0c\u7ed9\u5168\u5c40\u53d8\u91cf\u8bbe\u503c\u5c31\u4e00\u5b9a\u4f1a\u9020\u6210\u4e0d\u540c\u6b65\u7684\u95ee\u9898\u3002\u8fd9\u65f6\u6211\u4eec\u5c31\u4e0d\u53ef\u4ee5\u4f7f\u7528\u5168\u5c40\u53d8\u91cf\u505a\u6570\u636e\u540c\u6b65\uff08\u6ce8\u610f\uff0c\u6211\u8bf4\u7684\u662f\u6570\u636e\u540c\u6b65\uff09\u3002","title":"\u8fdb\u7a0b\u95f4\u9694\u79bb"},{"location":"advanced/multi-process/#_6","text":"\u8de8\u8fdb\u7a0b\u540c\u6b65\u65b9\u6848\u4e2d\uff0c\u6846\u67b6\u7ed9\u51fa\u4e86\u5f88\u591a\u79cd\u89e3\u51b3\u65b9\u6848\u3002 MySQL \u6570\u636e\u5e93 Redis LightCache \u8f7b\u91cf\u7f13\u5b58\uff08\u5171\u4eab\u5185\u5b58\uff09 WorkerCache \u5927\u7f13\u5b58 ZMAtomic \u8de8\u8fdb\u7a0b\u539f\u5b50\u8ba1\u6570\u5668 \u4e0b\u9762\u7684\u8868\u683c\u6211\u5c06\u5217\u51fa\u4e0b\u65b9\u7684\u7279\u70b9\u548c\u5404\u81ea\u7684\u4f18\u7f3a\u70b9\uff1a \u7c7b\u578b \u7528\u9014 \u4f18\u70b9 \u7f3a\u70b9 MySQL \u5927\u578b\u7684\u4f20\u7edf\u7684\u5173\u7cfb\u5f0f\u6570\u636e\u90fd\u53ef\u4ee5\u7528\u6570\u636e\u5e93\uff0c\u4f60\u61c2\u7684 \u5c31\u662f\u6570\u636e\u5e93\u7684\u4f18\u70b9 \u548c\u6570\u636e\u5e93\u4e0d\u5728\u540c\u4e00\u53f0\u670d\u52a1\u5668\u7684\u8bdd\u7f51\u7edc\u5ef6\u8fdf\u4f1a\u8f83\u5927\uff0c\u6570\u636e\u83b7\u53d6\u6548\u7387\u4e0d\u9ad8 Redis \u4f20\u7edf\u7684 key-value \u6570\u636e\u5e93 \u6570\u636e\u65e0\u540c\u6b65\u7b49\u95ee\u9898\uff0c\u6027\u80fd\u9ad8 \u6709\u7f51\u7edc\u901a\u4fe1\u5ef6\u8fdf LightCache \u6846\u67b6\u5c01\u88c5\u7684\u8de8\u8fdb\u7a0b\u7684 key-value \u5b58\u50a8\u6a21\u578b \u6027\u80fd\u5f3a\u608d\uff0c\u65e0 I/O \u548c\u7f51\u7edc\u901a\u4fe1 \u9700\u8981\u63d0\u524d\u5206\u914d\u6700\u5927\u5185\u5b58\u5927\u5c0f\uff0c\u6700\u5927\u5355\u4e2a\u503c\u957f\u5ea6\u5927\u5c0f\uff0c\u4e0d\u7075\u6d3b WorkerCache \u6846\u67b6\u5c01\u88c5\u7684\u57fa\u4e8e\u8fdb\u7a0b\u7684 key-value \u5b58\u50a8\u6a21\u578b\uff0c\u7c7b\u4f3c Redis \u65e0\u9700\u63d0\u524d\u5206\u914d\u6700\u5927\u5185\u5b58\u5927\u5c0f\uff0c\u53d7\u9650\u4e8e PHP memory_limit \u89c1 WorkerCache \u7684\u8bf4\u660e WorkerCache \u7684\u8bf4\u660e \u5bf9\u4e8e WorkerCache \u6765\u8bf4\uff0c\u5176\u5b9e\u662f\u6bd4\u8f83\u7279\u6b8a\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u3002\u5177\u4f53\u6765\u8bf4\u5c31\u662f\uff0cWorkerCache \u7684\u539f\u7406\u5c31\u662f\u5c06\u53d8\u91cf\u6307\u5b9a\u7684\u5b58\u5230\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\uff0c\u5982\u679c\u662f\u672c\u8fdb\u7a0b\u8bfb\u5199\u7684\u8bdd\u76f4\u63a5\u76f8\u5f53\u4e8e\u6539\u4e00\u4e0b\u5168\u5c40\u53d8\u91cf\uff0c\u5982\u679c\u662f\u5176\u4ed6\u8fdb\u7a0b\u8bfb\u5199\u7684\u8bdd\uff0c\u5219\u4f9d\u9760\u8fdb\u7a0b\u95f4\u901a\u4fe1\u3002 \u6240\u4ee5\u7f3a\u70b9\u4e5f\u663e\u800c\u6613\u89c1\uff0c\u5982\u679c\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u4e0d\u662f\u547d\u4e2d\u4e86 WorkerCache \u5b58\u50a8\u6240\u5728\u7684\u8fdb\u7a0b\u7684\u8bdd\uff0c\u5219\u4e00\u76f4\u4f1a\u4f7f\u7528\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u5f71\u54cd\u4e00\u5b9a\u7684\u6548\u7387\u3002","title":"\u8de8\u8fdb\u7a0b\u540c\u6b65"},{"location":"advanced/task-worker/","text":"\u4f7f\u7528 TaskWorker \u8fdb\u7a0b\u5904\u7406\u5bc6\u96c6\u8fd0\u7b97 \u65b0\u5f00\u4e2a\u5751\uff0c\u6709\u65f6\u95f4\u8865\u4e0a\u3002\uff08 \u586b\u5751\u6807\u8bb0 \uff09","title":"TaskWorker \u63d0\u9ad8\u5e76\u53d1"},{"location":"advanced/task-worker/#taskworker","text":"\u65b0\u5f00\u4e2a\u5751\uff0c\u6709\u65f6\u95f4\u8865\u4e0a\u3002\uff08 \u586b\u5751\u6807\u8bb0 \uff09","title":"\u4f7f\u7528 TaskWorker \u8fdb\u7a0b\u5904\u7406\u5bc6\u96c6\u8fd0\u7b97"},{"location":"advanced/to-v2/","text":"\u4ece\u70b8\u6bdb\u6846\u67b6 V1 \u5347\u7ea7 \u8fd9\u91cc\u53ea\u5199\u660e\u53ef\u80fd\u5728\u5347\u7ea7\u8fc7\u7a0b\u4e2d\u4f1a\u5f71\u54cd\u539f\u5148\u4ee3\u7801\u6267\u884c\u7684\u90e8\u5206\uff0c\u4e0d\u5305\u542b\u65b0\u589e\u7684\u7279\u6027\u7b49\u3002 \u9700\u8981\u6539\u53d8\u547d\u540d\u7a7a\u95f4\u7684\u7c7b Framework\\Console -> ZM\\Console\\Console Swlib\\Util\\SingletonTrait -> ZM\\Utils\\SingletonTrait ZM\\Annotation\\Http\\Before -> ZM\\Annotation\\Http\\HandleBefore ZM\\Annotation\\Http\\After -> ZM\\Annotation\\Http\\HandleAfter @SwooleEventAt -> @OnSwooleEvent \u5220\u9664 @SwooleEventAfter \u5220\u9664 ModBase @HandleEvent -> @SwooleHandler ZM\\Utils\\ZMRobot -> \\ZM\\API\\ZMRobot \u65b9\u6cd5\u540d\u79f0\u53d8\u66f4 ZM\\Console::stackTrace() -> ZM\\Console::trace() \u6ce8\u89e3\u7684\u53d8\u5316 @OnSwooleEvent \uff08\u539f @SwooleEventAt \uff09\u4e2d\uff0c rule \u53c2\u6570\u4e0d\u518d\u662f\u81ea\u5b9a\u4e49\u8bed\u6cd5\u7684\u4e1c\u897f\u4e86\uff08\u6bd4\u5982\u4e4b\u524d\u7684 connectType:qq \u4e4b\u7c7b\u7684\u9e21\u808b\u8bed\u6cd5\uff09\uff0c\u76f4\u63a5\u662f\u53ef\u6267\u884c\u7684 PHP \u4ee3\u7801\uff0c\u6bd4\u5982 3 == 4 \uff0c connectIsQQ() \u4e4b\u7c7b\u7684\u3002 \u53bb\u9664 @CQAPISend \uff0c\u56e0\u4e3a\u76ee\u524d\u6ca1\u4ec0\u4e48\u610f\u4e49\u3002 @CQCommand \u4e2d\uff0c regexMatch \u53d8\u6210 pattern \uff0c fullMatch \u53d8\u6210 regex \uff0c\u6d88\u9664\u6b67\u4e49\uff08\u7b2c\u4e00\u4e2a\u662f * \u53f7\u5339\u914d\u7b26\u8fdb\u884c\u5339\u914d\u7684\uff0c\u7b2c\u4e8c\u4e2a\u662f\u6807\u51c6\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\uff09\u3002\u540c\u65f6\u65b0\u589e start_with \uff0c end_with \uff0c keyword \u5e73\u884c\u9009\u9879\u3002 @OnTick \u6ce8\u89e3\u65b0\u589e\u7b2c\u4e8c\u4e2a\u53c2\u6570 worker_id \uff0c\u5176\u4e2d\u9ed8\u8ba4\u662f 0\uff0c\u4ee3\u8868\u53ea\u5728 #0 \u53f7\u5de5\u4f5c\u8fdb\u7a0b\u4e0a\u8fd0\u884c\u8ba1\u65f6\u5668\u3002 \u4e2d\u95f4\u4ef6\u7f16\u5199\u7684\u6539\u53d8 \u539f\u5148\u7684 Middleware \u662f\u9700\u8981\u542b\u6709 getName() \u65b9\u6cd5\u624d\u5408\u6cd5\uff0c\u73b0\u5728\u4e0d\u9700\u8981\u4e86\uff0c\u4f46\u662f\u5bf9 @MiddlewareClass \u6ce8\u89e3\u9700\u8981\u589e\u52a0\u53c2\u6570\uff0c\u4e5f\u5c31\u662f\u8bf4\u539f\u5148 getName() \u8fd4\u56de\u7684\u540d\u79f0\u73b0\u5728\u9700\u8981\u5199\u5230 @MiddlewareClass(\"xxx\") \u8fd9\u6837\u7684\u5f62\u5f0f\u3002 ZMBuf \u7684\u53d8\u5316 \u7531\u4e8e 2.0 \u6846\u67b6\u4f7f\u7528\u4e86\u591a\u8fdb\u7a0b\u6a21\u578b\uff0c\u6240\u4ee5\u4e0d\u80fd\u4f7f\u7528\u539f\u5148\u9002\u7528\u4e8e\u5355\u8fdb\u7a0b\u4e0b\u5168\u5c40\u53d8\u91cf\u7684\u65b9\u5f0f\uff08ZMBuf\uff09\u8fdb\u884c\u5b58\u53d6\u53d8\u91cf\uff0c\u6240\u4ee5 ZMBuf \u4e0b\u7684\u6240\u6709\u65b9\u6cd5\u90fd\u9700\u8981\u66f4\u6539\uff0c\u5176\u4e2d get, set \u7b49\u5bf9\u7f13\u5b58\u64cd\u4f5c\u7684\u6a21\u578b\u8bf7\u6839\u636e 2.0 \u7684\u6587\u6863\u53d8\u66f4\u4f7f\u7528 Redis \u6216\u5185\u7f6e\u7684\u591a\u8fdb\u7a0b\u5171\u4eab\u5185\u5b58\u53ef\u7528\u7684 LightCache \u8f7b\u91cf\u7f13\u5b58\u3002 \u800c\u83b7\u53d6\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\uff0c\u5982 global.php \u6587\u4ef6\uff0c\u4e5f\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u65b0\u6846\u67b6\u5f15\u5165\u4e86 ZMConfig \u5bf9\u8c61\uff0c\u53ef\u4ee5\u5feb\u901f\u5730\u533a\u5206\u5404\u7c7b\u73af\u5883\u53d8\u91cf\u4ece\u800c\u8bfb\u53d6\u4e0d\u540c\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u6bd4\u5982\u6211\u4eec\u83b7\u53d6\u539f\u5148\u7684 global \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u4e00\u9879\uff1a ZMBuf::globals(\"port\") \uff0c\u5728 2.0 \u4e2d\u9700\u8981\u4f7f\u7528 ZMConfig::get(\"global\", \"port\") \u65b9\u5f0f\u3002\u4ee5\u6b64\u7c7b\u63a8\uff0c ZMBuf::config(\"xxx\") \u4e5f\u76f4\u63a5\u53d8\u4e3a ZMConfig::get(\"xxx\") \u4e86\u3002","title":"\u4ece v1 \u5347\u7ea7"},{"location":"advanced/to-v2/#v1","text":"\u8fd9\u91cc\u53ea\u5199\u660e\u53ef\u80fd\u5728\u5347\u7ea7\u8fc7\u7a0b\u4e2d\u4f1a\u5f71\u54cd\u539f\u5148\u4ee3\u7801\u6267\u884c\u7684\u90e8\u5206\uff0c\u4e0d\u5305\u542b\u65b0\u589e\u7684\u7279\u6027\u7b49\u3002","title":"\u4ece\u70b8\u6bdb\u6846\u67b6 V1 \u5347\u7ea7"},{"location":"advanced/to-v2/#_1","text":"Framework\\Console -> ZM\\Console\\Console Swlib\\Util\\SingletonTrait -> ZM\\Utils\\SingletonTrait ZM\\Annotation\\Http\\Before -> ZM\\Annotation\\Http\\HandleBefore ZM\\Annotation\\Http\\After -> ZM\\Annotation\\Http\\HandleAfter @SwooleEventAt -> @OnSwooleEvent \u5220\u9664 @SwooleEventAfter \u5220\u9664 ModBase @HandleEvent -> @SwooleHandler ZM\\Utils\\ZMRobot -> \\ZM\\API\\ZMRobot","title":"\u9700\u8981\u6539\u53d8\u547d\u540d\u7a7a\u95f4\u7684\u7c7b"},{"location":"advanced/to-v2/#_2","text":"ZM\\Console::stackTrace() -> ZM\\Console::trace()","title":"\u65b9\u6cd5\u540d\u79f0\u53d8\u66f4"},{"location":"advanced/to-v2/#_3","text":"@OnSwooleEvent \uff08\u539f @SwooleEventAt \uff09\u4e2d\uff0c rule \u53c2\u6570\u4e0d\u518d\u662f\u81ea\u5b9a\u4e49\u8bed\u6cd5\u7684\u4e1c\u897f\u4e86\uff08\u6bd4\u5982\u4e4b\u524d\u7684 connectType:qq \u4e4b\u7c7b\u7684\u9e21\u808b\u8bed\u6cd5\uff09\uff0c\u76f4\u63a5\u662f\u53ef\u6267\u884c\u7684 PHP \u4ee3\u7801\uff0c\u6bd4\u5982 3 == 4 \uff0c connectIsQQ() \u4e4b\u7c7b\u7684\u3002 \u53bb\u9664 @CQAPISend \uff0c\u56e0\u4e3a\u76ee\u524d\u6ca1\u4ec0\u4e48\u610f\u4e49\u3002 @CQCommand \u4e2d\uff0c regexMatch \u53d8\u6210 pattern \uff0c fullMatch \u53d8\u6210 regex \uff0c\u6d88\u9664\u6b67\u4e49\uff08\u7b2c\u4e00\u4e2a\u662f * \u53f7\u5339\u914d\u7b26\u8fdb\u884c\u5339\u914d\u7684\uff0c\u7b2c\u4e8c\u4e2a\u662f\u6807\u51c6\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\uff09\u3002\u540c\u65f6\u65b0\u589e start_with \uff0c end_with \uff0c keyword \u5e73\u884c\u9009\u9879\u3002 @OnTick \u6ce8\u89e3\u65b0\u589e\u7b2c\u4e8c\u4e2a\u53c2\u6570 worker_id \uff0c\u5176\u4e2d\u9ed8\u8ba4\u662f 0\uff0c\u4ee3\u8868\u53ea\u5728 #0 \u53f7\u5de5\u4f5c\u8fdb\u7a0b\u4e0a\u8fd0\u884c\u8ba1\u65f6\u5668\u3002","title":"\u6ce8\u89e3\u7684\u53d8\u5316"},{"location":"advanced/to-v2/#_4","text":"\u539f\u5148\u7684 Middleware \u662f\u9700\u8981\u542b\u6709 getName() \u65b9\u6cd5\u624d\u5408\u6cd5\uff0c\u73b0\u5728\u4e0d\u9700\u8981\u4e86\uff0c\u4f46\u662f\u5bf9 @MiddlewareClass \u6ce8\u89e3\u9700\u8981\u589e\u52a0\u53c2\u6570\uff0c\u4e5f\u5c31\u662f\u8bf4\u539f\u5148 getName() \u8fd4\u56de\u7684\u540d\u79f0\u73b0\u5728\u9700\u8981\u5199\u5230 @MiddlewareClass(\"xxx\") \u8fd9\u6837\u7684\u5f62\u5f0f\u3002","title":"\u4e2d\u95f4\u4ef6\u7f16\u5199\u7684\u6539\u53d8"},{"location":"advanced/to-v2/#zmbuf","text":"\u7531\u4e8e 2.0 \u6846\u67b6\u4f7f\u7528\u4e86\u591a\u8fdb\u7a0b\u6a21\u578b\uff0c\u6240\u4ee5\u4e0d\u80fd\u4f7f\u7528\u539f\u5148\u9002\u7528\u4e8e\u5355\u8fdb\u7a0b\u4e0b\u5168\u5c40\u53d8\u91cf\u7684\u65b9\u5f0f\uff08ZMBuf\uff09\u8fdb\u884c\u5b58\u53d6\u53d8\u91cf\uff0c\u6240\u4ee5 ZMBuf \u4e0b\u7684\u6240\u6709\u65b9\u6cd5\u90fd\u9700\u8981\u66f4\u6539\uff0c\u5176\u4e2d get, set \u7b49\u5bf9\u7f13\u5b58\u64cd\u4f5c\u7684\u6a21\u578b\u8bf7\u6839\u636e 2.0 \u7684\u6587\u6863\u53d8\u66f4\u4f7f\u7528 Redis \u6216\u5185\u7f6e\u7684\u591a\u8fdb\u7a0b\u5171\u4eab\u5185\u5b58\u53ef\u7528\u7684 LightCache \u8f7b\u91cf\u7f13\u5b58\u3002 \u800c\u83b7\u53d6\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\uff0c\u5982 global.php \u6587\u4ef6\uff0c\u4e5f\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u65b0\u6846\u67b6\u5f15\u5165\u4e86 ZMConfig \u5bf9\u8c61\uff0c\u53ef\u4ee5\u5feb\u901f\u5730\u533a\u5206\u5404\u7c7b\u73af\u5883\u53d8\u91cf\u4ece\u800c\u8bfb\u53d6\u4e0d\u540c\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u6bd4\u5982\u6211\u4eec\u83b7\u53d6\u539f\u5148\u7684 global \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u4e00\u9879\uff1a ZMBuf::globals(\"port\") \uff0c\u5728 2.0 \u4e2d\u9700\u8981\u4f7f\u7528 ZMConfig::get(\"global\", \"port\") \u65b9\u5f0f\u3002\u4ee5\u6b64\u7c7b\u63a8\uff0c ZMBuf::config(\"xxx\") \u4e5f\u76f4\u63a5\u53d8\u4e3a ZMConfig::get(\"xxx\") \u4e86\u3002","title":"ZMBuf \u7684\u53d8\u5316"},{"location":"advanced/example/admin/","text":"\u7f16\u5199\u7ba1\u7406\u5458\u4e13\u5c5e\u529f\u80fd \u4f17\u6240\u5468\u77e5\uff0c\u5982\u679c\u5927\u5bb6\u4f7f\u7528\u70b8\u6bdb\u6846\u67b6\u6765\u5f00\u53d1\u804a\u5929\u673a\u5668\u4eba\u7684\u8bdd\uff0c\u4f1a\u6bd4\u8f83\u65b9\u4fbf\u3002\u4f46\u662f\u6709\u4e9b\u5730\u65b9\u4f60\u4e00\u5b9a\u4f1a\u611f\u89c9\u8fd8\u662f\u6b20\u7f3a\u4e86\u70b9\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u6837\uff0c\u4f60\u60f3\u7f16\u5199\u4e00\u4e2a\u53ea\u80fd\u7531\u673a\u5668\u4eba\u7ba1\u7406\u5458\uff0c\u4e5f\u5c31\u662f\u4f60\u81ea\u5df1\uff0c\u624d\u80fd\u89e6\u53d1\u7684\u529f\u80fd\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 /** * @CQCommand(match=\"\u7981\u8a00\",message_type=\"group\") */ public function banSomeone() { $r1 = ctx()->getNextArg(\"\u8bf7\u8f93\u5165\u7981\u8a00\u7684\u4eba\u6216at\u4ed6\"); $r2 = ctx()->getFullArg(\"\u8bf7\u8f93\u5165\u7981\u8a00\u7684\u65f6\u95f4\uff08\u79d2\uff09\"); $cq = CQ::getCQ($r1); if ($cq !== null) { if ($cq[\"type\"] != \"at\") return \"\u8bf7at\u6216\u8005\u8f93\u5165\u6b63\u786e\u7684QQ\u53f7\uff01\"; $r1 = $cq[\"params\"][\"qq\"]; } // \u7fa4\u5185\u7981\u8a00\u7528\u6237 ctx()->getRobot()->setGroupBan(ctx()->getGroupId(), $r1, $r2); return \"\u7981\u8a00\u6210\u529f\uff01\"; } \u8fd9\u65f6\u5019\uff0c\u5982\u679c\u53ea\u662f\u81ea\u5df1\u6709\u7edd\u5bf9\u7684\u6743\u5229\uff0c\u53ef\u4ee5\u5c06\u81ea\u5df1\u7684 QQ \u53f7\u5199\u6b7b\u5728\u6ce8\u89e3 @CQCommand \u4e2d\uff0c\u5e76\u9650\u5b9a user_id \uff08\u5047\u8bbe\u6211\u7684 QQ \u53f7\u7801\u4e3a 123456\uff09\uff1a 1 2 3 /** * @CQCommand(match=\"\u7981\u8a00\",message_type=\"group\",user_id=123456) */ \u4f46\u662f\uff0c\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0c\u4f60\u7684\u673a\u5668\u4eba\u4f19\u4f34\u7fa4\u53ef\u80fd\u8d8a\u6765\u8d8a\u5927\uff0c\u8fd9\u4e2a\u547d\u4ee4\u53ef\u80fd\u4e0d\u6b62\u9700\u8981\u7edd\u5bf9\u7684\u4f60\u6765\u4f7f\u7528\uff0c\u4f60\u8fd8\u8981\u5c06\u673a\u5668\u4eba\u7684\u90e8\u5206\u6743\u5229\u4e0b\u53d1\u7ed9\u66f4\u591a\u7684\u4f19\u4f34\uff0c\u600e\u4e48\u529e\u5462\uff1f\u6ce8\u89e3\u91cc\u9762\u53ea\u80fd\u5199\u6b7b\u7684\u3002 \u7b54\u6848\u5f88\u7b80\u5355\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u9700\u8981\u7528\u5230\u6846\u67b6\u63d0\u4f9b\u7684\u4e2d\u95f4\u4ef6\uff08Middleware\uff09\u3002\u4e2d\u95f4\u4ef6\u8bf4\u767d\u4e86\u5c31\u662f\u5728\u4e8b\u4ef6\u6267\u884c\u524d\u3001\u540e\u3001\u8fc7\u7a0b\u4e2d\u629b\u51fa\u7684\u5f02\u5e38\u5bf9\u5176\u8fdb\u884c\u963b\u65ad\u548c\u63d2\u5165\u4ee3\u7801\uff0c\u6bd4\u5982\u6211\u4eec\u4e0a\u65b9\u5728\u89e6\u53d1\u7981\u8a00\u8fd9\u4e2a\u6ce8\u89e3\u4e8b\u4ef6\u524d\u9996\u5148\u8981\u5224\u65ad\u6267\u884c\u8fd9\u4e2a\u547d\u4ee4\u7684\u662f\u4e0d\u662f\u94a6\u5b9a\u7684\u7ba1\u7406\u5458\u3002 \u7b2c\u4e00\u6b65\uff1a\u5b9a\u4e49\u4e2d\u95f4\u4ef6 \u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u3002\u5728\u6846\u67b6\u9ed8\u8ba4\u63d0\u4f9b\u7684\u811a\u624b\u67b6\u4e2d\uff0c\u5305\u542b\u4e86\u4e00\u4e2a\u53eb TimerMiddleware.php \u7684\u793a\u4f8b\u4e2d\u95f4\u4ef6\uff0c\u8fd9\u4e2a\u793a\u4f8b\u4e2d\u95f4\u4ef6\u7684\u76ee\u7684\u662f\u975e\u5e38\u7b80\u5355\u7684\uff0c\u5c31\u662f\u5224\u65ad\u8fd9\u4e2a\u6ce8\u89e3\u4e8b\u4ef6\u8fd0\u884c\u4e86\u591a\u957f\u65f6\u95f4\u3002\u5047\u8bbe\u4f60\u6709\u4e00\u4e2a\u673a\u5668\u4eba\u529f\u80fd\uff0c\u8fd9\u4e2a\u529f\u80fd\u4e0b\u7684\u4ee3\u7801\u9700\u8981\u6267\u884c\u5f88\u957f\u65f6\u95f4\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e00\u6ce8\u89e3\u8f7b\u677e\u5c06\u4e8b\u4ef6\u6267\u884c\u7684\u65f6\u95f4\u6253\u5370\u5230\u7ec8\u7aef\u4e0a\u3002 \u5173\u4e8e\u4e2d\u95f4\u4ef6\u7684\u6709\u5173\u8bf4\u660e\uff0c\u89c1 \u4e2d\u95f4\u4ef6 \u3002 \u4e0b\u9762\u6211\u4eec\u5047\u8bbe\u4f60\u5df2\u7ecf\u9605\u8bfb\u8fc7\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u7684\u6587\u6863\u4e86\uff0c\u6211\u4eec\u7740\u624b\u7f16\u5199\u4e00\u4e2a\u5224\u65ad\u6307\u4ee4\u6267\u884c\u8005\u662f\u5426\u662f\u6307\u5b9a\u7684\u7ba1\u7406\u5458 QQ \u7684\u4e2d\u95f4\u4ef6\u3002\u4e3a\u4e86\u7701\u4e8b\u548c\u8ba9\u5927\u5bb6\u65b9\u4fbf\u5730\u590d\u73b0\uff0c\u6211\u5148\u5728\u811a\u624b\u67b6\u4e0b\u7684\u76ee\u5f55 src/Module/Middleware/ \u4e0b\u65b0\u5efa PHP \u7c7b\u6587\u4ef6 AdminMiddleware.php \uff08\u548c TimerMiddleware.php \u5728\u540c\u4e00\u4e2a\u76ee\u5f55\uff09\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 <?php namespace Module\\Middleware ; use ZM\\Annotation\\Http\\HandleBefore ; use ZM\\Annotation\\Http\\MiddlewareClass ; use ZM\\Exception\\ZMException ; use ZM\\Http\\MiddlewareInterface ; use ZM\\Store\\LightCache ; /** * Class AdminMiddleware * \u793a\u4f8b\u4e2d\u95f4\u4ef6\uff1a\u7528\u4e8e\u52a8\u6001\u7ba1\u7406\u4e00\u4e9b\u7ba1\u7406\u5458\u6307\u4ee4\u7684\u4e2d\u95f4\u4ef6 * @package Module\\Middleware * @MiddlewareClass(\"admin\") */ class AdminMiddleware implements MiddlewareInterface { /** * @HandleBefore() * @return bool * @throws ZMException */ public function onBefore () : bool { $r = ctx () -> getUserId (); // \u4ece\u4e0a\u4e0b\u6587\u83b7\u53d6\u53d1\u6d88\u606f\u7684\u7528\u6237 QQ $admin_list = LightCache :: get ( \"admin_list\" ) ?? []; // \u4ece\u8f7b\u91cf\u7f13\u5b58\u83b7\u53d6\u7ba1\u7406\u5458\u5217\u8868 return in_array ( $r , $admin_list ); // \u8fd4\u56de\u8fd9\u4e2a QQ \u662f\u5426\u5728\u7ba1\u7406\u5458\u5217\u8868\u4e2d } } \u5176\u4e2d\uff0c @MiddlewareClass(\"admin\") \u7684\u610f\u601d\u662f\uff0c\u5b9a\u4e49\u8fd9\u4e2a\u7c7b\u4e3a\u540d\u5b57\u53eb admin \u7684\u4e2d\u95f4\u4ef6\uff0c\u540c\u65f6\uff0c\u6240\u6709\u4e2d\u95f4\u4ef6\u7684\u7c7b \u5fc5\u987b \u5e26\u4e0a implements MiddlewareInterface \uff0c\u7edf\u4e00\u63a5\u53e3\u5f62\u5f0f\u3002 @HandleBefore() \u4ee3\u8868\u7684\u662f\uff0c\u8fd9\u4e2a\u7c7b\u4e0b\u7684\u8fd9\u4e2a\u51fd\u6570\uff08onBefore\uff09\u88ab\u6807\u6ce8\u4e3a\u8fd9\u4e2a\u4e2d\u95f4\u4ef6\u7684 onBefore \u4e8b\u4ef6\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6709\u522b\u7684\u6ce8\u89e3\u4e8b\u4ef6\u63d2\u5165\u4e86\u8fd9\u4e2a admin \u4e2d\u95f4\u4ef6\uff0c\u90a3\u4e48\u6267\u884c\u5bf9\u5e94\u6ce8\u89e3\u4e8b\u4ef6\u524d\u90fd\u8981\u6267\u884c\u4e00\u4e0b @HandleBefore \u6240\u7ed1\u5b9a\u7684\u8fd9\u4e2a\u51fd\u6570\u3002\u800c\u8fd9\u4e2a\u7ed1\u5b9a\u7684\u51fd\u6570\u53ea\u80fd\u8fd4\u56de bool \u7c7b\u578b\u7684\u503c\u54e6\uff01 \u7b2c\u4e8c\u6b65\uff1a\u4f7f\u7528\u4e2d\u95f4\u4ef6 \u4f7f\u7528\u4e2d\u95f4\u4ef6\u5f88\u7b80\u5355\uff0c\u5728\u9700\u8981\u963b\u65ad\u7684\u6ce8\u89e3\u4e8b\u4ef6\u7ed1\u5b9a\u7684\u51fd\u6570\u4e0a\u518d\u52a0\u4e00\u4e2a\u6ce8\u89e3\u5c31\u597d\u4e86\uff01\u6211\u4eec\u4ee5\u4e0a\u65b9\u7684\u7981\u8a00\u4f8b\u5b50\u8bf4\u660e\uff1a 1 2 3 4 /** * @Middleware(\"admin\") * @CQCommand(match=\"\u7981\u8a00\",message_type=\"group\") */ ^ \u5047\u8bbe\u6211\u662f\u7ba1\u7406\u5458 ) \u7981\u8a00 1234567 600 ( \u7981\u8a00\u6210\u529f\uff01 ^ \u5047\u8bbe\u6211\u4e0d\u5728\u7ba1\u7406\u5458\u540d\u5355\u91cc ) \u7981\u8a00 1234567 900 ^ \u673a\u5668\u4eba\u6ca1\u6709\u56de\u590d\uff0c\u56e0\u4e3a\u4e2d\u95f4\u4ef6\u8fd4\u56de\u4e86 false\uff0c\u4e0d\u7ee7\u7eed\u6267\u884c \u800c\u8fd9\u65f6\u5019\u6709\u670b\u53cb\u53c8\u8981\u95ee\u4e86\uff0c\u5982\u679c\u6211\u6709\u4e00\u7cfb\u5217\u7ba1\u7406\u5458\u547d\u4ee4\uff0c\u5047\u8bbe\u90fd\u5728\u4e00\u4e2a\u53eb AdminFunc.php \u7684\u6a21\u5757\u7c7b\u91cc\uff0c\u6211\u662f\u4e0d\u662f\u8fd8\u5f97\u4e00\u4e2a\u4e00\u4e2a\u5730\u7ed9\u6ce8\u89e3\u4e8b\u4ef6\u5199 @Middleware(\"admin\") \u5462\uff1f\u5f53\u7136\u4e0d\u9700\u8981\uff01\u5982\u679c\u4f60\u8fd9\u4e2a\u7c7b\u6240\u6709\u7684\u6ce8\u89e3\u4e8b\u4ef6\u90fd\u662f\u673a\u5668\u4eba\u7684\u804a\u5929\u4e8b\u4ef6\uff08 @CQCommand \uff0c @CQMessage \uff09\u7684\u8bdd\uff0c\u53ef\u4ee5\u76f4\u63a5\u7ed9\u7c7b\u6ce8\u89e3\u8fd9\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u6548\u679c\u7b49\u540c\u4e8e\u7ed9\u6bcf\u4e00\u4e2a\u51fd\u6570\u5199\u4e00\u6b21\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php namespace Module\\Example ; use ZM\\Annotation\\Http\\Middleware ; /** * Class AdminFunc * @package Module\\Example * @Middleware(\"admin\") */ class AdminFunc { // ...\u8fd9\u91cc\u662f\u4f60\u7684\u4e00\u5806\u6ce8\u89e3\u4e8b\u4ef6\u7684\u51fd\u6570 } \u7b2c\u4e09\u6b65\uff1a\u8865\u5168\u4ee3\u7801 \u4e0a\u9762\u6211\u4eec\u8bb2\u5230\u4e86\uff0c\u4e2d\u95f4\u4ef6\u91cc\u9762\u4f7f\u7528\u4e86 LightCache \u8f7b\u91cf\u7f13\u5b58\u6765\u50a8\u5b58\u4e34\u65f6\u7684\u7ba1\u7406\u5458\u5217\u8868\uff0c\u90a3\u4e48\u6211\u4eec\u5c06\u8fd9\u90e8\u5206\u7684\u4ee3\u7801\u5b8c\u5584\u5427\uff01 src/Module/Example/AdminFunc.php 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 <?php namespace Module\\Example ; use ZM\\Annotation\\CQ\\CQCommand ; use ZM\\Annotation\\Http\\Middleware ; use ZM\\API\\CQ ; /** * Class AdminFunc * @package Module\\Example * @Middleware(\"admin\") */ class AdminFunc { /** * @CQCommand(match=\"\u7981\u8a00\",message_type=\"group\") */ public function banSomeone () { $r1 = ctx () -> getNextArg ( \"\u8bf7\u8f93\u5165\u7981\u8a00\u7684\u4eba\u6216at\u4ed6\" ); $r2 = ctx () -> getFullArg ( \"\u8bf7\u8f93\u5165\u7981\u8a00\u7684\u65f6\u95f4\uff08\u79d2\uff09\" ); $cq = CQ :: getCQ ( $r1 ); if ( $cq !== null ) { if ( $cq [ \"type\" ] != \"at\" ) return \"\u8bf7at\u6216\u8005\u8f93\u5165\u6b63\u786e\u7684QQ\u53f7\uff01\" ; $r1 = $cq [ \"params\" ][ \"qq\" ]; } // \u7fa4\u5185\u7981\u8a00\u7528\u6237 ctx () -> getRobot () -> setGroupBan ( ctx () -> getGroupId (), $r1 , $r2 ); return \"\u7981\u8a00\u6210\u529f\uff01\" ; } /** * @CQCommand(match=\"\u89e3\u9664\u7981\u8a00\",message_type=\"group\") */ public function unbanSomeone () { $r1 = ctx () -> getNextArg ( \"\u8bf7\u8f93\u5165\u7981\u8a00\u7684\u4eba\u6216at\u4ed6\" ); $cq = CQ :: getCQ ( $r1 ); if ( $cq !== null ) { if ( $cq [ \"type\" ] != \"at\" ) return \"\u8bf7at\u6216\u8005\u8f93\u5165\u6b63\u786e\u7684QQ\u53f7\uff01\" ; $r1 = $cq [ \"params\" ][ \"qq\" ]; } // \u7fa4\u5185\u7981\u8a00\u7528\u6237 ctx () -> getRobot () -> setGroupBan ( ctx () -> getGroupId (), $r1 , 0 ); return \"\u89e3\u9664\u7981\u8a00\u6210\u529f\uff01\" ; } } src/Module/Example/AdminManager.php 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 <?php namespace Module\\Example ; use ZM\\Annotation\\CQ\\CQCommand ; use ZM\\Annotation\\Http\\Middleware ; use ZM\\Annotation\\Swoole\\OnStart ; use ZM\\Store\\LightCache ; use ZM\\Store\\Lock\\SpinLock ; class AdminManager { /** * @OnStart() */ public function onStart () { if ( ! LightCache :: isset ( \"admin_list\" )) { //\u4e00\u6b21\u6027\u4ee3\u7801\uff0c\u9996\u6b21\u6267\u884c\u624d\u4f1a\u6267\u884cif LightCache :: set ( \"admin_list\" , [ // \u6846\u67b6\u542f\u52a8\u65f6\u521d\u59cb\u5316\u7ba1\u7406\u5458\u5217\u8868 \"123456\" , \"234567\" ], - 2 ); // \u8fd9\u91cc\u7528 -2 \u7684\u539f\u56e0\u662f\u5c06\u8fd9\u4e00\u5217\u8868\u6301\u4e45\u5316\u4fdd\u5b58\uff0c\u907f\u514d\u5173\u95ed\u6846\u67b6\u540e\u4e22\u5931 } } /** * @CQCommand(match=\"\u6dfb\u52a0\u7ba1\u7406\u5458\") * @Middleware(\"admin\") */ public function addAdmin () { //\u53ea\u6709\u7ba1\u7406\u5458\u624d\u80fd\u6dfb\u52a0\u7ba1\u7406\u5458 $qq = ctx () -> getNextArg ( \"\u8bf7\u8f93\u5165\u8981\u6dfb\u52a0\u7ba1\u7406\u5458\u7684QQ(qq\u53f7\u7801\uff0c\u4e0d\u53efat\uff09\" ); SpinLock :: lock ( \"admin_list\" ); //\u5982\u679c\u662f\u591a\u8fdb\u7a0b\u6a21\u5f0f\u7684\u8bdd\u9700\u8981\u52a0\u9501 $ls = LightCache :: get ( \"admin_list\" ); if ( ! in_array ( $qq , $ls )) $ls [] = $qq ; LightCache :: set ( \"admin_list\" , $ls , - 2 ); SpinLock :: unlock ( \"admin_list\" ); //\u5982\u679c\u662f\u591a\u8fdb\u7a0b\u6a21\u5f0f\u7684\u8bdd\u9700\u8981\u52a0\u9501 return \"\u6210\u529f\u6dfb\u52a0 $qq \u5230\u7ba1\u7406\u5458\u5217\u8868\uff01\" ; } } ^ \u73b0\u5728\u6211\u662f 123456 ) \u7981\u8a00 13579 60 ( \u7981\u8a00\u6210\u529f\uff01 ) \u89e3\u9664\u7981\u8a00 13579 ( \u89e3\u9664\u7981\u8a00\u6210\u529f\uff01 ) \u6dfb\u52a0\u7ba1\u7406\u5458 98765 ( \u6210\u529f\u6dfb\u52a0 98765 \u5230\u7ba1\u7406\u5458\u5217\u8868\uff01 ^ \u73b0\u5728\u6211\u662f98765 ) \u7981\u8a00 13579 ( \u8bf7\u8f93\u5165\u7981\u8a00\u7684\u65f6\u95f4\uff08\u79d2\uff09 ) 120 ( \u7981\u8a00\u6210\u529f\uff01","title":"\u7f16\u5199\u7ba1\u7406\u5458\u624d\u80fd\u89e6\u53d1\u7684\u529f\u80fd"},{"location":"advanced/example/admin/#_1","text":"\u4f17\u6240\u5468\u77e5\uff0c\u5982\u679c\u5927\u5bb6\u4f7f\u7528\u70b8\u6bdb\u6846\u67b6\u6765\u5f00\u53d1\u804a\u5929\u673a\u5668\u4eba\u7684\u8bdd\uff0c\u4f1a\u6bd4\u8f83\u65b9\u4fbf\u3002\u4f46\u662f\u6709\u4e9b\u5730\u65b9\u4f60\u4e00\u5b9a\u4f1a\u611f\u89c9\u8fd8\u662f\u6b20\u7f3a\u4e86\u70b9\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u6837\uff0c\u4f60\u60f3\u7f16\u5199\u4e00\u4e2a\u53ea\u80fd\u7531\u673a\u5668\u4eba\u7ba1\u7406\u5458\uff0c\u4e5f\u5c31\u662f\u4f60\u81ea\u5df1\uff0c\u624d\u80fd\u89e6\u53d1\u7684\u529f\u80fd\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 /** * @CQCommand(match=\"\u7981\u8a00\",message_type=\"group\") */ public function banSomeone() { $r1 = ctx()->getNextArg(\"\u8bf7\u8f93\u5165\u7981\u8a00\u7684\u4eba\u6216at\u4ed6\"); $r2 = ctx()->getFullArg(\"\u8bf7\u8f93\u5165\u7981\u8a00\u7684\u65f6\u95f4\uff08\u79d2\uff09\"); $cq = CQ::getCQ($r1); if ($cq !== null) { if ($cq[\"type\"] != \"at\") return \"\u8bf7at\u6216\u8005\u8f93\u5165\u6b63\u786e\u7684QQ\u53f7\uff01\"; $r1 = $cq[\"params\"][\"qq\"]; } // \u7fa4\u5185\u7981\u8a00\u7528\u6237 ctx()->getRobot()->setGroupBan(ctx()->getGroupId(), $r1, $r2); return \"\u7981\u8a00\u6210\u529f\uff01\"; } \u8fd9\u65f6\u5019\uff0c\u5982\u679c\u53ea\u662f\u81ea\u5df1\u6709\u7edd\u5bf9\u7684\u6743\u5229\uff0c\u53ef\u4ee5\u5c06\u81ea\u5df1\u7684 QQ \u53f7\u5199\u6b7b\u5728\u6ce8\u89e3 @CQCommand \u4e2d\uff0c\u5e76\u9650\u5b9a user_id \uff08\u5047\u8bbe\u6211\u7684 QQ \u53f7\u7801\u4e3a 123456\uff09\uff1a 1 2 3 /** * @CQCommand(match=\"\u7981\u8a00\",message_type=\"group\",user_id=123456) */ \u4f46\u662f\uff0c\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0c\u4f60\u7684\u673a\u5668\u4eba\u4f19\u4f34\u7fa4\u53ef\u80fd\u8d8a\u6765\u8d8a\u5927\uff0c\u8fd9\u4e2a\u547d\u4ee4\u53ef\u80fd\u4e0d\u6b62\u9700\u8981\u7edd\u5bf9\u7684\u4f60\u6765\u4f7f\u7528\uff0c\u4f60\u8fd8\u8981\u5c06\u673a\u5668\u4eba\u7684\u90e8\u5206\u6743\u5229\u4e0b\u53d1\u7ed9\u66f4\u591a\u7684\u4f19\u4f34\uff0c\u600e\u4e48\u529e\u5462\uff1f\u6ce8\u89e3\u91cc\u9762\u53ea\u80fd\u5199\u6b7b\u7684\u3002 \u7b54\u6848\u5f88\u7b80\u5355\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u9700\u8981\u7528\u5230\u6846\u67b6\u63d0\u4f9b\u7684\u4e2d\u95f4\u4ef6\uff08Middleware\uff09\u3002\u4e2d\u95f4\u4ef6\u8bf4\u767d\u4e86\u5c31\u662f\u5728\u4e8b\u4ef6\u6267\u884c\u524d\u3001\u540e\u3001\u8fc7\u7a0b\u4e2d\u629b\u51fa\u7684\u5f02\u5e38\u5bf9\u5176\u8fdb\u884c\u963b\u65ad\u548c\u63d2\u5165\u4ee3\u7801\uff0c\u6bd4\u5982\u6211\u4eec\u4e0a\u65b9\u5728\u89e6\u53d1\u7981\u8a00\u8fd9\u4e2a\u6ce8\u89e3\u4e8b\u4ef6\u524d\u9996\u5148\u8981\u5224\u65ad\u6267\u884c\u8fd9\u4e2a\u547d\u4ee4\u7684\u662f\u4e0d\u662f\u94a6\u5b9a\u7684\u7ba1\u7406\u5458\u3002","title":"\u7f16\u5199\u7ba1\u7406\u5458\u4e13\u5c5e\u529f\u80fd"},{"location":"advanced/example/admin/#_2","text":"\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u3002\u5728\u6846\u67b6\u9ed8\u8ba4\u63d0\u4f9b\u7684\u811a\u624b\u67b6\u4e2d\uff0c\u5305\u542b\u4e86\u4e00\u4e2a\u53eb TimerMiddleware.php \u7684\u793a\u4f8b\u4e2d\u95f4\u4ef6\uff0c\u8fd9\u4e2a\u793a\u4f8b\u4e2d\u95f4\u4ef6\u7684\u76ee\u7684\u662f\u975e\u5e38\u7b80\u5355\u7684\uff0c\u5c31\u662f\u5224\u65ad\u8fd9\u4e2a\u6ce8\u89e3\u4e8b\u4ef6\u8fd0\u884c\u4e86\u591a\u957f\u65f6\u95f4\u3002\u5047\u8bbe\u4f60\u6709\u4e00\u4e2a\u673a\u5668\u4eba\u529f\u80fd\uff0c\u8fd9\u4e2a\u529f\u80fd\u4e0b\u7684\u4ee3\u7801\u9700\u8981\u6267\u884c\u5f88\u957f\u65f6\u95f4\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e00\u6ce8\u89e3\u8f7b\u677e\u5c06\u4e8b\u4ef6\u6267\u884c\u7684\u65f6\u95f4\u6253\u5370\u5230\u7ec8\u7aef\u4e0a\u3002 \u5173\u4e8e\u4e2d\u95f4\u4ef6\u7684\u6709\u5173\u8bf4\u660e\uff0c\u89c1 \u4e2d\u95f4\u4ef6 \u3002 \u4e0b\u9762\u6211\u4eec\u5047\u8bbe\u4f60\u5df2\u7ecf\u9605\u8bfb\u8fc7\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u7684\u6587\u6863\u4e86\uff0c\u6211\u4eec\u7740\u624b\u7f16\u5199\u4e00\u4e2a\u5224\u65ad\u6307\u4ee4\u6267\u884c\u8005\u662f\u5426\u662f\u6307\u5b9a\u7684\u7ba1\u7406\u5458 QQ \u7684\u4e2d\u95f4\u4ef6\u3002\u4e3a\u4e86\u7701\u4e8b\u548c\u8ba9\u5927\u5bb6\u65b9\u4fbf\u5730\u590d\u73b0\uff0c\u6211\u5148\u5728\u811a\u624b\u67b6\u4e0b\u7684\u76ee\u5f55 src/Module/Middleware/ \u4e0b\u65b0\u5efa PHP \u7c7b\u6587\u4ef6 AdminMiddleware.php \uff08\u548c TimerMiddleware.php \u5728\u540c\u4e00\u4e2a\u76ee\u5f55\uff09\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 <?php namespace Module\\Middleware ; use ZM\\Annotation\\Http\\HandleBefore ; use ZM\\Annotation\\Http\\MiddlewareClass ; use ZM\\Exception\\ZMException ; use ZM\\Http\\MiddlewareInterface ; use ZM\\Store\\LightCache ; /** * Class AdminMiddleware * \u793a\u4f8b\u4e2d\u95f4\u4ef6\uff1a\u7528\u4e8e\u52a8\u6001\u7ba1\u7406\u4e00\u4e9b\u7ba1\u7406\u5458\u6307\u4ee4\u7684\u4e2d\u95f4\u4ef6 * @package Module\\Middleware * @MiddlewareClass(\"admin\") */ class AdminMiddleware implements MiddlewareInterface { /** * @HandleBefore() * @return bool * @throws ZMException */ public function onBefore () : bool { $r = ctx () -> getUserId (); // \u4ece\u4e0a\u4e0b\u6587\u83b7\u53d6\u53d1\u6d88\u606f\u7684\u7528\u6237 QQ $admin_list = LightCache :: get ( \"admin_list\" ) ?? []; // \u4ece\u8f7b\u91cf\u7f13\u5b58\u83b7\u53d6\u7ba1\u7406\u5458\u5217\u8868 return in_array ( $r , $admin_list ); // \u8fd4\u56de\u8fd9\u4e2a QQ \u662f\u5426\u5728\u7ba1\u7406\u5458\u5217\u8868\u4e2d } } \u5176\u4e2d\uff0c @MiddlewareClass(\"admin\") \u7684\u610f\u601d\u662f\uff0c\u5b9a\u4e49\u8fd9\u4e2a\u7c7b\u4e3a\u540d\u5b57\u53eb admin \u7684\u4e2d\u95f4\u4ef6\uff0c\u540c\u65f6\uff0c\u6240\u6709\u4e2d\u95f4\u4ef6\u7684\u7c7b \u5fc5\u987b \u5e26\u4e0a implements MiddlewareInterface \uff0c\u7edf\u4e00\u63a5\u53e3\u5f62\u5f0f\u3002 @HandleBefore() \u4ee3\u8868\u7684\u662f\uff0c\u8fd9\u4e2a\u7c7b\u4e0b\u7684\u8fd9\u4e2a\u51fd\u6570\uff08onBefore\uff09\u88ab\u6807\u6ce8\u4e3a\u8fd9\u4e2a\u4e2d\u95f4\u4ef6\u7684 onBefore \u4e8b\u4ef6\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6709\u522b\u7684\u6ce8\u89e3\u4e8b\u4ef6\u63d2\u5165\u4e86\u8fd9\u4e2a admin \u4e2d\u95f4\u4ef6\uff0c\u90a3\u4e48\u6267\u884c\u5bf9\u5e94\u6ce8\u89e3\u4e8b\u4ef6\u524d\u90fd\u8981\u6267\u884c\u4e00\u4e0b @HandleBefore \u6240\u7ed1\u5b9a\u7684\u8fd9\u4e2a\u51fd\u6570\u3002\u800c\u8fd9\u4e2a\u7ed1\u5b9a\u7684\u51fd\u6570\u53ea\u80fd\u8fd4\u56de bool \u7c7b\u578b\u7684\u503c\u54e6\uff01","title":"\u7b2c\u4e00\u6b65\uff1a\u5b9a\u4e49\u4e2d\u95f4\u4ef6"},{"location":"advanced/example/admin/#_3","text":"\u4f7f\u7528\u4e2d\u95f4\u4ef6\u5f88\u7b80\u5355\uff0c\u5728\u9700\u8981\u963b\u65ad\u7684\u6ce8\u89e3\u4e8b\u4ef6\u7ed1\u5b9a\u7684\u51fd\u6570\u4e0a\u518d\u52a0\u4e00\u4e2a\u6ce8\u89e3\u5c31\u597d\u4e86\uff01\u6211\u4eec\u4ee5\u4e0a\u65b9\u7684\u7981\u8a00\u4f8b\u5b50\u8bf4\u660e\uff1a 1 2 3 4 /** * @Middleware(\"admin\") * @CQCommand(match=\"\u7981\u8a00\",message_type=\"group\") */ ^ \u5047\u8bbe\u6211\u662f\u7ba1\u7406\u5458 ) \u7981\u8a00 1234567 600 ( \u7981\u8a00\u6210\u529f\uff01 ^ \u5047\u8bbe\u6211\u4e0d\u5728\u7ba1\u7406\u5458\u540d\u5355\u91cc ) \u7981\u8a00 1234567 900 ^ \u673a\u5668\u4eba\u6ca1\u6709\u56de\u590d\uff0c\u56e0\u4e3a\u4e2d\u95f4\u4ef6\u8fd4\u56de\u4e86 false\uff0c\u4e0d\u7ee7\u7eed\u6267\u884c \u800c\u8fd9\u65f6\u5019\u6709\u670b\u53cb\u53c8\u8981\u95ee\u4e86\uff0c\u5982\u679c\u6211\u6709\u4e00\u7cfb\u5217\u7ba1\u7406\u5458\u547d\u4ee4\uff0c\u5047\u8bbe\u90fd\u5728\u4e00\u4e2a\u53eb AdminFunc.php \u7684\u6a21\u5757\u7c7b\u91cc\uff0c\u6211\u662f\u4e0d\u662f\u8fd8\u5f97\u4e00\u4e2a\u4e00\u4e2a\u5730\u7ed9\u6ce8\u89e3\u4e8b\u4ef6\u5199 @Middleware(\"admin\") \u5462\uff1f\u5f53\u7136\u4e0d\u9700\u8981\uff01\u5982\u679c\u4f60\u8fd9\u4e2a\u7c7b\u6240\u6709\u7684\u6ce8\u89e3\u4e8b\u4ef6\u90fd\u662f\u673a\u5668\u4eba\u7684\u804a\u5929\u4e8b\u4ef6\uff08 @CQCommand \uff0c @CQMessage \uff09\u7684\u8bdd\uff0c\u53ef\u4ee5\u76f4\u63a5\u7ed9\u7c7b\u6ce8\u89e3\u8fd9\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u6548\u679c\u7b49\u540c\u4e8e\u7ed9\u6bcf\u4e00\u4e2a\u51fd\u6570\u5199\u4e00\u6b21\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php namespace Module\\Example ; use ZM\\Annotation\\Http\\Middleware ; /** * Class AdminFunc * @package Module\\Example * @Middleware(\"admin\") */ class AdminFunc { // ...\u8fd9\u91cc\u662f\u4f60\u7684\u4e00\u5806\u6ce8\u89e3\u4e8b\u4ef6\u7684\u51fd\u6570 }","title":"\u7b2c\u4e8c\u6b65\uff1a\u4f7f\u7528\u4e2d\u95f4\u4ef6"},{"location":"advanced/example/admin/#_4","text":"\u4e0a\u9762\u6211\u4eec\u8bb2\u5230\u4e86\uff0c\u4e2d\u95f4\u4ef6\u91cc\u9762\u4f7f\u7528\u4e86 LightCache \u8f7b\u91cf\u7f13\u5b58\u6765\u50a8\u5b58\u4e34\u65f6\u7684\u7ba1\u7406\u5458\u5217\u8868\uff0c\u90a3\u4e48\u6211\u4eec\u5c06\u8fd9\u90e8\u5206\u7684\u4ee3\u7801\u5b8c\u5584\u5427\uff01 src/Module/Example/AdminFunc.php 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 <?php namespace Module\\Example ; use ZM\\Annotation\\CQ\\CQCommand ; use ZM\\Annotation\\Http\\Middleware ; use ZM\\API\\CQ ; /** * Class AdminFunc * @package Module\\Example * @Middleware(\"admin\") */ class AdminFunc { /** * @CQCommand(match=\"\u7981\u8a00\",message_type=\"group\") */ public function banSomeone () { $r1 = ctx () -> getNextArg ( \"\u8bf7\u8f93\u5165\u7981\u8a00\u7684\u4eba\u6216at\u4ed6\" ); $r2 = ctx () -> getFullArg ( \"\u8bf7\u8f93\u5165\u7981\u8a00\u7684\u65f6\u95f4\uff08\u79d2\uff09\" ); $cq = CQ :: getCQ ( $r1 ); if ( $cq !== null ) { if ( $cq [ \"type\" ] != \"at\" ) return \"\u8bf7at\u6216\u8005\u8f93\u5165\u6b63\u786e\u7684QQ\u53f7\uff01\" ; $r1 = $cq [ \"params\" ][ \"qq\" ]; } // \u7fa4\u5185\u7981\u8a00\u7528\u6237 ctx () -> getRobot () -> setGroupBan ( ctx () -> getGroupId (), $r1 , $r2 ); return \"\u7981\u8a00\u6210\u529f\uff01\" ; } /** * @CQCommand(match=\"\u89e3\u9664\u7981\u8a00\",message_type=\"group\") */ public function unbanSomeone () { $r1 = ctx () -> getNextArg ( \"\u8bf7\u8f93\u5165\u7981\u8a00\u7684\u4eba\u6216at\u4ed6\" ); $cq = CQ :: getCQ ( $r1 ); if ( $cq !== null ) { if ( $cq [ \"type\" ] != \"at\" ) return \"\u8bf7at\u6216\u8005\u8f93\u5165\u6b63\u786e\u7684QQ\u53f7\uff01\" ; $r1 = $cq [ \"params\" ][ \"qq\" ]; } // \u7fa4\u5185\u7981\u8a00\u7528\u6237 ctx () -> getRobot () -> setGroupBan ( ctx () -> getGroupId (), $r1 , 0 ); return \"\u89e3\u9664\u7981\u8a00\u6210\u529f\uff01\" ; } } src/Module/Example/AdminManager.php 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 <?php namespace Module\\Example ; use ZM\\Annotation\\CQ\\CQCommand ; use ZM\\Annotation\\Http\\Middleware ; use ZM\\Annotation\\Swoole\\OnStart ; use ZM\\Store\\LightCache ; use ZM\\Store\\Lock\\SpinLock ; class AdminManager { /** * @OnStart() */ public function onStart () { if ( ! LightCache :: isset ( \"admin_list\" )) { //\u4e00\u6b21\u6027\u4ee3\u7801\uff0c\u9996\u6b21\u6267\u884c\u624d\u4f1a\u6267\u884cif LightCache :: set ( \"admin_list\" , [ // \u6846\u67b6\u542f\u52a8\u65f6\u521d\u59cb\u5316\u7ba1\u7406\u5458\u5217\u8868 \"123456\" , \"234567\" ], - 2 ); // \u8fd9\u91cc\u7528 -2 \u7684\u539f\u56e0\u662f\u5c06\u8fd9\u4e00\u5217\u8868\u6301\u4e45\u5316\u4fdd\u5b58\uff0c\u907f\u514d\u5173\u95ed\u6846\u67b6\u540e\u4e22\u5931 } } /** * @CQCommand(match=\"\u6dfb\u52a0\u7ba1\u7406\u5458\") * @Middleware(\"admin\") */ public function addAdmin () { //\u53ea\u6709\u7ba1\u7406\u5458\u624d\u80fd\u6dfb\u52a0\u7ba1\u7406\u5458 $qq = ctx () -> getNextArg ( \"\u8bf7\u8f93\u5165\u8981\u6dfb\u52a0\u7ba1\u7406\u5458\u7684QQ(qq\u53f7\u7801\uff0c\u4e0d\u53efat\uff09\" ); SpinLock :: lock ( \"admin_list\" ); //\u5982\u679c\u662f\u591a\u8fdb\u7a0b\u6a21\u5f0f\u7684\u8bdd\u9700\u8981\u52a0\u9501 $ls = LightCache :: get ( \"admin_list\" ); if ( ! in_array ( $qq , $ls )) $ls [] = $qq ; LightCache :: set ( \"admin_list\" , $ls , - 2 ); SpinLock :: unlock ( \"admin_list\" ); //\u5982\u679c\u662f\u591a\u8fdb\u7a0b\u6a21\u5f0f\u7684\u8bdd\u9700\u8981\u52a0\u9501 return \"\u6210\u529f\u6dfb\u52a0 $qq \u5230\u7ba1\u7406\u5458\u5217\u8868\uff01\" ; } } ^ \u73b0\u5728\u6211\u662f 123456 ) \u7981\u8a00 13579 60 ( \u7981\u8a00\u6210\u529f\uff01 ) \u89e3\u9664\u7981\u8a00 13579 ( \u89e3\u9664\u7981\u8a00\u6210\u529f\uff01 ) \u6dfb\u52a0\u7ba1\u7406\u5458 98765 ( \u6210\u529f\u6dfb\u52a0 98765 \u5230\u7ba1\u7406\u5458\u5217\u8868\uff01 ^ \u73b0\u5728\u6211\u662f98765 ) \u7981\u8a00 13579 ( \u8bf7\u8f93\u5165\u7981\u8a00\u7684\u65f6\u95f4\uff08\u79d2\uff09 ) 120 ( \u7981\u8a00\u6210\u529f\uff01","title":"\u7b2c\u4e09\u6b65\uff1a\u8865\u5168\u4ee3\u7801"},{"location":"component/","text":"\u6846\u67b6\u7ec4\u4ef6 \u8fd9\u91cc\u5217\u4e3e\u4e86\u6846\u67b6\u5185\u7684\u4f60\u53ef\u80fd\u4f1a\u7528\u5230\u7684\u5e38\u7528\u7ec4\u4ef6\u3002","title":"\u6846\u67b6\u7ec4\u4ef6"},{"location":"component/#_1","text":"\u8fd9\u91cc\u5217\u4e3e\u4e86\u6846\u67b6\u5185\u7684\u4f60\u53ef\u80fd\u4f1a\u7528\u5230\u7684\u5e38\u7528\u7ec4\u4ef6\u3002","title":"\u6846\u67b6\u7ec4\u4ef6"},{"location":"component/console/","text":"Console \u63a7\u5236\u53f0 Console \u7c7b\u6240\u5728\u547d\u540d\u7a7a\u95f4\uff1a \\ZM\\Console\\Console Console \u7c7b\u4e3a\u6846\u67b6\u7684\u7ec8\u7aef\u8f93\u51fa\u7ba1\u7406\u7c7b\u3002 \u8bbe\u7f6e Log \u8f93\u51fa\u7b49\u7ea7 \u8f93\u51fa\u7b49\u7ea7 \u63a7\u5236\u4e86\u8f93\u51fa\u5230\u547d\u4ee4\u884c\u7684\u5185\u5bb9\u7684\u91cd\u8981\u6027\u3002\u5728\u6846\u67b6\u7684\u8f93\u51fa\u4e2d\uff0c\u6d88\u606f\u6709\u4ee5\u4e0b\u51e0\u79cd\u4e0d\u540c\u7b49\u7ea7\u7684\u7c7b\u522b error / log : 0 warning : 1 info / success : 2 verbose : 3 debug : 4 \u8f93\u51fa\u7b49\u7ea7\u8bbe\u7f6e\u540e\u663e\u793a\u7684\u6d88\u606f\u7c7b\u522b\u4e3a\u5c0f\u4e8e\u7b49\u4e8e\u5f53\u524d log \u7684\u3002\u5047\u8bbe\u4f60\u5c06 log \u7b49\u7ea7\u8bbe\u7f6e\u4e3a 3\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u9664 debug \u5916\u7684\u6240\u6709 log \u5185\u5bb9\u3002 \u901a\u8fc7\u914d\u7f6e\u6587\u4ef6 global.php \u4e2d\u7684 init_atomics -> info_level \u7684\u6570\u503c\u4f60\u53ef\u4ee5\u66f4\u6539\u6846\u67b6\u7684\u9ed8\u8ba4 log \u7b49\u7ea7\uff08\u9ed8\u8ba4\u4e3a 2\uff09\u3002 \u4f60\u4e5f\u53ef\u4ee5\u5728\u542f\u52a8\u6846\u67b6\u7684\u547d\u4ee4\u884c\u4e2d\u6dfb\u52a0\u53c2\u6570\u6765\u5207\u6362 log \u7b49\u7ea7\uff1a 1 2 3 4 5 vendor/bin/start server --log-error # \u4ee5 error \u7b49\u7ea7\u542f\u52a8\u6846\u67b6 vendor/bin/start server --log-warning # \u4ee5 warning \u7b49\u7ea7\u542f\u52a8\u6846\u67b6 vendor/bin/start server --log-info # \u4ee5 info \u7b49\u7ea7\u542f\u52a8\u6846\u67b6 vendor/bin/start server --log-verbose # \u4ee5 verbose \u7b49\u7ea7\u542f\u52a8\u6846\u67b6 vendor/bin/start server --log-debug # \u4ee5 debug \u7b49\u7ea7\u542f\u52a8\u6846\u67b6 \u4f7f\u7528 Log \u8f93\u51fa\u5185\u5bb9 \u4f5c\u4e3a\u6a21\u5757\u5f00\u53d1\u8005\u7684\u4f60\uff0c\u4f60\u53ef\u4ee5\u4e3b\u52a8\u8c03\u7528\u6846\u67b6\u5185\u7684 Console \u7c7b\u8f93\u51fa\u4fe1\u606f\u5230\u7ec8\u7aef\u3002 Console::log() \u8f93\u51fa 0 \u7ea7\u522b\u7684\u666e\u901a log\u3002 \u53c2\u6570\uff1a $msg, $color \uff0c\u5206\u522b\u4e3a\u5185\u5bb9\u548c\u5b57\u4f53\u989c\u8272\u3002 \u6b64 log \u4e0d\u4f1a\u88ab info_level \u6240\u9650\u5236\uff0c\u65e0\u8bba\u5982\u4f55\u4e5f\u4f1a\u8f93\u51fa\u5230\u7ec8\u7aef\u3002 Console::error() \u8f93\u51fa error \u7ea7\u522b\u7684\u7ea2\u8272\u9192\u76ee log\u3002\u4e00\u822c\u6b64 log \u4e3a\u6846\u67b6\u5185\u90e8\u51fa\u73b0\u4e0d\u53ef\u5fcd\u53d7\u7684\u9519\u8bef\uff0c\u6bd4\u5982\u5185\u5b58\u4e0d\u8db3\u3001PHP fatal error \u7b49\u9519\u8bef\u3002 \u53c2\u6570\uff1a $msg \u6b64 log \u4e0d\u4f1a\u88ab info_level \u6240\u9650\u5236\uff0c\u65e0\u8bba\u5982\u4f55\u4e5f\u4f1a\u8f93\u51fa\u5230\u7ec8\u7aef\u3002 Console::warning() \u8f93\u51fa warning \u7ea7\u522b\u7684 log\u3002 Warning \u6846\u67b6\u5185\u51fa\u73b0\u7684\u7528\u6237\u6001\u5f02\u5e38\uff0c\u6bd4\u5982\u65e0\u6cd5\u53d1\u9001 API\u3001\u65e0\u6cd5\u8fde\u63a5\u6570\u636e\u5e93\u7b49\u9519\u8bef\uff0c\u90fd\u662f warning \u9519\u8bef\uff0c\u4e0d\u4f1a\u5bfc\u81f4\u6846\u67b6\u5d29\u6e83\u6216\u529f\u80fd\u9519\u8bef\u7684\u5f02\u5e38\u60c5\u51b5\u5efa\u8bae\u90fd\u4f7f\u7528 warning \u8f93\u51fa\u800c\u4e0d\u662f error\u3002 Console::info() \u8f93\u51fa info \u7ea7\u522b\u7684 log\u3002 Console::success() \u8f93\u51fa success \u7ea7\u522b\u7684log\u3002 Console::verbose() \u8f93\u51fa verbose \u7ea7\u522b\u7684 log\u3002 Console::debug() \u8f93\u51fa debug \u7ea7\u522b\u7684 log\u3002 Console::stackTrace() \u8f93\u51fa\u6808\u8ffd\u8e2a\u4fe1\u606f\u3002 Console::setColor() \u8fd4\u56de\uff1a\u5f69\u8272\u7684\u5b57\u7b26\u4e32\u3002 string : \u8981\u53d8\u989c\u8272\u7684\u5b57\u7b26\u4e32 color : \u8981\u53d8\u7684\u989c\u8272\u3002\u652f\u6301 red \uff0c green \uff0c yellow \uff0c reset \uff0c blue \uff0c gray \uff0c gold \uff0c pink \uff0c lightblue \uff0c lightlightblue 1 2 3 4 5 6 7 8 9 Console::log(\"This is normal msg. (0)\"); Console::error(\"This is error msg. (0)\"); Console::warning(\"This is warning msg. (1)\"); Console::info(\"This is info msg. (2)\"); Console::success(\"This is success msg. (2)\"); Console::verbose(\"This is verbose msg. (3)\"); Console::debug(\"This is debug msg. (4)\"); Console::stackTrace(); $str = Console::setColor(\"I am gold color.\", \"gold\"); \u7ec8\u7aef\u4ea4\u4e92\u547d\u4ee4 \u70b8\u6bdb\u6846\u67b6\u652f\u6301\u4ece\u7ec8\u7aef\u8f93\u5165\u547d\u4ee4\u6765\u8fdb\u884c\u4e00\u4e9b\u64cd\u4f5c\uff0c\u4f8b\u5982\u91cd\u542f\u6846\u67b6\u3001\u505c\u6b62\u6846\u67b6\u3001\u6267\u884c\u51fd\u6570\u7b49\u3002 Warning \u5728 Docker\u3001systemd\u3001daemon \u72b6\u6001\u4e0b\u542f\u52a8\u7684\u6846\u67b6\u4f1a\u81ea\u52a8\u5173\u95ed\u7ec8\u7aef\u7b49\u5f85\u8f93\u5165\uff0c\u4ea4\u4e92\u4e0d\u53ef\u7528\u3002 reload \u91cd\u65b0\u52a0\u8f7d\u9664 src/Framework/ \u4e0b\u7684\u6240\u6709\u6a21\u5757\u3002 \u522b\u540d\uff1a r stop \u505c\u6b62\u6846\u67b6\u3002 logtest \u8f93\u51fa\u5404\u79cd\u7b49\u7ea7\u7684 log \u793a\u4f8b\u6587\u672c\u3002 call \u6267\u884c\u5bf9\u5e94\u7c7b\u7684\u6210\u5458\u65b9\u6cd5\u3002\u4e0b\u9762\u662f\u4f8b\u5b50\uff1a 1 call \\Z M \\U tils \\Z MUtil reload bc \u76f4\u63a5\u6267\u884c PHP \u4ee3\u7801\uff0c\u8f93\u5165\u683c\u5f0f\u4e3a base64\u3002 1 2 3 bc XEZyYW1ld29ya1xDb25zb2xlOjp3YXJuaW5nKCJoZWxsbyB3YXJuaW5nISIpOw == # \u4ee3\u7801\u5185\u5bb9\uff1a\\ZM\\Console\\Console::warning(\"hello warning!\"); # \u7ec8\u7aef\u8f93\u51fa\uff1a[19:14:32] [W] hello warning! echo \u8f93\u51fa\u6587\u672c 1 echo hello color \u6309\u7167\u989c\u8272\u8f93\u51fa\u6587\u672c 1 color green \u6211\u662f\u7eff\u8272\u7684\u5b57 MOTD \u5728 1.4 \u7248\u672c\u5f00\u59cb\uff0c\u6846\u67b6\u652f\u6301\u542f\u52a8\u65f6\u7684 motd \u5185\u5bb9\u4fee\u6539\u3002 \u6587\u4ef6\u4f4d\u7f6e\uff1a config/motd.txt \u5176\u4e2d\uff0c\u9ed8\u8ba4\u7684 Zhamao \u5b57\u6837\u7684 MOTD \u662f\u4f7f\u7528 figlet \u547d\u4ee4\u751f\u6210\u7684\uff0c figlet \"Zhamao\" \uff0c\u4f60\u4e5f\u53ef\u4ee5\u9488\u5bf9\u81ea\u5df1\u7684\u673a\u5668\u4eba\u540d\u79f0\u6216\u54c1\u724c\u8fdb\u884c\u751f\u6210\u3002 \u8bbe\u7f6e\u8f93\u51fa\u4e3b\u9898 Console \u7ec4\u4ef6\u652f\u6301\u4e3a\u591a\u79cd\u4e0d\u540c\u7684\u7ec8\u7aef\u8bbe\u7f6e\u4e0d\u540c\u7684\u4e3b\u9898\uff0c\u6bd4\u5982\u6709\u4e9b\u4eba\u559c\u6b22\u4f7f\u7528\u767d\u8272\u7684\u7ec8\u7aef\uff0c\u4f46\u662f\u767d\u8272\u7ec8\u7aef\u4e0b info \u7684\u989c\u8272\u5f88\u6d45\uff0c\u770b\u4e0d\u5230\uff0c\u8fd8\u6709\u4eba\u4f7f\u7528\u4e0d\u80fd\u663e\u793a\u989c\u8272\u7684\u9ed1\u767d\u7ec8\u7aef..... 1 vendor/bin/start server --log-theme ={ \u4e3b\u9898\u540d } \u73b0\u6709\u652f\u6301\u7684\u4e3b\u9898\u6709\uff1a default \uff0c white-term \uff0c no-color 1 2 vendor/bin/start server --log-theme = white-term # \u5982\u679c\u7528\u7684\u662f\u767d\u8272\u7ec8\u7aef\uff0c\u8fd9\u4e2a\u4e3b\u9898\u66f4\u53cb\u597d vendor/bin/start server --log-theme = no-color # \u5982\u679c\u4e0d\u60f3\u8ba9 log \u5e26\u6709\u4efb\u4f55\u989c\u8272\uff0c\u4f7f\u7528\u65e0\u8272\u4e3b\u9898","title":"Console \u7ec8\u7aef"},{"location":"component/console/#console","text":"Console \u7c7b\u6240\u5728\u547d\u540d\u7a7a\u95f4\uff1a \\ZM\\Console\\Console Console \u7c7b\u4e3a\u6846\u67b6\u7684\u7ec8\u7aef\u8f93\u51fa\u7ba1\u7406\u7c7b\u3002","title":"Console \u63a7\u5236\u53f0"},{"location":"component/console/#log","text":"\u8f93\u51fa\u7b49\u7ea7 \u63a7\u5236\u4e86\u8f93\u51fa\u5230\u547d\u4ee4\u884c\u7684\u5185\u5bb9\u7684\u91cd\u8981\u6027\u3002\u5728\u6846\u67b6\u7684\u8f93\u51fa\u4e2d\uff0c\u6d88\u606f\u6709\u4ee5\u4e0b\u51e0\u79cd\u4e0d\u540c\u7b49\u7ea7\u7684\u7c7b\u522b error / log : 0 warning : 1 info / success : 2 verbose : 3 debug : 4 \u8f93\u51fa\u7b49\u7ea7\u8bbe\u7f6e\u540e\u663e\u793a\u7684\u6d88\u606f\u7c7b\u522b\u4e3a\u5c0f\u4e8e\u7b49\u4e8e\u5f53\u524d log \u7684\u3002\u5047\u8bbe\u4f60\u5c06 log \u7b49\u7ea7\u8bbe\u7f6e\u4e3a 3\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u9664 debug \u5916\u7684\u6240\u6709 log \u5185\u5bb9\u3002 \u901a\u8fc7\u914d\u7f6e\u6587\u4ef6 global.php \u4e2d\u7684 init_atomics -> info_level \u7684\u6570\u503c\u4f60\u53ef\u4ee5\u66f4\u6539\u6846\u67b6\u7684\u9ed8\u8ba4 log \u7b49\u7ea7\uff08\u9ed8\u8ba4\u4e3a 2\uff09\u3002 \u4f60\u4e5f\u53ef\u4ee5\u5728\u542f\u52a8\u6846\u67b6\u7684\u547d\u4ee4\u884c\u4e2d\u6dfb\u52a0\u53c2\u6570\u6765\u5207\u6362 log \u7b49\u7ea7\uff1a 1 2 3 4 5 vendor/bin/start server --log-error # \u4ee5 error \u7b49\u7ea7\u542f\u52a8\u6846\u67b6 vendor/bin/start server --log-warning # \u4ee5 warning \u7b49\u7ea7\u542f\u52a8\u6846\u67b6 vendor/bin/start server --log-info # \u4ee5 info \u7b49\u7ea7\u542f\u52a8\u6846\u67b6 vendor/bin/start server --log-verbose # \u4ee5 verbose \u7b49\u7ea7\u542f\u52a8\u6846\u67b6 vendor/bin/start server --log-debug # \u4ee5 debug \u7b49\u7ea7\u542f\u52a8\u6846\u67b6","title":"\u8bbe\u7f6e Log \u8f93\u51fa\u7b49\u7ea7"},{"location":"component/console/#log_1","text":"\u4f5c\u4e3a\u6a21\u5757\u5f00\u53d1\u8005\u7684\u4f60\uff0c\u4f60\u53ef\u4ee5\u4e3b\u52a8\u8c03\u7528\u6846\u67b6\u5185\u7684 Console \u7c7b\u8f93\u51fa\u4fe1\u606f\u5230\u7ec8\u7aef\u3002","title":"\u4f7f\u7528 Log \u8f93\u51fa\u5185\u5bb9"},{"location":"component/console/#consolelog","text":"\u8f93\u51fa 0 \u7ea7\u522b\u7684\u666e\u901a log\u3002 \u53c2\u6570\uff1a $msg, $color \uff0c\u5206\u522b\u4e3a\u5185\u5bb9\u548c\u5b57\u4f53\u989c\u8272\u3002 \u6b64 log \u4e0d\u4f1a\u88ab info_level \u6240\u9650\u5236\uff0c\u65e0\u8bba\u5982\u4f55\u4e5f\u4f1a\u8f93\u51fa\u5230\u7ec8\u7aef\u3002","title":"Console::log()"},{"location":"component/console/#consoleerror","text":"\u8f93\u51fa error \u7ea7\u522b\u7684\u7ea2\u8272\u9192\u76ee log\u3002\u4e00\u822c\u6b64 log \u4e3a\u6846\u67b6\u5185\u90e8\u51fa\u73b0\u4e0d\u53ef\u5fcd\u53d7\u7684\u9519\u8bef\uff0c\u6bd4\u5982\u5185\u5b58\u4e0d\u8db3\u3001PHP fatal error \u7b49\u9519\u8bef\u3002 \u53c2\u6570\uff1a $msg \u6b64 log \u4e0d\u4f1a\u88ab info_level \u6240\u9650\u5236\uff0c\u65e0\u8bba\u5982\u4f55\u4e5f\u4f1a\u8f93\u51fa\u5230\u7ec8\u7aef\u3002","title":"Console::error()"},{"location":"component/console/#consolewarning","text":"\u8f93\u51fa warning \u7ea7\u522b\u7684 log\u3002 Warning \u6846\u67b6\u5185\u51fa\u73b0\u7684\u7528\u6237\u6001\u5f02\u5e38\uff0c\u6bd4\u5982\u65e0\u6cd5\u53d1\u9001 API\u3001\u65e0\u6cd5\u8fde\u63a5\u6570\u636e\u5e93\u7b49\u9519\u8bef\uff0c\u90fd\u662f warning \u9519\u8bef\uff0c\u4e0d\u4f1a\u5bfc\u81f4\u6846\u67b6\u5d29\u6e83\u6216\u529f\u80fd\u9519\u8bef\u7684\u5f02\u5e38\u60c5\u51b5\u5efa\u8bae\u90fd\u4f7f\u7528 warning \u8f93\u51fa\u800c\u4e0d\u662f error\u3002","title":"Console::warning()"},{"location":"component/console/#consoleinfo","text":"\u8f93\u51fa info \u7ea7\u522b\u7684 log\u3002","title":"Console::info()"},{"location":"component/console/#consolesuccess","text":"\u8f93\u51fa success \u7ea7\u522b\u7684log\u3002","title":"Console::success()"},{"location":"component/console/#consoleverbose","text":"\u8f93\u51fa verbose \u7ea7\u522b\u7684 log\u3002","title":"Console::verbose()"},{"location":"component/console/#consoledebug","text":"\u8f93\u51fa debug \u7ea7\u522b\u7684 log\u3002","title":"Console::debug()"},{"location":"component/console/#consolestacktrace","text":"\u8f93\u51fa\u6808\u8ffd\u8e2a\u4fe1\u606f\u3002","title":"Console::stackTrace()"},{"location":"component/console/#consolesetcolor","text":"\u8fd4\u56de\uff1a\u5f69\u8272\u7684\u5b57\u7b26\u4e32\u3002 string : \u8981\u53d8\u989c\u8272\u7684\u5b57\u7b26\u4e32 color : \u8981\u53d8\u7684\u989c\u8272\u3002\u652f\u6301 red \uff0c green \uff0c yellow \uff0c reset \uff0c blue \uff0c gray \uff0c gold \uff0c pink \uff0c lightblue \uff0c lightlightblue 1 2 3 4 5 6 7 8 9 Console::log(\"This is normal msg. (0)\"); Console::error(\"This is error msg. (0)\"); Console::warning(\"This is warning msg. (1)\"); Console::info(\"This is info msg. (2)\"); Console::success(\"This is success msg. (2)\"); Console::verbose(\"This is verbose msg. (3)\"); Console::debug(\"This is debug msg. (4)\"); Console::stackTrace(); $str = Console::setColor(\"I am gold color.\", \"gold\");","title":"Console::setColor()"},{"location":"component/console/#_1","text":"\u70b8\u6bdb\u6846\u67b6\u652f\u6301\u4ece\u7ec8\u7aef\u8f93\u5165\u547d\u4ee4\u6765\u8fdb\u884c\u4e00\u4e9b\u64cd\u4f5c\uff0c\u4f8b\u5982\u91cd\u542f\u6846\u67b6\u3001\u505c\u6b62\u6846\u67b6\u3001\u6267\u884c\u51fd\u6570\u7b49\u3002 Warning \u5728 Docker\u3001systemd\u3001daemon \u72b6\u6001\u4e0b\u542f\u52a8\u7684\u6846\u67b6\u4f1a\u81ea\u52a8\u5173\u95ed\u7ec8\u7aef\u7b49\u5f85\u8f93\u5165\uff0c\u4ea4\u4e92\u4e0d\u53ef\u7528\u3002","title":"\u7ec8\u7aef\u4ea4\u4e92\u547d\u4ee4"},{"location":"component/console/#reload","text":"\u91cd\u65b0\u52a0\u8f7d\u9664 src/Framework/ \u4e0b\u7684\u6240\u6709\u6a21\u5757\u3002 \u522b\u540d\uff1a r","title":"reload"},{"location":"component/console/#stop","text":"\u505c\u6b62\u6846\u67b6\u3002","title":"stop"},{"location":"component/console/#logtest","text":"\u8f93\u51fa\u5404\u79cd\u7b49\u7ea7\u7684 log \u793a\u4f8b\u6587\u672c\u3002","title":"logtest"},{"location":"component/console/#call","text":"\u6267\u884c\u5bf9\u5e94\u7c7b\u7684\u6210\u5458\u65b9\u6cd5\u3002\u4e0b\u9762\u662f\u4f8b\u5b50\uff1a 1 call \\Z M \\U tils \\Z MUtil reload","title":"call"},{"location":"component/console/#bc","text":"\u76f4\u63a5\u6267\u884c PHP \u4ee3\u7801\uff0c\u8f93\u5165\u683c\u5f0f\u4e3a base64\u3002 1 2 3 bc XEZyYW1ld29ya1xDb25zb2xlOjp3YXJuaW5nKCJoZWxsbyB3YXJuaW5nISIpOw == # \u4ee3\u7801\u5185\u5bb9\uff1a\\ZM\\Console\\Console::warning(\"hello warning!\"); # \u7ec8\u7aef\u8f93\u51fa\uff1a[19:14:32] [W] hello warning!","title":"bc"},{"location":"component/console/#echo","text":"\u8f93\u51fa\u6587\u672c 1 echo hello","title":"echo"},{"location":"component/console/#color","text":"\u6309\u7167\u989c\u8272\u8f93\u51fa\u6587\u672c 1 color green \u6211\u662f\u7eff\u8272\u7684\u5b57","title":"color"},{"location":"component/console/#motd","text":"\u5728 1.4 \u7248\u672c\u5f00\u59cb\uff0c\u6846\u67b6\u652f\u6301\u542f\u52a8\u65f6\u7684 motd \u5185\u5bb9\u4fee\u6539\u3002 \u6587\u4ef6\u4f4d\u7f6e\uff1a config/motd.txt \u5176\u4e2d\uff0c\u9ed8\u8ba4\u7684 Zhamao \u5b57\u6837\u7684 MOTD \u662f\u4f7f\u7528 figlet \u547d\u4ee4\u751f\u6210\u7684\uff0c figlet \"Zhamao\" \uff0c\u4f60\u4e5f\u53ef\u4ee5\u9488\u5bf9\u81ea\u5df1\u7684\u673a\u5668\u4eba\u540d\u79f0\u6216\u54c1\u724c\u8fdb\u884c\u751f\u6210\u3002","title":"MOTD"},{"location":"component/console/#_2","text":"Console \u7ec4\u4ef6\u652f\u6301\u4e3a\u591a\u79cd\u4e0d\u540c\u7684\u7ec8\u7aef\u8bbe\u7f6e\u4e0d\u540c\u7684\u4e3b\u9898\uff0c\u6bd4\u5982\u6709\u4e9b\u4eba\u559c\u6b22\u4f7f\u7528\u767d\u8272\u7684\u7ec8\u7aef\uff0c\u4f46\u662f\u767d\u8272\u7ec8\u7aef\u4e0b info \u7684\u989c\u8272\u5f88\u6d45\uff0c\u770b\u4e0d\u5230\uff0c\u8fd8\u6709\u4eba\u4f7f\u7528\u4e0d\u80fd\u663e\u793a\u989c\u8272\u7684\u9ed1\u767d\u7ec8\u7aef..... 1 vendor/bin/start server --log-theme ={ \u4e3b\u9898\u540d } \u73b0\u6709\u652f\u6301\u7684\u4e3b\u9898\u6709\uff1a default \uff0c white-term \uff0c no-color 1 2 vendor/bin/start server --log-theme = white-term # \u5982\u679c\u7528\u7684\u662f\u767d\u8272\u7ec8\u7aef\uff0c\u8fd9\u4e2a\u4e3b\u9898\u66f4\u53cb\u597d vendor/bin/start server --log-theme = no-color # \u5982\u679c\u4e0d\u60f3\u8ba9 log \u5e26\u6709\u4efb\u4f55\u989c\u8272\uff0c\u4f7f\u7528\u65e0\u8272\u4e3b\u9898","title":"\u8bbe\u7f6e\u8f93\u51fa\u4e3b\u9898"},{"location":"component/context/","text":"\u4e0a\u4e0b\u6587 \u4e0a\u4e0b\u6587\u4f5c\u4e3a\u6574\u4e2a\u6846\u67b6\u4e2d\u6700\u91cd\u8981\u7684\u5185\u5bb9\u4e4b\u4e00\uff0c\u8bf7\u52a1\u5fc5\u7406\u89e3\u548c\u5b8c\u6574\u5730\u9605\u8bfb\u6b64\u90e8\u5206\uff01 \u4e00\u4e2a\u4e0a\u4e0b\u6587\u63cf\u8ff0\u4e86\u4e00\u4e2a\u4e8b\u4ef6\u548c\u6240\u5173\u8054\u7684\u5bf9\u8c61\u7684\u73af\u5883\u3002\u4f8b\u5982\uff1a\u4f60\u5728\u5904\u7406 HTTP \u8bf7\u6c42\u7684 @RequestMapping \u7ed1\u5b9a\u7684\u4e8b\u4ef6\u4e2d\uff0c\u4f60\u9700\u8981\u83b7\u53d6\u8bf7\u6c42\u7684 HTTP \u5934\u548c Cookie\uff0c\u518d\u6bd4\u5982\u4f60\u5728\u5904\u7406 QQ \u673a\u5668\u4eba\u53d1\u6765\u7684\u547d\u4ee4 @CQCommand(\"\u968f\u673a\u6570\") \u7684\u65f6\u5019\uff0c\u5728\u8fd9\u4e2a\u65b9\u6cd5\u5185\uff0c\u4f60\u9700\u8981\u83b7\u53d6\u53d1\u6765\u7684\u4eba\u7684 QQ \u53f7\u7801\u3002\u4ee5\u4e0a\u6211\u4eec\u5c06\u5904\u7406\u4ee5\u4e0a\u8fd0\u884c\u73af\u5883\u7684\u5bf9\u8c61\u53eb\u505a\u4e0a\u4e0b\u6587\u3002 \u7531\u4e8e Swoole \u7684\u534f\u7a0b\u52a0\u6301\uff0c\u6211\u4eec\u5229\u7528\u4e86\u534f\u7a0b ID \u7ed1\u5b9a\u5bf9\u8c61\u6765\u8fdb\u884c\u6784\u9020\u4e0a\u4e0b\u6587\u3002 \u4ee5\u9ed8\u8ba4\u7684\u673a\u5668\u4eba\u6536\u53d1\u6d88\u606f\u4e3a\u4f8b\uff0c\u901a\u8fc7\u5bf9\u9ed8\u8ba4\u6a21\u5757\u7684\u4e86\u89e3\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u5728\u7ed1\u5b9a @CQCommand \u7b49\u7c7b\u4f3c\u4e8b\u4ef6\u540e\uff0c\u4f60\u53ef\u4ee5\u7528\u4e0a\u4e0b\u6587\u83b7\u53d6\u53d1\u6765\u8fd9\u6761\u6d88\u606f\u7684\u4eba\u7684 QQ \u53f7\u7801\uff1a 1 2 3 4 5 6 7 /** * @CQCommand(\"\u4f60\u597d\") */ public function hello() { $user_id = ctx()->getUserId(); ctx()->reply(\"\u4f60\u597d\u554a\uff0c\".$user_id.\"\uff0c\u5f88\u9ad8\u5174\u8ba4\u8bc6\u4f60\uff01\"); } context() \u5c31\u662f\u83b7\u53d6\u4e0a\u4e0b\u6587\u5bf9\u8c61\u7684\u5168\u5c40\u51fd\u6570\uff0c\u5b83\u8fd8\u6709\u7b80\u5199\uff1a ctx() \u3002 \u5f53\u7136\uff0c\u4e0a\u4e0b\u6587\u4e2d\u7684\u65b9\u6cd5\u4e0d\u662f\u6bcf\u4e2a\u90fd\u80fd\u5728\u4efb\u4f55\u65f6\u5019\u4f7f\u7528\u7684\u3002\u4f8b\u5982 getUserId() \u4f60\u4e0d\u80fd\u5728 @RequestMapping \u6ce8\u89e3\u7684\u51fd\u6570\u4e2d\u4f7f\u7528\uff0c\u56e0\u4e3a\u5b83\u4e0d\u662f\u673a\u5668\u4eba\u6d88\u606f\u7684\u4e0a\u4e0b\u6587\u3002\u4e0b\u9762\u8bf4\u660e\u4e0a\u4e0b\u6587\u5bf9\u8c61\u7684\u65b9\u6cd5\u4e2d\uff0c\u6bcf\u4e2a\u90fd\u4f1a\u8bf4\u660e\u6bcf\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5728\u54ea\u4e9b\u4e8b\u4ef6\u4e2d\u4f7f\u7528\uff1a getServer() - \u83b7\u53d6 Server \u5bf9\u8c61 \u83b7\u53d6 Swoole WebSocker Server \u5bf9\u8c61\u3002\u6b64\u5bf9\u8c61\u662f Swoole \u7684\u5bf9\u8c61\uff0c\u8be6\u60c5\u89c1 Swoole \u6587\u6863 \u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a @OnMessageEvent() \uff0c @OnOpenEvent() \uff0c @OnCloseEvent() \uff0c @OnStart() \u4ee5\u53ca\u6240\u6709 HTTP API \u53d1\u6765\u7684\u4e8b\u4ef6\uff1a @CQCommand() \uff0c @CQMessage() \u7b49\u3002 getFrame() - \u83b7\u53d6 WS \u6570\u636e\u5e27 \u83b7\u53d6 \\Swoole\\Websocket\\Frame \u5bf9\u8c61\uff0c\u6b64\u5bf9\u8c61\u662f Swoole \u7684\u5bf9\u8c61\uff0c\u8be6\u60c5\u89c1 Swoole \u6587\u6863 \u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a @OnMessageEvent() \u4ee5\u53ca\u6240\u6709 HTTP API \u53d1\u6765\u7684\u4e8b\u4ef6\uff1a @CQCommand() \uff0c @CQMessage() \u7b49\uff0c getFd() - \u8fd4\u56de fd \u503c \u83b7\u53d6\u5f53\u524d\u8fde\u5165 Swoole \u670d\u52a1\u5668\u7684\u8fde\u63a5\u6587\u4ef6\u63cf\u8ff0\u7b26 ID\u3002\u8fd4\u56de int\u3002\u4e00\u822c\u4ee3\u8868\u8fde\u63a5\u53f7\uff0c\u53ef\u7528\u6765\u7ed1\u5b9a\u5bf9\u5e94\u94fe\u63a5\u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709 getFrame() \u53ef\u4ee5\u4f7f\u7528\u7684\uff0c @OnOpenEvent() \uff0c @OnCloseEvent() \u63d0\u793a \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u7531\u4e8e\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u548c\u70b8\u6bdb\u6846\u67b6\u7684\u8fde\u63a5\u662f\u901a\u8fc7 WebSocket \u8fdb\u884c\u7684\uff0c\u800c WebSocket \u662f\u957f\u8fde\u63a5\uff0c\u6240\u4ee5\u540c\u4e00\u4e2a\u673a\u5668\u4eba\u4e00\u6b21\u8fde\u63a5\u4e0b\u6536\u53d1\u6d88\u606f\u6240\u7528\u7684\u8fde\u63a5\u662f\u540c\u4e00\u4e2a\uff0c\u6240\u4ee5 Fd \u4e5f\u662f\u76f8\u540c\u7684\u3002\u540c\u7406\uff0c\u70b8\u6bdb\u6846\u67b6\u7684\u5185\u90e8\u6765\u533a\u5206\u591a\u4e2a\u673a\u5668\u4eba\u4e5f\u662f\u901a\u8fc7\u8fd9\u4e00 Fd \u8fdb\u884c\u5224\u5b9a\u7684\u3002 \u4ee3\u7801 1 2 3 4 5 6 /** * @CQCommand(\"\u6d4b\u8bd5fd\") */ public function testfd() { ctx()->reply(\"\u5f53\u524d\u673a\u5668\u4eba\u8fde\u63a5\u7684fd\u662f\uff1a\".ctx()->getFd().\"\uff0c\u673a\u5668\u4ebaQQ\u662f\uff1a\".ctx()->getRobotId()); } \u6548\u679c ^ \u5047\u8bbe\u6211\u4eec\u548c\u8fde\u63a555555\u7684\u673a\u5668\u4eba\u7684\u79c1\u804a ) \u6d4b\u8bd5fd ( \u5f53\u524d\u673a\u5668\u4eba\u8fde\u63a5\u7684fd\u662f\uff1a1\uff0c\u673a\u5668\u4ebaQQ\u662f\uff1a55555 ^ \u5047\u8bbe\u5207\u5230\u4e86\u53e6\u4e00\u4e2a\u673a\u5668\u4eba\uff0866666\uff09\u7684\u79c1\u804a ) \u6d4b\u8bd5fd ( \u5f53\u524d\u673a\u5668\u4eba\u8fde\u63a5\u7684fd\u662f\uff1a2\uff0c\u673a\u5668\u4ebaQQ\u662f\uff1a66666 getData() - \u83b7\u53d6\u4e8b\u4ef6\u5b8c\u6574\u6570\u636e \u8fd4\u56de CQHTTP \u4e8b\u4ef6\u4e0a\u62a5\u7684\u539f\u59cb\u6570\u636e\u5305\uff0c\u5df2\u7ecf\u88ab\u89e3\u6790\u6210\u6570\u7ec4\uff0c\u53ef\u4ee5\u76f4\u63a5\u64cd\u4f5c\u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709 HTTP API \u53d1\u6765\u7684\u4e8b\u4ef6\uff1a @CQCommand() \uff0c @CQMessage() \u7b49\u3002 1 2 3 4 5 6 7 /** * @CQMessage(user_id=123456) */ public function onMessage() { $data = ctx()->getData(); ctx()->reply(\"\u6d88\u606f\u7c7b\u578b\u662f\uff1a\" . $data[\"message_type\"]); } ^ \u5047\u8bbe\u6211\u662fQQ\u4e3a123456\u7684\u7528\u6237\uff0c\u79c1\u804a\u53d1\u6d88\u606f ) \u54c8\u54af\uff01\uff01 ( \u6d88\u606f\u7c7b\u578b\u662f\uff1aprivate getRequest() - HTTP \u8bf7\u6c42\u5bf9\u8c61 \u8fd4\u56de \\Swoole\\Http\\Request \u5bf9\u8c61\uff0c\u53ef\u5728 @RequestMapping \u4e2d\u4f7f\u7528\uff0c\u83b7\u53d6 Cookie\uff0c\u8bf7\u6c42\u5934\uff0cGET \u53c2\u6570\u4ec0\u4e48\u7684\u3002 Swoole \u6587\u6863 \u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a @RequestMapping() \uff0c @OnRequestEvent() \uff0c @OnOpenEvent() \u3002 getResponse() - HTTP \u54cd\u5e94\u5bf9\u8c61 \u8fd4\u56de \\Swoole\\Http\\Response \u5bf9\u8c61\u7684\u589e\u5f3a\u7248\uff0c\u53ef\u5728 HTTP \u8bf7\u6c42\u76f8\u5173\u7684\u4e8b\u4ef6\u4e2d\u4f7f\u7528\uff0c\u8fd4\u56de\u5185\u5bb9\u548c\u8bbe\u7f6e Cookie \u4ec0\u4e48\u7684\u3002 Swoole \u6587\u6863 \u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a @RequestMapping() \uff0c @OnRequestEvent() \u3002 \u4e0b\u9762\u662f\u4f7f\u7528\u4ee5\u4e0a\u4e24\u4e2a\u529f\u80fd\u7684\u7ec4\u5408\u793a\u4f8b\uff1a 1 2 3 4 5 6 7 /** * @RequestMapping(\"/ping\") */ public function ping() { $name = ctx()->getRequest()->get[\"name\"] ?? \"unknown\"; ctx()->getResponse()->end(\"Hello \".$name.\"!\"); } getConnection() - WS \u8fde\u63a5\u5bf9\u8c61 \u8fd4\u56de\u6b64\u4e0a\u4e0b\u6587\u76f8\u5173\u8054\u7684 WebSocket \u8fde\u63a5\u5bf9\u8c61\u3002\u8be6\u89c1 \u8fdb\u9636 - \u63a5\u5165 WebSocket \u5ba2\u6237\u7aef \u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709 getFrame() \u53ef\u4ee5\u4f7f\u7528\u7684\u90fd\u53ef\u4ee5\u4f7f\u7528\u3002 getCid() - \u4e0a\u4e0b\u6587 ID \u8fd4\u56de\u5f53\u524d\u4e0a\u4e0b\u6587\u6240\u7ed1\u5b9a\u7684\u534f\u7a0b ID\uff0c\u6b64 ID \u548c \\Co::getCid() \u8fd4\u56de\u503c\u4e00\u6837\u3002 getRobot() - \u83b7\u53d6\u673a\u5668\u4eba API \u5bf9\u8c61 \u8fd4\u56de\u5f53\u524d\u4e0a\u4e0b\u6587\u5173\u8054\u7684\u673a\u5668\u4eba API \u8c03\u7528\u5bf9\u8c61 ZMRobot \u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709 HTTP API \u53d1\u6765\u7684\u4e8b\u4ef6\uff1a @CQCommand() \uff0c @CQMessage() \u7b49\u3002 1 ctx()->getRobot()->sendPrivateMsg(123456, \"\u53d1\u9001\u79c1\u804a\u6d88\u606f\"); ^ \u6b63\u5728\u548c\u673a\u5668\u4eba\u804a\u5929 ( \u53d1\u9001\u79c1\u804a\u6d88\u606f getMessage() - \u83b7\u53d6\u6d88\u606f \u83b7\u53d6 data \u6570\u636e\u4e2d\u7684 message \u6d88\u606f\uff0c\u7528\u4e8e\u5feb\u901f\u83b7\u53d6\u7528\u6237\u6d88\u606f\u4e8b\u4ef6\u7684\u6d88\u606f\u5185\u5bb9\u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a @CQCommand() \uff0c @CQMessage \uff0c @CQBefore(\"message\") \uff0c @CQAfter(\"message\") \u4ee3\u7801 1 2 3 4 5 6 /** * @CQMessage(group_id=33333) */ public function groupRepeat() { ctx()->reply(ctx()->getMessage()); } \u6548\u679c ^ \u73b0\u5728\u5728\u7fa433333\u5185\uff0c\u673a\u5668\u4eba\u5df2\u7ecf\u6210\u4e86\u590d\u8bfb\u673a ) \u6765\u4e16\u8fd8\u505a\u590d\u8bfb\u673a\uff01\uff01\uff01 ( \u6765\u4e16\u8fd8\u505a\u590d\u8bfb\u673a\uff01\uff01\uff01 ) \u4f60\u4e0d\u8bb8\u590d\u8bfb\uff01 ( \u4f60\u4e0d\u8bb8\u590d\u8bfb\uff01 getUserId() - \u83b7\u53d6\u7528\u6237 QQ \u53f7 \u83b7\u53d6\u53d1\u6d88\u606f\u7684\u7528\u6237\u7684 QQ \u53f7\u7801\u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709 \u542b\u6709 user_id \u4e0a\u62a5\u53c2\u6570\u7684 OneBot \u4e8b\u4ef6\u3002 1 2 3 4 5 6 /** * @CQCommand(\"whoami\") */ public function whoami() { ctx()->reply(\"\u4f60\u662f\".ctx()->getUserId()); //\u8fd4\u56de\uff1a\u4f60\u662f123456 } getGroupId() - \u83b7\u53d6 QQ \u7fa4\u53f7 \u83b7\u53d6\u53d1\u6d88\u606f\u6765\u81ea\u7684 QQ \u7fa4\u53f7\u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709\u542b\u6709 group_id \u4e0a\u62a5\u53c2\u6570\u7684 OneBot \u4e8b\u4ef6\u3002 getMessageType() - \u6d88\u606f\u7c7b\u578b \u83b7\u53d6\u6d88\u606f\u7c7b\u578b\uff0c\u540c\u53c2\u6570 message_type \u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709 post_type \u4e3a message \u7684\u54cd\u5e94\u4e8b\u4ef6\uff0c\u5982 @CQMessage \uff0c @CQCommand \u3002 getRobotId() - \u673a\u5668\u4eba QQ \u53f7 \u83b7\u53d6\u4e8b\u4ef6\u4e0a\u62a5\u7684\u673a\u5668\u4eba\u81ea\u5df1\u7684 QQ \u53f7\u7801\u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709 OneBot \u53d1\u6765\u7684\u4e8b\u4ef6\uff1a @CQCommand() \uff0c @CQNotice() \u7b49\u3002 setMessage() - \u8bbe\u7f6e\u6d88\u606f \u4e0e getMessage() \u5bf9\u5e94\uff0c\u7528\u4e8e\u66f4\u6539\u4e0a\u4e0b\u6587\u4e2d\u4fdd\u5b58\u7684\u4e8b\u4ef6\u4fe1\u606f\uff0c\u53ef\u4ee5\u7528\u4e8e\u6d88\u606f\u53d8\u66f4\u548c\u8fc7\u6ee4\u3002 setUserId() - \u8bbe\u7f6e\u7528\u6237 ID \u4e0e\u4e0a\u540c\u7406\uff0c\u66f4\u6539 user_id \u3002 setGroupId() - \u8bbe\u7f6e\u7fa4\u53f7 \u4e0e\u4e0a\u540c\u7406\u3002 setMessageType() - \u8bbe\u7f6e\u7c7b\u578b \u4e0e\u4e0a\u540c\u7406\uff0c\u4fee\u6539\u6d88\u606f\u7c7b\u578b\u3002 setData() - \u8bbe\u7f6e\u6570\u636e\u5305 \u4e0e\u4e0a\u540c\u7406\uff0c\u4e0e getData() \u5bf9\u5e94\uff0c\u7528\u4e8e\u66f4\u6539\u4e0a\u4e0b\u6587\u4e2d\u7684 data \u3002 getCache() - \u4e0a\u4e0b\u6587\u7f13\u5b58 \u83b7\u53d6\u4fdd\u5b58\u5728\u4e0a\u4e0b\u6587\u4e2d\u7684\u4e34\u65f6\u7f13\u5b58\u53d8\u91cf\u3002\u5f53\u76f8\u5173\u8054\u7684\u4e8b\u4ef6\u7ed3\u675f\u540e\uff0c\u6570\u636e\u4f1a\u4ece\u5185\u5b58\u4e2d\u88ab\u91ca\u653e\u3002\u7528\u4e8e\u540c\u4e00\u4e8b\u4ef6\u7684\u591a\u4e2a\u51fd\u6570\u4e2d\u7684\u4fe1\u606f\u4f20\u9012\u3002 \u53c2\u6570\uff1a $key \uff0c\u7f13\u5b58\u53d8\u91cf\u7684\u952e\u540d \u8fd4\u56de\uff1a mixed \uff0c\u5b58\u5165\u7f13\u5b58\u7684\u53d8\u91cf\u503c\u3002 1 2 $a = ctx()->getCache(\"block_continue\"); // \u5982\u679c\u53d8\u91cf\u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56de null setCache() - \u4e0a\u4e0b\u6587\u7f13\u5b58 \u4e0e getCache() \u5bf9\u5e94\uff0c\u662f\u8bbe\u7f6e\u5185\u5bb9\u7684\u3002 1 2 ctx()->setCache(\"abc\", \"asdasd\"); $result = ctx()->getCache(\"abc\"); // asdasd reply() - \u5feb\u901f\u56de\u590d \u5feb\u901f\u56de\u590d\u5f53\u524d\u7528\u6237\u6d88\u606f\u5185\u5bb9\u3002 \u53c2\u65701\uff1a $msg \uff0c\u5b57\u7b26\u4e32\uff0c\u4f60\u8981\u56de\u590d\u7684\u6d88\u606f\u5185\u5bb9 \u53c2\u65702\uff1a $yield = false \uff0c\u53ef\u9009\uff0c\u5f53\u4e3a true \u65f6\uff0c\u4f1a\u534f\u7a0b\u7b49\u5f85\u540e\u8fd4\u56de \u6d88\u606f\u56de\u590d \u7684\u7ed3\u679c\uff0c\u5305\u62ec API \u72b6\u6001\u7801\u3001\u6d88\u606f message_id \u7b49\u3002 1 2 $r = ctx()->reply(\"\u6211\u53c8\u597d\u4e86\u3002\"); if($r[\"retcode\"] == 0) Console::success(\"\u6d88\u606f\u53d1\u9001\u6210\u529f\uff01\"); finalReply() - \u5feb\u901f\u56de\u590d \u5feb\u901f\u56de\u590d\u7528\u6237\u6d88\u606f\uff0c\u5e76\u963b\u6b62\u5176\u4ed6\u6a21\u5757\u63a5\u4e0b\u6765\u7ee7\u7eed\u5904\u7406\u6b64\u4e8b\u4ef6\u3002 \u53c2\u6570\u540c reply() \u3002 waitMessage() - \u7b49\u5f85\u7528\u6237\u6d88\u606f \u53c2\u6570\uff1a waitMessage($prompt = \"\", $timeout = 600, $timeout_prompt = \"\") \u7528\u9014\uff1a\u7b49\u5f85\u7528\u6237\u8f93\u5165\u6d88\u606f $prompt \u53c2\u6570\u4e3a\u56de\u590d\u7528\u6237\u7684\u6587\u672c\u5185\u5bb9\uff0c $timeout \u662f\u7b49\u5f85\u7528\u6237\u56de\u590d\u7684\u8d85\u65f6\u65f6\u95f4(\u79d2)\uff0c $timeout_prompt \u662f\u8d85\u65f6\u540e\u56de\u590d\u7528\u6237\u7684\u6587\u672c\u3002 \u8fd9\u4e2a\u529f\u80fd\u53ef\u4ee5\u8ba9\u5f00\u53d1\u673a\u5668\u4eba\u7684\u4ee3\u7801\u903b\u8f91\u548c\u5b9e\u9645\u8d34\u5408\uff0c\u907f\u514d\u56de\u8c03\u5730\u72f1\u3001\u62fc\u63a5\u53c2\u6570\u3001\u4e0a\u4e0b\u6587\u8131\u8282\u7b49\u95ee\u9898\uff0c\u6bd4\u5982\u4e0b\u65b9\u7684\u793a\u4f8b\uff0c\u53ef\u4ee5\u4ec5\u4ec5\u7528\u4e24\u884c\u4ee3\u7801\u5b9e\u73b0\u4e00\u4e2a\u95ee\u7b54\u5f0f\u7684\u5bf9\u8bdd\u8fc7\u7a0b\u3002 \u7528\u6cd5\u793a\u4f8b\uff1a 1 2 3 4 5 6 7 /** * @CQCommand(\"\u81ea\u6211\u4ecb\u7ecd\") */ function yourName(){ $r = ctx()->waitMessage(\"\u4f60\u53eb\u5565\u540d\u5b57\u5440\uff1f\", 600, \"\u4f60\u90fd10\u5206\u949f\u4e0d\u7406\u6211\u4e86\uff0c\u5624\u5624\u5624\"); ctx()->finalReply(\"\u597d\u7684\uff0c\u53ef\u7231\u7684\u673a\u5668\u4eba\u8bb0\u4f4f\u4f60\u53eb \".$r.\" \u5566\uff01\u4ee5\u540e\u591a\u804a\u5929\u54e6\uff01\"); } ) \u81ea\u6211\u4ecb\u7ecd ( \u4f60\u53eb\u5565\u540d\u5b57\u5440\uff1f ) jerry ( \u597d\u7684\uff0c\u53ef\u7231\u7684\u673a\u5668\u4eba\u8bb0\u4f4f\u4f60\u53eb jerry \u5566\uff01\u4ee5\u540e\u591a\u804a\u5929\u54e6\uff01 ) \u81ea\u6211\u4ecb\u7ecd ( \u4f60\u53eb\u5565\u540d\u5b57\u5440\uff1f ^ 10\u5206\u949f\u6ca1\u7406\u673a\u5668\u4eba ( \u4f60\u90fd10\u5206\u949f\u4e0d\u7406\u6211\u4e86\uff0c\u5624\u5624\u5624 getArgs() - \u81ea\u52a8\u83b7\u53d6\u53c2\u6570 \u4e3a waitMessage() \u7684\u5c01\u88c5\uff0c\u76ee\u7684\u662f\u8ba9\u673a\u5668\u4eba\u7684\u56de\u590d\u66f4\u52a0\u667a\u80fd\u5316\u3002\u6700\u597d\u7684\u4f8b\u5b50\u5c31\u662f\u5728\u6846\u67b6\u81ea\u5e26\u7684\u9ed8\u8ba4\u793a\u4f8b\u4e2d\u201c\u968f\u673a\u6570\u201d\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u5047\u8bbe\u8981\u5199\u4e00\u4e2a\u968f\u673a\u6570\u529f\u80fd\uff0c\u4f46\u662f\u7528\u6237\u4ece\u6765\u90fd\u662f\u4e0d\u601d\u8003\u5c31\u4f7f\u7528\u673a\u5668\u4eba\u7684\u3002\u629b\u5f00\u4eba\u5de5\u667a\u80fd\uff0c\u6211\u4eec\u80fd\u505a\u7684\u5c31\u662f\u201c\u4e13\u5bb6\u7cfb\u7edf\u201d\uff0c\u540c\u65f6\u8ba9\u6211\u4eec\u5199\u7684\u4ee3\u7801\u5c3d\u53ef\u80fd\u9002\u914d\u7528\u6237\u6240\u8bf4\u7684\u6bcf\u4e00\u53e5\u8bdd\uff1a \u968f\u673a\u6570 1 100 \u968f\u673a\u6570\uff08\u4e00\u822c\u4e0d\u77e5\u9053\u600e\u4e48\u7528\u8fd9\u4e2a\u529f\u80fd\u7684\u4eba\u90fd\u4f1a\u53ea\u8bf4\u4e00\u4e2a\u5173\u952e\u8bcd\uff09 \u4ece2\u52309\u7684\u968f\u673a\u6570 \u6240\u4ee5\uff0c\u5728\u5339\u914d\u7b2c\u4e00\u548c\u7b2c\u4e8c\u79cd\u60c5\u51b5\u65f6\u5019\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u91cd\u590d\u5199\u4ee3\u7801\uff0c\u800c\u7b2c\u4e00\u79cd\u7684\u8bdd\u7528\u6237\u5df2\u7ecf\u5c06\u53c2\u6570\u7ed9\u4f60\u7684\u65f6\u5019\uff0c\u4f60\u4e0d\u9700\u8981\u518d\u6b21\u4f7f\u7528 waitMessage() \u65b9\u5f0f\u8fdb\u884c\u7b49\u5f85\u8be2\u95ee\uff0c\u53ea\u9700\u8981\u53d6\u5230\u4f7f\u7528\u5c31\u597d\u4e86\u3002 getArgs() \u5c31\u662f\u505a\u8fd9\u4e2a\u7684\u3002 \u5b9a\u4e49\uff1a getArgs($mode, $prompt_msg) $mode \uff1a\u83b7\u53d6\u6a21\u5f0f\uff0c\u6709\u4e09\u79cd\uff1a ZM_MATCH_ALL \uff1a\u6548\u679c\u7b49\u540c\u4e8e getFullArg() \uff0c\u83b7\u53d6\u5168\u90e8\u7684\u5185\u5bb9\uff0c\u628a\u7a7a\u683c\u4e5f\u5f53\u4f5c\u4e00\u90e8\u5206 ZM_MATCH_NUMBER \uff1a\u6548\u679c\u7b49\u540c\u4e8e getNumArg() \uff0c\u83b7\u53d6\u4e0b\u4e00\u4e2a\u6570\u5b57\u53c2\u6570 ZM_MATCH_FIRST \uff1a\u6548\u679c\u7b49\u540c\u4e8e getNextArg() \uff0c\u83b7\u53d6\u4e0b\u4e00\u4e2a\u53c2\u6570 $prompt_msg \uff1a\u5b57\u7b26\u4e32\uff0c\u6307\u5b9a\u5982\u679c\u53c2\u6570\u7f3a\u5931\u65f6\u8be2\u95ee\u7528\u6237\u7684\u5185\u5bb9\u3002 1 2 3 4 5 6 7 /** * @CQCommand(\"test\") */ public function argTest1() { $s = ctx()->getArgs(ZM_MATCH_FIRST, \"\u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u53c2\u6570\u5185\u5bb9\"); return \"\u53c2\u6570\u5185\u5bb9\uff1a\".$s; } ) test ( \u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u53c2\u6570\u5185\u5bb9 ) test2 ( \u53c2\u6570\u5185\u5bb9\uff1atest2 getArgs() \u4e5f\u6709\u4e09\u5c42\u5c01\u88c5\uff0c\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u907f\u514d\u9ebb\u70e6\u7684\u8bdd\uff0c\u63a8\u8350\u4f7f\u7528\u4e0b\u9762\u8fd9\u51e0\u79cd get*Arg() \u65b9\u5f0f\u3002 getFullArg() \u83b7\u53d6\u5173\u952e\u8bcd\u540e\u7684\u6574\u4e2a\u5b57\u7b26\u4e32\u53c2\u6570\uff0c\u5305\u62ec\u7a7a\u683c\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5219\u8be2\u95ee\u3002 \u5178\u578b\u4f8b\u5b50\uff1a \u590d\u8bfb\u673a \u4f60\u597d \u4f60\u597d \uff0c\u83b7\u53d6\u53c2\u6570\u65f6\u4f1a\u5c06 \u4f60\u597d \u4f60\u597d \u5f53\u4f5c\u4e00\u4e2a\u53c2\u6570\u6765\u83b7\u53d6\u3002 1 2 3 4 5 6 7 /** * @CQCommand(\"test\") */ public function argTest1() { $s = ctx()->getFullArg(\"\u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u53c2\u6570\u5185\u5bb9\"); return \"\u53c2\u6570\u5185\u5bb9\uff1a\".$s; } ) test abc def argtest ( \u53c2\u6570\u5185\u5bb9\uff1aabc def argtest ) test ( \u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u53c2\u6570\u5185\u5bb9 ) abc def ( \u53c2\u6570\u5185\u5bb9\uff1aabc def getNextArg() \u83b7\u53d6\u4e0b\u4e00\u4e2a\u53c2\u6570\uff0c\u5206\u9694\u7b26\u53ef\u4ee5\u662f\u7a7a\u683c\uff0ctab\u3002 1 2 3 4 5 6 7 /** * @CQCommand(\"test\") */ public function argTest1() { $s = ctx()->getNextArg(\"\u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u53c2\u6570\u5185\u5bb9\"); return \"\u53c2\u6570\u5185\u5bb9\uff1a\".$s; } ) test abc def argtest ( \u53c2\u6570\u5185\u5bb9\uff1aabc ) test ( \u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u53c2\u6570\u5185\u5bb9 ) abc ( \u53c2\u6570\u5185\u5bb9\uff1aabc getNumArg() 2.1.5 \u7248\u672c\u8d77\u53ef\u7528\u3002 \u83b7\u53d6\u4e0b\u4e00\u4e2a\u6570\u5b57\u578b\u53c2\u6570\uff0c\u5982\u679c is_numeric() \u4e3a true \u5219\u83b7\u53d6\u6210\u529f\uff0c\u5982\u679c\u6ca1\u6709\u7b26\u5408\u7684\u5219\u8be2\u95ee\u7528\u6237\u3002 1 2 3 4 5 6 7 /** * @CQCommand(\"test\") */ public function argTest1() { $s = ctx()->getNextArg(\"\u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u6570\u5b57\u5185\u5bb9\"); return \"\u6570\u5b57\u53c2\u6570\u5185\u5bb9\uff1a\".$s; } ) test abc 334 argtest ( \u6570\u5b57\u53c2\u6570\u5185\u5bb9\uff1a334 ) test abc ( \u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u6570\u5b57\u5185\u5bb9 ) 998 ( \u53c2\u6570\u5185\u5bb9\uff1a998 copy() \u83b7\u53d6\u6574\u4e2a\u4e0a\u4e0b\u6587\u7684\u6240\u6709\u5185\u5bb9\u7684\u6570\u7ec4\u5f62\u5f0f\u3002 1 2 $arr = ctx()->copy(); dump($arr); getOption() - \u83b7\u53d6\u5339\u914d\u53c2\u6570\u5185\u5bb9 1 2 3 4 5 6 /** * @CQCommand(\"test\") */ public function argTest1() { return \"\u53c2\u6570\u5185\u5bb9\uff1a\".implode(\", \", ctx()->getOption()); } ) test abc 334 argtest ( \u53c2\u6570\u5185\u5bb9\uff1aabc, 334, argtest","title":"\u4e0a\u4e0b\u6587"},{"location":"component/context/#_1","text":"\u4e0a\u4e0b\u6587\u4f5c\u4e3a\u6574\u4e2a\u6846\u67b6\u4e2d\u6700\u91cd\u8981\u7684\u5185\u5bb9\u4e4b\u4e00\uff0c\u8bf7\u52a1\u5fc5\u7406\u89e3\u548c\u5b8c\u6574\u5730\u9605\u8bfb\u6b64\u90e8\u5206\uff01 \u4e00\u4e2a\u4e0a\u4e0b\u6587\u63cf\u8ff0\u4e86\u4e00\u4e2a\u4e8b\u4ef6\u548c\u6240\u5173\u8054\u7684\u5bf9\u8c61\u7684\u73af\u5883\u3002\u4f8b\u5982\uff1a\u4f60\u5728\u5904\u7406 HTTP \u8bf7\u6c42\u7684 @RequestMapping \u7ed1\u5b9a\u7684\u4e8b\u4ef6\u4e2d\uff0c\u4f60\u9700\u8981\u83b7\u53d6\u8bf7\u6c42\u7684 HTTP \u5934\u548c Cookie\uff0c\u518d\u6bd4\u5982\u4f60\u5728\u5904\u7406 QQ \u673a\u5668\u4eba\u53d1\u6765\u7684\u547d\u4ee4 @CQCommand(\"\u968f\u673a\u6570\") \u7684\u65f6\u5019\uff0c\u5728\u8fd9\u4e2a\u65b9\u6cd5\u5185\uff0c\u4f60\u9700\u8981\u83b7\u53d6\u53d1\u6765\u7684\u4eba\u7684 QQ \u53f7\u7801\u3002\u4ee5\u4e0a\u6211\u4eec\u5c06\u5904\u7406\u4ee5\u4e0a\u8fd0\u884c\u73af\u5883\u7684\u5bf9\u8c61\u53eb\u505a\u4e0a\u4e0b\u6587\u3002 \u7531\u4e8e Swoole \u7684\u534f\u7a0b\u52a0\u6301\uff0c\u6211\u4eec\u5229\u7528\u4e86\u534f\u7a0b ID \u7ed1\u5b9a\u5bf9\u8c61\u6765\u8fdb\u884c\u6784\u9020\u4e0a\u4e0b\u6587\u3002 \u4ee5\u9ed8\u8ba4\u7684\u673a\u5668\u4eba\u6536\u53d1\u6d88\u606f\u4e3a\u4f8b\uff0c\u901a\u8fc7\u5bf9\u9ed8\u8ba4\u6a21\u5757\u7684\u4e86\u89e3\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u5728\u7ed1\u5b9a @CQCommand \u7b49\u7c7b\u4f3c\u4e8b\u4ef6\u540e\uff0c\u4f60\u53ef\u4ee5\u7528\u4e0a\u4e0b\u6587\u83b7\u53d6\u53d1\u6765\u8fd9\u6761\u6d88\u606f\u7684\u4eba\u7684 QQ \u53f7\u7801\uff1a 1 2 3 4 5 6 7 /** * @CQCommand(\"\u4f60\u597d\") */ public function hello() { $user_id = ctx()->getUserId(); ctx()->reply(\"\u4f60\u597d\u554a\uff0c\".$user_id.\"\uff0c\u5f88\u9ad8\u5174\u8ba4\u8bc6\u4f60\uff01\"); } context() \u5c31\u662f\u83b7\u53d6\u4e0a\u4e0b\u6587\u5bf9\u8c61\u7684\u5168\u5c40\u51fd\u6570\uff0c\u5b83\u8fd8\u6709\u7b80\u5199\uff1a ctx() \u3002 \u5f53\u7136\uff0c\u4e0a\u4e0b\u6587\u4e2d\u7684\u65b9\u6cd5\u4e0d\u662f\u6bcf\u4e2a\u90fd\u80fd\u5728\u4efb\u4f55\u65f6\u5019\u4f7f\u7528\u7684\u3002\u4f8b\u5982 getUserId() \u4f60\u4e0d\u80fd\u5728 @RequestMapping \u6ce8\u89e3\u7684\u51fd\u6570\u4e2d\u4f7f\u7528\uff0c\u56e0\u4e3a\u5b83\u4e0d\u662f\u673a\u5668\u4eba\u6d88\u606f\u7684\u4e0a\u4e0b\u6587\u3002\u4e0b\u9762\u8bf4\u660e\u4e0a\u4e0b\u6587\u5bf9\u8c61\u7684\u65b9\u6cd5\u4e2d\uff0c\u6bcf\u4e2a\u90fd\u4f1a\u8bf4\u660e\u6bcf\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5728\u54ea\u4e9b\u4e8b\u4ef6\u4e2d\u4f7f\u7528\uff1a","title":"\u4e0a\u4e0b\u6587"},{"location":"component/context/#getserver-server","text":"\u83b7\u53d6 Swoole WebSocker Server \u5bf9\u8c61\u3002\u6b64\u5bf9\u8c61\u662f Swoole \u7684\u5bf9\u8c61\uff0c\u8be6\u60c5\u89c1 Swoole \u6587\u6863 \u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a @OnMessageEvent() \uff0c @OnOpenEvent() \uff0c @OnCloseEvent() \uff0c @OnStart() \u4ee5\u53ca\u6240\u6709 HTTP API \u53d1\u6765\u7684\u4e8b\u4ef6\uff1a @CQCommand() \uff0c @CQMessage() \u7b49\u3002","title":"getServer() - \u83b7\u53d6 Server \u5bf9\u8c61"},{"location":"component/context/#getframe-ws","text":"\u83b7\u53d6 \\Swoole\\Websocket\\Frame \u5bf9\u8c61\uff0c\u6b64\u5bf9\u8c61\u662f Swoole \u7684\u5bf9\u8c61\uff0c\u8be6\u60c5\u89c1 Swoole \u6587\u6863 \u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a @OnMessageEvent() \u4ee5\u53ca\u6240\u6709 HTTP API \u53d1\u6765\u7684\u4e8b\u4ef6\uff1a @CQCommand() \uff0c @CQMessage() \u7b49\uff0c","title":"getFrame() - \u83b7\u53d6 WS \u6570\u636e\u5e27"},{"location":"component/context/#getfd-fd","text":"\u83b7\u53d6\u5f53\u524d\u8fde\u5165 Swoole \u670d\u52a1\u5668\u7684\u8fde\u63a5\u6587\u4ef6\u63cf\u8ff0\u7b26 ID\u3002\u8fd4\u56de int\u3002\u4e00\u822c\u4ee3\u8868\u8fde\u63a5\u53f7\uff0c\u53ef\u7528\u6765\u7ed1\u5b9a\u5bf9\u5e94\u94fe\u63a5\u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709 getFrame() \u53ef\u4ee5\u4f7f\u7528\u7684\uff0c @OnOpenEvent() \uff0c @OnCloseEvent() \u63d0\u793a \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u7531\u4e8e\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u548c\u70b8\u6bdb\u6846\u67b6\u7684\u8fde\u63a5\u662f\u901a\u8fc7 WebSocket \u8fdb\u884c\u7684\uff0c\u800c WebSocket \u662f\u957f\u8fde\u63a5\uff0c\u6240\u4ee5\u540c\u4e00\u4e2a\u673a\u5668\u4eba\u4e00\u6b21\u8fde\u63a5\u4e0b\u6536\u53d1\u6d88\u606f\u6240\u7528\u7684\u8fde\u63a5\u662f\u540c\u4e00\u4e2a\uff0c\u6240\u4ee5 Fd \u4e5f\u662f\u76f8\u540c\u7684\u3002\u540c\u7406\uff0c\u70b8\u6bdb\u6846\u67b6\u7684\u5185\u90e8\u6765\u533a\u5206\u591a\u4e2a\u673a\u5668\u4eba\u4e5f\u662f\u901a\u8fc7\u8fd9\u4e00 Fd \u8fdb\u884c\u5224\u5b9a\u7684\u3002 \u4ee3\u7801 1 2 3 4 5 6 /** * @CQCommand(\"\u6d4b\u8bd5fd\") */ public function testfd() { ctx()->reply(\"\u5f53\u524d\u673a\u5668\u4eba\u8fde\u63a5\u7684fd\u662f\uff1a\".ctx()->getFd().\"\uff0c\u673a\u5668\u4ebaQQ\u662f\uff1a\".ctx()->getRobotId()); } \u6548\u679c ^ \u5047\u8bbe\u6211\u4eec\u548c\u8fde\u63a555555\u7684\u673a\u5668\u4eba\u7684\u79c1\u804a ) \u6d4b\u8bd5fd ( \u5f53\u524d\u673a\u5668\u4eba\u8fde\u63a5\u7684fd\u662f\uff1a1\uff0c\u673a\u5668\u4ebaQQ\u662f\uff1a55555 ^ \u5047\u8bbe\u5207\u5230\u4e86\u53e6\u4e00\u4e2a\u673a\u5668\u4eba\uff0866666\uff09\u7684\u79c1\u804a ) \u6d4b\u8bd5fd ( \u5f53\u524d\u673a\u5668\u4eba\u8fde\u63a5\u7684fd\u662f\uff1a2\uff0c\u673a\u5668\u4ebaQQ\u662f\uff1a66666","title":"getFd() - \u8fd4\u56de fd \u503c"},{"location":"component/context/#getdata-","text":"\u8fd4\u56de CQHTTP \u4e8b\u4ef6\u4e0a\u62a5\u7684\u539f\u59cb\u6570\u636e\u5305\uff0c\u5df2\u7ecf\u88ab\u89e3\u6790\u6210\u6570\u7ec4\uff0c\u53ef\u4ee5\u76f4\u63a5\u64cd\u4f5c\u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709 HTTP API \u53d1\u6765\u7684\u4e8b\u4ef6\uff1a @CQCommand() \uff0c @CQMessage() \u7b49\u3002 1 2 3 4 5 6 7 /** * @CQMessage(user_id=123456) */ public function onMessage() { $data = ctx()->getData(); ctx()->reply(\"\u6d88\u606f\u7c7b\u578b\u662f\uff1a\" . $data[\"message_type\"]); } ^ \u5047\u8bbe\u6211\u662fQQ\u4e3a123456\u7684\u7528\u6237\uff0c\u79c1\u804a\u53d1\u6d88\u606f ) \u54c8\u54af\uff01\uff01 ( \u6d88\u606f\u7c7b\u578b\u662f\uff1aprivate","title":"getData() - \u83b7\u53d6\u4e8b\u4ef6\u5b8c\u6574\u6570\u636e"},{"location":"component/context/#getrequest-http","text":"\u8fd4\u56de \\Swoole\\Http\\Request \u5bf9\u8c61\uff0c\u53ef\u5728 @RequestMapping \u4e2d\u4f7f\u7528\uff0c\u83b7\u53d6 Cookie\uff0c\u8bf7\u6c42\u5934\uff0cGET \u53c2\u6570\u4ec0\u4e48\u7684\u3002 Swoole \u6587\u6863 \u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a @RequestMapping() \uff0c @OnRequestEvent() \uff0c @OnOpenEvent() \u3002","title":"getRequest() - HTTP \u8bf7\u6c42\u5bf9\u8c61"},{"location":"component/context/#getresponse-http","text":"\u8fd4\u56de \\Swoole\\Http\\Response \u5bf9\u8c61\u7684\u589e\u5f3a\u7248\uff0c\u53ef\u5728 HTTP \u8bf7\u6c42\u76f8\u5173\u7684\u4e8b\u4ef6\u4e2d\u4f7f\u7528\uff0c\u8fd4\u56de\u5185\u5bb9\u548c\u8bbe\u7f6e Cookie \u4ec0\u4e48\u7684\u3002 Swoole \u6587\u6863 \u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a @RequestMapping() \uff0c @OnRequestEvent() \u3002 \u4e0b\u9762\u662f\u4f7f\u7528\u4ee5\u4e0a\u4e24\u4e2a\u529f\u80fd\u7684\u7ec4\u5408\u793a\u4f8b\uff1a 1 2 3 4 5 6 7 /** * @RequestMapping(\"/ping\") */ public function ping() { $name = ctx()->getRequest()->get[\"name\"] ?? \"unknown\"; ctx()->getResponse()->end(\"Hello \".$name.\"!\"); }","title":"getResponse() - HTTP \u54cd\u5e94\u5bf9\u8c61"},{"location":"component/context/#getconnection-ws","text":"\u8fd4\u56de\u6b64\u4e0a\u4e0b\u6587\u76f8\u5173\u8054\u7684 WebSocket \u8fde\u63a5\u5bf9\u8c61\u3002\u8be6\u89c1 \u8fdb\u9636 - \u63a5\u5165 WebSocket \u5ba2\u6237\u7aef \u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709 getFrame() \u53ef\u4ee5\u4f7f\u7528\u7684\u90fd\u53ef\u4ee5\u4f7f\u7528\u3002","title":"getConnection() - WS \u8fde\u63a5\u5bf9\u8c61"},{"location":"component/context/#getcid-id","text":"\u8fd4\u56de\u5f53\u524d\u4e0a\u4e0b\u6587\u6240\u7ed1\u5b9a\u7684\u534f\u7a0b ID\uff0c\u6b64 ID \u548c \\Co::getCid() \u8fd4\u56de\u503c\u4e00\u6837\u3002","title":"getCid() - \u4e0a\u4e0b\u6587 ID"},{"location":"component/context/#getrobot-api","text":"\u8fd4\u56de\u5f53\u524d\u4e0a\u4e0b\u6587\u5173\u8054\u7684\u673a\u5668\u4eba API \u8c03\u7528\u5bf9\u8c61 ZMRobot \u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709 HTTP API \u53d1\u6765\u7684\u4e8b\u4ef6\uff1a @CQCommand() \uff0c @CQMessage() \u7b49\u3002 1 ctx()->getRobot()->sendPrivateMsg(123456, \"\u53d1\u9001\u79c1\u804a\u6d88\u606f\"); ^ \u6b63\u5728\u548c\u673a\u5668\u4eba\u804a\u5929 ( \u53d1\u9001\u79c1\u804a\u6d88\u606f","title":"getRobot() - \u83b7\u53d6\u673a\u5668\u4eba API \u5bf9\u8c61"},{"location":"component/context/#getmessage-","text":"\u83b7\u53d6 data \u6570\u636e\u4e2d\u7684 message \u6d88\u606f\uff0c\u7528\u4e8e\u5feb\u901f\u83b7\u53d6\u7528\u6237\u6d88\u606f\u4e8b\u4ef6\u7684\u6d88\u606f\u5185\u5bb9\u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a @CQCommand() \uff0c @CQMessage \uff0c @CQBefore(\"message\") \uff0c @CQAfter(\"message\") \u4ee3\u7801 1 2 3 4 5 6 /** * @CQMessage(group_id=33333) */ public function groupRepeat() { ctx()->reply(ctx()->getMessage()); } \u6548\u679c ^ \u73b0\u5728\u5728\u7fa433333\u5185\uff0c\u673a\u5668\u4eba\u5df2\u7ecf\u6210\u4e86\u590d\u8bfb\u673a ) \u6765\u4e16\u8fd8\u505a\u590d\u8bfb\u673a\uff01\uff01\uff01 ( \u6765\u4e16\u8fd8\u505a\u590d\u8bfb\u673a\uff01\uff01\uff01 ) \u4f60\u4e0d\u8bb8\u590d\u8bfb\uff01 ( \u4f60\u4e0d\u8bb8\u590d\u8bfb\uff01","title":"getMessage() - \u83b7\u53d6\u6d88\u606f"},{"location":"component/context/#getuserid-qq","text":"\u83b7\u53d6\u53d1\u6d88\u606f\u7684\u7528\u6237\u7684 QQ \u53f7\u7801\u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709 \u542b\u6709 user_id \u4e0a\u62a5\u53c2\u6570\u7684 OneBot \u4e8b\u4ef6\u3002 1 2 3 4 5 6 /** * @CQCommand(\"whoami\") */ public function whoami() { ctx()->reply(\"\u4f60\u662f\".ctx()->getUserId()); //\u8fd4\u56de\uff1a\u4f60\u662f123456 }","title":"getUserId() - \u83b7\u53d6\u7528\u6237 QQ \u53f7"},{"location":"component/context/#getgroupid-qq","text":"\u83b7\u53d6\u53d1\u6d88\u606f\u6765\u81ea\u7684 QQ \u7fa4\u53f7\u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709\u542b\u6709 group_id \u4e0a\u62a5\u53c2\u6570\u7684 OneBot \u4e8b\u4ef6\u3002","title":"getGroupId() - \u83b7\u53d6 QQ \u7fa4\u53f7"},{"location":"component/context/#getmessagetype-","text":"\u83b7\u53d6\u6d88\u606f\u7c7b\u578b\uff0c\u540c\u53c2\u6570 message_type \u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709 post_type \u4e3a message \u7684\u54cd\u5e94\u4e8b\u4ef6\uff0c\u5982 @CQMessage \uff0c @CQCommand \u3002","title":"getMessageType() - \u6d88\u606f\u7c7b\u578b"},{"location":"component/context/#getrobotid-qq","text":"\u83b7\u53d6\u4e8b\u4ef6\u4e0a\u62a5\u7684\u673a\u5668\u4eba\u81ea\u5df1\u7684 QQ \u53f7\u7801\u3002 \u53ef\u4ee5\u4f7f\u7528\u7684\u4e8b\u4ef6\uff1a\u6240\u6709 OneBot \u53d1\u6765\u7684\u4e8b\u4ef6\uff1a @CQCommand() \uff0c @CQNotice() \u7b49\u3002","title":"getRobotId() - \u673a\u5668\u4eba QQ \u53f7"},{"location":"component/context/#setmessage-","text":"\u4e0e getMessage() \u5bf9\u5e94\uff0c\u7528\u4e8e\u66f4\u6539\u4e0a\u4e0b\u6587\u4e2d\u4fdd\u5b58\u7684\u4e8b\u4ef6\u4fe1\u606f\uff0c\u53ef\u4ee5\u7528\u4e8e\u6d88\u606f\u53d8\u66f4\u548c\u8fc7\u6ee4\u3002","title":"setMessage() - \u8bbe\u7f6e\u6d88\u606f"},{"location":"component/context/#setuserid-id","text":"\u4e0e\u4e0a\u540c\u7406\uff0c\u66f4\u6539 user_id \u3002","title":"setUserId() - \u8bbe\u7f6e\u7528\u6237 ID"},{"location":"component/context/#setgroupid-","text":"\u4e0e\u4e0a\u540c\u7406\u3002","title":"setGroupId() - \u8bbe\u7f6e\u7fa4\u53f7"},{"location":"component/context/#setmessagetype-","text":"\u4e0e\u4e0a\u540c\u7406\uff0c\u4fee\u6539\u6d88\u606f\u7c7b\u578b\u3002","title":"setMessageType() - \u8bbe\u7f6e\u7c7b\u578b"},{"location":"component/context/#setdata-","text":"\u4e0e\u4e0a\u540c\u7406\uff0c\u4e0e getData() \u5bf9\u5e94\uff0c\u7528\u4e8e\u66f4\u6539\u4e0a\u4e0b\u6587\u4e2d\u7684 data \u3002","title":"setData() - \u8bbe\u7f6e\u6570\u636e\u5305"},{"location":"component/context/#getcache-","text":"\u83b7\u53d6\u4fdd\u5b58\u5728\u4e0a\u4e0b\u6587\u4e2d\u7684\u4e34\u65f6\u7f13\u5b58\u53d8\u91cf\u3002\u5f53\u76f8\u5173\u8054\u7684\u4e8b\u4ef6\u7ed3\u675f\u540e\uff0c\u6570\u636e\u4f1a\u4ece\u5185\u5b58\u4e2d\u88ab\u91ca\u653e\u3002\u7528\u4e8e\u540c\u4e00\u4e8b\u4ef6\u7684\u591a\u4e2a\u51fd\u6570\u4e2d\u7684\u4fe1\u606f\u4f20\u9012\u3002 \u53c2\u6570\uff1a $key \uff0c\u7f13\u5b58\u53d8\u91cf\u7684\u952e\u540d \u8fd4\u56de\uff1a mixed \uff0c\u5b58\u5165\u7f13\u5b58\u7684\u53d8\u91cf\u503c\u3002 1 2 $a = ctx()->getCache(\"block_continue\"); // \u5982\u679c\u53d8\u91cf\u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56de null","title":"getCache() - \u4e0a\u4e0b\u6587\u7f13\u5b58"},{"location":"component/context/#setcache-","text":"\u4e0e getCache() \u5bf9\u5e94\uff0c\u662f\u8bbe\u7f6e\u5185\u5bb9\u7684\u3002 1 2 ctx()->setCache(\"abc\", \"asdasd\"); $result = ctx()->getCache(\"abc\"); // asdasd","title":"setCache() - \u4e0a\u4e0b\u6587\u7f13\u5b58"},{"location":"component/context/#reply-","text":"\u5feb\u901f\u56de\u590d\u5f53\u524d\u7528\u6237\u6d88\u606f\u5185\u5bb9\u3002 \u53c2\u65701\uff1a $msg \uff0c\u5b57\u7b26\u4e32\uff0c\u4f60\u8981\u56de\u590d\u7684\u6d88\u606f\u5185\u5bb9 \u53c2\u65702\uff1a $yield = false \uff0c\u53ef\u9009\uff0c\u5f53\u4e3a true \u65f6\uff0c\u4f1a\u534f\u7a0b\u7b49\u5f85\u540e\u8fd4\u56de \u6d88\u606f\u56de\u590d \u7684\u7ed3\u679c\uff0c\u5305\u62ec API \u72b6\u6001\u7801\u3001\u6d88\u606f message_id \u7b49\u3002 1 2 $r = ctx()->reply(\"\u6211\u53c8\u597d\u4e86\u3002\"); if($r[\"retcode\"] == 0) Console::success(\"\u6d88\u606f\u53d1\u9001\u6210\u529f\uff01\");","title":"reply() - \u5feb\u901f\u56de\u590d"},{"location":"component/context/#finalreply-","text":"\u5feb\u901f\u56de\u590d\u7528\u6237\u6d88\u606f\uff0c\u5e76\u963b\u6b62\u5176\u4ed6\u6a21\u5757\u63a5\u4e0b\u6765\u7ee7\u7eed\u5904\u7406\u6b64\u4e8b\u4ef6\u3002 \u53c2\u6570\u540c reply() \u3002","title":"finalReply() - \u5feb\u901f\u56de\u590d"},{"location":"component/context/#waitmessage-","text":"\u53c2\u6570\uff1a waitMessage($prompt = \"\", $timeout = 600, $timeout_prompt = \"\") \u7528\u9014\uff1a\u7b49\u5f85\u7528\u6237\u8f93\u5165\u6d88\u606f $prompt \u53c2\u6570\u4e3a\u56de\u590d\u7528\u6237\u7684\u6587\u672c\u5185\u5bb9\uff0c $timeout \u662f\u7b49\u5f85\u7528\u6237\u56de\u590d\u7684\u8d85\u65f6\u65f6\u95f4(\u79d2)\uff0c $timeout_prompt \u662f\u8d85\u65f6\u540e\u56de\u590d\u7528\u6237\u7684\u6587\u672c\u3002 \u8fd9\u4e2a\u529f\u80fd\u53ef\u4ee5\u8ba9\u5f00\u53d1\u673a\u5668\u4eba\u7684\u4ee3\u7801\u903b\u8f91\u548c\u5b9e\u9645\u8d34\u5408\uff0c\u907f\u514d\u56de\u8c03\u5730\u72f1\u3001\u62fc\u63a5\u53c2\u6570\u3001\u4e0a\u4e0b\u6587\u8131\u8282\u7b49\u95ee\u9898\uff0c\u6bd4\u5982\u4e0b\u65b9\u7684\u793a\u4f8b\uff0c\u53ef\u4ee5\u4ec5\u4ec5\u7528\u4e24\u884c\u4ee3\u7801\u5b9e\u73b0\u4e00\u4e2a\u95ee\u7b54\u5f0f\u7684\u5bf9\u8bdd\u8fc7\u7a0b\u3002 \u7528\u6cd5\u793a\u4f8b\uff1a 1 2 3 4 5 6 7 /** * @CQCommand(\"\u81ea\u6211\u4ecb\u7ecd\") */ function yourName(){ $r = ctx()->waitMessage(\"\u4f60\u53eb\u5565\u540d\u5b57\u5440\uff1f\", 600, \"\u4f60\u90fd10\u5206\u949f\u4e0d\u7406\u6211\u4e86\uff0c\u5624\u5624\u5624\"); ctx()->finalReply(\"\u597d\u7684\uff0c\u53ef\u7231\u7684\u673a\u5668\u4eba\u8bb0\u4f4f\u4f60\u53eb \".$r.\" \u5566\uff01\u4ee5\u540e\u591a\u804a\u5929\u54e6\uff01\"); } ) \u81ea\u6211\u4ecb\u7ecd ( \u4f60\u53eb\u5565\u540d\u5b57\u5440\uff1f ) jerry ( \u597d\u7684\uff0c\u53ef\u7231\u7684\u673a\u5668\u4eba\u8bb0\u4f4f\u4f60\u53eb jerry \u5566\uff01\u4ee5\u540e\u591a\u804a\u5929\u54e6\uff01 ) \u81ea\u6211\u4ecb\u7ecd ( \u4f60\u53eb\u5565\u540d\u5b57\u5440\uff1f ^ 10\u5206\u949f\u6ca1\u7406\u673a\u5668\u4eba ( \u4f60\u90fd10\u5206\u949f\u4e0d\u7406\u6211\u4e86\uff0c\u5624\u5624\u5624","title":"waitMessage() - \u7b49\u5f85\u7528\u6237\u6d88\u606f"},{"location":"component/context/#getargs-","text":"\u4e3a waitMessage() \u7684\u5c01\u88c5\uff0c\u76ee\u7684\u662f\u8ba9\u673a\u5668\u4eba\u7684\u56de\u590d\u66f4\u52a0\u667a\u80fd\u5316\u3002\u6700\u597d\u7684\u4f8b\u5b50\u5c31\u662f\u5728\u6846\u67b6\u81ea\u5e26\u7684\u9ed8\u8ba4\u793a\u4f8b\u4e2d\u201c\u968f\u673a\u6570\u201d\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u5047\u8bbe\u8981\u5199\u4e00\u4e2a\u968f\u673a\u6570\u529f\u80fd\uff0c\u4f46\u662f\u7528\u6237\u4ece\u6765\u90fd\u662f\u4e0d\u601d\u8003\u5c31\u4f7f\u7528\u673a\u5668\u4eba\u7684\u3002\u629b\u5f00\u4eba\u5de5\u667a\u80fd\uff0c\u6211\u4eec\u80fd\u505a\u7684\u5c31\u662f\u201c\u4e13\u5bb6\u7cfb\u7edf\u201d\uff0c\u540c\u65f6\u8ba9\u6211\u4eec\u5199\u7684\u4ee3\u7801\u5c3d\u53ef\u80fd\u9002\u914d\u7528\u6237\u6240\u8bf4\u7684\u6bcf\u4e00\u53e5\u8bdd\uff1a \u968f\u673a\u6570 1 100 \u968f\u673a\u6570\uff08\u4e00\u822c\u4e0d\u77e5\u9053\u600e\u4e48\u7528\u8fd9\u4e2a\u529f\u80fd\u7684\u4eba\u90fd\u4f1a\u53ea\u8bf4\u4e00\u4e2a\u5173\u952e\u8bcd\uff09 \u4ece2\u52309\u7684\u968f\u673a\u6570 \u6240\u4ee5\uff0c\u5728\u5339\u914d\u7b2c\u4e00\u548c\u7b2c\u4e8c\u79cd\u60c5\u51b5\u65f6\u5019\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u91cd\u590d\u5199\u4ee3\u7801\uff0c\u800c\u7b2c\u4e00\u79cd\u7684\u8bdd\u7528\u6237\u5df2\u7ecf\u5c06\u53c2\u6570\u7ed9\u4f60\u7684\u65f6\u5019\uff0c\u4f60\u4e0d\u9700\u8981\u518d\u6b21\u4f7f\u7528 waitMessage() \u65b9\u5f0f\u8fdb\u884c\u7b49\u5f85\u8be2\u95ee\uff0c\u53ea\u9700\u8981\u53d6\u5230\u4f7f\u7528\u5c31\u597d\u4e86\u3002 getArgs() \u5c31\u662f\u505a\u8fd9\u4e2a\u7684\u3002 \u5b9a\u4e49\uff1a getArgs($mode, $prompt_msg) $mode \uff1a\u83b7\u53d6\u6a21\u5f0f\uff0c\u6709\u4e09\u79cd\uff1a ZM_MATCH_ALL \uff1a\u6548\u679c\u7b49\u540c\u4e8e getFullArg() \uff0c\u83b7\u53d6\u5168\u90e8\u7684\u5185\u5bb9\uff0c\u628a\u7a7a\u683c\u4e5f\u5f53\u4f5c\u4e00\u90e8\u5206 ZM_MATCH_NUMBER \uff1a\u6548\u679c\u7b49\u540c\u4e8e getNumArg() \uff0c\u83b7\u53d6\u4e0b\u4e00\u4e2a\u6570\u5b57\u53c2\u6570 ZM_MATCH_FIRST \uff1a\u6548\u679c\u7b49\u540c\u4e8e getNextArg() \uff0c\u83b7\u53d6\u4e0b\u4e00\u4e2a\u53c2\u6570 $prompt_msg \uff1a\u5b57\u7b26\u4e32\uff0c\u6307\u5b9a\u5982\u679c\u53c2\u6570\u7f3a\u5931\u65f6\u8be2\u95ee\u7528\u6237\u7684\u5185\u5bb9\u3002 1 2 3 4 5 6 7 /** * @CQCommand(\"test\") */ public function argTest1() { $s = ctx()->getArgs(ZM_MATCH_FIRST, \"\u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u53c2\u6570\u5185\u5bb9\"); return \"\u53c2\u6570\u5185\u5bb9\uff1a\".$s; } ) test ( \u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u53c2\u6570\u5185\u5bb9 ) test2 ( \u53c2\u6570\u5185\u5bb9\uff1atest2 getArgs() \u4e5f\u6709\u4e09\u5c42\u5c01\u88c5\uff0c\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u907f\u514d\u9ebb\u70e6\u7684\u8bdd\uff0c\u63a8\u8350\u4f7f\u7528\u4e0b\u9762\u8fd9\u51e0\u79cd get*Arg() \u65b9\u5f0f\u3002","title":"getArgs() - \u81ea\u52a8\u83b7\u53d6\u53c2\u6570"},{"location":"component/context/#getfullarg","text":"\u83b7\u53d6\u5173\u952e\u8bcd\u540e\u7684\u6574\u4e2a\u5b57\u7b26\u4e32\u53c2\u6570\uff0c\u5305\u62ec\u7a7a\u683c\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5219\u8be2\u95ee\u3002 \u5178\u578b\u4f8b\u5b50\uff1a \u590d\u8bfb\u673a \u4f60\u597d \u4f60\u597d \uff0c\u83b7\u53d6\u53c2\u6570\u65f6\u4f1a\u5c06 \u4f60\u597d \u4f60\u597d \u5f53\u4f5c\u4e00\u4e2a\u53c2\u6570\u6765\u83b7\u53d6\u3002 1 2 3 4 5 6 7 /** * @CQCommand(\"test\") */ public function argTest1() { $s = ctx()->getFullArg(\"\u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u53c2\u6570\u5185\u5bb9\"); return \"\u53c2\u6570\u5185\u5bb9\uff1a\".$s; } ) test abc def argtest ( \u53c2\u6570\u5185\u5bb9\uff1aabc def argtest ) test ( \u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u53c2\u6570\u5185\u5bb9 ) abc def ( \u53c2\u6570\u5185\u5bb9\uff1aabc def","title":"getFullArg()"},{"location":"component/context/#getnextarg","text":"\u83b7\u53d6\u4e0b\u4e00\u4e2a\u53c2\u6570\uff0c\u5206\u9694\u7b26\u53ef\u4ee5\u662f\u7a7a\u683c\uff0ctab\u3002 1 2 3 4 5 6 7 /** * @CQCommand(\"test\") */ public function argTest1() { $s = ctx()->getNextArg(\"\u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u53c2\u6570\u5185\u5bb9\"); return \"\u53c2\u6570\u5185\u5bb9\uff1a\".$s; } ) test abc def argtest ( \u53c2\u6570\u5185\u5bb9\uff1aabc ) test ( \u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u53c2\u6570\u5185\u5bb9 ) abc ( \u53c2\u6570\u5185\u5bb9\uff1aabc","title":"getNextArg()"},{"location":"component/context/#getnumarg","text":"2.1.5 \u7248\u672c\u8d77\u53ef\u7528\u3002 \u83b7\u53d6\u4e0b\u4e00\u4e2a\u6570\u5b57\u578b\u53c2\u6570\uff0c\u5982\u679c is_numeric() \u4e3a true \u5219\u83b7\u53d6\u6210\u529f\uff0c\u5982\u679c\u6ca1\u6709\u7b26\u5408\u7684\u5219\u8be2\u95ee\u7528\u6237\u3002 1 2 3 4 5 6 7 /** * @CQCommand(\"test\") */ public function argTest1() { $s = ctx()->getNextArg(\"\u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u6570\u5b57\u5185\u5bb9\"); return \"\u6570\u5b57\u53c2\u6570\u5185\u5bb9\uff1a\".$s; } ) test abc 334 argtest ( \u6570\u5b57\u53c2\u6570\u5185\u5bb9\uff1a334 ) test abc ( \u8bf7\u8f93\u5165\u4f60\u8981\u4f20\u5165\u7684\u6570\u5b57\u5185\u5bb9 ) 998 ( \u53c2\u6570\u5185\u5bb9\uff1a998","title":"getNumArg()"},{"location":"component/context/#copy","text":"\u83b7\u53d6\u6574\u4e2a\u4e0a\u4e0b\u6587\u7684\u6240\u6709\u5185\u5bb9\u7684\u6570\u7ec4\u5f62\u5f0f\u3002 1 2 $arr = ctx()->copy(); dump($arr);","title":"copy()"},{"location":"component/context/#getoption-","text":"1 2 3 4 5 6 /** * @CQCommand(\"test\") */ public function argTest1() { return \"\u53c2\u6570\u5185\u5bb9\uff1a\".implode(\", \", ctx()->getOption()); } ) test abc 334 argtest ( \u53c2\u6570\u5185\u5bb9\uff1aabc, 334, argtest","title":"getOption() - \u83b7\u53d6\u5339\u914d\u53c2\u6570\u5185\u5bb9"},{"location":"component/coroutine-pool/","text":"\u534f\u7a0b\u6c60 \u9996\u5148\u8981\u58f0\u660e\u7684\u4e00\u70b9\u662f\uff0c\u534f\u7a0b\u6c60\u8fd9\u4e2a\u6982\u5ff5\u662f\u6211\u81ea\u5df1\u7f16\u7684\u3002 \u56e0\u4e3a\u534f\u7a0b\u7684\u7279\u70b9\uff0c\u5b83\u662f\u5355\u7ebf\u7a0b\u4e0b\u8fd0\u884c\u7684\uff0c\u6240\u4ee5\u5728\u4e00\u4e2a\u8fdb\u7a0b\u5185\u540c\u65f6\u5b9e\u9645\u4e0a\u53ea\u4f1a\u6709\u4e00\u4e2a\u534f\u7a0b\u7684\u4ee3\u7801\u5728\u6267\u884c\u903b\u8f91\uff0c\u4f46\u662f\u540e\u9762\u7684 IO \u64cd\u4f5c\u3001\u534f\u7a0b\u6302\u8d77\u7b49\u5f85\u7684\u64cd\u4f5c\u90fd\u662f\u540c\u65f6\u53bb\u505a\u7684\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u7684\u5927\u6570\u636e\u8bfb\u53d6\u3001\u5199\u5165\u9700\u8981\u8017\u65f6\u51e0\u79d2\u751a\u81f3\u51e0\u5341\u79d2\uff0c\u8fd9\u65f6\u7528\u57fa\u4e8e\u534f\u7a0b\u7684 MySQL \u8fde\u63a5\u6c60\u5c31\u5b8c\u5168\u4e0d\u662f\u95ee\u9898\u3002 \u4f46\u662f\u5c31\u62ff MySQL \u4e3e\u4f8b\uff0c\u6211\u4eec MySQL \u4f7f\u7528\u7684\u662f TCP \u8fde\u63a5\uff0c\u800c\u65e0\u8bba\u662f MySQL \u8fd8\u662f TCP \u8fde\u63a5\uff0c\u6700\u5927\u6570\u91cf\u90fd\u662f\u6709\u9650\u7684\u3002\u6211\u4eec\u5373\u4f7f\u8bbe\u7f6e\u4e86\u5141\u8bb8\u6700\u5927\u534f\u7a0b\u6570\u91cf\u975e\u5e38\u5927\uff0c\u6bd4\u5982\u4e0a\u767e\u4e07\uff0c\u4f46\u662f\u4e5f\u4e0d\u80fd\u8ba9\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u4e00\u4e2a\u6c60\u652f\u6301\u4e0a\u767e\u4e07\u7684\u8fde\u63a5\u3002 \u8fd9\u65f6\u5047\u8bbe\u9ad8\u5e76\u53d1\u8fdb\u6765\u4e86\u600e\u4e48\u529e\u5462\uff1f\u8fd9\u65f6\u5c31\u9700\u8981\u6846\u67b6\u63d0\u51fa\u7684\u4e00\u4e2a\u6298\u4e2d\u65b9\u6848\uff1a\u534f\u7a0b\u6c60\u4e86\u3002 \u987e\u540d\u601d\u4e49\uff0c\u534f\u7a0b\u6c60\u662f\u4e00\u4e2a\u5bb9\u7eb3\u534f\u7a0b\u7684\u533a\u57df\uff0c\u800c\u534f\u7a0b\u91cc\u53c8\u5bb9\u7eb3\u7740\u5404\u79cd\u5404\u6837\u9700\u8981\u963b\u585e\u8c03\u7528\u88ab\u534f\u7a0b\u8c03\u7528\u7684 IO \u64cd\u4f5c\uff0c\u534f\u7a0b\u6c60\u7528\u4f5c\u9650\u5236\u534f\u7a0b\u7684\u6570\u91cf\u3002 1 2 3 4 5 6 7 8 9 10 11 use ZM\\Utils\\CoroutinePool; use ZM\\DB\\DB; // \u4f20\u7edf\u5199\u6cd5\uff0c\u4e00\u65e6\u9ad8\u5e76\u53d1\u5219\u53ef\u80fd\u5bfc\u81f4 Too many connections go(funuction(){ DB::rawQuery(\"INSERT INTO users VALUES(?,?)\", [\"admin\", \"password\"]); }); // \u534f\u7a0b\u6c60\u5199\u6cd5 CoroutinePool::go(function(){ DB::rawQuery(\"INSERT INTO users VALUES(?,?)\", [\"admin\", \"password\"]); }, \"foo\"); \u53c2\u6570\uff1a go(callable $func, $name = \"default\") $name \u4e3a\u534f\u7a0b\u6c60\u5bf9\u5e94\u7684\u540d\u5b57\uff0c\u4f60\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u534f\u7a0b\u6c60\uff0c\u7528\u6765\u652f\u6301\u4e0d\u540c\u7684\u9700\u8981\u9650\u5236\u5e76\u53d1 IO \u6570\u91cf\u7684\u5730\u65b9\uff0c\u4f8b\u5982 Redis \u548c MySQL \u8bbe\u7f6e\u4e0d\u540c\u7684\u540d\u5b57\u3002 $func \u53ef\u4e3a\u95ed\u5305\u6216\u53ef\u8c03\u7528\u7684\u65b9\u6cd5\u540d\u79f0\u6216\u6570\u7ec4\u3002 \u914d\u7f6e \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u76f4\u63a5\u8c03\u7528 CoroutinePool::go() \u65f6\uff0c\u534f\u7a0b\u6c60\u5927\u5c0f\u4e3a 30\uff0c\u4e5f\u5c31\u662f\u5982\u679c\u6709 30 \u4e2a\u534f\u7a0b\u8fdb\u5165\u4e86\u6302\u8d77\u72b6\u6001\uff08\u6bd4\u5982\u6570\u636e\u5e93\u5728\u6267\u884c\u67e5\u8be2\u8bed\u53e5\uff09\uff0c\u90a3\u4e48\u66f4\u591a\u7684\u534f\u7a0b\u6267\u884c\u65f6\u5c31\u4f1a\u963b\u585e\u5e76\u4ee5\u534f\u7a0b\u7b49\u5f85\u7684\u65b9\u5f0f\u7b49\u5f85\uff0c\u76f4\u5230\u73b0\u6709\u7684 30 \u4e2a\u534f\u7a0b\u4e2d\u7684\u4e00\u90e8\u5206\u5b8c\u6210\u4e86\u5b83\u7684\u5de5\u4f5c\u3002 \u65b9\u6cd5 CoroutinePool::go() \u5c06\u534f\u7a0b\u653e\u5165\u534f\u7a0b\u6c60\u8fd0\u884c\u3002 \u5982\u679c\u4e0d\u5199 $name \u53c2\u6570\uff0c\u5219\u4f7f\u7528\u7684\u662f\u9ed8\u8ba4\u534f\u7a0b\u6c60\u3002 CoroutinePool::defaultSize() \u8bbe\u7f6e\u9ed8\u8ba4\u534f\u7a0b\u6c60\u7684\u5927\u5c0f\uff08\u9ed8\u8ba4 30\uff09 1 2 3 4 5 6 CoroutinePool::defaultSize(64); for($i = 0; $i < 1000; ++$i) { CoroutinePool::go(function(){ DB::rawQuery(\"SELECT * FROM users\"); }); } CoroutinePool::setSize() \u5b9a\u4e49\uff1a setSize($name, int $size) $name \u4e3a\u5b57\u7b26\u4e32\uff0c\u662f\u4f60\u8981\u7528\u7684\u534f\u7a0b\u6c60\u7684\u540d\u79f0\u3002 $size \u4e3a\u5927\u5c0f\uff0c\u6700\u5927\u4e0d\u53ef\u8d85\u8fc7 Swoole \u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u7684\u6700\u5927\u534f\u7a0b\u6570\u91cf\u3002","title":"\u534f\u7a0b\u6c60"},{"location":"component/coroutine-pool/#_1","text":"\u9996\u5148\u8981\u58f0\u660e\u7684\u4e00\u70b9\u662f\uff0c\u534f\u7a0b\u6c60\u8fd9\u4e2a\u6982\u5ff5\u662f\u6211\u81ea\u5df1\u7f16\u7684\u3002 \u56e0\u4e3a\u534f\u7a0b\u7684\u7279\u70b9\uff0c\u5b83\u662f\u5355\u7ebf\u7a0b\u4e0b\u8fd0\u884c\u7684\uff0c\u6240\u4ee5\u5728\u4e00\u4e2a\u8fdb\u7a0b\u5185\u540c\u65f6\u5b9e\u9645\u4e0a\u53ea\u4f1a\u6709\u4e00\u4e2a\u534f\u7a0b\u7684\u4ee3\u7801\u5728\u6267\u884c\u903b\u8f91\uff0c\u4f46\u662f\u540e\u9762\u7684 IO \u64cd\u4f5c\u3001\u534f\u7a0b\u6302\u8d77\u7b49\u5f85\u7684\u64cd\u4f5c\u90fd\u662f\u540c\u65f6\u53bb\u505a\u7684\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u7684\u5927\u6570\u636e\u8bfb\u53d6\u3001\u5199\u5165\u9700\u8981\u8017\u65f6\u51e0\u79d2\u751a\u81f3\u51e0\u5341\u79d2\uff0c\u8fd9\u65f6\u7528\u57fa\u4e8e\u534f\u7a0b\u7684 MySQL \u8fde\u63a5\u6c60\u5c31\u5b8c\u5168\u4e0d\u662f\u95ee\u9898\u3002 \u4f46\u662f\u5c31\u62ff MySQL \u4e3e\u4f8b\uff0c\u6211\u4eec MySQL \u4f7f\u7528\u7684\u662f TCP \u8fde\u63a5\uff0c\u800c\u65e0\u8bba\u662f MySQL \u8fd8\u662f TCP \u8fde\u63a5\uff0c\u6700\u5927\u6570\u91cf\u90fd\u662f\u6709\u9650\u7684\u3002\u6211\u4eec\u5373\u4f7f\u8bbe\u7f6e\u4e86\u5141\u8bb8\u6700\u5927\u534f\u7a0b\u6570\u91cf\u975e\u5e38\u5927\uff0c\u6bd4\u5982\u4e0a\u767e\u4e07\uff0c\u4f46\u662f\u4e5f\u4e0d\u80fd\u8ba9\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u4e00\u4e2a\u6c60\u652f\u6301\u4e0a\u767e\u4e07\u7684\u8fde\u63a5\u3002 \u8fd9\u65f6\u5047\u8bbe\u9ad8\u5e76\u53d1\u8fdb\u6765\u4e86\u600e\u4e48\u529e\u5462\uff1f\u8fd9\u65f6\u5c31\u9700\u8981\u6846\u67b6\u63d0\u51fa\u7684\u4e00\u4e2a\u6298\u4e2d\u65b9\u6848\uff1a\u534f\u7a0b\u6c60\u4e86\u3002 \u987e\u540d\u601d\u4e49\uff0c\u534f\u7a0b\u6c60\u662f\u4e00\u4e2a\u5bb9\u7eb3\u534f\u7a0b\u7684\u533a\u57df\uff0c\u800c\u534f\u7a0b\u91cc\u53c8\u5bb9\u7eb3\u7740\u5404\u79cd\u5404\u6837\u9700\u8981\u963b\u585e\u8c03\u7528\u88ab\u534f\u7a0b\u8c03\u7528\u7684 IO \u64cd\u4f5c\uff0c\u534f\u7a0b\u6c60\u7528\u4f5c\u9650\u5236\u534f\u7a0b\u7684\u6570\u91cf\u3002 1 2 3 4 5 6 7 8 9 10 11 use ZM\\Utils\\CoroutinePool; use ZM\\DB\\DB; // \u4f20\u7edf\u5199\u6cd5\uff0c\u4e00\u65e6\u9ad8\u5e76\u53d1\u5219\u53ef\u80fd\u5bfc\u81f4 Too many connections go(funuction(){ DB::rawQuery(\"INSERT INTO users VALUES(?,?)\", [\"admin\", \"password\"]); }); // \u534f\u7a0b\u6c60\u5199\u6cd5 CoroutinePool::go(function(){ DB::rawQuery(\"INSERT INTO users VALUES(?,?)\", [\"admin\", \"password\"]); }, \"foo\"); \u53c2\u6570\uff1a go(callable $func, $name = \"default\") $name \u4e3a\u534f\u7a0b\u6c60\u5bf9\u5e94\u7684\u540d\u5b57\uff0c\u4f60\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u534f\u7a0b\u6c60\uff0c\u7528\u6765\u652f\u6301\u4e0d\u540c\u7684\u9700\u8981\u9650\u5236\u5e76\u53d1 IO \u6570\u91cf\u7684\u5730\u65b9\uff0c\u4f8b\u5982 Redis \u548c MySQL \u8bbe\u7f6e\u4e0d\u540c\u7684\u540d\u5b57\u3002 $func \u53ef\u4e3a\u95ed\u5305\u6216\u53ef\u8c03\u7528\u7684\u65b9\u6cd5\u540d\u79f0\u6216\u6570\u7ec4\u3002","title":"\u534f\u7a0b\u6c60"},{"location":"component/coroutine-pool/#_2","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u76f4\u63a5\u8c03\u7528 CoroutinePool::go() \u65f6\uff0c\u534f\u7a0b\u6c60\u5927\u5c0f\u4e3a 30\uff0c\u4e5f\u5c31\u662f\u5982\u679c\u6709 30 \u4e2a\u534f\u7a0b\u8fdb\u5165\u4e86\u6302\u8d77\u72b6\u6001\uff08\u6bd4\u5982\u6570\u636e\u5e93\u5728\u6267\u884c\u67e5\u8be2\u8bed\u53e5\uff09\uff0c\u90a3\u4e48\u66f4\u591a\u7684\u534f\u7a0b\u6267\u884c\u65f6\u5c31\u4f1a\u963b\u585e\u5e76\u4ee5\u534f\u7a0b\u7b49\u5f85\u7684\u65b9\u5f0f\u7b49\u5f85\uff0c\u76f4\u5230\u73b0\u6709\u7684 30 \u4e2a\u534f\u7a0b\u4e2d\u7684\u4e00\u90e8\u5206\u5b8c\u6210\u4e86\u5b83\u7684\u5de5\u4f5c\u3002","title":"\u914d\u7f6e"},{"location":"component/coroutine-pool/#_3","text":"","title":"\u65b9\u6cd5"},{"location":"component/coroutine-pool/#coroutinepoolgo","text":"\u5c06\u534f\u7a0b\u653e\u5165\u534f\u7a0b\u6c60\u8fd0\u884c\u3002 \u5982\u679c\u4e0d\u5199 $name \u53c2\u6570\uff0c\u5219\u4f7f\u7528\u7684\u662f\u9ed8\u8ba4\u534f\u7a0b\u6c60\u3002","title":"CoroutinePool::go()"},{"location":"component/coroutine-pool/#coroutinepooldefaultsize","text":"\u8bbe\u7f6e\u9ed8\u8ba4\u534f\u7a0b\u6c60\u7684\u5927\u5c0f\uff08\u9ed8\u8ba4 30\uff09 1 2 3 4 5 6 CoroutinePool::defaultSize(64); for($i = 0; $i < 1000; ++$i) { CoroutinePool::go(function(){ DB::rawQuery(\"SELECT * FROM users\"); }); }","title":"CoroutinePool::defaultSize()"},{"location":"component/coroutine-pool/#coroutinepoolsetsize","text":"\u5b9a\u4e49\uff1a setSize($name, int $size) $name \u4e3a\u5b57\u7b26\u4e32\uff0c\u662f\u4f60\u8981\u7528\u7684\u534f\u7a0b\u6c60\u7684\u540d\u79f0\u3002 $size \u4e3a\u5927\u5c0f\uff0c\u6700\u5927\u4e0d\u53ef\u8d85\u8fc7 Swoole \u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u7684\u6700\u5927\u534f\u7a0b\u6570\u91cf\u3002","title":"CoroutinePool::setSize()"},{"location":"component/global-functions/","text":"\u5168\u5c40\u65b9\u6cd5 \u5168\u5c40\u65b9\u6cd5\u5c31\u662f PHP \u7684\u5168\u5c40\u51fd\u6570\uff0c\u4efb\u610f\u4f4d\u7f6e\u90fd\u53ef\u4ee5\u8c03\u7528\uff0c\u65e0\u9700\u4f7f\u7528 use \u5b57\u6837\u3002 getClassPath() \u6e90\u7801 \u6839\u636e\u52a0\u8f7d\u7684\u7528\u6237\u7f16\u5199\u7684\u4ee3\u7801\u7c7b\u540d\u6765\u83b7\u53d6\u7c7b\u6240\u5728\u7684\u6587\u4ef6\u8def\u5f84\u3002 src/Module/Example/Hello.php 1 2 3 <?php namespace Module\\Example ; class Hello { ... } src/Module/Example/Start.php 1 2 3 4 5 6 7 8 9 10 11 <?php namespace Module\\Example ; use ZM\\Annotation\\Swoole\\OnStart ; class Start { /** * @OnStart() */ public function onStart () { Console :: info ( \"Path: \" . getClassPath ( Hello :: class )); } } \u8f93\u51fa\u7ed3\u679c 1 [11:12:02] [I] [#0] Path: /mnt/d/project/zhamao-framework/src/Module/Example/Hello.ph explodeMsg() \u6e90\u7801 \u5207\u5272\u5b57\u7b26\u4e32\u7684\u51fd\u6570\uff0c\u652f\u6301\u591a\u7a7a\u683c\uff0c\u6362\u884c\uff0ctab\u3002 \u5b9a\u4e49\uff1a explodeMsg($msg, $ban_comma = false) 1 2 $s = explodeMsg(\"\u4f60\u597d\u554a \u4f60\u597d\u4f60\u597d\\n\u6211\u8fd8\u6709\u591a\u4e2a\u7a7a\u683c \u54c8\u54c8\u54c8\"); echo json_encode($s, 128|256); // [\"\u4f60\u597d\u554a\",\"\u4f60\u597d\u4f60\u597d\",\"\u6211\u8fd8\u6709\u591a\u4e2a\u7a7a\u683c\",\"\u54c8\u54c8\u54c8\"] unicode_decode() \u6e90\u7801 Unicode \u89e3\u7801\uff0c\u4e00\u822c\u7528\u4e8e\u88ab\u8f6c\u4e49\u7684 Unicode \u8f6c\u56de\u6765\u3002 1 echo unicode_decode(\"\\u4f60\\u597d\"); // \u4f60\u597d matchPattern() \u6e90\u7801 \u6839\u636e\u661f\u53f7\u5339\u914d\u5b57\u7b26\u4e32\uff08\u975e\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\u3002 \u5339\u914d\u793a\u4f8b\uff1a \u4f60\u4eca\u5929*\u4e86\u5417 -> \u4f60\u4eca\u5929\u559d\u6c34\u4e86\u5417 *\u7684\u5929\u6c14\u600e\u4e48\u6837 -> \u5fb7\u5dde\u7684\u5929\u6c14\u600e\u4e48\u6837 \u628a*\u7ffb\u8bd1\u6210* -> \u628a\u8336\u7ffb\u8bd1\u6210\u82f1\u8bed \u5b9a\u4e49\uff1a matchPattern($pattern, $context) $pattern \u4e3a\u5339\u914d\u6a21\u5f0f\uff0c\u4f8b\u5982 \u4f60\u4eca\u5929*\u4e86\u5417 \u3002 $context \u4e3a\u8981\u5224\u65ad\u662f\u5426\u5339\u914d\u7684\u5185\u5bb9\u3002 \u8fd4\u56de\u503c\uff1a bool \uff0c\u5f53\u4e3a true \u65f6\u4ee3\u8868\u89c4\u5219\u662f\u5339\u914d\u7684\uff0cfalse \u4ee3\u8868\u4e0d\u5339\u914d\u3002 1 2 3 matchPattern(\"*\u662f\u4e2a\u5565\uff1f\", \"996\u662f\u4e2a\u5565\uff1f\"); // true matchPattern(\"\u6211\u60f3\u542c*\u5531\u6b4c\", \"\u4f60\u60f3\u542c\u8c01\u5531\u6b4c\"); // false matchPattern(\"*\u628a*\u7ffb\u8bd1\u6210*\", \"\u8bf7\u628a\u4f60\u597d\u7ffb\u8bd1\u6210\u963f\u62c9\u4f2f\u8bed\"); // true split_explode() \u6e90\u7801 \u548c explodeMsg() \u7c7b\u4f3c\uff0c\u7528\u4f5c\u5206\u5272\u5b57\u7b26\u4e32\uff0c\u4e0d\u8fc7\u6b64\u51fd\u6570\u52a0\u5165\u4e86\u5bf9 \u4e2d\u6587|\u6570\u5b57 \u4e24\u8005\u7684\u5206\u5272\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e2d\u6587\u548c\u6570\u5b57\u4e4b\u95f4\u4e5f\u4f1a\u88ab\u5206\u5272\u3002 \u5b9a\u4e49\uff1a split_explode($del, $str, $divide_en = false) 1 split_explode(\" \", \"\u524d\u8fdb20 \u6025\u554a\u6025\u554a\"); // [\"\u524d\u8fdb\",\"20\",\"\u6025\u554a\u6025\u554a\"] $del \u548c explode() \u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f5c\u7528\u76f8\u540c\uff0c\u4f5c\u4e3a\u521d\u671f\u5206\u5272\u7684\u6807\u5fd7\u3002 $str \u8868\u793a\u5f85\u5206\u5272\u7684\u5185\u5bb9\u3002 $divide_en \u8868\u793a\u662f\u5426\u5206\u5272\u4e2d\u6587\u548c\u82f1\u6587\uff0c\u5982\u679c\u4e3a\u662f\uff0c\u5219\u4e2d\u6587\u548c\u82f1\u6587\u4e4b\u95f4\u4e5f\u4f1a\u88ab\u5206\u5272\u5f00\u3002 matchArgs() \u6e90\u7801 matchPattern() \u7684\u6269\u5c55\uff0c\u5982\u679c matchPattern() \u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u548c\u6a21\u5f0f\u5339\u914d\u6210\u529f\uff0c\u5219\u901a\u8fc7\u661f\u53f7\u4f4d\u7f6e\u6765\u63d0\u53d6\u661f\u53f7\u5339\u914d\u5230\u7684\u5185\u5bb9\uff0c\u53c2\u6570\u540c matchPattern() \u3002 1 $r = matchArgs(\"\u628a*\u7ffb\u8bd1\u6210*\", \"\u628a\u65e5\u8bed\u7ffb\u8bd1\u6210\u82f1\u8bed\"); // [\"\u65e5\u8bed\",\"\u82f1\u8bed\"] connectIsQQ() \u5224\u65ad\u5f53\u524d WebSocket \u8fde\u63a5\u662f\u5426\u4e3a OneBot \u6807\u51c6\u7684\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u3002 connectIsDefault() \u5224\u65ad\u8fde\u63a5\u662f\u5426\u662f\u672a\u5b9a\u4e49\u7c7b\u578b\u7684 WebSocket \u8fde\u63a5\u3002 connectIs() \u5224\u65ad\u8fde\u63a5\u662f\u5426\u662f\u5bf9\u5e94\u7c7b\u578b\u7684 WebSocket \u8fde\u63a5\u3002 1 connectIs(\"your_another_type_connect\"); set_coroutine_params() \u8bbe\u7f6e\u5f53\u524d\u4e0a\u4e0b\u6587\u4e2d\u7684\u4e00\u4e9b\u53d8\u91cf\u3002 1 2 3 4 set_coroutine_params([\"data\" => [ \"post_type\" => \"message\", ... ]]); ctx() \u522b\u540d\uff1a context() \uff0c\u83b7\u53d6\u5f53\u524d\u534f\u7a0b\u7684\u4e0a\u4e0b\u6587\uff0c\u89c1 \u4e0a\u4e0b\u6587 \u3002 zm_sleep() \u534f\u7a0b\u7248 sleep() \u51fd\u6570\u3002 \u5b9a\u4e49\uff1a zm_sleep($s = 1) $s \uff1a\u7761\u7720\u7684\u65f6\u95f4\uff1a\u79d2\uff0c\u53ef\u652f\u6301\u5c0f\u6570\u3002\uff08\u4f8b\u5982\uff1a0.001 \u4ee3\u8868 1 \u6beb\u79d2\uff09 \u4e3a\u4ec0\u4e48\u4e0d\u7528 PHP \u81ea\u5e26\u7684 sleep \u5462\uff1f\u56e0\u4e3a\u70b8\u6bdb\u6846\u67b6\u662f\u57fa\u4e8e\u534f\u7a0b\u7684\uff0c\u534f\u7a0b\u7248 sleep \u9700\u8981\u4f7f\u7528 Swoole \u81ea\u5e26\u7684 sleep\u3002\u6b64\u51fd\u6570\u505a\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u5c01\u88c5\u3002 1 2 zm_sleep(5); zm_sleep(0.05); zm_exec() \u6267\u884c\u7cfb\u7edf\u547d\u4ee4\uff0c\u66ff\u4ee3 PHP \u7684 exec() \u3002 \u5b9a\u4e49\uff1a zm_exec($cmd) \u8fd4\u56de\u503c\uff1a 1 2 3 4 5 array( 'code' => 0, // \u8fdb\u7a0b\u9000\u51fa\u7684\u72b6\u6001\u7801 'signal' => 0, // \u4fe1\u53f7 'output' => 'hello world', // \u8f93\u51fa\u5185\u5bb9 ); 1 $result = zm_exec(\"echo 'hello world'\")[\"output\"]; zm_cid() \u83b7\u53d6\u5f53\u524d\u534f\u7a0b\u7684 ID\uff0c\u6548\u679c\u7b49\u540c\u4e8e \\Swoole\\Coroutine::getCid() \u3002 zm_yield() \u6302\u8d77\u5f53\u524d\u534f\u7a0b\uff0c\u76f4\u5230\u624b\u52a8\u6062\u590d\uff0c\u6548\u679c\u7b49\u540c\u4e8e \\Swoole\\Coroutine::yield() \u3002 zm_resume() \u6062\u590d\u7ee7\u7eed\u6267\u884c\u534f\u7a0b\uff0c\u6548\u679c\u7b49\u540c\u4e8e \\Swoole\\Coroutine::resume() \u3002 1 2 3 4 5 6 7 8 9 10 11 12 $r = 0; function test() { echo \"hello-1\\n\"; global $r; $r = zm_cid(); zm_yield(); echo \"hello-2\\n\"; } go(\"test\"); echo \"hello-3\\n\"; zm_resume($r); \u8f93\u51fa\u7ed3\u679c\uff1a 1 2 3 hello-1 hello-3 hello-2 server() \u83b7\u53d6 Swoole Server \u5bf9\u8c61\u8fdb\u884c\u64cd\u4f5c\uff0c\u6548\u679c\u7b49\u540c\u4e8e \\ZM\\Framework::$server \u3002 1 echo server()->worker_id.PHP_EOL; // 0 bot() \u8fd4\u56de ZMRobot \u64cd\u4f5c\u673a\u5668\u4eba API \u7684\u5bf9\u8c61\u3002 \u5bf9\u4e8e\u9ed8\u8ba4\u7684\u6a21\u5f0f\uff0c\u5982\u679c\u6846\u67b6\u8fde\u63a5\u4e86\u591a\u4e2a\u673a\u5668\u4eba\u5b9e\u4f8b\uff0c\u5219\u4f1a\u968f\u673a\u8fd4\u56de\u4e00\u4e2a\u673a\u5668\u4eba\u7684 API \u5b9e\u4f8b\u3002\u5982\u679c\u4f7f\u7528\u4e86\u5355\u4f8b\u6a21\u5f0f\uff0c\u5219\u8fd4\u56de\u5355\u4f8b\u6a21\u5f0f\u7684\u673a\u5668\u4eba API \u5b9e\u4f8b\u3002 1 2 bot()->sendPrivateMsg(123456, \"\u4f60\u597d\u554a\uff01\uff01\"); // \u7b49\u540c\u4e8e ZMRobot::getRandom()->sendPrivateMsg(123456, \"\u4f60\u597d\u554a\uff01\uff01\"); zm_atomic() \u83b7\u53d6\u8ba1\u65f6\u5668\uff0c\u6548\u679c\u540c \\ZM\\Store\\ZMAtomic::get($name) \u3002 \u5b9a\u4e49\uff1a zm_atmoic($name) uuidgen() 2.2.5 \u7248\u672c\u8d77\u53ef\u7528\u3002 \u751f\u6210\u4e00\u4e2a\u968f\u673a\u7684 uuid\uff0c\u652f\u6301\u5927\u5199\u6216\u5c0f\u5199\u3002 \u5b9a\u4e49\uff1a uuidgen($uppercase = false) \u5f53 $uppercase \u4e3a true \u65f6\uff0c\u8fd4\u56de\u7684 uuid \u4e2d\u5b57\u6bcd\u90fd\u662f\u5927\u5199\u3002 working_dir() 2.2.6 \u7248\u672c\u8d77\u53ef\u7528\u3002 \u83b7\u53d6\u6846\u67b6\u8fd0\u884c\u7684\u5de5\u4f5c\u76ee\u5f55\u3002\u4f8b\u5982\u4f60\u662f\u4ece /root/framework-starter/ \u76ee\u5f55\u542f\u52a8\u7684\u6846\u67b6\uff0c vendor/bin/start server \uff0c\u90a3\u4e48 working_dir() \u8fd4\u56de\u7684\u5c31\u662f /root/framework-starter \u3002\uff08\u6ce8\u610f\uff0c\u8fd4\u56de\u7684\u76ee\u5f55\u6700\u540e\u6ca1\u6709\u659c\u6760\uff0c\u8bf7\u81ea\u884c\u6dfb\u52a0\u3002\uff09 getAllFdByConnectType() \u83b7\u53d6\u540c\u7c7b\u578b\u7684\u6240\u6709\u8fde\u63a5\u7684\u63cf\u8ff0\u7b26 ID\u3002 \u5b9a\u4e49\uff1a getAllFdByConnectType(string $type = 'default'): array \u5f53 $type \u4e3a qq \u65f6\uff0c\u5219\u8fd4\u56de\u6240\u6709 OneBot \u673a\u5668\u4eba\u63a5\u5165\u7684 WebSocket \u8fde\u63a5\u53f7\u3002 zm_dump() \u66f4\u6f02\u4eae\u5730\u8f93\u51fa\u53d8\u91cf\u503c\uff0c\u53ef\u66ff\u4ee3 var_dump() \u3002 1 2 3 4 5 6 7 class Pass { public $foo = 123; public $bar = [\"a\", \"b\"]; } $pass = new Pass(); $pass->obj = true; zm_dump($pass); zm_config() v2.4.0 \u8d77\u53ef\u7528\u3002 \u540c ZMConfig::get() \u3002 \u5b9a\u4e49\uff1a zm_config($name, $key = null) \u3002 \u6709\u5173 ZMConfig \u6a21\u5757\u7684\u8bf4\u660e\uff0c\u89c1 \u6307\u5357 - \u57fa\u672c\u914d\u7f6e \u3002 1 2 zm_config(\"global\"); //\u7b49\u540c\u4e8e ZMConfig::get(\"global\"); zm_config(\"global\", \"swoole\"); //\u7b49\u540c\u4e8e ZMConfig::get(\"global\", \"swoole\"); zm_info() v2.4.0 \u8d77\u53ef\u7528\u3002\uff08\u4e0b\u9762\u7684 log \u7c7b\u4e5f\u4e00\u6837\uff09 \u540c Console::info($msg) \u3002 zm_debug() \u540c Console::debug($msg) \u3002 zm_warning() \u540c Console::warning($msg) \u3002 zm_success() \u540c Console::success($msg) \u3002 zm_error() \u540c Console::error($msg) \u3002 zm_verbose() \u540c Console::verbose($msg) \u3002","title":"\u5168\u5c40\u65b9\u6cd5"},{"location":"component/global-functions/#_1","text":"\u5168\u5c40\u65b9\u6cd5\u5c31\u662f PHP \u7684\u5168\u5c40\u51fd\u6570\uff0c\u4efb\u610f\u4f4d\u7f6e\u90fd\u53ef\u4ee5\u8c03\u7528\uff0c\u65e0\u9700\u4f7f\u7528 use \u5b57\u6837\u3002","title":"\u5168\u5c40\u65b9\u6cd5"},{"location":"component/global-functions/#getclasspath","text":"\u6e90\u7801 \u6839\u636e\u52a0\u8f7d\u7684\u7528\u6237\u7f16\u5199\u7684\u4ee3\u7801\u7c7b\u540d\u6765\u83b7\u53d6\u7c7b\u6240\u5728\u7684\u6587\u4ef6\u8def\u5f84\u3002 src/Module/Example/Hello.php 1 2 3 <?php namespace Module\\Example ; class Hello { ... } src/Module/Example/Start.php 1 2 3 4 5 6 7 8 9 10 11 <?php namespace Module\\Example ; use ZM\\Annotation\\Swoole\\OnStart ; class Start { /** * @OnStart() */ public function onStart () { Console :: info ( \"Path: \" . getClassPath ( Hello :: class )); } } \u8f93\u51fa\u7ed3\u679c 1 [11:12:02] [I] [#0] Path: /mnt/d/project/zhamao-framework/src/Module/Example/Hello.ph","title":"getClassPath()"},{"location":"component/global-functions/#explodemsg","text":"\u6e90\u7801 \u5207\u5272\u5b57\u7b26\u4e32\u7684\u51fd\u6570\uff0c\u652f\u6301\u591a\u7a7a\u683c\uff0c\u6362\u884c\uff0ctab\u3002 \u5b9a\u4e49\uff1a explodeMsg($msg, $ban_comma = false) 1 2 $s = explodeMsg(\"\u4f60\u597d\u554a \u4f60\u597d\u4f60\u597d\\n\u6211\u8fd8\u6709\u591a\u4e2a\u7a7a\u683c \u54c8\u54c8\u54c8\"); echo json_encode($s, 128|256); // [\"\u4f60\u597d\u554a\",\"\u4f60\u597d\u4f60\u597d\",\"\u6211\u8fd8\u6709\u591a\u4e2a\u7a7a\u683c\",\"\u54c8\u54c8\u54c8\"]","title":"explodeMsg()"},{"location":"component/global-functions/#unicode_decode","text":"\u6e90\u7801 Unicode \u89e3\u7801\uff0c\u4e00\u822c\u7528\u4e8e\u88ab\u8f6c\u4e49\u7684 Unicode \u8f6c\u56de\u6765\u3002 1 echo unicode_decode(\"\\u4f60\\u597d\"); // \u4f60\u597d","title":"unicode_decode()"},{"location":"component/global-functions/#matchpattern","text":"\u6e90\u7801 \u6839\u636e\u661f\u53f7\u5339\u914d\u5b57\u7b26\u4e32\uff08\u975e\u6b63\u5219\u8868\u8fbe\u5f0f\uff09\u3002 \u5339\u914d\u793a\u4f8b\uff1a \u4f60\u4eca\u5929*\u4e86\u5417 -> \u4f60\u4eca\u5929\u559d\u6c34\u4e86\u5417 *\u7684\u5929\u6c14\u600e\u4e48\u6837 -> \u5fb7\u5dde\u7684\u5929\u6c14\u600e\u4e48\u6837 \u628a*\u7ffb\u8bd1\u6210* -> \u628a\u8336\u7ffb\u8bd1\u6210\u82f1\u8bed \u5b9a\u4e49\uff1a matchPattern($pattern, $context) $pattern \u4e3a\u5339\u914d\u6a21\u5f0f\uff0c\u4f8b\u5982 \u4f60\u4eca\u5929*\u4e86\u5417 \u3002 $context \u4e3a\u8981\u5224\u65ad\u662f\u5426\u5339\u914d\u7684\u5185\u5bb9\u3002 \u8fd4\u56de\u503c\uff1a bool \uff0c\u5f53\u4e3a true \u65f6\u4ee3\u8868\u89c4\u5219\u662f\u5339\u914d\u7684\uff0cfalse \u4ee3\u8868\u4e0d\u5339\u914d\u3002 1 2 3 matchPattern(\"*\u662f\u4e2a\u5565\uff1f\", \"996\u662f\u4e2a\u5565\uff1f\"); // true matchPattern(\"\u6211\u60f3\u542c*\u5531\u6b4c\", \"\u4f60\u60f3\u542c\u8c01\u5531\u6b4c\"); // false matchPattern(\"*\u628a*\u7ffb\u8bd1\u6210*\", \"\u8bf7\u628a\u4f60\u597d\u7ffb\u8bd1\u6210\u963f\u62c9\u4f2f\u8bed\"); // true","title":"matchPattern()"},{"location":"component/global-functions/#split_explode","text":"\u6e90\u7801 \u548c explodeMsg() \u7c7b\u4f3c\uff0c\u7528\u4f5c\u5206\u5272\u5b57\u7b26\u4e32\uff0c\u4e0d\u8fc7\u6b64\u51fd\u6570\u52a0\u5165\u4e86\u5bf9 \u4e2d\u6587|\u6570\u5b57 \u4e24\u8005\u7684\u5206\u5272\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e2d\u6587\u548c\u6570\u5b57\u4e4b\u95f4\u4e5f\u4f1a\u88ab\u5206\u5272\u3002 \u5b9a\u4e49\uff1a split_explode($del, $str, $divide_en = false) 1 split_explode(\" \", \"\u524d\u8fdb20 \u6025\u554a\u6025\u554a\"); // [\"\u524d\u8fdb\",\"20\",\"\u6025\u554a\u6025\u554a\"] $del \u548c explode() \u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f5c\u7528\u76f8\u540c\uff0c\u4f5c\u4e3a\u521d\u671f\u5206\u5272\u7684\u6807\u5fd7\u3002 $str \u8868\u793a\u5f85\u5206\u5272\u7684\u5185\u5bb9\u3002 $divide_en \u8868\u793a\u662f\u5426\u5206\u5272\u4e2d\u6587\u548c\u82f1\u6587\uff0c\u5982\u679c\u4e3a\u662f\uff0c\u5219\u4e2d\u6587\u548c\u82f1\u6587\u4e4b\u95f4\u4e5f\u4f1a\u88ab\u5206\u5272\u5f00\u3002","title":"split_explode()"},{"location":"component/global-functions/#matchargs","text":"\u6e90\u7801 matchPattern() \u7684\u6269\u5c55\uff0c\u5982\u679c matchPattern() \u683c\u5f0f\u7684\u5b57\u7b26\u4e32\u548c\u6a21\u5f0f\u5339\u914d\u6210\u529f\uff0c\u5219\u901a\u8fc7\u661f\u53f7\u4f4d\u7f6e\u6765\u63d0\u53d6\u661f\u53f7\u5339\u914d\u5230\u7684\u5185\u5bb9\uff0c\u53c2\u6570\u540c matchPattern() \u3002 1 $r = matchArgs(\"\u628a*\u7ffb\u8bd1\u6210*\", \"\u628a\u65e5\u8bed\u7ffb\u8bd1\u6210\u82f1\u8bed\"); // [\"\u65e5\u8bed\",\"\u82f1\u8bed\"]","title":"matchArgs()"},{"location":"component/global-functions/#connectisqq","text":"\u5224\u65ad\u5f53\u524d WebSocket \u8fde\u63a5\u662f\u5426\u4e3a OneBot \u6807\u51c6\u7684\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u3002","title":"connectIsQQ()"},{"location":"component/global-functions/#connectisdefault","text":"\u5224\u65ad\u8fde\u63a5\u662f\u5426\u662f\u672a\u5b9a\u4e49\u7c7b\u578b\u7684 WebSocket \u8fde\u63a5\u3002","title":"connectIsDefault()"},{"location":"component/global-functions/#connectis","text":"\u5224\u65ad\u8fde\u63a5\u662f\u5426\u662f\u5bf9\u5e94\u7c7b\u578b\u7684 WebSocket \u8fde\u63a5\u3002 1 connectIs(\"your_another_type_connect\");","title":"connectIs()"},{"location":"component/global-functions/#set_coroutine_params","text":"\u8bbe\u7f6e\u5f53\u524d\u4e0a\u4e0b\u6587\u4e2d\u7684\u4e00\u4e9b\u53d8\u91cf\u3002 1 2 3 4 set_coroutine_params([\"data\" => [ \"post_type\" => \"message\", ... ]]);","title":"set_coroutine_params()"},{"location":"component/global-functions/#ctx","text":"\u522b\u540d\uff1a context() \uff0c\u83b7\u53d6\u5f53\u524d\u534f\u7a0b\u7684\u4e0a\u4e0b\u6587\uff0c\u89c1 \u4e0a\u4e0b\u6587 \u3002","title":"ctx()"},{"location":"component/global-functions/#zm_sleep","text":"\u534f\u7a0b\u7248 sleep() \u51fd\u6570\u3002 \u5b9a\u4e49\uff1a zm_sleep($s = 1) $s \uff1a\u7761\u7720\u7684\u65f6\u95f4\uff1a\u79d2\uff0c\u53ef\u652f\u6301\u5c0f\u6570\u3002\uff08\u4f8b\u5982\uff1a0.001 \u4ee3\u8868 1 \u6beb\u79d2\uff09 \u4e3a\u4ec0\u4e48\u4e0d\u7528 PHP \u81ea\u5e26\u7684 sleep \u5462\uff1f\u56e0\u4e3a\u70b8\u6bdb\u6846\u67b6\u662f\u57fa\u4e8e\u534f\u7a0b\u7684\uff0c\u534f\u7a0b\u7248 sleep \u9700\u8981\u4f7f\u7528 Swoole \u81ea\u5e26\u7684 sleep\u3002\u6b64\u51fd\u6570\u505a\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u5c01\u88c5\u3002 1 2 zm_sleep(5); zm_sleep(0.05);","title":"zm_sleep()"},{"location":"component/global-functions/#zm_exec","text":"\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\uff0c\u66ff\u4ee3 PHP \u7684 exec() \u3002 \u5b9a\u4e49\uff1a zm_exec($cmd) \u8fd4\u56de\u503c\uff1a 1 2 3 4 5 array( 'code' => 0, // \u8fdb\u7a0b\u9000\u51fa\u7684\u72b6\u6001\u7801 'signal' => 0, // \u4fe1\u53f7 'output' => 'hello world', // \u8f93\u51fa\u5185\u5bb9 ); 1 $result = zm_exec(\"echo 'hello world'\")[\"output\"];","title":"zm_exec()"},{"location":"component/global-functions/#zm_cid","text":"\u83b7\u53d6\u5f53\u524d\u534f\u7a0b\u7684 ID\uff0c\u6548\u679c\u7b49\u540c\u4e8e \\Swoole\\Coroutine::getCid() \u3002","title":"zm_cid()"},{"location":"component/global-functions/#zm_yield","text":"\u6302\u8d77\u5f53\u524d\u534f\u7a0b\uff0c\u76f4\u5230\u624b\u52a8\u6062\u590d\uff0c\u6548\u679c\u7b49\u540c\u4e8e \\Swoole\\Coroutine::yield() \u3002","title":"zm_yield()"},{"location":"component/global-functions/#zm_resume","text":"\u6062\u590d\u7ee7\u7eed\u6267\u884c\u534f\u7a0b\uff0c\u6548\u679c\u7b49\u540c\u4e8e \\Swoole\\Coroutine::resume() \u3002 1 2 3 4 5 6 7 8 9 10 11 12 $r = 0; function test() { echo \"hello-1\\n\"; global $r; $r = zm_cid(); zm_yield(); echo \"hello-2\\n\"; } go(\"test\"); echo \"hello-3\\n\"; zm_resume($r); \u8f93\u51fa\u7ed3\u679c\uff1a 1 2 3 hello-1 hello-3 hello-2","title":"zm_resume()"},{"location":"component/global-functions/#server","text":"\u83b7\u53d6 Swoole Server \u5bf9\u8c61\u8fdb\u884c\u64cd\u4f5c\uff0c\u6548\u679c\u7b49\u540c\u4e8e \\ZM\\Framework::$server \u3002 1 echo server()->worker_id.PHP_EOL; // 0","title":"server()"},{"location":"component/global-functions/#bot","text":"\u8fd4\u56de ZMRobot \u64cd\u4f5c\u673a\u5668\u4eba API \u7684\u5bf9\u8c61\u3002 \u5bf9\u4e8e\u9ed8\u8ba4\u7684\u6a21\u5f0f\uff0c\u5982\u679c\u6846\u67b6\u8fde\u63a5\u4e86\u591a\u4e2a\u673a\u5668\u4eba\u5b9e\u4f8b\uff0c\u5219\u4f1a\u968f\u673a\u8fd4\u56de\u4e00\u4e2a\u673a\u5668\u4eba\u7684 API \u5b9e\u4f8b\u3002\u5982\u679c\u4f7f\u7528\u4e86\u5355\u4f8b\u6a21\u5f0f\uff0c\u5219\u8fd4\u56de\u5355\u4f8b\u6a21\u5f0f\u7684\u673a\u5668\u4eba API \u5b9e\u4f8b\u3002 1 2 bot()->sendPrivateMsg(123456, \"\u4f60\u597d\u554a\uff01\uff01\"); // \u7b49\u540c\u4e8e ZMRobot::getRandom()->sendPrivateMsg(123456, \"\u4f60\u597d\u554a\uff01\uff01\");","title":"bot()"},{"location":"component/global-functions/#zm_atomic","text":"\u83b7\u53d6\u8ba1\u65f6\u5668\uff0c\u6548\u679c\u540c \\ZM\\Store\\ZMAtomic::get($name) \u3002 \u5b9a\u4e49\uff1a zm_atmoic($name)","title":"zm_atomic()"},{"location":"component/global-functions/#uuidgen","text":"2.2.5 \u7248\u672c\u8d77\u53ef\u7528\u3002 \u751f\u6210\u4e00\u4e2a\u968f\u673a\u7684 uuid\uff0c\u652f\u6301\u5927\u5199\u6216\u5c0f\u5199\u3002 \u5b9a\u4e49\uff1a uuidgen($uppercase = false) \u5f53 $uppercase \u4e3a true \u65f6\uff0c\u8fd4\u56de\u7684 uuid \u4e2d\u5b57\u6bcd\u90fd\u662f\u5927\u5199\u3002","title":"uuidgen()"},{"location":"component/global-functions/#working_dir","text":"2.2.6 \u7248\u672c\u8d77\u53ef\u7528\u3002 \u83b7\u53d6\u6846\u67b6\u8fd0\u884c\u7684\u5de5\u4f5c\u76ee\u5f55\u3002\u4f8b\u5982\u4f60\u662f\u4ece /root/framework-starter/ \u76ee\u5f55\u542f\u52a8\u7684\u6846\u67b6\uff0c vendor/bin/start server \uff0c\u90a3\u4e48 working_dir() \u8fd4\u56de\u7684\u5c31\u662f /root/framework-starter \u3002\uff08\u6ce8\u610f\uff0c\u8fd4\u56de\u7684\u76ee\u5f55\u6700\u540e\u6ca1\u6709\u659c\u6760\uff0c\u8bf7\u81ea\u884c\u6dfb\u52a0\u3002\uff09","title":"working_dir()"},{"location":"component/global-functions/#getallfdbyconnecttype","text":"\u83b7\u53d6\u540c\u7c7b\u578b\u7684\u6240\u6709\u8fde\u63a5\u7684\u63cf\u8ff0\u7b26 ID\u3002 \u5b9a\u4e49\uff1a getAllFdByConnectType(string $type = 'default'): array \u5f53 $type \u4e3a qq \u65f6\uff0c\u5219\u8fd4\u56de\u6240\u6709 OneBot \u673a\u5668\u4eba\u63a5\u5165\u7684 WebSocket \u8fde\u63a5\u53f7\u3002","title":"getAllFdByConnectType()"},{"location":"component/global-functions/#zm_dump","text":"\u66f4\u6f02\u4eae\u5730\u8f93\u51fa\u53d8\u91cf\u503c\uff0c\u53ef\u66ff\u4ee3 var_dump() \u3002 1 2 3 4 5 6 7 class Pass { public $foo = 123; public $bar = [\"a\", \"b\"]; } $pass = new Pass(); $pass->obj = true; zm_dump($pass);","title":"zm_dump()"},{"location":"component/global-functions/#zm_config","text":"v2.4.0 \u8d77\u53ef\u7528\u3002 \u540c ZMConfig::get() \u3002 \u5b9a\u4e49\uff1a zm_config($name, $key = null) \u3002 \u6709\u5173 ZMConfig \u6a21\u5757\u7684\u8bf4\u660e\uff0c\u89c1 \u6307\u5357 - \u57fa\u672c\u914d\u7f6e \u3002 1 2 zm_config(\"global\"); //\u7b49\u540c\u4e8e ZMConfig::get(\"global\"); zm_config(\"global\", \"swoole\"); //\u7b49\u540c\u4e8e ZMConfig::get(\"global\", \"swoole\");","title":"zm_config()"},{"location":"component/global-functions/#zm_info","text":"v2.4.0 \u8d77\u53ef\u7528\u3002\uff08\u4e0b\u9762\u7684 log \u7c7b\u4e5f\u4e00\u6837\uff09 \u540c Console::info($msg) \u3002","title":"zm_info()"},{"location":"component/global-functions/#zm_debug","text":"\u540c Console::debug($msg) \u3002","title":"zm_debug()"},{"location":"component/global-functions/#zm_warning","text":"\u540c Console::warning($msg) \u3002","title":"zm_warning()"},{"location":"component/global-functions/#zm_success","text":"\u540c Console::success($msg) \u3002","title":"zm_success()"},{"location":"component/global-functions/#zm_error","text":"\u540c Console::error($msg) \u3002","title":"zm_error()"},{"location":"component/global-functions/#zm_verbose","text":"\u540c Console::verbose($msg) \u3002","title":"zm_verbose()"},{"location":"component/remote-terminal/","text":"\u8fdc\u7a0b\u7ec8\u7aef \u6846\u67b6\u5728 2.3 \u7248\u672c\u65f6\u5220\u9664\u4e86\u672c\u5730\u7ec8\u7aef\uff08\u5c31\u662f\u6846\u67b6\u542f\u52a8\u540e\u53ef\u4ee5\u5728\u7ec8\u7aef\u8f93\u5165\u4e00\u4e9b\u53c2\u6570\uff09\uff0c\u56e0\u4e3a\u6846\u67b6\u7684\u591a\u8fdb\u7a0b\u6a21\u5f0f\u4f1a\u5bfc\u81f4\u7ec8\u7aef\u8f93\u5165\u9519\u4e71\uff0c\u6240\u4ee5\u6682\u65f6\u53d6\u6d88\u6389\u4e86\u3002 \u800c\u8fdc\u7a0b\u7ec8\u7aef\u5e94\u8fd0\u800c\u751f\uff0c\u4e3a\u7684\u662f\u5f25\u8865\u8fd9\u4e00\u529f\u80fd\u3002\u4e0e\u4e4b\u524d\u4e0d\u540c\u7684\u662f\uff0c\u8fdc\u7a0b\u7ec8\u7aef\u4f7f\u7528 nc \u8fde\u63a5\uff0c\u65e0\u9700\u4efb\u4f55\u5176\u4ed6\u7ec4\u4ef6\u548c\u5ba2\u6237\u7aef\uff0c\u800c\u4e14\u529f\u80fd\u66f4\u4e30\u5bcc\uff0c\u652f\u6301\u81ea\u5b9a\u4e49\u547d\u4ee4\u3002 \u542f\u7528 \u6709\u4e24\u79cd\u5f00\u542f\u65b9\u5f0f\uff1a \u6c38\u4e45\u5f00\u542f\uff1a\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u4e2d\u627e\u5230 remote_terminal \u7684 status \uff0c\u6539\u4e3a true\uff0c\u542f\u52a8\u6846\u67b6\u5373\u53ef\u3002 \u4e34\u65f6\u5f00\u542f\uff1a\u542f\u52a8\u6846\u67b6\u65f6\u52a0\u4e0a\u53c2\u6570 --remote-terminal \u3002\u4f8b\u5982\uff1a vendor/bin/start server --remote-terminal \u3002 \u914d\u7f6e \u5728\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6846\u67b6\u4e3a\u4e86\u5b89\u5168\uff0c\u76f4\u63a5\u6309\u7167\u9ed8\u8ba4\u914d\u7f6e\uff0c\u4f1a\u76d1\u542c 127.0.0.1:20002 \u7aef\u53e3\uff0c\u4e0d\u53ef\u4ee5\u8fdc\u7a0b\u8bbf\u95ee\uff0c\u53ea\u80fd\u4f7f\u7528\u672c\u673a\u7684 nc \u8fde\u63a5\uff0c\u6548\u679c\u5982\u4e0b\uff1a \u672c\u5730\u4e3b\u673a\uff1a \u4ece\u522b\u7684\u4e3b\u673a\uff1a \u5982\u679c\u5c06 host \u6539\u4e3a 0.0.0.0 \u6216\u5bf9\u5e94\u76d1\u542c\u5730\u5740\uff0c\u5373\u53ef\u6307\u5411\u6027\u8bbf\u95ee\u3002 \u4f46\u662f\uff0c\u5982\u679c\u4f60\u53c8\u60f3\u8fdc\u7a0b\u8fde\u63a5\uff0c\u53c8\u60f3\u4fdd\u8bc1\u5b89\u5168\uff0c\u90a3\u4e48\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2a token \u53c2\u6570\uff0c\u6765\u4fdd\u8bc1\u8fde\u63a5\u65f6\u9700\u8981\u8f93\u5165 token \u624d\u80fd\u4f7f\u7528\u8fdc\u7a0b\u7ec8\u7aef\u3002 \u5047\u8bbe\u6211\u4eec\u7684 token \u662f iAMTokEn \uff1a \u4f7f\u7528 \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 nc \u547d\u4ee4\u5373\u53ef\u3002 1 2 nc <your-host> <your-port> -vvv # nc 127.0.0.1 20002 -vvv \u8f93\u5165 help \u5373\u53ef\u67e5\u770b\u5185\u7f6e\u7684\u5e38\u7528\u6307\u4ee4\uff1a","title":"Terminal \u7ec8\u7aef"},{"location":"component/remote-terminal/#_1","text":"\u6846\u67b6\u5728 2.3 \u7248\u672c\u65f6\u5220\u9664\u4e86\u672c\u5730\u7ec8\u7aef\uff08\u5c31\u662f\u6846\u67b6\u542f\u52a8\u540e\u53ef\u4ee5\u5728\u7ec8\u7aef\u8f93\u5165\u4e00\u4e9b\u53c2\u6570\uff09\uff0c\u56e0\u4e3a\u6846\u67b6\u7684\u591a\u8fdb\u7a0b\u6a21\u5f0f\u4f1a\u5bfc\u81f4\u7ec8\u7aef\u8f93\u5165\u9519\u4e71\uff0c\u6240\u4ee5\u6682\u65f6\u53d6\u6d88\u6389\u4e86\u3002 \u800c\u8fdc\u7a0b\u7ec8\u7aef\u5e94\u8fd0\u800c\u751f\uff0c\u4e3a\u7684\u662f\u5f25\u8865\u8fd9\u4e00\u529f\u80fd\u3002\u4e0e\u4e4b\u524d\u4e0d\u540c\u7684\u662f\uff0c\u8fdc\u7a0b\u7ec8\u7aef\u4f7f\u7528 nc \u8fde\u63a5\uff0c\u65e0\u9700\u4efb\u4f55\u5176\u4ed6\u7ec4\u4ef6\u548c\u5ba2\u6237\u7aef\uff0c\u800c\u4e14\u529f\u80fd\u66f4\u4e30\u5bcc\uff0c\u652f\u6301\u81ea\u5b9a\u4e49\u547d\u4ee4\u3002","title":"\u8fdc\u7a0b\u7ec8\u7aef"},{"location":"component/remote-terminal/#_2","text":"\u6709\u4e24\u79cd\u5f00\u542f\u65b9\u5f0f\uff1a \u6c38\u4e45\u5f00\u542f\uff1a\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u4e2d\u627e\u5230 remote_terminal \u7684 status \uff0c\u6539\u4e3a true\uff0c\u542f\u52a8\u6846\u67b6\u5373\u53ef\u3002 \u4e34\u65f6\u5f00\u542f\uff1a\u542f\u52a8\u6846\u67b6\u65f6\u52a0\u4e0a\u53c2\u6570 --remote-terminal \u3002\u4f8b\u5982\uff1a vendor/bin/start server --remote-terminal \u3002","title":"\u542f\u7528"},{"location":"component/remote-terminal/#_3","text":"\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6846\u67b6\u4e3a\u4e86\u5b89\u5168\uff0c\u76f4\u63a5\u6309\u7167\u9ed8\u8ba4\u914d\u7f6e\uff0c\u4f1a\u76d1\u542c 127.0.0.1:20002 \u7aef\u53e3\uff0c\u4e0d\u53ef\u4ee5\u8fdc\u7a0b\u8bbf\u95ee\uff0c\u53ea\u80fd\u4f7f\u7528\u672c\u673a\u7684 nc \u8fde\u63a5\uff0c\u6548\u679c\u5982\u4e0b\uff1a \u672c\u5730\u4e3b\u673a\uff1a \u4ece\u522b\u7684\u4e3b\u673a\uff1a \u5982\u679c\u5c06 host \u6539\u4e3a 0.0.0.0 \u6216\u5bf9\u5e94\u76d1\u542c\u5730\u5740\uff0c\u5373\u53ef\u6307\u5411\u6027\u8bbf\u95ee\u3002 \u4f46\u662f\uff0c\u5982\u679c\u4f60\u53c8\u60f3\u8fdc\u7a0b\u8fde\u63a5\uff0c\u53c8\u60f3\u4fdd\u8bc1\u5b89\u5168\uff0c\u90a3\u4e48\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2a token \u53c2\u6570\uff0c\u6765\u4fdd\u8bc1\u8fde\u63a5\u65f6\u9700\u8981\u8f93\u5165 token \u624d\u80fd\u4f7f\u7528\u8fdc\u7a0b\u7ec8\u7aef\u3002 \u5047\u8bbe\u6211\u4eec\u7684 token \u662f iAMTokEn \uff1a","title":"\u914d\u7f6e"},{"location":"component/remote-terminal/#_4","text":"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 nc \u547d\u4ee4\u5373\u53ef\u3002 1 2 nc <your-host> <your-port> -vvv # nc 127.0.0.1 20002 -vvv \u8f93\u5165 help \u5373\u53ef\u67e5\u770b\u5185\u7f6e\u7684\u5e38\u7528\u6307\u4ee4\uff1a","title":"\u4f7f\u7528"},{"location":"component/route-manager/","text":"HTTP \u8def\u7531\u7ba1\u7406 HTTP \u8def\u7531\u7ba1\u7406\u5668\u7528\u4f5c\u7ba1\u7406\u70b8\u6bdb\u6846\u67b6\u5185 @RequestMapping \u548c\u9759\u6001\u76ee\u5f55\u7684\u8def\u7531\u64cd\u4f5c\u7684\uff0c\u53ef\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7f16\u5199\u6dfb\u52a0\u8def\u7531\u3002 \u7c7b\u5b9a\u4e49\uff1a \\ZM\\Http\\RouteManager 2.3.0 \u7248\u672c\u8d77\u53ef\u7528\u3002 \u6ce8\u610f \u56e0\u4e3a\u70b8\u6bdb\u6846\u67b6\u7684\u8def\u7531\u5b9e\u73b0\u662f\u4e0d\u57fa\u4e8e\u8de8\u8fdb\u7a0b\u7684\u5171\u4eab\u5185\u5b58\u7684\uff0c\u6240\u4ee5\u6bcf\u6b21\u4f7f\u7528\u8fd9\u91cc\u9762\u7684\u5de5\u5177\u51fd\u6570\u90fd\u9700\u8981\u5355\u72ec\u5728\u6240\u6709 Worker \u8fdb\u7a0b\u4e2d\u6267\u884c\u4e00\u6b21\uff0c\u6700\u597d\u7684\u529e\u6cd5\u5c31\u662f\u5728\u542f\u52a8\u6846\u67b6\u65f6\u6267\u884c\uff08 @OnStart(-1) \u5373\u53ef\uff0c\u4ee3\u8868\u6b64\u6ce8\u89e3\u4e8b\u4ef6\u5c06\u5728\u6bcf\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u4e2d\u90fd\u88ab\u6267\u884c\u4e00\u6b21\uff09\u3002 \u65b9\u6cd5 importRouteByAnnotation() \u901a\u8fc7\u6ce8\u89e3\u7c7b\u5bfc\u5165\u8def\u7531\u3002\uff08\u6ce8\uff1a\u6b64\u65b9\u6cd5\u4e00\u822c\u4e3a\u6846\u67b6\u5185\u90e8\u4f7f\u7528\uff09 \u5b9a\u4e49\uff1a importRouteByAnnotation(RequestMapping $vss, $method, $class, $methods_annotations) \u53c2\u6570 $vss \uff1aRequestMapping \u6ce8\u89e3\u7c7b\uff0c\u7c7b\u4e2d\u5b9a\u4e49 route \u548c request_method \u5373\u53ef\u3002 \u53c2\u6570 $method, $class \uff1a\u6267\u884c\u7684\u76ee\u6807\u6ce8\u89e3\u4e8b\u4ef6\u51fd\u6570\u4f4d\u7f6e\uff0c\u6bd4\u5982 $class = \\Module\\Example\\Hello::class \uff0c $method = 'hitokoto' \u3002 \u53c2\u6570 $methods_annotations \uff1a\u9700\u8981\u7ed1\u5b9a\u7684 Controller \u6ce8\u89e3\u7c7b\u6570\u7ec4\uff0c\u4e00\u822c\u6570\u7ec4\u5185\u5efa\u8bae\u53ea\u5e26\u6709\u4e00\u4e2a Controller\uff0c\u5982 [$controller] \u3002 addStaticFileRoute() \u6dfb\u52a0\u4e00\u4e2a\u5355\u76ee\u5f55\uff08\u6b64\u76ee\u5f55\u4e0b\u65e0\u5b50\u76ee\u5f55\uff0c\u53ea\u6709\u6587\u4ef6\uff09\u5e76\u7ed1\u5b9a\u4e3a\u4e00\u4e2a\u8def\u7531\u3002 \u5b9a\u4e49\uff1a addStaticFileRoute($route, $path) \u53c2\u6570 $route \uff1a\u7ed1\u5b9a\u7684\u76ee\u6807\u8def\u7531\uff0c\u5982 /images/ \u3002 \u53c2\u6570 $path \uff1a\u7ed1\u5b9a\u7684\u6587\u4ef6\u76ee\u5f55\u4f4d\u7f6e\uff0c\u5982 /root/zhamao-framework-starter/zm_data/images/ \u3002 1 2 3 4 5 6 /** * @OnStart(-1) */ public function onStart() { RouteManager::addStaticFileRoute(\"/images/\", DataProvider::getDataFolder().\"images/\"); } \u5c5e\u6027 RouteManager::$routes \u6b64\u4e3a\u5b58\u653e\u8def\u7531\u6811\u7684\u53d8\u91cf\uff0c\u8bf7\u8c28\u614e\u64cd\u4f5c\u3002 \u5b9a\u4e49\uff1a \\Symfony\\Component\\Routing\\RouteCollection | null \u70b8\u6bdb\u6846\u67b6\u4f7f\u7528\u4e86 Symfony \u6846\u67b6\u7684 route \u7ec4\u4ef6\uff0c\u6709\u5173\u8be6\u60c5\u8bf7\u67e5\u9605 \u6587\u6863 \u3002","title":"HTTP \u8def\u7531\u7ba1\u7406"},{"location":"component/route-manager/#http","text":"HTTP \u8def\u7531\u7ba1\u7406\u5668\u7528\u4f5c\u7ba1\u7406\u70b8\u6bdb\u6846\u67b6\u5185 @RequestMapping \u548c\u9759\u6001\u76ee\u5f55\u7684\u8def\u7531\u64cd\u4f5c\u7684\uff0c\u53ef\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7f16\u5199\u6dfb\u52a0\u8def\u7531\u3002 \u7c7b\u5b9a\u4e49\uff1a \\ZM\\Http\\RouteManager 2.3.0 \u7248\u672c\u8d77\u53ef\u7528\u3002 \u6ce8\u610f \u56e0\u4e3a\u70b8\u6bdb\u6846\u67b6\u7684\u8def\u7531\u5b9e\u73b0\u662f\u4e0d\u57fa\u4e8e\u8de8\u8fdb\u7a0b\u7684\u5171\u4eab\u5185\u5b58\u7684\uff0c\u6240\u4ee5\u6bcf\u6b21\u4f7f\u7528\u8fd9\u91cc\u9762\u7684\u5de5\u5177\u51fd\u6570\u90fd\u9700\u8981\u5355\u72ec\u5728\u6240\u6709 Worker \u8fdb\u7a0b\u4e2d\u6267\u884c\u4e00\u6b21\uff0c\u6700\u597d\u7684\u529e\u6cd5\u5c31\u662f\u5728\u542f\u52a8\u6846\u67b6\u65f6\u6267\u884c\uff08 @OnStart(-1) \u5373\u53ef\uff0c\u4ee3\u8868\u6b64\u6ce8\u89e3\u4e8b\u4ef6\u5c06\u5728\u6bcf\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u4e2d\u90fd\u88ab\u6267\u884c\u4e00\u6b21\uff09\u3002","title":"HTTP \u8def\u7531\u7ba1\u7406"},{"location":"component/route-manager/#_1","text":"","title":"\u65b9\u6cd5"},{"location":"component/route-manager/#importroutebyannotation","text":"\u901a\u8fc7\u6ce8\u89e3\u7c7b\u5bfc\u5165\u8def\u7531\u3002\uff08\u6ce8\uff1a\u6b64\u65b9\u6cd5\u4e00\u822c\u4e3a\u6846\u67b6\u5185\u90e8\u4f7f\u7528\uff09 \u5b9a\u4e49\uff1a importRouteByAnnotation(RequestMapping $vss, $method, $class, $methods_annotations) \u53c2\u6570 $vss \uff1aRequestMapping \u6ce8\u89e3\u7c7b\uff0c\u7c7b\u4e2d\u5b9a\u4e49 route \u548c request_method \u5373\u53ef\u3002 \u53c2\u6570 $method, $class \uff1a\u6267\u884c\u7684\u76ee\u6807\u6ce8\u89e3\u4e8b\u4ef6\u51fd\u6570\u4f4d\u7f6e\uff0c\u6bd4\u5982 $class = \\Module\\Example\\Hello::class \uff0c $method = 'hitokoto' \u3002 \u53c2\u6570 $methods_annotations \uff1a\u9700\u8981\u7ed1\u5b9a\u7684 Controller \u6ce8\u89e3\u7c7b\u6570\u7ec4\uff0c\u4e00\u822c\u6570\u7ec4\u5185\u5efa\u8bae\u53ea\u5e26\u6709\u4e00\u4e2a Controller\uff0c\u5982 [$controller] \u3002","title":"importRouteByAnnotation()"},{"location":"component/route-manager/#addstaticfileroute","text":"\u6dfb\u52a0\u4e00\u4e2a\u5355\u76ee\u5f55\uff08\u6b64\u76ee\u5f55\u4e0b\u65e0\u5b50\u76ee\u5f55\uff0c\u53ea\u6709\u6587\u4ef6\uff09\u5e76\u7ed1\u5b9a\u4e3a\u4e00\u4e2a\u8def\u7531\u3002 \u5b9a\u4e49\uff1a addStaticFileRoute($route, $path) \u53c2\u6570 $route \uff1a\u7ed1\u5b9a\u7684\u76ee\u6807\u8def\u7531\uff0c\u5982 /images/ \u3002 \u53c2\u6570 $path \uff1a\u7ed1\u5b9a\u7684\u6587\u4ef6\u76ee\u5f55\u4f4d\u7f6e\uff0c\u5982 /root/zhamao-framework-starter/zm_data/images/ \u3002 1 2 3 4 5 6 /** * @OnStart(-1) */ public function onStart() { RouteManager::addStaticFileRoute(\"/images/\", DataProvider::getDataFolder().\"images/\"); }","title":"addStaticFileRoute()"},{"location":"component/route-manager/#_2","text":"","title":"\u5c5e\u6027"},{"location":"component/route-manager/#routemanagerroutes","text":"\u6b64\u4e3a\u5b58\u653e\u8def\u7531\u6811\u7684\u53d8\u91cf\uff0c\u8bf7\u8c28\u614e\u64cd\u4f5c\u3002 \u5b9a\u4e49\uff1a \\Symfony\\Component\\Routing\\RouteCollection | null \u70b8\u6bdb\u6846\u67b6\u4f7f\u7528\u4e86 Symfony \u6846\u67b6\u7684 route \u7ec4\u4ef6\uff0c\u6709\u5173\u8be6\u60c5\u8bf7\u67e5\u9605 \u6587\u6863 \u3002","title":"RouteManager::$routes"},{"location":"component/singleton-trait/","text":"\u5355\u4f8b\u7c7b\uff08SingletonTrait\uff09 \u5355\u4f8b\u7c7b\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u8ba9\u7528\u6237\u58f0\u660e\u7684\u7c7b\u62e5\u6709\u5355\u4f8b\u7684\u7279\u6027\uff0c\u800c\u8fd9\u4e00\u7ec4\u4ef6\u5f15\u5165\u7684\u65b9\u5f0f\u4e5f\u6700\u76f4\u63a5\u3002\u5b83\u662f\u4e00\u4e2a PHP \u7684 trait \u3002 \u6211\u4eec\u4f20\u7edf\u5199\u5355\u4f8b\u7c7b\u7684\u65b9\u5f0f\u5f88\u624b\u52a8\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u6837\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Foo { public $test = 0 ; private static $instance ; public static function getInstance () { if ( null === self :: $instance ) { self :: $instance = new Foo (); } return self :: $instance ; } } Foo :: getInstance () -> test = 4 ; $obj = Foo :: getInstance () -> test ; var_dump ( $obj ); // 4 \u8fd9\u5c31\u8981\u6c42\u6211\u4eec\u6bcf\u4e2a\u9700\u8981\u58f0\u660e\u4e3a\u5355\u4f8b\u7684\u7c7b\u90fd\u5199\u4e00\u4e2a\u6210\u5458\u9759\u6001\u65b9\u6cd5\u548c\u6210\u5458\u9759\u6001\u53d8\u91cf\u3002 \u6846\u67b6\u4f7f\u7528\u4e86 PHP Trait \u6765\u5feb\u901f\u8ba9\u4e00\u4e2a\u7c7b\u652f\u6301\u8fd9\u4e00\u7279\u6027\uff1a 1 2 3 4 5 6 7 8 9 10 <?php use ZM\\Utils\\SingletonTrait ; class Foo { use SingletonTrait ; public $test = 0 ; } Foo :: getInstance () -> test = 5 ; var_dump ( Foo :: getInstance () -> test ); \u53ea\u9700\u8981\u5728\u7c7b\u4e2d\u4f7f\u7528\uff1a use \\ZM\\Utils\\SingletonTrait; \u4e00\u53e5\u8bdd\u5373\u53ef\u3002","title":"\u5355\u4f8b\u7c7b"},{"location":"component/singleton-trait/#singletontrait","text":"\u5355\u4f8b\u7c7b\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5c31\u662f\u8ba9\u7528\u6237\u58f0\u660e\u7684\u7c7b\u62e5\u6709\u5355\u4f8b\u7684\u7279\u6027\uff0c\u800c\u8fd9\u4e00\u7ec4\u4ef6\u5f15\u5165\u7684\u65b9\u5f0f\u4e5f\u6700\u76f4\u63a5\u3002\u5b83\u662f\u4e00\u4e2a PHP \u7684 trait \u3002 \u6211\u4eec\u4f20\u7edf\u5199\u5355\u4f8b\u7c7b\u7684\u65b9\u5f0f\u5f88\u624b\u52a8\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u6837\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 <?php class Foo { public $test = 0 ; private static $instance ; public static function getInstance () { if ( null === self :: $instance ) { self :: $instance = new Foo (); } return self :: $instance ; } } Foo :: getInstance () -> test = 4 ; $obj = Foo :: getInstance () -> test ; var_dump ( $obj ); // 4 \u8fd9\u5c31\u8981\u6c42\u6211\u4eec\u6bcf\u4e2a\u9700\u8981\u58f0\u660e\u4e3a\u5355\u4f8b\u7684\u7c7b\u90fd\u5199\u4e00\u4e2a\u6210\u5458\u9759\u6001\u65b9\u6cd5\u548c\u6210\u5458\u9759\u6001\u53d8\u91cf\u3002 \u6846\u67b6\u4f7f\u7528\u4e86 PHP Trait \u6765\u5feb\u901f\u8ba9\u4e00\u4e2a\u7c7b\u652f\u6301\u8fd9\u4e00\u7279\u6027\uff1a 1 2 3 4 5 6 7 8 9 10 <?php use ZM\\Utils\\SingletonTrait ; class Foo { use SingletonTrait ; public $test = 0 ; } Foo :: getInstance () -> test = 5 ; var_dump ( Foo :: getInstance () -> test ); \u53ea\u9700\u8981\u5728\u7c7b\u4e2d\u4f7f\u7528\uff1a use \\ZM\\Utils\\SingletonTrait; \u4e00\u53e5\u8bdd\u5373\u53ef\u3002","title":"\u5355\u4f8b\u7c7b\uff08SingletonTrait\uff09"},{"location":"component/task-worker/","text":"TaskManager \u5de5\u4f5c\u8fdb\u7a0b\u7ba1\u7406 \u6b64\u7c7b\u7ba1\u7406\u7684\u662f TaskWorker \u76f8\u5173\u5de5\u4f5c\u3002\u6709\u5173\u4f7f\u7528 TaskWorker \u7684\u6559\u7a0b\uff0c\u89c1 \u8fdb\u9636 - \u4f7f\u7528 TaskWorker \u8fdb\u7a0b\u5904\u7406\u5bc6\u96c6\u8fd0\u7b97 \u7c7b\u5b9a\u4e49\uff1a \\ZM\\Utils\\TaskManager \u4f7f\u7528 TaskWorker \u9700\u8981\u5148\u5728 global.php \u914d\u7f6e\u6587\u4ef6\u4e2d\u5f00\u542f\uff01 \u65b9\u6cd5 runTask() \u5728 TaskWorker \u8fd0\u884c\u4efb\u52a1\u3002 \u5b9a\u4e49\uff1a runTask($task_name, $timeout = -1, ...$params) \u53c2\u6570 $task_name \uff1a\u5bf9\u5e94 @OnTask \u6ce8\u89e3\u7ed1\u5b9a\u7684\u4efb\u52a1\u51fd\u6570\u3002 \u53c2\u6570 $timeout \uff1a\u7b49\u5f85\u4efb\u52a1\u51fd\u6570\u6700\u957f\u8fd0\u884c\u7684\u65f6\u95f4\uff08\u79d2\uff09\uff0c\u5982\u679c\u8d85\u8fc7\u6b64\u65f6\u95f4\u5c06\u8fd4\u56de false\u3002 \u53c2\u6570 \u5269\u4f59 \uff1a\u5c06\u53d8\u91cf\u4f20\u5165 TaskWorker \u8fdb\u7a0b\uff0c\u9664 Closure\uff0c\u8d44\u6e90\u7c7b\u578b\u5916\uff0c\u53ef\u5e8f\u5217\u5316\u7684\u53d8\u91cf\u5747\u53ef\u3002 1 TaskManager::runTask(\"heavy_task\", 100, \"param1\", \"param2\");","title":"TaskWorker \u7ba1\u7406"},{"location":"component/task-worker/#taskmanager","text":"\u6b64\u7c7b\u7ba1\u7406\u7684\u662f TaskWorker \u76f8\u5173\u5de5\u4f5c\u3002\u6709\u5173\u4f7f\u7528 TaskWorker \u7684\u6559\u7a0b\uff0c\u89c1 \u8fdb\u9636 - \u4f7f\u7528 TaskWorker \u8fdb\u7a0b\u5904\u7406\u5bc6\u96c6\u8fd0\u7b97 \u7c7b\u5b9a\u4e49\uff1a \\ZM\\Utils\\TaskManager \u4f7f\u7528 TaskWorker \u9700\u8981\u5148\u5728 global.php \u914d\u7f6e\u6587\u4ef6\u4e2d\u5f00\u542f\uff01","title":"TaskManager \u5de5\u4f5c\u8fdb\u7a0b\u7ba1\u7406"},{"location":"component/task-worker/#_1","text":"","title":"\u65b9\u6cd5"},{"location":"component/task-worker/#runtask","text":"\u5728 TaskWorker \u8fd0\u884c\u4efb\u52a1\u3002 \u5b9a\u4e49\uff1a runTask($task_name, $timeout = -1, ...$params) \u53c2\u6570 $task_name \uff1a\u5bf9\u5e94 @OnTask \u6ce8\u89e3\u7ed1\u5b9a\u7684\u4efb\u52a1\u51fd\u6570\u3002 \u53c2\u6570 $timeout \uff1a\u7b49\u5f85\u4efb\u52a1\u51fd\u6570\u6700\u957f\u8fd0\u884c\u7684\u65f6\u95f4\uff08\u79d2\uff09\uff0c\u5982\u679c\u8d85\u8fc7\u6b64\u65f6\u95f4\u5c06\u8fd4\u56de false\u3002 \u53c2\u6570 \u5269\u4f59 \uff1a\u5c06\u53d8\u91cf\u4f20\u5165 TaskWorker \u8fdb\u7a0b\uff0c\u9664 Closure\uff0c\u8d44\u6e90\u7c7b\u578b\u5916\uff0c\u53ef\u5e8f\u5217\u5316\u7684\u53d8\u91cf\u5747\u53ef\u3002 1 TaskManager::runTask(\"heavy_task\", 100, \"param1\", \"param2\");","title":"runTask()"},{"location":"component/zmrequest/","text":"ZMRequest\uff08HTTP \u5ba2\u6237\u7aef\uff09 \u6846\u67b6\u63d0\u4f9b\u4e86\u8f7b\u91cf\u7684 HTTP \u8bf7\u6c42\u53d1\u8d77\u5de5\u5177\u7c7b\uff0c\u76f4\u63a5\u9759\u6001\u8c03\u7528\u5373\u53ef\u3002 \u547d\u540d\u7a7a\u95f4\uff1a use ZM\\Requests\\ZMRequest; \u6ce8\u610f \u5728\u4f7f\u7528 Swoole 4.6.0 \u4ee5\u4e0b\uff08\u4e0d\u5305\u542b\uff09\u7684\u7248\u672c\u65f6\uff0c\u6700\u597d\u4f7f\u7528 Swoole \u5b98\u65b9\u63a8\u8350\u7684 Saber \u6216\u8005 ZMRequest \u8fd9\u4e2a\u8f7b\u91cf\u7684 HTTP \u8bf7\u6c42\u5ba2\u6237\u7aef\uff0c\u4e0d\u8981\u4f7f\u7528 curl_exec\uff0c\u56e0\u4e3a\u5728\u8001\u7248\u672c\u7684 Swoole \u4e0a\u5bf9 curl \u7684\u534f\u7a0b Hook \u652f\u6301\u4e0d\u662f\u5f88\u5b8c\u5584\u3002 ZMRequest::get() \u53d1\u8d77 GET \u8bf7\u6c42\u3002 \u5b9a\u4e49\uff1a ZMRequest::get($url, $headers = [], $set = [], $return_body = true) \u5168\u5c40\u51fd\u6570\u522b\u540d\uff1a zm_request_get($url, $headers = [], $set = [], $return_body = true) $url \uff1a\u8981\u8bf7\u6c42\u7684 url\uff0c\u5982 http://captive.apple.com/ $headers \uff1a\u8981\u8bf7\u6c42\u7684 Headers\uff0c\u4f8b\u5982\uff1a [\"User-Agent\" => \"Chrome\"] \uff0c\u6570\u7ec4\u5f62\u5f0f $set \uff1a\u8bf7\u6c42\u65f6\u7684\u4e00\u4e9b\u8bbe\u7f6e\uff0c\u4f8b\u5982\u8d85\u65f6\u65f6\u95f4\u7b49\u7b49\u3002\u8be6\u89c1\u4e0b\u65b9\u201c\u8bbe\u7f6e\u53c2\u6570\u201d $return_body \uff1a\u662f\u5426\u53ea\u8fd4\u56de\u8bf7\u6c42\u56de\u6765\u7684\u5185\u5bb9\u90e8\u5206\uff0c\u9ed8\u8ba4\u4e3a true\uff0c\u5982\u679c\u4e3a false \u65f6\u5219\u4f1a\u8fd4\u56de\u4e00\u4e2a \\Swoole\\Coroutine\\Http\\Client \u5bf9\u8c61\uff0c\u53ef\u67e5\u9605 Swoole \u6587\u6863 \u8fdb\u884c\u63a5\u4e0b\u6765\u7684\u4e00\u7cfb\u5217\u64cd\u4f5c\u3002 \u5982\u679c $return_body \u4e3a true\uff0c\u4f46\u662f\u8bf7\u6c42\u5931\u8d25\uff08HTTP \u72b6\u6001\u7801\u4e0d\u662f 200 \u6216\u65e0\u6cd5\u8fde\u63a5\u5230\u76ee\u6807\u670d\u52a1\u5668\u6216\u8005\u65e0\u6cd5\u89e3\u6790\u57df\u540d\u7b49\u95ee\u9898\uff09\u65f6\uff0c\u65b9\u6cd5\u4f1a\u8fd4\u56de false\uff0c\u5426\u5219\u4f1a\u8fd4\u56de\u5185\u5bb9\u3002 \u8fd4\u56de\u503c\uff1a false|string|\\Swoole\\Coroutine\\Http\\Client 1 2 $r = ZMRequest::get(\"http://captive.apple.com/\", [\"User-Agent\" => \"Chrome\"]); echo $r.PHP_EOL; // <HTML><HEAD><TITLE>Success</TITLE></HEAD><BODY>Success</BODY></HTML> 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 $r = zm_request_get(\"http://captive.apple.com/\", [], [], false); echo $r->body.PHP_EOL; // \u8fd9\u884c\u8f93\u51fa\u548c\u4e0a\u65b9\u7684\u4e00\u81f4 dump($r); /* ^ Swoole\\Coroutine\\Http\\Client {#170 +errCode: 0 +errMsg: \"\" +connected: false +host: \"captive.apple.com\" +port: 80 +ssl: false +setting: array:1 [ \"timeout\" => 15.0 ] +requestMethod: \"GET\" +requestHeaders: [] +requestBody: null +uploadFiles: null +downloadFile: null +downloadOffset: 0 +statusCode: 200 +headers: array:4 [ \"content-type\" => \"text/html\" \"content-length\" => \"68\" \"date\" => \"Thu, 07 Jan 2021 06:22:32 GMT\" \"connection\" => \"keep-alive\" ] +set_cookie_headers: null +cookies: null +body: \"<HTML><HEAD><TITLE>Success</TITLE></HEAD><BODY>Success</BODY></HTML>\" } */ ZMRequest::post() \u53d1\u9001\u4e00\u4e2a POST \u8bf7\u6c42\u3002 \u5b9a\u4e49\uff1a ZMRequest::post($url, array $header, $data, $set = [], $return_body = true) \u5168\u5c40\u51fd\u6570\u522b\u540d\uff1a zm_request_post($url, array $header, $data, $set = [], $return_body = true) $url \uff1a\u540c\u4e0a\uff0c\u586b\u5165 url\uff0c\u5fc5\u586b $header \uff1a\u8bf7\u6c42\u7684 Headers\uff0c\u5fc5\u586b\uff0c\u6570\u7ec4\u5f62\u5f0f\uff0c\u4f8b\u5982 [\"Content-Type\" => \"application/json\"] $data \uff1a\u8bf7\u6c42\u7684\u6570\u636e\u4f53\uff0c\u9ed8\u8ba4\u5e94\u8be5\u4f20\u5165\u6570\u7ec4\uff0c\u5982\u679c\u4f20\u5165 array \u7c7b\u578b\uff0c\u5219\u4f1a\u9ed8\u8ba4\u5f53\u4f5c Content-Type: application/x-www-form-urlencoded \u65b9\u5f0f\u81ea\u52a8\u8f6c\u7801\u548c\u8f6c\u6362\uff0c\u4f8b\u5982 [\"key1\" => \"b1\", \"key2\" => \"b2\"] \u4f1a\u53d8\u6210 key1=b1&key2=b2 $set \uff1a\u540c\u4e0a\uff0c\u89c1\u4e0b\u9762\u7684\u8bbe\u7f6e\u53c2\u6570\u90e8\u5206\u3002 $return_body \uff1a\u540c\u4e0a\u3002 1 $s = ZMRequest::post(\"http://captive.apple.com/\", [\"Content-Type\" => \"application/json\"], json_encode([\"key1\" => \"value1\"])); ZMRequest::request() \u53d1\u8d77\u81ea\u5b9a\u4e49\u4e00\u5207\u53c2\u6570\u7684 HTTP \u8bf7\u6c42\u3002 \u53c2\u6570\uff1a $url \uff1a\u8bf7\u6c42\u7684\u94fe\u63a5\uff0c\u81ea\u52a8\u89e3\u6790\u7aef\u53e3\u3001HTTPS\u3001DNS \u7b49\u64cd\u4f5c $attribute \uff1a\u8bf7\u6c42\u7684\u5c5e\u6027\uff0c\u793a\u4f8b\u89c1\u4e0b\u65b9 $return_body \uff1a\u53ef\u9009\u53c2\u6570\uff0c bool \u7c7b\u578b\uff0c\u548c\u4e0a\u9762\u7684 $return_body \u53c2\u6570\u610f\u4e49\u76f8\u540c \u5176\u4e2d $attribute \u53c2\u6570\u5bf9\u5e94\u53ef\u8bbe\u7f6e\u7684\u6709\uff1a method \uff1a\u53ef\u9009 GET \uff0c POST \u7b49 HTTP \u8bf7\u6c42\u7684\u65b9\u5f0f set \uff1a\u8bbe\u7f6e Swoole \u5ba2\u6237\u7aef\u7684\u53c2\u6570 headers \uff1a\u8981\u8bf7\u6c42\u7684 HTTP Headers data \uff1a\u8bf7\u6c42\u7684 body \u6570\u636e\uff0c\u4e3a\u6570\u7ec4\u65f6\u81ea\u52a8\u8f6c\u6362\u5934\u90e8\u4e3a x-www-form-urlencoded file \uff1a\u8981\u53d1\u9001\u7684\u6587\u4ef6\uff0c\u6570\u7ec4\uff0c\u53ef\u9009\u591a\u4e2a\u6587\u4ef6 \u4f8b1\uff1a\u4f7f\u7528 GET \u8bf7\u6c42\u53d1\u9001\u5e26\u6709 Body \u7684 HTTP \u8bf7\u6c42 1 2 3 4 5 6 $r = ZMRequest::request(\"http://example.com\", [ \"method\" => \"GET\", \"data\" => [ \"key1\" => \"value1\" ] ]); \u4f8b2\uff1a\u8bbe\u7f6e\u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\u5e76\u6307\u5b9a\u81ea\u5b9a\u4e49\u5934\u90e8 1 2 3 4 5 6 7 8 $r = ZMRequest::request(\"http://example.com\", [ \"method\" => \"POST\", \"headers\" => [ \"X-Custom-Header\" => \"Hello world\", \"User-Agent\" => \"HEICORE\" ], \"set\" => [\"timeout\" => 10.0] ]); \u4f8b3\uff1a\u53d1\u9001\u6587\u4ef6\u548c data 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $r = ZMRequest::request(\"http://example.com/sendfile\", [ \"file\" => [ [ \"path\" => \"/path/to/image1.jpg\", // path\u5b57\u6bb5\u5fc5\u586b \"name\" => \"file1\", // name\u5b57\u6bb5\u5fc5\u586b\uff0c\u8fd9\u4e2a\u662f POST \u8fc7\u53bb\u7684 key //\"mime_type\" => \"image/jpeg\", // \u53ef\u9009\u5b57\u6bb5\uff0c\u5e95\u5c42\u4f1a\u81ea\u52a8\u63a8\u65ad //\"filename\" => \"a.jpg\", // \u53ef\u9009\u5b57\u6bb5\uff0c\u6587\u4ef6\u540d\u79f0 //\"offset\" => 0, // \u53ef\u9009\u5b57\u6bb5\uff0c\u53ef\u4ee5\u4ece\u6307\u5b9a\u6587\u4ef6\u7684\u4e2d\u95f4\u90e8\u5206\u5f00\u59cb\u4f20\u8f93\u6570\u636e\uff0c\u6b64\u7279\u6027\u7528\u4e8e\u65ad\u70b9\u7eed\u4f20 //\"length\" => 1024 // \u53ef\u9009\u5b57\u6bb5\uff0c\u9ed8\u8ba4\u4e3a\u6574\u4e2a\u6587\u4ef6\u7684\u5c3a\u5bf8 ], [ \"path\" => \"/path/to/image2.jpg\", \"name\" => \"file2\" ] ], \"data\" => [ \"key1\" => \"value1\" ] ]); ZMRequest::downloadFile() \u4e0b\u8f7d\u6587\u4ef6\u5230\u672c\u5730\u3002 \u5b9a\u4e49\uff1a ZMRequest::downloadFile($url, $dst = null) $url \uff1a\u4e0d\u591a\u8bb2\uff0c\u4e0b\u8f7d\u94fe\u63a5\u3002 $dst \uff1a\u672c\u5730\u4f4d\u7f6e\uff0c\u4f8b\u5982 /tmp/hello.html \u4e0b\u8f7d\u6210\u529f\u8fd4\u56de true \u6216\u6307\u5b9a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff0c\u5931\u8d25\u8fd4\u56de false\u3002 1 ZMRequest::downloadFile(\"http://captive.apple.com/\", \"/tmp/apple.html\"); ZMRequest::websocket() \u521b\u5efa\u4e00\u4e2a WebSocket \u8fde\u63a5\u3002\u56e0\u4e3a Swoole \u63d0\u4f9b\u7684\u662f\u540c\u6b65\u534f\u7a0b\u7684\u65b9\u6848\uff0c\u4f46\u5bf9\u4e8e WebSocket \u8fd9\u6837\u7684\u5168\u53cc\u5de5\u901a\u4fe1\uff0c\u53cd\u800c\u4e0d\u662f\u4e00\u4e2a\u597d\u7684\u4ee3\u7801\u903b\u8f91\uff0c\u70b8\u6bdb\u6846\u67b6\u5c06\u6b64\u540c\u6b65\u534f\u7a0b\u7684\u65b9\u6848\u5c01\u88c5\u6210\u4e86\u5f02\u6b65\u4e8b\u4ef6\u8c03\u7528\u7684\u65b9\u5f0f\u3002 \u5b9a\u4e49\uff1a ZMRequest::websocket($url, $set = ['websocket_mask' => true], $header = []) \u8fd4\u56de\uff1a\u4e00\u4e2a \\ZM\\Requests\\ZMWebSocket \u5bf9\u8c61 \u6548\u679c\u7b49\u540c\u4e8e\uff1a $s = new \\ZM\\Requests\\ZMWebSocket($url, $set = ['websocket_mask' => true], $header = []) \u8fd9\u4e2a\u662f ZMRequest \u6269\u5c55\u800c\u6765\u7684\u5f02\u6b65 WebSocket \u5ba2\u6237\u7aef\uff0c\u53ef\u4f9b\u65b9\u4fbf\u5730\u8fde\u63a5\u3001\u6536\u53d1 WebSocket \u6d88\u606f\u6240\u5b9a\u5236\u3002 \u547d\u540d\u7a7a\u95f4\uff1a \\ZM\\Requests\\ZMWebSocket 1 2 3 4 5 6 7 8 9 10 11 12 $ws = ZMRequest::websocket(\"ws://127.0.0.1:12345/\"); //\u4f7f\u7528\u5de5\u5177\u51fd\u6570 // $ws = new ZMWebSocket(\"ws://127.0.0.1:12345/\"); //\u76f4\u63a5\u6784\u9020 if($ws->is_available) { $ws->onMessage(function(\\Swoole\\WebSocket\\Frame $frame, $client) { var_dump($frame->data); }); $ws->onClose(function($client){ Console::info(\"Websocket closed.\"); }); $result = $ws->upgrade(); var_dump($result); } \u5c5e\u6027 is_available bool \u7c7b\u578b\uff0c\u7528\u4e8e\u5224\u65ad\u6784\u9020\u5bf9\u8c61\u662f\u5426\u6210\u529f\u6216\u94fe\u63a5\u662f\u5426\u53ef\u7528\u3002\u5728\u6784\u5efa\u65b0\u7684\u5bf9\u8c61\u5e76\u6267\u884c upgrade() \u524d\uff0c\u5982\u679c ws \u94fe\u63a5\u6ca1\u6709\u95ee\u9898\uff0c\u5219\u4f1a\u53d8\u4e3a true\uff1b\u5728 onClose() \u56de\u8c03\u6267\u884c\u540e\uff0c\u6b64\u503c\u53d8\u56de false\u3002 \u65b9\u6cd5 __construct() \u5ba2\u6237\u7aef\u5bf9\u8c61\u7684\u6784\u9020\u65b9\u6cd5\u3002 \u53c2\u6570\uff1a $url \uff1a\u8981\u8bf7\u6c42\u5230\u7684 WebSocket \u76ee\u6807\u5730\u5740\uff0c\u5fc5\u987b\u4ee5 ws(s):// \u5f00\u5934 $set \uff1a\u53ef\u9009\uff0cSwoole \u5ba2\u6237\u7aef\u7684\u53c2\u6570\uff0c\u4f8b\u5982\u8d85\u65f6\u3001\u662f\u5426\u4f7f\u7528 websocket_mask \u7b49\uff0c\u5982\u679c\u4e3a\u7a7a\u6570\u7ec4\u5219\u9ed8\u8ba4\u4e3a [\"websocket_mask\" => true] \uff0c\u5177\u4f53\u53ef\u8bbe\u7f6e\u7684\u5185\u5bb9\u89c1 Swoole \u6587\u6863 $header \uff1a\u53ef\u9009\uff0c\u8bf7\u6c42\u7684\u5934\u90e8\u4fe1\u606f\uff0c\u6570\u7ec4 1 2 3 $a = new ZMWebSocket(\"ws://127.0.0.1:8080/\", [\"websocket_mask\" => true], [ \"User-Agent\" => \"Firefox\" ]); onMessage() \u8bbe\u7f6e\u6536\u5230\u6d88\u606f\u7684\u56de\u8c03\u51fd\u6570\u3002 \u56de\u8c03\u7684\u53c2\u6570\uff1a $frame \uff1a Swoole\\WebSocket\\Frame \u7c7b\u578b\uff0c\u6d88\u606f\u5e27\uff0c\u4e00\u822c\u53ea\u7528 $frame->data \u83b7\u53d6\u6570\u636e\uff0c\u5177\u4f53\u89c1 Swoole \u6587\u6863 $client \uff1a Swoole\\Coroutine\\Http\\Client \u7c7b\u578b\uff0c\u4e3a\u5ba2\u6237\u7aef\u672c\u8eab\u7684\u5bf9\u8c61\uff0c\u7528\u4e8e push \u6570\u636e\u7b49 1 2 3 4 $a->onMessage(function($frame, $client){ echo \"\u6536\u5230\u6d88\u606f\uff1a\".$frame->data.PHP_EOL; $client->push(\"hello world\"); }); onClose() \u8bbe\u7f6e\u8fde\u63a5\u65ad\u5f00\u540e\u6267\u884c\u7684\u56de\u8c03\u51fd\u6570\u3002 \u56de\u8c03\u7684\u53c2\u6570\uff1a $client \uff1a\u540c\u4e0a\uff0c\u4f46\u65ad\u5f00\u8fde\u63a5\u540e\u4e0d\u80fd\u4f7f\u7528 push() \u53d1\u9001\u6570\u636e\u4e86\uff0c\u53ea\u5efa\u8bae\u4f5c\u4e3a\u91cd\u8fde\u7b49\u673a\u5236\u7684\u4f7f\u7528 1 2 3 $a->onClose(function($client){ echo \"WS \u94fe\u63a5\u65ad\u5f00\u4e86\uff01\".PHP_EOL; }); upgrade() \u53d1\u8d77\u8fde\u63a5\u3002 \u8fd4\u56de\u503c\uff1a true|false \uff0c\u5f53\u4e3a true \u65f6\u4ee3\u8868\u63e1\u624b\u6210\u529f\uff0c\u6b64\u65f6\u53ef\u4ee5\u5728\u56de\u8c03\u91cc\u6109\u5feb\u5730\u6536\u53d1\u6d88\u606f\u4e86\u3002\u5982\u679c\u4e3a false \u8868\u660e\u63e1\u624b\u5931\u8d25\u3002 \u6ce8\u610f \u8fd9\u91cc\u7531\u4e8e\u662f\u534f\u7a0b\u8f6c\u5f02\u6b65\uff0c\u6240\u4ee5\u4e0d\u80fd\u786e\u5b9a upgrade() \u548c onMessage() \u54ea\u4e2a\u5148\u4f1a\u88ab\u89e6\u53d1\uff08\u4e00\u822c\u60c5\u51b5\u4e0b\u5982\u679c\u670d\u52a1\u5668\u4e0d\u662f\u7acb\u523b\u54cd\u5e94\u56de\u5305\u4fe1\u606f\uff0c\u603b\u662f\u4f1a\u5148\u8fd4\u56de upgrade() \u7684\u7ed3\u679c\u3002 \u8bbe\u7f6e\u53c2\u6570 \u89c1\uff1a Swoole - HTTP \u5ba2\u6237\u7aef","title":"HTTP \u548c WebSocket \u5ba2\u6237\u7aef"},{"location":"component/zmrequest/#zmrequesthttp","text":"\u6846\u67b6\u63d0\u4f9b\u4e86\u8f7b\u91cf\u7684 HTTP \u8bf7\u6c42\u53d1\u8d77\u5de5\u5177\u7c7b\uff0c\u76f4\u63a5\u9759\u6001\u8c03\u7528\u5373\u53ef\u3002 \u547d\u540d\u7a7a\u95f4\uff1a use ZM\\Requests\\ZMRequest; \u6ce8\u610f \u5728\u4f7f\u7528 Swoole 4.6.0 \u4ee5\u4e0b\uff08\u4e0d\u5305\u542b\uff09\u7684\u7248\u672c\u65f6\uff0c\u6700\u597d\u4f7f\u7528 Swoole \u5b98\u65b9\u63a8\u8350\u7684 Saber \u6216\u8005 ZMRequest \u8fd9\u4e2a\u8f7b\u91cf\u7684 HTTP \u8bf7\u6c42\u5ba2\u6237\u7aef\uff0c\u4e0d\u8981\u4f7f\u7528 curl_exec\uff0c\u56e0\u4e3a\u5728\u8001\u7248\u672c\u7684 Swoole \u4e0a\u5bf9 curl \u7684\u534f\u7a0b Hook \u652f\u6301\u4e0d\u662f\u5f88\u5b8c\u5584\u3002","title":"ZMRequest\uff08HTTP \u5ba2\u6237\u7aef\uff09"},{"location":"component/zmrequest/#zmrequestget","text":"\u53d1\u8d77 GET \u8bf7\u6c42\u3002 \u5b9a\u4e49\uff1a ZMRequest::get($url, $headers = [], $set = [], $return_body = true) \u5168\u5c40\u51fd\u6570\u522b\u540d\uff1a zm_request_get($url, $headers = [], $set = [], $return_body = true) $url \uff1a\u8981\u8bf7\u6c42\u7684 url\uff0c\u5982 http://captive.apple.com/ $headers \uff1a\u8981\u8bf7\u6c42\u7684 Headers\uff0c\u4f8b\u5982\uff1a [\"User-Agent\" => \"Chrome\"] \uff0c\u6570\u7ec4\u5f62\u5f0f $set \uff1a\u8bf7\u6c42\u65f6\u7684\u4e00\u4e9b\u8bbe\u7f6e\uff0c\u4f8b\u5982\u8d85\u65f6\u65f6\u95f4\u7b49\u7b49\u3002\u8be6\u89c1\u4e0b\u65b9\u201c\u8bbe\u7f6e\u53c2\u6570\u201d $return_body \uff1a\u662f\u5426\u53ea\u8fd4\u56de\u8bf7\u6c42\u56de\u6765\u7684\u5185\u5bb9\u90e8\u5206\uff0c\u9ed8\u8ba4\u4e3a true\uff0c\u5982\u679c\u4e3a false \u65f6\u5219\u4f1a\u8fd4\u56de\u4e00\u4e2a \\Swoole\\Coroutine\\Http\\Client \u5bf9\u8c61\uff0c\u53ef\u67e5\u9605 Swoole \u6587\u6863 \u8fdb\u884c\u63a5\u4e0b\u6765\u7684\u4e00\u7cfb\u5217\u64cd\u4f5c\u3002 \u5982\u679c $return_body \u4e3a true\uff0c\u4f46\u662f\u8bf7\u6c42\u5931\u8d25\uff08HTTP \u72b6\u6001\u7801\u4e0d\u662f 200 \u6216\u65e0\u6cd5\u8fde\u63a5\u5230\u76ee\u6807\u670d\u52a1\u5668\u6216\u8005\u65e0\u6cd5\u89e3\u6790\u57df\u540d\u7b49\u95ee\u9898\uff09\u65f6\uff0c\u65b9\u6cd5\u4f1a\u8fd4\u56de false\uff0c\u5426\u5219\u4f1a\u8fd4\u56de\u5185\u5bb9\u3002 \u8fd4\u56de\u503c\uff1a false|string|\\Swoole\\Coroutine\\Http\\Client 1 2 $r = ZMRequest::get(\"http://captive.apple.com/\", [\"User-Agent\" => \"Chrome\"]); echo $r.PHP_EOL; // <HTML><HEAD><TITLE>Success</TITLE></HEAD><BODY>Success</BODY></HTML> 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 $r = zm_request_get(\"http://captive.apple.com/\", [], [], false); echo $r->body.PHP_EOL; // \u8fd9\u884c\u8f93\u51fa\u548c\u4e0a\u65b9\u7684\u4e00\u81f4 dump($r); /* ^ Swoole\\Coroutine\\Http\\Client {#170 +errCode: 0 +errMsg: \"\" +connected: false +host: \"captive.apple.com\" +port: 80 +ssl: false +setting: array:1 [ \"timeout\" => 15.0 ] +requestMethod: \"GET\" +requestHeaders: [] +requestBody: null +uploadFiles: null +downloadFile: null +downloadOffset: 0 +statusCode: 200 +headers: array:4 [ \"content-type\" => \"text/html\" \"content-length\" => \"68\" \"date\" => \"Thu, 07 Jan 2021 06:22:32 GMT\" \"connection\" => \"keep-alive\" ] +set_cookie_headers: null +cookies: null +body: \"<HTML><HEAD><TITLE>Success</TITLE></HEAD><BODY>Success</BODY></HTML>\" } */","title":"ZMRequest::get()"},{"location":"component/zmrequest/#zmrequestpost","text":"\u53d1\u9001\u4e00\u4e2a POST \u8bf7\u6c42\u3002 \u5b9a\u4e49\uff1a ZMRequest::post($url, array $header, $data, $set = [], $return_body = true) \u5168\u5c40\u51fd\u6570\u522b\u540d\uff1a zm_request_post($url, array $header, $data, $set = [], $return_body = true) $url \uff1a\u540c\u4e0a\uff0c\u586b\u5165 url\uff0c\u5fc5\u586b $header \uff1a\u8bf7\u6c42\u7684 Headers\uff0c\u5fc5\u586b\uff0c\u6570\u7ec4\u5f62\u5f0f\uff0c\u4f8b\u5982 [\"Content-Type\" => \"application/json\"] $data \uff1a\u8bf7\u6c42\u7684\u6570\u636e\u4f53\uff0c\u9ed8\u8ba4\u5e94\u8be5\u4f20\u5165\u6570\u7ec4\uff0c\u5982\u679c\u4f20\u5165 array \u7c7b\u578b\uff0c\u5219\u4f1a\u9ed8\u8ba4\u5f53\u4f5c Content-Type: application/x-www-form-urlencoded \u65b9\u5f0f\u81ea\u52a8\u8f6c\u7801\u548c\u8f6c\u6362\uff0c\u4f8b\u5982 [\"key1\" => \"b1\", \"key2\" => \"b2\"] \u4f1a\u53d8\u6210 key1=b1&key2=b2 $set \uff1a\u540c\u4e0a\uff0c\u89c1\u4e0b\u9762\u7684\u8bbe\u7f6e\u53c2\u6570\u90e8\u5206\u3002 $return_body \uff1a\u540c\u4e0a\u3002 1 $s = ZMRequest::post(\"http://captive.apple.com/\", [\"Content-Type\" => \"application/json\"], json_encode([\"key1\" => \"value1\"]));","title":"ZMRequest::post()"},{"location":"component/zmrequest/#zmrequestrequest","text":"\u53d1\u8d77\u81ea\u5b9a\u4e49\u4e00\u5207\u53c2\u6570\u7684 HTTP \u8bf7\u6c42\u3002 \u53c2\u6570\uff1a $url \uff1a\u8bf7\u6c42\u7684\u94fe\u63a5\uff0c\u81ea\u52a8\u89e3\u6790\u7aef\u53e3\u3001HTTPS\u3001DNS \u7b49\u64cd\u4f5c $attribute \uff1a\u8bf7\u6c42\u7684\u5c5e\u6027\uff0c\u793a\u4f8b\u89c1\u4e0b\u65b9 $return_body \uff1a\u53ef\u9009\u53c2\u6570\uff0c bool \u7c7b\u578b\uff0c\u548c\u4e0a\u9762\u7684 $return_body \u53c2\u6570\u610f\u4e49\u76f8\u540c \u5176\u4e2d $attribute \u53c2\u6570\u5bf9\u5e94\u53ef\u8bbe\u7f6e\u7684\u6709\uff1a method \uff1a\u53ef\u9009 GET \uff0c POST \u7b49 HTTP \u8bf7\u6c42\u7684\u65b9\u5f0f set \uff1a\u8bbe\u7f6e Swoole \u5ba2\u6237\u7aef\u7684\u53c2\u6570 headers \uff1a\u8981\u8bf7\u6c42\u7684 HTTP Headers data \uff1a\u8bf7\u6c42\u7684 body \u6570\u636e\uff0c\u4e3a\u6570\u7ec4\u65f6\u81ea\u52a8\u8f6c\u6362\u5934\u90e8\u4e3a x-www-form-urlencoded file \uff1a\u8981\u53d1\u9001\u7684\u6587\u4ef6\uff0c\u6570\u7ec4\uff0c\u53ef\u9009\u591a\u4e2a\u6587\u4ef6 \u4f8b1\uff1a\u4f7f\u7528 GET \u8bf7\u6c42\u53d1\u9001\u5e26\u6709 Body \u7684 HTTP \u8bf7\u6c42 1 2 3 4 5 6 $r = ZMRequest::request(\"http://example.com\", [ \"method\" => \"GET\", \"data\" => [ \"key1\" => \"value1\" ] ]); \u4f8b2\uff1a\u8bbe\u7f6e\u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\u5e76\u6307\u5b9a\u81ea\u5b9a\u4e49\u5934\u90e8 1 2 3 4 5 6 7 8 $r = ZMRequest::request(\"http://example.com\", [ \"method\" => \"POST\", \"headers\" => [ \"X-Custom-Header\" => \"Hello world\", \"User-Agent\" => \"HEICORE\" ], \"set\" => [\"timeout\" => 10.0] ]); \u4f8b3\uff1a\u53d1\u9001\u6587\u4ef6\u548c data 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 $r = ZMRequest::request(\"http://example.com/sendfile\", [ \"file\" => [ [ \"path\" => \"/path/to/image1.jpg\", // path\u5b57\u6bb5\u5fc5\u586b \"name\" => \"file1\", // name\u5b57\u6bb5\u5fc5\u586b\uff0c\u8fd9\u4e2a\u662f POST \u8fc7\u53bb\u7684 key //\"mime_type\" => \"image/jpeg\", // \u53ef\u9009\u5b57\u6bb5\uff0c\u5e95\u5c42\u4f1a\u81ea\u52a8\u63a8\u65ad //\"filename\" => \"a.jpg\", // \u53ef\u9009\u5b57\u6bb5\uff0c\u6587\u4ef6\u540d\u79f0 //\"offset\" => 0, // \u53ef\u9009\u5b57\u6bb5\uff0c\u53ef\u4ee5\u4ece\u6307\u5b9a\u6587\u4ef6\u7684\u4e2d\u95f4\u90e8\u5206\u5f00\u59cb\u4f20\u8f93\u6570\u636e\uff0c\u6b64\u7279\u6027\u7528\u4e8e\u65ad\u70b9\u7eed\u4f20 //\"length\" => 1024 // \u53ef\u9009\u5b57\u6bb5\uff0c\u9ed8\u8ba4\u4e3a\u6574\u4e2a\u6587\u4ef6\u7684\u5c3a\u5bf8 ], [ \"path\" => \"/path/to/image2.jpg\", \"name\" => \"file2\" ] ], \"data\" => [ \"key1\" => \"value1\" ] ]);","title":"ZMRequest::request()"},{"location":"component/zmrequest/#zmrequestdownloadfile","text":"\u4e0b\u8f7d\u6587\u4ef6\u5230\u672c\u5730\u3002 \u5b9a\u4e49\uff1a ZMRequest::downloadFile($url, $dst = null) $url \uff1a\u4e0d\u591a\u8bb2\uff0c\u4e0b\u8f7d\u94fe\u63a5\u3002 $dst \uff1a\u672c\u5730\u4f4d\u7f6e\uff0c\u4f8b\u5982 /tmp/hello.html \u4e0b\u8f7d\u6210\u529f\u8fd4\u56de true \u6216\u6307\u5b9a\u7684\u6587\u4ef6\u4f4d\u7f6e\uff0c\u5931\u8d25\u8fd4\u56de false\u3002 1 ZMRequest::downloadFile(\"http://captive.apple.com/\", \"/tmp/apple.html\");","title":"ZMRequest::downloadFile()"},{"location":"component/zmrequest/#zmrequestwebsocket","text":"\u521b\u5efa\u4e00\u4e2a WebSocket \u8fde\u63a5\u3002\u56e0\u4e3a Swoole \u63d0\u4f9b\u7684\u662f\u540c\u6b65\u534f\u7a0b\u7684\u65b9\u6848\uff0c\u4f46\u5bf9\u4e8e WebSocket \u8fd9\u6837\u7684\u5168\u53cc\u5de5\u901a\u4fe1\uff0c\u53cd\u800c\u4e0d\u662f\u4e00\u4e2a\u597d\u7684\u4ee3\u7801\u903b\u8f91\uff0c\u70b8\u6bdb\u6846\u67b6\u5c06\u6b64\u540c\u6b65\u534f\u7a0b\u7684\u65b9\u6848\u5c01\u88c5\u6210\u4e86\u5f02\u6b65\u4e8b\u4ef6\u8c03\u7528\u7684\u65b9\u5f0f\u3002 \u5b9a\u4e49\uff1a ZMRequest::websocket($url, $set = ['websocket_mask' => true], $header = []) \u8fd4\u56de\uff1a\u4e00\u4e2a \\ZM\\Requests\\ZMWebSocket \u5bf9\u8c61 \u6548\u679c\u7b49\u540c\u4e8e\uff1a $s = new \\ZM\\Requests\\ZMWebSocket($url, $set = ['websocket_mask' => true], $header = []) \u8fd9\u4e2a\u662f ZMRequest \u6269\u5c55\u800c\u6765\u7684\u5f02\u6b65 WebSocket \u5ba2\u6237\u7aef\uff0c\u53ef\u4f9b\u65b9\u4fbf\u5730\u8fde\u63a5\u3001\u6536\u53d1 WebSocket \u6d88\u606f\u6240\u5b9a\u5236\u3002 \u547d\u540d\u7a7a\u95f4\uff1a \\ZM\\Requests\\ZMWebSocket 1 2 3 4 5 6 7 8 9 10 11 12 $ws = ZMRequest::websocket(\"ws://127.0.0.1:12345/\"); //\u4f7f\u7528\u5de5\u5177\u51fd\u6570 // $ws = new ZMWebSocket(\"ws://127.0.0.1:12345/\"); //\u76f4\u63a5\u6784\u9020 if($ws->is_available) { $ws->onMessage(function(\\Swoole\\WebSocket\\Frame $frame, $client) { var_dump($frame->data); }); $ws->onClose(function($client){ Console::info(\"Websocket closed.\"); }); $result = $ws->upgrade(); var_dump($result); }","title":"ZMRequest::websocket()"},{"location":"component/zmrequest/#_1","text":"","title":"\u5c5e\u6027"},{"location":"component/zmrequest/#is_available","text":"bool \u7c7b\u578b\uff0c\u7528\u4e8e\u5224\u65ad\u6784\u9020\u5bf9\u8c61\u662f\u5426\u6210\u529f\u6216\u94fe\u63a5\u662f\u5426\u53ef\u7528\u3002\u5728\u6784\u5efa\u65b0\u7684\u5bf9\u8c61\u5e76\u6267\u884c upgrade() \u524d\uff0c\u5982\u679c ws \u94fe\u63a5\u6ca1\u6709\u95ee\u9898\uff0c\u5219\u4f1a\u53d8\u4e3a true\uff1b\u5728 onClose() \u56de\u8c03\u6267\u884c\u540e\uff0c\u6b64\u503c\u53d8\u56de false\u3002","title":"is_available"},{"location":"component/zmrequest/#_2","text":"","title":"\u65b9\u6cd5"},{"location":"component/zmrequest/#__construct","text":"\u5ba2\u6237\u7aef\u5bf9\u8c61\u7684\u6784\u9020\u65b9\u6cd5\u3002 \u53c2\u6570\uff1a $url \uff1a\u8981\u8bf7\u6c42\u5230\u7684 WebSocket \u76ee\u6807\u5730\u5740\uff0c\u5fc5\u987b\u4ee5 ws(s):// \u5f00\u5934 $set \uff1a\u53ef\u9009\uff0cSwoole \u5ba2\u6237\u7aef\u7684\u53c2\u6570\uff0c\u4f8b\u5982\u8d85\u65f6\u3001\u662f\u5426\u4f7f\u7528 websocket_mask \u7b49\uff0c\u5982\u679c\u4e3a\u7a7a\u6570\u7ec4\u5219\u9ed8\u8ba4\u4e3a [\"websocket_mask\" => true] \uff0c\u5177\u4f53\u53ef\u8bbe\u7f6e\u7684\u5185\u5bb9\u89c1 Swoole \u6587\u6863 $header \uff1a\u53ef\u9009\uff0c\u8bf7\u6c42\u7684\u5934\u90e8\u4fe1\u606f\uff0c\u6570\u7ec4 1 2 3 $a = new ZMWebSocket(\"ws://127.0.0.1:8080/\", [\"websocket_mask\" => true], [ \"User-Agent\" => \"Firefox\" ]);","title":"__construct()"},{"location":"component/zmrequest/#onmessage","text":"\u8bbe\u7f6e\u6536\u5230\u6d88\u606f\u7684\u56de\u8c03\u51fd\u6570\u3002 \u56de\u8c03\u7684\u53c2\u6570\uff1a $frame \uff1a Swoole\\WebSocket\\Frame \u7c7b\u578b\uff0c\u6d88\u606f\u5e27\uff0c\u4e00\u822c\u53ea\u7528 $frame->data \u83b7\u53d6\u6570\u636e\uff0c\u5177\u4f53\u89c1 Swoole \u6587\u6863 $client \uff1a Swoole\\Coroutine\\Http\\Client \u7c7b\u578b\uff0c\u4e3a\u5ba2\u6237\u7aef\u672c\u8eab\u7684\u5bf9\u8c61\uff0c\u7528\u4e8e push \u6570\u636e\u7b49 1 2 3 4 $a->onMessage(function($frame, $client){ echo \"\u6536\u5230\u6d88\u606f\uff1a\".$frame->data.PHP_EOL; $client->push(\"hello world\"); });","title":"onMessage()"},{"location":"component/zmrequest/#onclose","text":"\u8bbe\u7f6e\u8fde\u63a5\u65ad\u5f00\u540e\u6267\u884c\u7684\u56de\u8c03\u51fd\u6570\u3002 \u56de\u8c03\u7684\u53c2\u6570\uff1a $client \uff1a\u540c\u4e0a\uff0c\u4f46\u65ad\u5f00\u8fde\u63a5\u540e\u4e0d\u80fd\u4f7f\u7528 push() \u53d1\u9001\u6570\u636e\u4e86\uff0c\u53ea\u5efa\u8bae\u4f5c\u4e3a\u91cd\u8fde\u7b49\u673a\u5236\u7684\u4f7f\u7528 1 2 3 $a->onClose(function($client){ echo \"WS \u94fe\u63a5\u65ad\u5f00\u4e86\uff01\".PHP_EOL; });","title":"onClose()"},{"location":"component/zmrequest/#upgrade","text":"\u53d1\u8d77\u8fde\u63a5\u3002 \u8fd4\u56de\u503c\uff1a true|false \uff0c\u5f53\u4e3a true \u65f6\u4ee3\u8868\u63e1\u624b\u6210\u529f\uff0c\u6b64\u65f6\u53ef\u4ee5\u5728\u56de\u8c03\u91cc\u6109\u5feb\u5730\u6536\u53d1\u6d88\u606f\u4e86\u3002\u5982\u679c\u4e3a false \u8868\u660e\u63e1\u624b\u5931\u8d25\u3002 \u6ce8\u610f \u8fd9\u91cc\u7531\u4e8e\u662f\u534f\u7a0b\u8f6c\u5f02\u6b65\uff0c\u6240\u4ee5\u4e0d\u80fd\u786e\u5b9a upgrade() \u548c onMessage() \u54ea\u4e2a\u5148\u4f1a\u88ab\u89e6\u53d1\uff08\u4e00\u822c\u60c5\u51b5\u4e0b\u5982\u679c\u670d\u52a1\u5668\u4e0d\u662f\u7acb\u523b\u54cd\u5e94\u56de\u5305\u4fe1\u606f\uff0c\u603b\u662f\u4f1a\u5148\u8fd4\u56de upgrade() \u7684\u7ed3\u679c\u3002","title":"upgrade()"},{"location":"component/zmrequest/#_3","text":"\u89c1\uff1a Swoole - HTTP \u5ba2\u6237\u7aef","title":"\u8bbe\u7f6e\u53c2\u6570"},{"location":"component/zmutil/","text":"ZMUtil \u6742\u9879\u5de5\u5177\u7c7b \u8c03\u7528\u524d\u5148 use\uff1a use ZM\\Utils\\ZMUtil; ZMUtil::stop() \u505c\u6b62\u6846\u67b6\u8fd0\u884c\u3002 ZMUtil::reload() \u91cd\u8f7d\u6846\u67b6\uff0c\u8fd9\u4f1a\u65ad\u5f00\u6240\u6709\u5230\u6846\u67b6\u7684\u8fde\u63a5\u548c\u91cd\u8f7d\u6240\u6709 src/ \u76ee\u5f55\u4e0b\u7684\u7528\u6237\u6e90\u7801\u5e76\u91cd\u65b0\u52a0\u8f7d\u6240\u6709 Worker \u8fdb\u7a0b\u3002 ZMUtil::getModInstance() \u6839\u636e\u7c7b\u540d\u79f0\u62ff\u5230\u6b64\u7c7b\u7684\u5355\u4f8b\uff08\u524d\u63d0\u662f\u76ee\u6807\u7684\u7c7b\u7684\u6784\u9020\u51fd\u6570\u4e3a\u7a7a\uff09\u3002 1 2 3 4 class ASD{ public $test = 0; } ZMUtil::getModInstance(ASD::class)->test = 5; ZMUtil::getReloadableFiles() \u8fd4\u56de\u53ef\u901a\u8fc7\u70ed\u91cd\u542f\uff08reload\uff09\u6765\u91cd\u65b0\u52a0\u8f7d\u7684 php \u6587\u4ef6\u5217\u8868\u3002 \u4ee5\u4e0b\u662f\u793a\u4f8b\u6a21\u5757\u4e0b\u7684\u4f8b\u5b50\uff08\u76f4\u63a5\u62c9\u53d6\u6700\u65b0\u7684\u6846\u67b6\u6e90\u7801\u5e76\u8fd0\u884c\u6846\u67b6\u540e\u83b7\u53d6\u7684\uff09\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 array:31 [ 94 => \"src/ZM/Context/Context.php\" 95 => \"src/ZM/Context/ContextInterface.php\" 96 => \"src/ZM/Annotation/AnnotationParser.php\" 97 => \"src/Custom/Annotation/Example.php\" 98 => \"src/ZM/Annotation/Interfaces/CustomAnnotation.php\" 99 => \"src/Module/Example/Hello.php\" 100 => \"src/ZM/Annotation/Swoole/OnStart.php\" 101 => \"src/ZM/Annotation/CQ/CQCommand.php\" 102 => \"src/ZM/Annotation/Interfaces/Level.php\" 103 => \"src/ZM/Annotation/Command/TerminalCommand.php\" 104 => \"src/ZM/Annotation/Http/RequestMapping.php\" 105 => \"src/ZM/Annotation/Http/RequestMethod.php\" 106 => \"src/ZM/Annotation/Http/Middleware.php\" 107 => \"src/ZM/Annotation/Interfaces/ErgodicAnnotation.php\" 108 => \"src/ZM/Annotation/Swoole/OnOpenEvent.php\" 109 => \"src/ZM/Annotation/Swoole/OnSwooleEventBase.php\" 110 => \"src/ZM/Annotation/Interfaces/Rule.php\" 111 => \"src/ZM/Annotation/Swoole/OnCloseEvent.php\" 112 => \"src/ZM/Annotation/Swoole/OnRequestEvent.php\" 113 => \"src/ZM/Http/RouteManager.php\" 114 => \"vendor/symfony/routing/RouteCollection.php\" 115 => \"vendor/symfony/routing/Route.php\" 116 => \"src/Module/Middleware/TimerMiddleware.php\" 117 => \"src/ZM/Http/MiddlewareInterface.php\" 118 => \"src/ZM/Annotation/Http/MiddlewareClass.php\" 119 => \"src/ZM/Annotation/Http/HandleBefore.php\" 120 => \"src/ZM/Annotation/Http/HandleAfter.php\" 121 => \"src/ZM/Annotation/Http/HandleException.php\" 122 => \"src/ZM/Event/EventManager.php\" 123 => \"src/ZM/Annotation/Swoole/OnSwooleEvent.php\" 124 => \"src/ZM/Event/EventDispatcher.php\" ] \u4e3a\u4ec0\u4e48\u4e0d\u80fd\u91cd\u8f7d\u6240\u6709\u6587\u4ef6\uff1f\u56e0\u4e3a\u6846\u67b6\u662f\u591a\u8fdb\u7a0b\u6a21\u578b\uff0c\u800c\u91cd\u8f7d\u76f8\u5f53\u4e8e\u53ea\u91cd\u65b0\u542f\u52a8\u4e86\u4e00\u6b21 Worker \u8fdb\u7a0b\uff0cManager \u548c Master \u8fdb\u7a0b\u672a\u91cd\u542f\uff0c\u6240\u4ee5\u88ab Manager\u3001Master \u8fdb\u7a0b\u5df2\u7ecf\u52a0\u8f7d\u7684 PHP \u6587\u4ef6\u65e0\u6cd5\u4f7f\u7528 reload \u547d\u4ee4\u91cd\u65b0\u52a0\u8f7d\u3002\u8be6\u89c1 \u8fdb\u9636 - \u8fdb\u7a0b\u95f4\u9694\u79bb \u3002","title":"ZMUtil \u6742\u9879"},{"location":"component/zmutil/#zmutil","text":"\u8c03\u7528\u524d\u5148 use\uff1a use ZM\\Utils\\ZMUtil;","title":"ZMUtil \u6742\u9879\u5de5\u5177\u7c7b"},{"location":"component/zmutil/#zmutilstop","text":"\u505c\u6b62\u6846\u67b6\u8fd0\u884c\u3002","title":"ZMUtil::stop()"},{"location":"component/zmutil/#zmutilreload","text":"\u91cd\u8f7d\u6846\u67b6\uff0c\u8fd9\u4f1a\u65ad\u5f00\u6240\u6709\u5230\u6846\u67b6\u7684\u8fde\u63a5\u548c\u91cd\u8f7d\u6240\u6709 src/ \u76ee\u5f55\u4e0b\u7684\u7528\u6237\u6e90\u7801\u5e76\u91cd\u65b0\u52a0\u8f7d\u6240\u6709 Worker \u8fdb\u7a0b\u3002","title":"ZMUtil::reload()"},{"location":"component/zmutil/#zmutilgetmodinstance","text":"\u6839\u636e\u7c7b\u540d\u79f0\u62ff\u5230\u6b64\u7c7b\u7684\u5355\u4f8b\uff08\u524d\u63d0\u662f\u76ee\u6807\u7684\u7c7b\u7684\u6784\u9020\u51fd\u6570\u4e3a\u7a7a\uff09\u3002 1 2 3 4 class ASD{ public $test = 0; } ZMUtil::getModInstance(ASD::class)->test = 5;","title":"ZMUtil::getModInstance()"},{"location":"component/zmutil/#zmutilgetreloadablefiles","text":"\u8fd4\u56de\u53ef\u901a\u8fc7\u70ed\u91cd\u542f\uff08reload\uff09\u6765\u91cd\u65b0\u52a0\u8f7d\u7684 php \u6587\u4ef6\u5217\u8868\u3002 \u4ee5\u4e0b\u662f\u793a\u4f8b\u6a21\u5757\u4e0b\u7684\u4f8b\u5b50\uff08\u76f4\u63a5\u62c9\u53d6\u6700\u65b0\u7684\u6846\u67b6\u6e90\u7801\u5e76\u8fd0\u884c\u6846\u67b6\u540e\u83b7\u53d6\u7684\uff09\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 array:31 [ 94 => \"src/ZM/Context/Context.php\" 95 => \"src/ZM/Context/ContextInterface.php\" 96 => \"src/ZM/Annotation/AnnotationParser.php\" 97 => \"src/Custom/Annotation/Example.php\" 98 => \"src/ZM/Annotation/Interfaces/CustomAnnotation.php\" 99 => \"src/Module/Example/Hello.php\" 100 => \"src/ZM/Annotation/Swoole/OnStart.php\" 101 => \"src/ZM/Annotation/CQ/CQCommand.php\" 102 => \"src/ZM/Annotation/Interfaces/Level.php\" 103 => \"src/ZM/Annotation/Command/TerminalCommand.php\" 104 => \"src/ZM/Annotation/Http/RequestMapping.php\" 105 => \"src/ZM/Annotation/Http/RequestMethod.php\" 106 => \"src/ZM/Annotation/Http/Middleware.php\" 107 => \"src/ZM/Annotation/Interfaces/ErgodicAnnotation.php\" 108 => \"src/ZM/Annotation/Swoole/OnOpenEvent.php\" 109 => \"src/ZM/Annotation/Swoole/OnSwooleEventBase.php\" 110 => \"src/ZM/Annotation/Interfaces/Rule.php\" 111 => \"src/ZM/Annotation/Swoole/OnCloseEvent.php\" 112 => \"src/ZM/Annotation/Swoole/OnRequestEvent.php\" 113 => \"src/ZM/Http/RouteManager.php\" 114 => \"vendor/symfony/routing/RouteCollection.php\" 115 => \"vendor/symfony/routing/Route.php\" 116 => \"src/Module/Middleware/TimerMiddleware.php\" 117 => \"src/ZM/Http/MiddlewareInterface.php\" 118 => \"src/ZM/Annotation/Http/MiddlewareClass.php\" 119 => \"src/ZM/Annotation/Http/HandleBefore.php\" 120 => \"src/ZM/Annotation/Http/HandleAfter.php\" 121 => \"src/ZM/Annotation/Http/HandleException.php\" 122 => \"src/ZM/Event/EventManager.php\" 123 => \"src/ZM/Annotation/Swoole/OnSwooleEvent.php\" 124 => \"src/ZM/Event/EventDispatcher.php\" ] \u4e3a\u4ec0\u4e48\u4e0d\u80fd\u91cd\u8f7d\u6240\u6709\u6587\u4ef6\uff1f\u56e0\u4e3a\u6846\u67b6\u662f\u591a\u8fdb\u7a0b\u6a21\u578b\uff0c\u800c\u91cd\u8f7d\u76f8\u5f53\u4e8e\u53ea\u91cd\u65b0\u542f\u52a8\u4e86\u4e00\u6b21 Worker \u8fdb\u7a0b\uff0cManager \u548c Master \u8fdb\u7a0b\u672a\u91cd\u542f\uff0c\u6240\u4ee5\u88ab Manager\u3001Master \u8fdb\u7a0b\u5df2\u7ecf\u52a0\u8f7d\u7684 PHP \u6587\u4ef6\u65e0\u6cd5\u4f7f\u7528 reload \u547d\u4ee4\u91cd\u65b0\u52a0\u8f7d\u3002\u8be6\u89c1 \u8fdb\u9636 - \u8fdb\u7a0b\u95f4\u9694\u79bb \u3002","title":"ZMUtil::getReloadableFiles()"},{"location":"component/bot/access-token/","text":"Token \u9a8c\u8bc1 \u4e3a\u4e86\u4fdd\u969c\u5b89\u5168\uff0c\u6846\u67b6\u652f\u6301\u7ed9\u63a5\u5165\u7684 WebSocket \u8fde\u63a5\u9a8c\u8bc1 Token\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e Token \u540c\u65f6\u53c8\u5c06\u6846\u67b6\u7684\u7aef\u53e3\u66b4\u9732\u5728\u516c\u7f51\u5c06\u4f1a\u975e\u5e38\u5371\u9669\u3002 \u70b8\u6bdb\u6846\u67b6\u517c\u5bb9 OneBot \u6807\u51c6\u7684\u673a\u5668\u4eba\u5ba2\u6237\u7aef\uff0c\u6240\u4ee5\u81ea\u5e26\u4e00\u4e2a Token \u9a8c\u8bc1\u5668\u3002 \u5173\u4e8e Access Token \u65b9\u9762\u7684\u6807\u51c6\u89c4\u8303\uff0c\u8bf7\u53c2\u8003\u4e0b\u9762\u5185\u5bb9\uff1a OneBot - \u9274\u6743 go-cqhttp - \u914d\u7f6e \u4ee5 go-cqhttp \u4e3e\u4f8b\uff0c\u5982\u679c\u8981\u8bbe\u7f6e\u9a8c\u8bc1\uff0c\u5219\u5c06 go-cqhttp \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 access_token \u9879\u586b\u5165\u5185\u5bb9\u5373\u53ef\u3002 \u9a8c\u8bc1\u4f4d\u7f6e \u6846\u67b6\u5bf9 Token \u7684\u9a8c\u8bc1\u662f\u5185\u7f6e\u7684\uff0c\u5728\u4e8b\u4ef6 open \uff08WebSocket \u8fde\u63a5\u63a5\u5165\u65f6\uff09\u89e6\u53d1\u3002 \u5982\u679c\u662f\u517c\u5bb9 OneBot \u6807\u51c6\u7684\u5ba2\u6237\u7aef\u63a5\u5165\uff0c\u5219\u4e00\u5207\u90fd\u662f\u517c\u5bb9\u7684\u3002 \u5982\u679c\u662f\u81ea\u5b9a\u4e49\u7684\u5176\u4ed6 WebSocket \u5ba2\u6237\u7aef\u4e5f\u60f3\u63a5\u5165\u6846\u67b6\uff0c\u90a3\u4e48\u5176\u4ed6 WebSocket \u5ba2\u6237\u7aef\u4e5f\u9700\u8981\u8fdb\u884c\u76f8\u5e94\u7684\u8bbe\u7f6e\u624d\u80fd\u5229\u7528\u6b64 Token \u9a8c\u8bc1\u3002 \u5982\u679c\u9a8c\u8bc1\u6210\u529f\uff08Token \u7b26\u5408\u8981\u6c42\uff09\u5219\u5206\u53d1\u4e8b\u4ef6 @OnOpenEvent \uff0c\u5426\u5219\u6b64\u4e8b\u4ef6\u4e0d\u89e6\u53d1\uff0c\u540c\u65f6\u65ad\u5f00 WebSocket \u8fde\u63a5\u3002 \u6807\u51c6\u9a8c\u8bc1\uff08\u5b57\u7b26\u4e32\u5f62\u5f0f\uff09 \u9ed8\u8ba4\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u6846\u67b6\u7684\u5168\u5c40\u914d\u7f6e\u6587\u4ef6 global.php \u4e2d\uff0c\u5bf9\u914d\u7f6e\u9879 access_token \u586b\u5165\u4e0e OneBot \u5ba2\u6237\u7aef\u76f8\u540c\u7684 access_token \u5373\u53ef\u5b9e\u73b0\u9274\u6743\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u6700\u57fa\u672c\u7684\u548c go-cqhttp \u8bbe\u7f6e\u9274\u6743\u914d\u7f6e\uff1a go-cqhttp \u7684\u914d\u7f6e\u6bb5\uff1a 1 2 // \u8bbf\u95ee\u5bc6\u94a5, \u5f3a\u70c8\u63a8\u8350\u5728\u516c\u7f51\u7684\u670d\u52a1\u5668\u8bbe\u7f6e access_token: \"emhhbWFvLXJvYm90\" \u6846\u67b6\u7684\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u6bb5\uff1a 1 2 /** onebot\u8fde\u63a5\u7ea6\u5b9a\u7684token */ $config[\"access_token\"] = 'emhhbWFvLXJvYm90'; \u7136\u540e\u91cd\u542f\u6846\u67b6\u548c go-cqhttp \u5373\u53ef\u3002\uff08\u5176\u4ed6 OneBot \u5ba2\u6237\u7aef\u540c\u7406\uff09 \u81ea\u5b9a\u4e49\u9a8c\u8bc1\uff08Token \u9a8c\u8bc1\uff09 \u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u4e00\u4e2a\u5355\u4e00\u7684\u5b57\u7b26\u4e32\u53ef\u80fd\u65e0\u6cd5\u6ee1\u8db3\u4f60\u5bf9 Token \u9a8c\u8bc1\u7684\u5b89\u5168\u9700\u6c42\uff0c\u9700\u8981\u81ea\u5b9a\u4e49\u4e00\u4e9b\u5224\u65ad\u6a21\u5f0f\u624d\u80fd\u6ee1\u8db3\uff0c\u6240\u4ee5\u6846\u67b6\u7684 access_token \u914d\u7f6e\u9879\u652f\u6301\u52a8\u6001\u7684\u95ed\u5305\u51fd\u6570\u81ea\u884c\u7f16\u5199\u5224\u65ad\u903b\u8f91\uff0c\u4f8b\u5982\u4e0b\u9762\u7684\u4e00\u4e2a\u4f8b\u5b50\uff0c\u6211\u53ef\u4ee5\u8ba9\u6846\u67b6\u540c\u65f6\u5141\u8bb8\u63a5\u5165\u591a\u4e2a\u4e0d\u540c token \u7684 WebSocket \u8fde\u63a5\uff1a 1 2 3 4 5 6 /** onebot\u8fde\u63a5\u7ea6\u5b9a\u7684token */ $config[\"access_token\"] = function($token){ $allow = ['emhhbWFvLXJvYm90','aXMtdmVyeS1nb29k']; if (in_array($token, $allow)) return true; else return false; }; \u81ea\u5b9a\u4e49\u9a8c\u8bc1\uff08open \u4e8b\u4ef6\uff09 \u5f53\u7136\uff0c\u8fd9\u91cc\u8bbe\u7f6e\u4e86\u81ea\u5b9a\u4e49\u65b9\u5f0f\uff0c\u5176\u5b9e\u4f60\u4e5f\u53ef\u4ee5\u5728\u4e0b\u4e00\u5c42\u7684 @OnOpenEvent \u6ce8\u89e3\u4e8b\u4ef6\u4e2d\u8fdb\u884c\u81ea\u5b9a\u4e49\u5185\u5bb9\u548c\u5224\u65ad\uff0c\u5177\u4f53\u89c1 @OnOpenEvent \u7684\u76f8\u5173\u7ae0\u8282\u3002","title":"Token \u9a8c\u8bc1"},{"location":"component/bot/access-token/#token","text":"\u4e3a\u4e86\u4fdd\u969c\u5b89\u5168\uff0c\u6846\u67b6\u652f\u6301\u7ed9\u63a5\u5165\u7684 WebSocket \u8fde\u63a5\u9a8c\u8bc1 Token\uff0c\u5982\u679c\u4e0d\u8bbe\u7f6e Token \u540c\u65f6\u53c8\u5c06\u6846\u67b6\u7684\u7aef\u53e3\u66b4\u9732\u5728\u516c\u7f51\u5c06\u4f1a\u975e\u5e38\u5371\u9669\u3002 \u70b8\u6bdb\u6846\u67b6\u517c\u5bb9 OneBot \u6807\u51c6\u7684\u673a\u5668\u4eba\u5ba2\u6237\u7aef\uff0c\u6240\u4ee5\u81ea\u5e26\u4e00\u4e2a Token \u9a8c\u8bc1\u5668\u3002 \u5173\u4e8e Access Token \u65b9\u9762\u7684\u6807\u51c6\u89c4\u8303\uff0c\u8bf7\u53c2\u8003\u4e0b\u9762\u5185\u5bb9\uff1a OneBot - \u9274\u6743 go-cqhttp - \u914d\u7f6e \u4ee5 go-cqhttp \u4e3e\u4f8b\uff0c\u5982\u679c\u8981\u8bbe\u7f6e\u9a8c\u8bc1\uff0c\u5219\u5c06 go-cqhttp \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 access_token \u9879\u586b\u5165\u5185\u5bb9\u5373\u53ef\u3002","title":"Token \u9a8c\u8bc1"},{"location":"component/bot/access-token/#_1","text":"\u6846\u67b6\u5bf9 Token \u7684\u9a8c\u8bc1\u662f\u5185\u7f6e\u7684\uff0c\u5728\u4e8b\u4ef6 open \uff08WebSocket \u8fde\u63a5\u63a5\u5165\u65f6\uff09\u89e6\u53d1\u3002 \u5982\u679c\u662f\u517c\u5bb9 OneBot \u6807\u51c6\u7684\u5ba2\u6237\u7aef\u63a5\u5165\uff0c\u5219\u4e00\u5207\u90fd\u662f\u517c\u5bb9\u7684\u3002 \u5982\u679c\u662f\u81ea\u5b9a\u4e49\u7684\u5176\u4ed6 WebSocket \u5ba2\u6237\u7aef\u4e5f\u60f3\u63a5\u5165\u6846\u67b6\uff0c\u90a3\u4e48\u5176\u4ed6 WebSocket \u5ba2\u6237\u7aef\u4e5f\u9700\u8981\u8fdb\u884c\u76f8\u5e94\u7684\u8bbe\u7f6e\u624d\u80fd\u5229\u7528\u6b64 Token \u9a8c\u8bc1\u3002 \u5982\u679c\u9a8c\u8bc1\u6210\u529f\uff08Token \u7b26\u5408\u8981\u6c42\uff09\u5219\u5206\u53d1\u4e8b\u4ef6 @OnOpenEvent \uff0c\u5426\u5219\u6b64\u4e8b\u4ef6\u4e0d\u89e6\u53d1\uff0c\u540c\u65f6\u65ad\u5f00 WebSocket \u8fde\u63a5\u3002","title":"\u9a8c\u8bc1\u4f4d\u7f6e"},{"location":"component/bot/access-token/#_2","text":"\u9ed8\u8ba4\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u6846\u67b6\u7684\u5168\u5c40\u914d\u7f6e\u6587\u4ef6 global.php \u4e2d\uff0c\u5bf9\u914d\u7f6e\u9879 access_token \u586b\u5165\u4e0e OneBot \u5ba2\u6237\u7aef\u76f8\u540c\u7684 access_token \u5373\u53ef\u5b9e\u73b0\u9274\u6743\u3002\u4e0b\u9762\u662f\u4e00\u4e2a\u6700\u57fa\u672c\u7684\u548c go-cqhttp \u8bbe\u7f6e\u9274\u6743\u914d\u7f6e\uff1a go-cqhttp \u7684\u914d\u7f6e\u6bb5\uff1a 1 2 // \u8bbf\u95ee\u5bc6\u94a5, \u5f3a\u70c8\u63a8\u8350\u5728\u516c\u7f51\u7684\u670d\u52a1\u5668\u8bbe\u7f6e access_token: \"emhhbWFvLXJvYm90\" \u6846\u67b6\u7684\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u6bb5\uff1a 1 2 /** onebot\u8fde\u63a5\u7ea6\u5b9a\u7684token */ $config[\"access_token\"] = 'emhhbWFvLXJvYm90'; \u7136\u540e\u91cd\u542f\u6846\u67b6\u548c go-cqhttp \u5373\u53ef\u3002\uff08\u5176\u4ed6 OneBot \u5ba2\u6237\u7aef\u540c\u7406\uff09","title":"\u6807\u51c6\u9a8c\u8bc1\uff08\u5b57\u7b26\u4e32\u5f62\u5f0f\uff09"},{"location":"component/bot/access-token/#token_1","text":"\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u4e00\u4e2a\u5355\u4e00\u7684\u5b57\u7b26\u4e32\u53ef\u80fd\u65e0\u6cd5\u6ee1\u8db3\u4f60\u5bf9 Token \u9a8c\u8bc1\u7684\u5b89\u5168\u9700\u6c42\uff0c\u9700\u8981\u81ea\u5b9a\u4e49\u4e00\u4e9b\u5224\u65ad\u6a21\u5f0f\u624d\u80fd\u6ee1\u8db3\uff0c\u6240\u4ee5\u6846\u67b6\u7684 access_token \u914d\u7f6e\u9879\u652f\u6301\u52a8\u6001\u7684\u95ed\u5305\u51fd\u6570\u81ea\u884c\u7f16\u5199\u5224\u65ad\u903b\u8f91\uff0c\u4f8b\u5982\u4e0b\u9762\u7684\u4e00\u4e2a\u4f8b\u5b50\uff0c\u6211\u53ef\u4ee5\u8ba9\u6846\u67b6\u540c\u65f6\u5141\u8bb8\u63a5\u5165\u591a\u4e2a\u4e0d\u540c token \u7684 WebSocket \u8fde\u63a5\uff1a 1 2 3 4 5 6 /** onebot\u8fde\u63a5\u7ea6\u5b9a\u7684token */ $config[\"access_token\"] = function($token){ $allow = ['emhhbWFvLXJvYm90','aXMtdmVyeS1nb29k']; if (in_array($token, $allow)) return true; else return false; };","title":"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\uff08Token \u9a8c\u8bc1\uff09"},{"location":"component/bot/access-token/#open","text":"\u5f53\u7136\uff0c\u8fd9\u91cc\u8bbe\u7f6e\u4e86\u81ea\u5b9a\u4e49\u65b9\u5f0f\uff0c\u5176\u5b9e\u4f60\u4e5f\u53ef\u4ee5\u5728\u4e0b\u4e00\u5c42\u7684 @OnOpenEvent \u6ce8\u89e3\u4e8b\u4ef6\u4e2d\u8fdb\u884c\u81ea\u5b9a\u4e49\u5185\u5bb9\u548c\u5224\u65ad\uff0c\u5177\u4f53\u89c1 @OnOpenEvent \u7684\u76f8\u5173\u7ae0\u8282\u3002","title":"\u81ea\u5b9a\u4e49\u9a8c\u8bc1\uff08open \u4e8b\u4ef6\uff09"},{"location":"component/bot/cqcode/","text":"CQ \u7801\uff08\u591a\u5a92\u4f53\u6d88\u606f\uff09 \u6d88\u606f\u4e2d\u7684\u591a\u5a92\u4f53\u5185\u5bb9\u4f7f\u7528 CQ \u7801\u6765\u8868\u793a\uff0c\u5f62\u5982 [CQ:face,id=178] \u3002\u5176\u4e2d\uff0c [CQ:] \u662f\u56fa\u5b9a\u683c\u5f0f\uff1b face \u662f\u300c\u529f\u80fd\u540d\u300d\uff0c\u9664\u4e86 face \u8fd8\u6709\u8bb8\u591a\u4e0d\u540c\u7684\u529f\u80fd\u540d\uff1b id=178 \u662f\u300c\u53c2\u6570\u300d\uff0c\u67d0\u4e9b\u529f\u80fd\u4e0d\u9700\u8981\u53c2\u6570\uff0c\u800c\u53e6\u4e00\u4e9b\u9700\u8981\u591a\u4e2a\u53c2\u6570\uff0c\u5f53\u6709\u591a\u4e2a\u53c2\u6570\u65f6\uff0c\u53c2\u6570\u95f4\u4f7f\u7528\u9017\u53f7\u5206\u9694\u3002 \u683c\u5f0f \u4e00\u4e9b CQ \u7801\u7684\u4f8b\u5b50\u5982\u4e0b\uff1a 1 2 3 [CQ:shake] [CQ:face,id=178] [CQ:share,title=\u6807\u9898,url=http://baidu.com] \u66f4\u591a CQ \u7801\u529f\u80fd\u8bf7\u53c2\u8003 \u6d88\u606f\u6bb5\u7c7b\u578b \u3002 \u6ce8\u610f CQ \u7801\u4e2d\u4e0d\u5e94\u6709\u591a\u4f59\u7684\u7a7a\u683c\uff0c\u4f8b\u5982\u4e0d\u5e94\u8be5\u4f7f\u7528 [CQ:face, id=178] \u3002 CQ \u7801\u7684\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u7a7a\u683c\u3001\u6362\u884c\u3001\u9664 [],& \u4e4b\u5916\u7684\u7279\u6b8a\u7b26\u53f7\u7b49\u3002\u5728\u89e3\u6790\u65f6\uff0c\u5e94\u76f4\u63a5\u53d6 [CQ: \u540e\u3001\u7b2c\u4e00\u4e2a , \u6216 ] \u524d\u7684\u90e8\u5206\u4e3a\u529f\u80fd\u540d\uff0c\u7b2c\u4e00\u4e2a , \u4e4b\u540e\u5230 ] \u4e4b\u95f4\u7684\u90e8\u5206\u4e3a\u53c2\u6570\uff0c\u6309 , \u5206\u5272\u540e\uff0c\u6bcf\u4e2a\u90e8\u5206\u7b2c\u4e00\u4e2a = \u524d\u7684\u5185\u5bb9\u4e3a\u53c2\u6570\u540d\uff0c\u4e4b\u540e\u7684\u90e8\u5206\u4e3a\u53c2\u6570\u503c\u3002\u4f8b\u5982 [CQ:share,title=\u6807\u9898\u4e2d\u6709=\u7b49\u53f7,url=http://baidu.com] \u4e2d\uff0c\u529f\u80fd\u540d\u4e3a share \uff0c title \u53c2\u6570\u503c\u4e3a \u6807\u9898\u4e2d\u6709=\u7b49\u53f7 \uff0c url \u53c2\u6570\u503c\u4e3a http://baidu.com \u3002 \u8f6c\u4e49 CQ \u7801\u4e2d\u5305\u542b\u4e00\u4e9b\u7279\u6b8a\u5b57\u7b26\uff1a [ \u3001 ] \u3001 , \u7b49\uff0c\u800c CQ \u7801\u53c8\u662f\u53ef\u80fd\u6df7\u6742\u5728\u7eaf\u6587\u672c\u5185\u5bb9\u4e4b\u4e2d\u7684\uff0c\u56e0\u6b64\u6d88\u606f\u4e2d\u7684\u7eaf\u6587\u672c\u5185\u5bb9\u9700\u8981\u5bf9\u7279\u6b8a\u5b57\u7b26\u8fdb\u884c\u8f6c\u4e49\uff0c\u4ee5\u907f\u514d\u6b67\u4e49\u3002\u5177\u4f53\u7684\u8f6c\u4e49\u89c4\u5219\u5982\u4e0b\uff1a \u8f6c\u4e49\u524d \u8f6c\u4e49\u540e & &amp; [ &#91; ] &#93; \u53e6\u4e00\u65b9\u9762\uff0cCQ \u7801\u5185\u90e8\u7684\u53c2\u6570\u503c\u4e5f\u53ef\u80fd\u51fa\u73b0\u7279\u6b8a\u5b57\u7b26\uff0c\u4e5f\u662f\u9700\u8981\u8f6c\u4e49\u7684\u3002\u7531\u4e8e , \uff08\u534a\u89d2\u9017\u53f7\uff09\u5728 CQ \u7801\u4e2d\u7528\u4e8e\u5206\u9694\u53c2\u6570\uff0c\u56e0\u6b64\u9664\u4e86\u4e0a\u9762\u7684\u8f6c\u4e49\u89c4\u5219\uff0c\u8fd8\u9700\u8981\u5bf9 , \u8fdb\u884c\u8f6c\u4e49\uff0c\u5982\u4e0b\uff1a \u8f6c\u4e49\u524d \u8f6c\u4e49\u540e & &amp; [ &#91; ] &#93; , &#44; \u4f8b\u5982\uff0c\u4e00\u4e2a\u94fe\u63a5\u5206\u4eab\u6d88\u606f\u7684 CQ \u7801\u53ef\u80fd\u5982\u4e0b\uff1a 1 [CQ:share,title=\u9707\u60ca&#44;\u5c0f\u4f19\u7761\u89c9\u524d\u5c45\u7136...,url=http://baidu.com/?a=1&amp;b=2] \u5c01\u88c5\u8c03\u7528 \u6846\u67b6\u63d0\u4f9b\u4e86 CQ \u7801\u7684\u5c01\u88c5\uff0c\u4f60\u53ef\u4ee5\u5728\u4efb\u4f55\u4f4d\u7f6e\u4f7f\u7528\u5c01\u88c5\u597d\u7684 CQ \u7801\u751f\u6210\u5668\u3002 \u751f\u6210\u5668\u662f\u4e00\u4e2a\u9759\u6001\u7c7b\uff0c\u91cc\u9762\u7684\u65b9\u6cd5\u5168\u90e8\u662f\u9759\u6001\u8c03\u7528\uff0c\u547d\u540d\u7a7a\u95f4\u662f\uff1a ZM\\API\\CQ \u3002 \u4f8b\u5982\uff0c\u7ed9\u7528\u6237\u53d1\u9001\u56fe\u7247\u8fd9\u6837\u5199\u5c31\u597d\u5566\uff01\u53ea\u9700\u8981\u5c06\u6dfb\u52a0\u56fe\u7247\u7684\u5730\u65b9\u62fc\u5230\u56de\u590d\u7528\u6237\u7684\u5b57\u7b26\u4e32\u91cc\u3002\u5982\u679c\u53ea\u53d1\u56fe\u7247\uff0c\u6574\u4e2a\u5b57\u7b26\u4e32\u91cc\u53ea\u80fd\u6709 CQ \u7801\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php namespace Module\\Example ; use ZM\\API\\CQ ; use ZM\\Annotation\\CQ\\CQCommand ; class Hello { /** * @CQCommand(\"\u53d1\u9001\u56fe\u7247\") */ public function msgRecv () { return CQ :: image ( \"https://zhamao.xin/file/hello.jpg\" ); // \u76f8\u5f53\u4e8e\u8fd4\u56de\uff1a\"[CQ:image,file=https://zhamao.xin/file/hello.jpg]\" } } \u6548\u679c ) \u53d1\u9001\u56fe\u7247 [ https://zhamao.xin/file/hello.jpg CQ \u7801\u64cd\u4f5c CQ::decode() CQ \u7801\u5b57\u7b26\u53cd\u8f6c\u4e49\u3002 \u5b9a\u4e49\uff1a CQ::encode($msg, $is_content = false) \u5f53 $is_content \u4e3a true \u65f6\uff0c\u4f1a\u5c06 &#44; \u8f6c\u4e49\u4e3a , \u3002 \u53cd\u8f6c\u4e49\u524d \u53cd\u8f6c\u4e49\u540e &amp; & &#91; [ &#93; ] &#44; , 1 2 $str = CQ::decode(\"&#91;CQ:at,qq=\u6211\u53ea\u662f\u4e00\u6761\u666e\u901a\u7684\u6587\u672c&#93;\"); // \u8f6c\u6362\u4e3a \"[CQ:at,qq=\u6211\u53ea\u662f\u4e00\u6761\u666e\u901a\u7684\u6587\u672c]\" CQ::encode() \u8f6c\u4e49 CQ \u7801\u7684\u654f\u611f\u7b26\u53f7\uff0c\u9632\u6b62 \u9177Q \u628a\u4e0d\u8be5\u89e3\u6790\u4e3a CQ \u7801\u7684\u6d88\u606f\u5185\u5bb9\u5f53\u4f5c CQ \u7801\u5904\u7406\u3002 1 2 $str = CQ::encode(\"[CQ:\u6211\u53ea\u662f\u4e00\u6761\u666e\u901a\u7684\u6587\u672c]\"); // $str: \"&#91;CQ:\u6211\u53ea\u662f\u4e00\u6761\u666e\u901a\u7684\u6587\u672c&#93;\" \u5b9a\u4e49\uff1a CQ::encode($msg, $is_content = false) \u5f53 $is_content \u4e3a true \u65f6\uff0c\u4f1a\u5c06 , \u8f6c\u4e49\u4e3a &#44; \u3002 CQ::escape() \u540c CQ::encode() \u3002 CQ::removeCQ() \u53bb\u9664\u5b57\u7b26\u4e32\u4e2d\u6240\u6709\u7684 CQ \u7801\u3002 1 2 $str = CQ::removeCQ(\"[CQ:at,qq=all]\u8fd9\u662f\u5e26\u8868\u60c5\u7684\u5168\u4f53\u6d88\u606f[CQ:face,id=8]\"); // $str: \"\u8fd9\u662f\u5e26\u8868\u60c5\u7684\u5168\u4f53\u6d88\u606f\" CQ::getCQ() \u89e3\u6790 CQ \u7801\u3002 \u5b9a\u4e49\uff1a getCQ($msg, $is_object = false) \u53c2\u6570 $is_object \u4e3a true \u65f6\uff0c\u8fd4\u56de\u4e00\u4e2a \\ZM\\Entity\\CQObject \u5bf9\u8c61\uff0c\u6b64\u5bf9\u8c61\u7684\u5c5e\u6027\u548c\u4e0b\u8868\u76f8\u540c\u3002\uff082.3.0+ \u7248\u672c\u53ef\u7528\uff09 \u8fd4\u56de\uff1a \u6570\u7ec4 | CQObject | null \uff0c\u89c1\u4e0b\u8868\u3002 \u952e\u540d \u8bf4\u660e type CQ\u7801\u7c7b\u578b\uff0c\u6bd4\u5982 [CQ:at] \u4e2d\u7684 at params \u53c2\u6570\u5217\u8868\uff0c\u6bd4\u5982 [CQ:image,file=123.jpg,url=http://a.com/a.jpg] \uff0cparams \u4e3a [\"file\" => \"123\",\"url\" => \"http://a.com/a.jpg\"] start \u6b64 CQ \u7801\u5728\u5b57\u7b26\u4e32\u4e2d\u7684\u8d77\u59cb\u4f4d\u7f6e end \u6b64 CQ \u7801\u5728\u5b57\u7b26\u4e32\u4e2d\u7684\u7ed3\u675f\u4f4d\u7f6e CQ::getAllCQ() \u5b9a\u4e49\uff1a CQ::getAllCQ($msg, $is_object = false) \u53c2\u6570 $is_object \u4e3a true \u65f6\uff0c\u8fd4\u56de\u4e00\u4e2a \\ZM\\Entity\\CQObject[] \u5bf9\u8c61\u6570\u7ec4\uff0c\u6b64\u5bf9\u8c61\u7684\u5c5e\u6027\u548c\u4e0a\u9762\u7684\u8868\u683c\u5185\u76f8\u540c\u3002\uff082.3.0+ \u7248\u672c\u53ef\u7528\uff09 \u89e3\u6790 CQ \u7801\uff0c\u548c getCQ() \u7684\u533a\u522b\u662f\uff0c\u8fd9\u4e2a\u4f1a\u5c06\u5b57\u7b26\u4e32\u4e2d\u7684\u6240\u6709 CQ \u7801\u90fd\u89e3\u6790\u51fa\u6765\uff0c\u5e76\u4ee5\u540c\u6837\u4e0a\u65b9\u89e3\u6790\u51fa\u6765\u7684\u6570\u7ec4\u683c\u5f0f\u8fd4\u56de\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 CQ::getAllCQ(\"[CQ:at,qq=123]\u4f60\u597d\u554a[CQ:at,qq=456]\"); /* [ [ \"type\" => \"at\", \"params\" => [ \"qq\" => \"123\", ], \"start\" => 0, \"end\" => 13, ], [ \"type\" => \"at\", \"params\" => [ \"qq\" => \"456\", ], \"start\" => 17, \"end\" => 30, ], ] */ CQ \u7801\u5217\u8868 CQ::face() - \u53d1\u9001 QQ \u8868\u60c5 \u53d1\u9001 QQ \u539f\u751f\u8868\u60c5\u3002 \u5b9a\u4e49\uff1a CQ::face($id) \u53c2\u6570\uff1a $id \u4e3a QQ \u8868\u60c5\u5bf9\u5e94\u7684 ID \u53f7\uff0c\u4e00\u4e9b\u5e38\u89c1\u7684\u8868\u60c5 ID \u5bf9\u5e94\u7684\u8868\u60c5\u6837\u5f0f\u89c1 QQ \u5bf9\u5e94\u8868\u60c5ID\u8868 \u3002 1 2 3 4 5 6 7 /** * @CQCommand(\"\u6253\u76f9\") */ public function faceTest() { ctx()->reply(\"\u6b63\u5728\u6253\u76f9...\"); ctx()->reply(CQ::face(8)); } ) \u6253\u76f9 ( \u6b63\u5728\u6253\u76f9... [ https://docs-v1.zhamao.xin/face/8.gif \u63d0\u793a \u5bf9\u4e8e\u4e0d\u65ad\u66f4\u65b0\u7684 QQ \u7248\u672c\u4e0b\uff0c\u53ef\u80fd\u4f1a\u6301\u7eed\u6269\u5145\u65b0\u7684 QQ \u8868\u60c5\uff0c\u5982\u679c\u4e0a\u8868\u6ca1\u6709\u65b0\u7684\u8868\u60c5\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6d88\u606f\u63a5\u6536\u7684\u65b9\u5f0f\uff0c\u8ba9\u673a\u5668\u4eba\u6536\u5230\u8868\u60c5\u540e\u89e3\u6790\u51fa\u6765\u5bf9\u5e94\u7684 id \u7136\u540e\u518d\u53d1\u9001\u3002 CQ::image() - \u53d1\u9001\u56fe\u7247 \u53d1\u9001\u56fe\u7247\u3002 \u5b9a\u4e49\uff1a image($file, $cache = true, $flash = false, $proxy = true, $timeout = -1) \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u9ed8\u8ba4\u503c \u8bf4\u660e file \u2713 \u2713 \u5fc5\u586b \u56fe\u7247\u6587\u4ef6\u540d flash \u2713 \u2713 false \u56fe\u7247\u7c7b\u578b\uff0c\u5f53\u53c2\u6570\u4e3a true \u65f6\u4ee3\u8868\u53d1\u9001\u95ea\u7167 cache \u2713 true \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u8868\u793a\u662f\u5426\u4f7f\u7528\u5df2\u7f13\u5b58\u7684\u6587\u4ef6\uff0c\u9ed8\u8ba4 true proxy \u2713 true \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u8868\u793a\u662f\u5426\u901a\u8fc7\u4ee3\u7406\u4e0b\u8f7d\u6587\u4ef6\uff08\u9700\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6216\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u4ee3\u7406\uff09\uff0c\u9ed8\u8ba4 true timeout \u2713 -1 \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u5355\u4f4d\u79d2\uff0c\u8868\u793a\u4e0b\u8f7d\u7f51\u7edc\u6587\u4ef6\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4 -1 \u4e0d\u8d85\u65f6 \u53d1\u9001\u65f6\uff0c file \u53c2\u6570\u9664\u4e86\u652f\u6301\u4f7f\u7528\u6536\u5230\u7684\u56fe\u7247\u6587\u4ef6\u540d\u76f4\u63a5\u53d1\u9001\u5916\uff0c\u8fd8\u652f\u6301\uff1a \u7edd\u5bf9\u8def\u5f84\uff0c\u4f8b\u5982 file:///root/imagetest/1.png \uff0c\u683c\u5f0f\u4f7f\u7528 file URI \u7f51\u7edc URL\uff0c\u4f8b\u5982 http://i1.piimg.com/567571/fdd6e7b6d93f1ef0.jpg Base64 \u7f16\u7801\uff0c\u4f8b\u5982 base64://iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAAKElEQVQ4EWPk5+RmIBcwkasRpG9UM4mhNxpgowFGMARGEwnBIEJVAAAdBgBNAZf+QAAAAABJRU5ErkJggg== CQ::record() - \u53d1\u9001\u8bed\u97f3 \u53d1\u9001\u8bed\u97f3\u6d88\u606f\u3002 \u5b9a\u4e49\uff1a CQ::record($file, $magic = false, $cache = true, $proxy = true, $timeout = -1) \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u9ed8\u8ba4\u503c \u8bf4\u660e file \u2713 \u2713 \u5fc5\u586b \u97f3\u9891\u6587\u4ef6\u540d flash \u2713 \u2713 false \u56fe\u7247\u7c7b\u578b\uff0c\u5f53\u53c2\u6570\u4e3a true \u65f6\u4ee3\u8868\u53d1\u9001\u95ea\u7167 cache \u2713 true \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u8868\u793a\u662f\u5426\u4f7f\u7528\u5df2\u7f13\u5b58\u7684\u6587\u4ef6\uff0c\u9ed8\u8ba4 true proxy \u2713 true \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u8868\u793a\u662f\u5426\u901a\u8fc7\u4ee3\u7406\u4e0b\u8f7d\u6587\u4ef6\uff08\u9700\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6216\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u4ee3\u7406\uff09\uff0c\u9ed8\u8ba4 true timeout \u2713 -1 \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u5355\u4f4d\u79d2\uff0c\u8868\u793a\u4e0b\u8f7d\u7f51\u7edc\u6587\u4ef6\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4 -1 \u4e0d\u8d85\u65f6 \u53d1\u9001\u65f6\uff0c file \u53c2\u6570\u9664\u4e86\u652f\u6301\u4f7f\u7528\u6536\u5230\u7684\u8bed\u97f3\u6587\u4ef6\u540d\u76f4\u63a5\u53d1\u9001\u5916\uff0c\u8fd8\u652f\u6301\u5176\u5b83\u5f62\u5f0f\uff0c\u53c2\u8003\u4e0a\u65b9\u53d1\u9001\u56fe\u7247\u3002 1 2 3 4 5 6 /** * @CQCommand(\"\u8bf4\u4f60\u597d\") */ public function say() { ctx()->reply(CQ::record(\"https://zhamao.xin/file/hello.mp3\")); } ) \u8bf4\u4f60\u597d ( [\u8bed\u97f3\u6d88\u606f\uff0c\u70b9\u51fb\u6536\u542c] 2'' ))) \u6b64 CQ \u7801\u53ea\u80fd\u7528\u4e8e\u5355\u72ec\u4e00\u6761\u6587\u672c\u6d88\u606f\u4e2d\uff0c\u5982\u679c\u6df7\u6709\u5176\u4ed6\u5b57\u7b26\u4e32\uff0c\u5219\u4f1a\u541e\u6389\u5176\u4ed6\u5b57\u7b26\u4e32\u5185\u5bb9\u3002 CQ::at() - \u7fa4\u91cc@\u67d0\u4eba\u6216\u5168\u4f53 \u5728\u7fa4\u91cc at \u67d0\u4e2a\u4eba\u6216\u5168\u4f53\u6210\u5458\uff08\u5168\u4f53\u6210\u5458\u9700\u8981\u6709\u7ba1\u7406\u5458\u6743\u9650\uff09\u3002 \u5b9a\u4e49\uff1a CQ::at($qq) \u53c2\u6570\uff1a $qq \u53c2\u6570\u5fc5\u586b\uff0c\u5982\u679c\u586b\u7684\u662f QQ \u53f7\uff0c\u5219\u662f\u5355\u72ec at \u67d0\u4eba\uff0c\u5982\u679c\u662f all \uff0c\u5219\u662f at \u5168\u4f53\u6210\u5458\u3002 1 2 3 4 5 6 /** * @CQCommand(\"at\u6d4b\u8bd5\") */ public function atTest() { ctx()->reply(CQ::at(627577391).\" \u4f60\u597d\u554a\uff01\"); } ) at\u6d4b\u8bd5 ( @\u9cb8\u9c7c \u4f60\u597d\u554a\uff01 CQ::video() - \u53d1\u9001\u77ed\u89c6\u9891 \u53d1\u9001\u77ed\u89c6\u9891\u3002 \u5b9a\u4e49\uff1a CQ::video($file, $cache = true, $proxy = true, $timeout = -1) \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u9ed8\u8ba4\u503c \u8bf4\u660e file \u2713 \u2713 \u5fc5\u586b \u77ed\u89c6\u9891\u6587\u4ef6\u540d cache \u2713 true \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u8868\u793a\u662f\u5426\u4f7f\u7528\u5df2\u7f13\u5b58\u7684\u6587\u4ef6\uff0c\u9ed8\u8ba4 true proxy \u2713 true \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u8868\u793a\u662f\u5426\u901a\u8fc7\u4ee3\u7406\u4e0b\u8f7d\u6587\u4ef6\uff08\u9700\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6216\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u4ee3\u7406\uff09\uff0c\u9ed8\u8ba4 true timeout \u2713 -1 \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u5355\u4f4d\u79d2\uff0c\u8868\u793a\u4e0b\u8f7d\u7f51\u7edc\u6587\u4ef6\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4 -1 \u4e0d\u8d85\u65f6 \u53d1\u9001\u65f6\uff0c file \u53c2\u6570\u9664\u4e86\u652f\u6301\u4f7f\u7528\u6536\u5230\u7684\u89c6\u9891\u6587\u4ef6\u540d\u76f4\u63a5\u53d1\u9001\u5916\uff0c\u8fd8\u652f\u6301\u5176\u5b83\u5f62\u5f0f\uff0c\u53c2\u8003\u4e0a\u65b9\u53d1\u9001\u56fe\u7247\u3002 \u6b64 CQ \u7801\u53ea\u80fd\u7528\u4e8e\u5355\u72ec\u4e00\u6761\u6587\u672c\u6d88\u606f\u4e2d\uff0c\u5982\u679c\u6df7\u6709\u5176\u4ed6\u5b57\u7b26\u4e32\uff0c\u5219\u4f1a\u541e\u6389\u5176\u4ed6\u5b57\u7b26\u4e32\u5185\u5bb9\u3002 CQ::rps() - \u731c\u62f3 \u5b9a\u4e49\uff1a CQ::rps() \u7528\u6cd5\uff1a CQ::rps() \u6b64 CQ \u7801\u53ea\u80fd\u7528\u4e8e\u5355\u72ec\u4e00\u6761\u6587\u672c\u6d88\u606f\u4e2d\uff0c\u5982\u679c\u6df7\u6709\u5176\u4ed6\u5b57\u7b26\u4e32\uff0c\u5219\u4f1a\u541e\u6389\u5176\u4ed6\u5b57\u7b26\u4e32\u5185\u5bb9\u3002 CQ::dice() - \u63b7\u9ab0\u5b50 \u5b9a\u4e49\uff1a CQ::dice() \u7528\u6cd5\uff1a CQ::dice() \u6b64 CQ \u7801\u53ea\u80fd\u7528\u4e8e\u5355\u72ec\u4e00\u6761\u6587\u672c\u6d88\u606f\u4e2d\uff0c\u5982\u679c\u6df7\u6709\u5176\u4ed6\u5b57\u7b26\u4e32\uff0c\u5219\u4f1a\u541e\u6389\u5176\u4ed6\u5b57\u7b26\u4e32\u5185\u5bb9\u3002 CQ::shake() - \u7a97\u53e3\u6296\u52a8 \u5b9a\u4e49\uff1a CQ::shake() \u7528\u6cd5\uff1a CQ::shake() \u6b64 CQ \u7801\u53ea\u80fd\u7528\u4e8e\u5355\u72ec\u4e00\u6761\u6587\u672c\u6d88\u606f\u4e2d\uff0c\u5982\u679c\u6df7\u6709\u5176\u4ed6\u5b57\u7b26\u4e32\uff0c\u5219\u4f1a\u541e\u6389\u5176\u4ed6\u5b57\u7b26\u4e32\u5185\u5bb9\u3002 CQ::poke() - \u6233\u4e00\u6233 \u53d1\u9001\u6233\u4e00\u6233\u3002 \u5b9a\u4e49\uff1a CQ::poke($type, $id, $name = \"\") \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u53ef\u80fd\u7684\u503c \u8bf4\u660e type \u2713 \u2713 \u89c1 Mirai \u7684 PokeMessage \u7c7b \u7c7b\u578b id \u2713 \u2713 \u540c\u4e0a ID name \u2713 \u540c\u4e0a \u8868\u60c5\u540d \u4f8b\u5b50\uff1a CQ::poke(6,-1) \u6548\u679c\uff1a\u653e\u5927\u62db \u6b64 CQ \u7801\u53ea\u80fd\u7528\u4e8e\u5355\u72ec\u4e00\u6761\u6587\u672c\u6d88\u606f\u4e2d\uff0c\u5982\u679c\u6df7\u6709\u5176\u4ed6\u5b57\u7b26\u4e32\uff0c\u5219\u4f1a\u541e\u6389\u5176\u4ed6\u5b57\u7b26\u4e32\u5185\u5bb9\u3002 CQ::anonymous() - \u533f\u540d\u53d1\u6d88\u606f \u533f\u540d\u53d1\u6d88\u606f\u3002\u9700\u8981\u5728\u5141\u8bb8\u533f\u540d\u53d1\u6d88\u606f\u7684\u7fa4\u91cc\u53d1\u3002 \u63d0\u793a \u5f53\u6536\u5230\u533f\u540d\u6d88\u606f\u65f6\uff0c\u9700\u8981\u901a\u8fc7 \u6d88\u606f\u4e8b\u4ef6\u7684\u7fa4\u6d88\u606f \u7684 anonymous \u5b57\u6bb5\u5224\u65ad\u3002 \u5b9a\u4e49\uff1a CQ::anonymous($ignore = 1) 1 2 3 4 5 6 /** * @CQCommand(\"\u533f\u540d\u6d4b\u8bd5\") */ public function anonymousTest() { ctx()->reply(CQ::anonymous().\"\u533f\u540d\u6d4b\u8bd5\"); } CQ::share() - \u94fe\u63a5\u5206\u4eab \u53d1\u9001\u94fe\u63a5\u5206\u4eab\u5361\u7247\uff0c\u53ef\u81ea\u5b9a\u4e49\u5185\u5bb9\u3002 \u5b9a\u4e49\uff1a CQ::share($url, $title, $content = null, $image = null) \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u53ef\u80fd\u7684\u503c \u8bf4\u660e url \u2713 \u2713 - URL title \u2713 \u2713 - \u6807\u9898 content \u2713 \u2713 - \u53ef\u9009\uff0c\u5185\u5bb9\u63cf\u8ff0 image \u2713 \u2713 - \u53ef\u9009\uff0c\u56fe\u7247 URL 1 2 3 4 5 6 /** * @CQCommand(\"\u94fe\u63a5\u5206\u4eab\u6d4b\u8bd5\") */ public function shareTest() { ctx()->reply(CQ::share(\"https://baidu.com\", \"UC\u5ffd\u60a0\u90e8\", \"\u9707\u60ca\uff01\u6211\u5e02\u4e00\u7537\u5b50\u5728\u5149\u5929\u5316\u65e5\u4e4b\u4e0b...\")); } CQ::contact() - \u63a8\u8350\u597d\u53cb \u53d1\u9001\u63a8\u8350\u597d\u53cb\u7684\u5361\u7247\u3002 \u5b9a\u4e49\uff1a CQ::contact($type, $id) \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u53ef\u80fd\u7684\u503c \u8bf4\u660e type \u2713 \u2713 qq \uff0c group \u63a8\u8350\u597d\u53cb\u6216\u7fa4 id \u2713 \u2713 - \u88ab\u63a8\u8350\u4eba\u7684 QQ \u53f7\u6216\u7fa4\u53f7 1 2 3 4 5 6 /** * @CQCommand(\"\u6211\u7684\u540d\u7247\") */ public function myCard() { ctx()->reply(CQ::contact(\"qq\", ctx()->getUserId())); } CQ::location() - \u53d1\u9001\u4f4d\u7f6e \u53d1\u9001\u4f4d\u7f6e\uff0c\u57fa\u4e8e\u7ecf\u7eac\u5ea6\u5750\u6807\u53d1\u7684\u3002 \u5b9a\u4e49\uff1a CQ::location($lat, $lon, $title = \"\", $content = \"\") \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u53ef\u80fd\u7684\u503c \u8bf4\u660e lat \u2713 \u2713 - \u7eac\u5ea6 lon \u2713 \u2713 - \u7ecf\u5ea6 title \u2713 \u2713 - \u53ef\u9009\uff0c\u6807\u9898 content \u2713 \u2713 - \u53ef\u9009\uff0c\u5185\u5bb9\u63cf\u8ff0 CQ::music() - \u97f3\u4e50\u5206\u4eab \u5206\u4eab\u97f3\u4e50\uff0c\u901a\u8fc7\u5361\u7247\u3002 \u53d1\u9001\u97f3\u4e50\u5206\u4eab\u5361\u7247\u3002\u6b64 CQ \u7801\u5982\u679c\u4f34\u968f\u7740\u5176\u4ed6\u6587\u5b57\uff0c\u5219\u6587\u5b57\u5185\u5bb9\u4f1a\u88ab\u4e22\u5f03\u3002 \u5b9a\u4e49\uff1a CQ::music($type, $id_or_url, $audio = null, $title = null, $content = null, $image = null) $type : \u53d1\u9001\u7c7b\u578b $id_or_url : \u97f3\u4e50\u7684 id \u6216 \u97f3\u4e50\u5361\u7247\u70b9\u8fdb\u53bb\u6253\u5f00\u7684\u94fe\u63a5 $audio : \u97f3\u9891\u6587\u4ef6\u7684 HTTP \u5730\u5740 $title : \u97f3\u4e50\u5361\u7247\u7684\u6807\u9898\uff0c\u5efa\u8bae 12 \u5b57\u4ee5\u5185 $content : \u97f3\u4e50\u5361\u7247\u7684\u7b80\u4ecb\u5185\u5bb9\uff08\u53ef\u9009\uff09 $image : \u97f3\u4e50\u5361\u7247\u7684\u56fe\u7247\u7684\u94fe\u63a5\u5730\u5740\uff08\u53ef\u9009\uff09 \u5982\u679c $type \u53c2\u6570\u4e3a qq \u6216 163 \u6216 xiami \uff0c\u5219\u5fc5\u987b\u4e14\u53ea\u548c\u7b2c\u4e8c\u4e2a\u53c2\u6570 $id_or_url \u914d\u5408\u4f7f\u7528\u3002\u8fd9\u4e09\u4e2a\u4e3a\u5185\u7f6e\u5206\u4eab\uff0c\u9700\u8981\u5148\u901a\u8fc7\u641c\u7d22\u529f\u80fd\u83b7\u53d6\u5bf9\u5e94\u5e73\u53f0\u6b4c\u66f2\u7684 id \u540e\u4f7f\u7528\u3002 \u5982\u679c $type \u53c2\u6570\u4e3a custom \uff0c\u5219\u8868\u660e\u6b64\u97f3\u4e50\u5361\u7247\u4e3a\u7528\u6237\u81ea\u5b9a\u4e49\uff0c\u4f60\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u81ea\u5b9a\u4e49\u5361\u7247\u5185\u5bb9\u548c\u97f3\u9891\u3002\u6b64\u65f6\u5fc5\u987b\u586b\u5199 $id_or_url , $audio , $title \u4e09\u4e2a\u53c2\u6570\u3002 1 2 3 4 5 ctx()->reply(CQ::music(\"163\", \"730806\")); //\u4e00\u9996\u6211\u559c\u6b22\u7684\u6b4c // \u4ee5\u5185\u7f6e\u7684\u53d1\u9001\u7c7b\u578b\u53d1\u9001\u97f3\u4e50\u5361\u7247\uff0c\u6211\u8fd9\u91cc\u6311\u4e86\u7f51\u6613\u4e91\u97f3\u4e50\u7684\u4e00\u9996\u6b4c\u3002 ctx()->reply(\"custom\", \"https://baidu.com/\", \"https://zhamao.xin/file/hello.mp3\", \"\u6211\u662fSiri\u8bf4\u51fa\u6765\u7684Hello\", \"\u4e0d\u670d\u6765\u6253\u6211\u5440\uff01\", \"https://zhamao.xin/file/hello.jpg\"); // \u81ea\u5b9a\u4e49\u6574\u4e2a\u5361\u7247\u7684\u6bcf\u4e2a\u5185\u5bb9 CQ::forward() - \u5408\u5e76\u8f6c\u53d1 \u5408\u5e76\u8f6c\u53d1\u6d88\u606f\u3002 \u5b9a\u4e49\uff1a CQ::forward($id) \u53c2\u6570 1 [CQ:forward,id=123456] \u53c2\u6570\u540d \u6536 \u53d1 \u53ef\u80fd\u7684\u503c \u8bf4\u660e id \u2713 \u5fc5\u586b \u5408\u5e76\u8f6c\u53d1 ID\uff0c\u9700\u901a\u8fc7 get_forward_msg API \u83b7\u53d6\u5177\u4f53\u5185\u5bb9 CQ::node() - \u5408\u5e76\u8f6c\u53d1\u81ea\u5b9a\u4e49\u8282\u70b9 \u63a5\u6536\u65f6\uff0c\u6b64\u6d88\u606f\u6bb5\u4e0d\u4f1a\u76f4\u63a5\u51fa\u73b0\u5728\u6d88\u606f\u4e8b\u4ef6\u7684 message \u4e2d\uff0c\u9700\u901a\u8fc7 get_forward_msg API \u83b7\u53d6\u3002\u53d1\u9001\u65f6\uff0c\u901a\u8fc7\u83b7\u53d6\u56de\u6765\u7684 API \u8282\u70b9\u4fe1\u606f\u8fdb\u884c\u53d1\u9001\u3002 \u5b9a\u4e49\uff1a CQ::node($user_id, $nickname, $content) \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u53ef\u80fd\u7684\u503c \u8bf4\u660e user_id \u2713 \u2713 - \u53d1\u9001\u8005 QQ \u53f7 nickname \u2713 \u2713 - \u53d1\u9001\u8005\u6635\u79f0 content \u2713 \u2713 - \u6d88\u606f\u5185\u5bb9\uff0c\u652f\u6301\u53d1\u9001\u6d88\u606f\u65f6\u7684 message \u6570\u636e\u7c7b\u578b\uff0c\u89c1 API \u7684\u53c2\u6570 1 2 3 4 5 6 /** * @CQCommand(\"node\u6d4b\u8bd5\") */ public function nodeTest() { ctx()->reply(CQ::node(123456, \"Jack\", \"[CQ:face,id=123]\u54c8\u55bd\uff5e\")); } CQ::xml() - XML \u6d88\u606f \u53d1\u9001 QQ \u517c\u5bb9\u7684 XML \u591a\u5a92\u4f53\u6d88\u606f\u3002 \u5b9a\u4e49\uff1a CQ::xml($data) \u53c2\u6570\uff1a $data \u4e3a xml \u5b57\u7b26\u4e32 1 2 3 4 5 6 /** * @CQCommand(\"xml\u6d4b\u8bd5\") */ public function xmlTest() { ctx()->reply(CQ::xml(\" <? xml ... \")); } CQ::json() - JSON \u6d88\u606f \u53d1\u9001 QQ \u517c\u5bb9\u7684 JSON \u591a\u5a92\u4f53\u6d88\u606f\u3002 \u5b9a\u4e49\uff1a CQ::json($data, $resid = 0) \u53c2\u6570\u540c\u4e0a\uff0c\u5185\u542b JSON \u5b57\u7b26\u4e32\u5373\u53ef\u3002 \u5176\u4e2d $resid \u662f\u9762\u5411 go-cqhttp \u6269\u5c55\u7684\u53c2\u6570\uff0c\u9ed8\u8ba4\u4e0d\u586b\u4e3a 0\uff0c\u8d70\u5c0f\u7a0b\u5e8f\u901a\u9053\uff0c\u586b\u4e86\u8d70\u5bcc\u6587\u672c\u901a\u9053\u53d1\u9001\u3002 \u63d0\u793a \u56e0\u4e3a\u67d0\u4e9b\u4f17\u6240\u5468\u77e5\u7684\u539f\u56e0\uff0cXML \u548c JSON \u7684\u8fd4\u56de\u4e0d\u63d0\u4f9b\u5b9e\u4f8b\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u81ea\u884c\u7814\u7a76\u5982\u4f55\u7f16\u5199\uff0c\u6587\u6863\u4e0d\u542b\u4efb\u4f55\u76f8\u5173\u6559\u7a0b\u3002 CQ::_custom() - \u6269\u5c55\u81ea\u5b9a\u4e49 CQ \u7801 \u7528\u4e8e\u517c\u5bb9\u5404\u7c7b\u542b\u6709\u88ab\u652f\u6301\u7684\u6269\u5c55 CQ \u7801\uff0c\u6bd4\u5982 go-cqhttp \u7684 [CQ:gift] \u793c\u7269\u7c7b\u578b\u3002 \u5b9a\u4e49\uff1a CQ::_custom(string $type_name, array $params) \u53c2\u6570\u540d \u8bf4\u660e type_name CQ \u7801\u7c7b\u578b\uff0c\u5982 music \uff0c at params \u53d1\u9001\u7684 CQ \u7801\u4e2d\u7684\u53c2\u6570\u6570\u7ec4\uff0c\u4f8b\u5982 [\"qq\" => \"123456\"] \u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\uff1a 1 2 CQ::_custom(\"at\",[\"qq\" => \"123456\",\"qwe\" => \"asd\"]); // \u8fd4\u56de\uff1a[CQ:at,qq=123456,qwe=asd]","title":"CQ \u7801\uff08\u591a\u5a92\u4f53\u6d88\u606f\uff09"},{"location":"component/bot/cqcode/#cq","text":"\u6d88\u606f\u4e2d\u7684\u591a\u5a92\u4f53\u5185\u5bb9\u4f7f\u7528 CQ \u7801\u6765\u8868\u793a\uff0c\u5f62\u5982 [CQ:face,id=178] \u3002\u5176\u4e2d\uff0c [CQ:] \u662f\u56fa\u5b9a\u683c\u5f0f\uff1b face \u662f\u300c\u529f\u80fd\u540d\u300d\uff0c\u9664\u4e86 face \u8fd8\u6709\u8bb8\u591a\u4e0d\u540c\u7684\u529f\u80fd\u540d\uff1b id=178 \u662f\u300c\u53c2\u6570\u300d\uff0c\u67d0\u4e9b\u529f\u80fd\u4e0d\u9700\u8981\u53c2\u6570\uff0c\u800c\u53e6\u4e00\u4e9b\u9700\u8981\u591a\u4e2a\u53c2\u6570\uff0c\u5f53\u6709\u591a\u4e2a\u53c2\u6570\u65f6\uff0c\u53c2\u6570\u95f4\u4f7f\u7528\u9017\u53f7\u5206\u9694\u3002","title":"CQ \u7801\uff08\u591a\u5a92\u4f53\u6d88\u606f\uff09"},{"location":"component/bot/cqcode/#_1","text":"\u4e00\u4e9b CQ \u7801\u7684\u4f8b\u5b50\u5982\u4e0b\uff1a 1 2 3 [CQ:shake] [CQ:face,id=178] [CQ:share,title=\u6807\u9898,url=http://baidu.com] \u66f4\u591a CQ \u7801\u529f\u80fd\u8bf7\u53c2\u8003 \u6d88\u606f\u6bb5\u7c7b\u578b \u3002 \u6ce8\u610f CQ \u7801\u4e2d\u4e0d\u5e94\u6709\u591a\u4f59\u7684\u7a7a\u683c\uff0c\u4f8b\u5982\u4e0d\u5e94\u8be5\u4f7f\u7528 [CQ:face, id=178] \u3002 CQ \u7801\u7684\u53c2\u6570\u503c\u53ef\u4ee5\u5305\u542b\u7a7a\u683c\u3001\u6362\u884c\u3001\u9664 [],& \u4e4b\u5916\u7684\u7279\u6b8a\u7b26\u53f7\u7b49\u3002\u5728\u89e3\u6790\u65f6\uff0c\u5e94\u76f4\u63a5\u53d6 [CQ: \u540e\u3001\u7b2c\u4e00\u4e2a , \u6216 ] \u524d\u7684\u90e8\u5206\u4e3a\u529f\u80fd\u540d\uff0c\u7b2c\u4e00\u4e2a , \u4e4b\u540e\u5230 ] \u4e4b\u95f4\u7684\u90e8\u5206\u4e3a\u53c2\u6570\uff0c\u6309 , \u5206\u5272\u540e\uff0c\u6bcf\u4e2a\u90e8\u5206\u7b2c\u4e00\u4e2a = \u524d\u7684\u5185\u5bb9\u4e3a\u53c2\u6570\u540d\uff0c\u4e4b\u540e\u7684\u90e8\u5206\u4e3a\u53c2\u6570\u503c\u3002\u4f8b\u5982 [CQ:share,title=\u6807\u9898\u4e2d\u6709=\u7b49\u53f7,url=http://baidu.com] \u4e2d\uff0c\u529f\u80fd\u540d\u4e3a share \uff0c title \u53c2\u6570\u503c\u4e3a \u6807\u9898\u4e2d\u6709=\u7b49\u53f7 \uff0c url \u53c2\u6570\u503c\u4e3a http://baidu.com \u3002","title":"\u683c\u5f0f"},{"location":"component/bot/cqcode/#_2","text":"CQ \u7801\u4e2d\u5305\u542b\u4e00\u4e9b\u7279\u6b8a\u5b57\u7b26\uff1a [ \u3001 ] \u3001 , \u7b49\uff0c\u800c CQ \u7801\u53c8\u662f\u53ef\u80fd\u6df7\u6742\u5728\u7eaf\u6587\u672c\u5185\u5bb9\u4e4b\u4e2d\u7684\uff0c\u56e0\u6b64\u6d88\u606f\u4e2d\u7684\u7eaf\u6587\u672c\u5185\u5bb9\u9700\u8981\u5bf9\u7279\u6b8a\u5b57\u7b26\u8fdb\u884c\u8f6c\u4e49\uff0c\u4ee5\u907f\u514d\u6b67\u4e49\u3002\u5177\u4f53\u7684\u8f6c\u4e49\u89c4\u5219\u5982\u4e0b\uff1a \u8f6c\u4e49\u524d \u8f6c\u4e49\u540e & &amp; [ &#91; ] &#93; \u53e6\u4e00\u65b9\u9762\uff0cCQ \u7801\u5185\u90e8\u7684\u53c2\u6570\u503c\u4e5f\u53ef\u80fd\u51fa\u73b0\u7279\u6b8a\u5b57\u7b26\uff0c\u4e5f\u662f\u9700\u8981\u8f6c\u4e49\u7684\u3002\u7531\u4e8e , \uff08\u534a\u89d2\u9017\u53f7\uff09\u5728 CQ \u7801\u4e2d\u7528\u4e8e\u5206\u9694\u53c2\u6570\uff0c\u56e0\u6b64\u9664\u4e86\u4e0a\u9762\u7684\u8f6c\u4e49\u89c4\u5219\uff0c\u8fd8\u9700\u8981\u5bf9 , \u8fdb\u884c\u8f6c\u4e49\uff0c\u5982\u4e0b\uff1a \u8f6c\u4e49\u524d \u8f6c\u4e49\u540e & &amp; [ &#91; ] &#93; , &#44; \u4f8b\u5982\uff0c\u4e00\u4e2a\u94fe\u63a5\u5206\u4eab\u6d88\u606f\u7684 CQ \u7801\u53ef\u80fd\u5982\u4e0b\uff1a 1 [CQ:share,title=\u9707\u60ca&#44;\u5c0f\u4f19\u7761\u89c9\u524d\u5c45\u7136...,url=http://baidu.com/?a=1&amp;b=2]","title":"\u8f6c\u4e49"},{"location":"component/bot/cqcode/#_3","text":"\u6846\u67b6\u63d0\u4f9b\u4e86 CQ \u7801\u7684\u5c01\u88c5\uff0c\u4f60\u53ef\u4ee5\u5728\u4efb\u4f55\u4f4d\u7f6e\u4f7f\u7528\u5c01\u88c5\u597d\u7684 CQ \u7801\u751f\u6210\u5668\u3002 \u751f\u6210\u5668\u662f\u4e00\u4e2a\u9759\u6001\u7c7b\uff0c\u91cc\u9762\u7684\u65b9\u6cd5\u5168\u90e8\u662f\u9759\u6001\u8c03\u7528\uff0c\u547d\u540d\u7a7a\u95f4\u662f\uff1a ZM\\API\\CQ \u3002 \u4f8b\u5982\uff0c\u7ed9\u7528\u6237\u53d1\u9001\u56fe\u7247\u8fd9\u6837\u5199\u5c31\u597d\u5566\uff01\u53ea\u9700\u8981\u5c06\u6dfb\u52a0\u56fe\u7247\u7684\u5730\u65b9\u62fc\u5230\u56de\u590d\u7528\u6237\u7684\u5b57\u7b26\u4e32\u91cc\u3002\u5982\u679c\u53ea\u53d1\u56fe\u7247\uff0c\u6574\u4e2a\u5b57\u7b26\u4e32\u91cc\u53ea\u80fd\u6709 CQ \u7801\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php namespace Module\\Example ; use ZM\\API\\CQ ; use ZM\\Annotation\\CQ\\CQCommand ; class Hello { /** * @CQCommand(\"\u53d1\u9001\u56fe\u7247\") */ public function msgRecv () { return CQ :: image ( \"https://zhamao.xin/file/hello.jpg\" ); // \u76f8\u5f53\u4e8e\u8fd4\u56de\uff1a\"[CQ:image,file=https://zhamao.xin/file/hello.jpg]\" } } \u6548\u679c ) \u53d1\u9001\u56fe\u7247 [ https://zhamao.xin/file/hello.jpg","title":"\u5c01\u88c5\u8c03\u7528"},{"location":"component/bot/cqcode/#cq_1","text":"","title":"CQ \u7801\u64cd\u4f5c"},{"location":"component/bot/cqcode/#cqdecode","text":"CQ \u7801\u5b57\u7b26\u53cd\u8f6c\u4e49\u3002 \u5b9a\u4e49\uff1a CQ::encode($msg, $is_content = false) \u5f53 $is_content \u4e3a true \u65f6\uff0c\u4f1a\u5c06 &#44; \u8f6c\u4e49\u4e3a , \u3002 \u53cd\u8f6c\u4e49\u524d \u53cd\u8f6c\u4e49\u540e &amp; & &#91; [ &#93; ] &#44; , 1 2 $str = CQ::decode(\"&#91;CQ:at,qq=\u6211\u53ea\u662f\u4e00\u6761\u666e\u901a\u7684\u6587\u672c&#93;\"); // \u8f6c\u6362\u4e3a \"[CQ:at,qq=\u6211\u53ea\u662f\u4e00\u6761\u666e\u901a\u7684\u6587\u672c]\"","title":"CQ::decode()"},{"location":"component/bot/cqcode/#cqencode","text":"\u8f6c\u4e49 CQ \u7801\u7684\u654f\u611f\u7b26\u53f7\uff0c\u9632\u6b62 \u9177Q \u628a\u4e0d\u8be5\u89e3\u6790\u4e3a CQ \u7801\u7684\u6d88\u606f\u5185\u5bb9\u5f53\u4f5c CQ \u7801\u5904\u7406\u3002 1 2 $str = CQ::encode(\"[CQ:\u6211\u53ea\u662f\u4e00\u6761\u666e\u901a\u7684\u6587\u672c]\"); // $str: \"&#91;CQ:\u6211\u53ea\u662f\u4e00\u6761\u666e\u901a\u7684\u6587\u672c&#93;\" \u5b9a\u4e49\uff1a CQ::encode($msg, $is_content = false) \u5f53 $is_content \u4e3a true \u65f6\uff0c\u4f1a\u5c06 , \u8f6c\u4e49\u4e3a &#44; \u3002","title":"CQ::encode()"},{"location":"component/bot/cqcode/#cqescape","text":"\u540c CQ::encode() \u3002","title":"CQ::escape()"},{"location":"component/bot/cqcode/#cqremovecq","text":"\u53bb\u9664\u5b57\u7b26\u4e32\u4e2d\u6240\u6709\u7684 CQ \u7801\u3002 1 2 $str = CQ::removeCQ(\"[CQ:at,qq=all]\u8fd9\u662f\u5e26\u8868\u60c5\u7684\u5168\u4f53\u6d88\u606f[CQ:face,id=8]\"); // $str: \"\u8fd9\u662f\u5e26\u8868\u60c5\u7684\u5168\u4f53\u6d88\u606f\"","title":"CQ::removeCQ()"},{"location":"component/bot/cqcode/#cqgetcq","text":"\u89e3\u6790 CQ \u7801\u3002 \u5b9a\u4e49\uff1a getCQ($msg, $is_object = false) \u53c2\u6570 $is_object \u4e3a true \u65f6\uff0c\u8fd4\u56de\u4e00\u4e2a \\ZM\\Entity\\CQObject \u5bf9\u8c61\uff0c\u6b64\u5bf9\u8c61\u7684\u5c5e\u6027\u548c\u4e0b\u8868\u76f8\u540c\u3002\uff082.3.0+ \u7248\u672c\u53ef\u7528\uff09 \u8fd4\u56de\uff1a \u6570\u7ec4 | CQObject | null \uff0c\u89c1\u4e0b\u8868\u3002 \u952e\u540d \u8bf4\u660e type CQ\u7801\u7c7b\u578b\uff0c\u6bd4\u5982 [CQ:at] \u4e2d\u7684 at params \u53c2\u6570\u5217\u8868\uff0c\u6bd4\u5982 [CQ:image,file=123.jpg,url=http://a.com/a.jpg] \uff0cparams \u4e3a [\"file\" => \"123\",\"url\" => \"http://a.com/a.jpg\"] start \u6b64 CQ \u7801\u5728\u5b57\u7b26\u4e32\u4e2d\u7684\u8d77\u59cb\u4f4d\u7f6e end \u6b64 CQ \u7801\u5728\u5b57\u7b26\u4e32\u4e2d\u7684\u7ed3\u675f\u4f4d\u7f6e","title":"CQ::getCQ()"},{"location":"component/bot/cqcode/#cqgetallcq","text":"\u5b9a\u4e49\uff1a CQ::getAllCQ($msg, $is_object = false) \u53c2\u6570 $is_object \u4e3a true \u65f6\uff0c\u8fd4\u56de\u4e00\u4e2a \\ZM\\Entity\\CQObject[] \u5bf9\u8c61\u6570\u7ec4\uff0c\u6b64\u5bf9\u8c61\u7684\u5c5e\u6027\u548c\u4e0a\u9762\u7684\u8868\u683c\u5185\u76f8\u540c\u3002\uff082.3.0+ \u7248\u672c\u53ef\u7528\uff09 \u89e3\u6790 CQ \u7801\uff0c\u548c getCQ() \u7684\u533a\u522b\u662f\uff0c\u8fd9\u4e2a\u4f1a\u5c06\u5b57\u7b26\u4e32\u4e2d\u7684\u6240\u6709 CQ \u7801\u90fd\u89e3\u6790\u51fa\u6765\uff0c\u5e76\u4ee5\u540c\u6837\u4e0a\u65b9\u89e3\u6790\u51fa\u6765\u7684\u6570\u7ec4\u683c\u5f0f\u8fd4\u56de\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 CQ::getAllCQ(\"[CQ:at,qq=123]\u4f60\u597d\u554a[CQ:at,qq=456]\"); /* [ [ \"type\" => \"at\", \"params\" => [ \"qq\" => \"123\", ], \"start\" => 0, \"end\" => 13, ], [ \"type\" => \"at\", \"params\" => [ \"qq\" => \"456\", ], \"start\" => 17, \"end\" => 30, ], ] */","title":"CQ::getAllCQ()"},{"location":"component/bot/cqcode/#cq_2","text":"","title":"CQ \u7801\u5217\u8868"},{"location":"component/bot/cqcode/#cqface-qq","text":"\u53d1\u9001 QQ \u539f\u751f\u8868\u60c5\u3002 \u5b9a\u4e49\uff1a CQ::face($id) \u53c2\u6570\uff1a $id \u4e3a QQ \u8868\u60c5\u5bf9\u5e94\u7684 ID \u53f7\uff0c\u4e00\u4e9b\u5e38\u89c1\u7684\u8868\u60c5 ID \u5bf9\u5e94\u7684\u8868\u60c5\u6837\u5f0f\u89c1 QQ \u5bf9\u5e94\u8868\u60c5ID\u8868 \u3002 1 2 3 4 5 6 7 /** * @CQCommand(\"\u6253\u76f9\") */ public function faceTest() { ctx()->reply(\"\u6b63\u5728\u6253\u76f9...\"); ctx()->reply(CQ::face(8)); } ) \u6253\u76f9 ( \u6b63\u5728\u6253\u76f9... [ https://docs-v1.zhamao.xin/face/8.gif \u63d0\u793a \u5bf9\u4e8e\u4e0d\u65ad\u66f4\u65b0\u7684 QQ \u7248\u672c\u4e0b\uff0c\u53ef\u80fd\u4f1a\u6301\u7eed\u6269\u5145\u65b0\u7684 QQ \u8868\u60c5\uff0c\u5982\u679c\u4e0a\u8868\u6ca1\u6709\u65b0\u7684\u8868\u60c5\u7684\u8bdd\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u6d88\u606f\u63a5\u6536\u7684\u65b9\u5f0f\uff0c\u8ba9\u673a\u5668\u4eba\u6536\u5230\u8868\u60c5\u540e\u89e3\u6790\u51fa\u6765\u5bf9\u5e94\u7684 id \u7136\u540e\u518d\u53d1\u9001\u3002","title":"CQ::face() - \u53d1\u9001 QQ \u8868\u60c5"},{"location":"component/bot/cqcode/#cqimage-","text":"\u53d1\u9001\u56fe\u7247\u3002 \u5b9a\u4e49\uff1a image($file, $cache = true, $flash = false, $proxy = true, $timeout = -1) \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u9ed8\u8ba4\u503c \u8bf4\u660e file \u2713 \u2713 \u5fc5\u586b \u56fe\u7247\u6587\u4ef6\u540d flash \u2713 \u2713 false \u56fe\u7247\u7c7b\u578b\uff0c\u5f53\u53c2\u6570\u4e3a true \u65f6\u4ee3\u8868\u53d1\u9001\u95ea\u7167 cache \u2713 true \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u8868\u793a\u662f\u5426\u4f7f\u7528\u5df2\u7f13\u5b58\u7684\u6587\u4ef6\uff0c\u9ed8\u8ba4 true proxy \u2713 true \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u8868\u793a\u662f\u5426\u901a\u8fc7\u4ee3\u7406\u4e0b\u8f7d\u6587\u4ef6\uff08\u9700\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6216\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u4ee3\u7406\uff09\uff0c\u9ed8\u8ba4 true timeout \u2713 -1 \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u5355\u4f4d\u79d2\uff0c\u8868\u793a\u4e0b\u8f7d\u7f51\u7edc\u6587\u4ef6\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4 -1 \u4e0d\u8d85\u65f6 \u53d1\u9001\u65f6\uff0c file \u53c2\u6570\u9664\u4e86\u652f\u6301\u4f7f\u7528\u6536\u5230\u7684\u56fe\u7247\u6587\u4ef6\u540d\u76f4\u63a5\u53d1\u9001\u5916\uff0c\u8fd8\u652f\u6301\uff1a \u7edd\u5bf9\u8def\u5f84\uff0c\u4f8b\u5982 file:///root/imagetest/1.png \uff0c\u683c\u5f0f\u4f7f\u7528 file URI \u7f51\u7edc URL\uff0c\u4f8b\u5982 http://i1.piimg.com/567571/fdd6e7b6d93f1ef0.jpg Base64 \u7f16\u7801\uff0c\u4f8b\u5982 base64://iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAAKElEQVQ4EWPk5+RmIBcwkasRpG9UM4mhNxpgowFGMARGEwnBIEJVAAAdBgBNAZf+QAAAAABJRU5ErkJggg==","title":"CQ::image() - \u53d1\u9001\u56fe\u7247"},{"location":"component/bot/cqcode/#cqrecord-","text":"\u53d1\u9001\u8bed\u97f3\u6d88\u606f\u3002 \u5b9a\u4e49\uff1a CQ::record($file, $magic = false, $cache = true, $proxy = true, $timeout = -1) \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u9ed8\u8ba4\u503c \u8bf4\u660e file \u2713 \u2713 \u5fc5\u586b \u97f3\u9891\u6587\u4ef6\u540d flash \u2713 \u2713 false \u56fe\u7247\u7c7b\u578b\uff0c\u5f53\u53c2\u6570\u4e3a true \u65f6\u4ee3\u8868\u53d1\u9001\u95ea\u7167 cache \u2713 true \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u8868\u793a\u662f\u5426\u4f7f\u7528\u5df2\u7f13\u5b58\u7684\u6587\u4ef6\uff0c\u9ed8\u8ba4 true proxy \u2713 true \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u8868\u793a\u662f\u5426\u901a\u8fc7\u4ee3\u7406\u4e0b\u8f7d\u6587\u4ef6\uff08\u9700\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6216\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u4ee3\u7406\uff09\uff0c\u9ed8\u8ba4 true timeout \u2713 -1 \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u5355\u4f4d\u79d2\uff0c\u8868\u793a\u4e0b\u8f7d\u7f51\u7edc\u6587\u4ef6\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4 -1 \u4e0d\u8d85\u65f6 \u53d1\u9001\u65f6\uff0c file \u53c2\u6570\u9664\u4e86\u652f\u6301\u4f7f\u7528\u6536\u5230\u7684\u8bed\u97f3\u6587\u4ef6\u540d\u76f4\u63a5\u53d1\u9001\u5916\uff0c\u8fd8\u652f\u6301\u5176\u5b83\u5f62\u5f0f\uff0c\u53c2\u8003\u4e0a\u65b9\u53d1\u9001\u56fe\u7247\u3002 1 2 3 4 5 6 /** * @CQCommand(\"\u8bf4\u4f60\u597d\") */ public function say() { ctx()->reply(CQ::record(\"https://zhamao.xin/file/hello.mp3\")); } ) \u8bf4\u4f60\u597d ( [\u8bed\u97f3\u6d88\u606f\uff0c\u70b9\u51fb\u6536\u542c] 2'' ))) \u6b64 CQ \u7801\u53ea\u80fd\u7528\u4e8e\u5355\u72ec\u4e00\u6761\u6587\u672c\u6d88\u606f\u4e2d\uff0c\u5982\u679c\u6df7\u6709\u5176\u4ed6\u5b57\u7b26\u4e32\uff0c\u5219\u4f1a\u541e\u6389\u5176\u4ed6\u5b57\u7b26\u4e32\u5185\u5bb9\u3002","title":"CQ::record() - \u53d1\u9001\u8bed\u97f3"},{"location":"component/bot/cqcode/#cqat-","text":"\u5728\u7fa4\u91cc at \u67d0\u4e2a\u4eba\u6216\u5168\u4f53\u6210\u5458\uff08\u5168\u4f53\u6210\u5458\u9700\u8981\u6709\u7ba1\u7406\u5458\u6743\u9650\uff09\u3002 \u5b9a\u4e49\uff1a CQ::at($qq) \u53c2\u6570\uff1a $qq \u53c2\u6570\u5fc5\u586b\uff0c\u5982\u679c\u586b\u7684\u662f QQ \u53f7\uff0c\u5219\u662f\u5355\u72ec at \u67d0\u4eba\uff0c\u5982\u679c\u662f all \uff0c\u5219\u662f at \u5168\u4f53\u6210\u5458\u3002 1 2 3 4 5 6 /** * @CQCommand(\"at\u6d4b\u8bd5\") */ public function atTest() { ctx()->reply(CQ::at(627577391).\" \u4f60\u597d\u554a\uff01\"); } ) at\u6d4b\u8bd5 ( @\u9cb8\u9c7c \u4f60\u597d\u554a\uff01","title":"CQ::at() - \u7fa4\u91cc@\u67d0\u4eba\u6216\u5168\u4f53"},{"location":"component/bot/cqcode/#cqvideo-","text":"\u53d1\u9001\u77ed\u89c6\u9891\u3002 \u5b9a\u4e49\uff1a CQ::video($file, $cache = true, $proxy = true, $timeout = -1) \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u9ed8\u8ba4\u503c \u8bf4\u660e file \u2713 \u2713 \u5fc5\u586b \u77ed\u89c6\u9891\u6587\u4ef6\u540d cache \u2713 true \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u8868\u793a\u662f\u5426\u4f7f\u7528\u5df2\u7f13\u5b58\u7684\u6587\u4ef6\uff0c\u9ed8\u8ba4 true proxy \u2713 true \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u8868\u793a\u662f\u5426\u901a\u8fc7\u4ee3\u7406\u4e0b\u8f7d\u6587\u4ef6\uff08\u9700\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u6216\u914d\u7f6e\u6587\u4ef6\u914d\u7f6e\u4ee3\u7406\uff09\uff0c\u9ed8\u8ba4 true timeout \u2713 -1 \u53ea\u5728\u901a\u8fc7\u7f51\u7edc URL \u53d1\u9001\u65f6\u6709\u6548\uff0c\u5355\u4f4d\u79d2\uff0c\u8868\u793a\u4e0b\u8f7d\u7f51\u7edc\u6587\u4ef6\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4 -1 \u4e0d\u8d85\u65f6 \u53d1\u9001\u65f6\uff0c file \u53c2\u6570\u9664\u4e86\u652f\u6301\u4f7f\u7528\u6536\u5230\u7684\u89c6\u9891\u6587\u4ef6\u540d\u76f4\u63a5\u53d1\u9001\u5916\uff0c\u8fd8\u652f\u6301\u5176\u5b83\u5f62\u5f0f\uff0c\u53c2\u8003\u4e0a\u65b9\u53d1\u9001\u56fe\u7247\u3002 \u6b64 CQ \u7801\u53ea\u80fd\u7528\u4e8e\u5355\u72ec\u4e00\u6761\u6587\u672c\u6d88\u606f\u4e2d\uff0c\u5982\u679c\u6df7\u6709\u5176\u4ed6\u5b57\u7b26\u4e32\uff0c\u5219\u4f1a\u541e\u6389\u5176\u4ed6\u5b57\u7b26\u4e32\u5185\u5bb9\u3002","title":"CQ::video() - \u53d1\u9001\u77ed\u89c6\u9891"},{"location":"component/bot/cqcode/#cqrps-","text":"\u5b9a\u4e49\uff1a CQ::rps() \u7528\u6cd5\uff1a CQ::rps() \u6b64 CQ \u7801\u53ea\u80fd\u7528\u4e8e\u5355\u72ec\u4e00\u6761\u6587\u672c\u6d88\u606f\u4e2d\uff0c\u5982\u679c\u6df7\u6709\u5176\u4ed6\u5b57\u7b26\u4e32\uff0c\u5219\u4f1a\u541e\u6389\u5176\u4ed6\u5b57\u7b26\u4e32\u5185\u5bb9\u3002","title":"CQ::rps() - \u731c\u62f3"},{"location":"component/bot/cqcode/#cqdice-","text":"\u5b9a\u4e49\uff1a CQ::dice() \u7528\u6cd5\uff1a CQ::dice() \u6b64 CQ \u7801\u53ea\u80fd\u7528\u4e8e\u5355\u72ec\u4e00\u6761\u6587\u672c\u6d88\u606f\u4e2d\uff0c\u5982\u679c\u6df7\u6709\u5176\u4ed6\u5b57\u7b26\u4e32\uff0c\u5219\u4f1a\u541e\u6389\u5176\u4ed6\u5b57\u7b26\u4e32\u5185\u5bb9\u3002","title":"CQ::dice() - \u63b7\u9ab0\u5b50"},{"location":"component/bot/cqcode/#cqshake-","text":"\u5b9a\u4e49\uff1a CQ::shake() \u7528\u6cd5\uff1a CQ::shake() \u6b64 CQ \u7801\u53ea\u80fd\u7528\u4e8e\u5355\u72ec\u4e00\u6761\u6587\u672c\u6d88\u606f\u4e2d\uff0c\u5982\u679c\u6df7\u6709\u5176\u4ed6\u5b57\u7b26\u4e32\uff0c\u5219\u4f1a\u541e\u6389\u5176\u4ed6\u5b57\u7b26\u4e32\u5185\u5bb9\u3002","title":"CQ::shake() - \u7a97\u53e3\u6296\u52a8"},{"location":"component/bot/cqcode/#cqpoke-","text":"\u53d1\u9001\u6233\u4e00\u6233\u3002 \u5b9a\u4e49\uff1a CQ::poke($type, $id, $name = \"\") \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u53ef\u80fd\u7684\u503c \u8bf4\u660e type \u2713 \u2713 \u89c1 Mirai \u7684 PokeMessage \u7c7b \u7c7b\u578b id \u2713 \u2713 \u540c\u4e0a ID name \u2713 \u540c\u4e0a \u8868\u60c5\u540d \u4f8b\u5b50\uff1a CQ::poke(6,-1) \u6548\u679c\uff1a\u653e\u5927\u62db \u6b64 CQ \u7801\u53ea\u80fd\u7528\u4e8e\u5355\u72ec\u4e00\u6761\u6587\u672c\u6d88\u606f\u4e2d\uff0c\u5982\u679c\u6df7\u6709\u5176\u4ed6\u5b57\u7b26\u4e32\uff0c\u5219\u4f1a\u541e\u6389\u5176\u4ed6\u5b57\u7b26\u4e32\u5185\u5bb9\u3002","title":"CQ::poke() - \u6233\u4e00\u6233"},{"location":"component/bot/cqcode/#cqanonymous-","text":"\u533f\u540d\u53d1\u6d88\u606f\u3002\u9700\u8981\u5728\u5141\u8bb8\u533f\u540d\u53d1\u6d88\u606f\u7684\u7fa4\u91cc\u53d1\u3002 \u63d0\u793a \u5f53\u6536\u5230\u533f\u540d\u6d88\u606f\u65f6\uff0c\u9700\u8981\u901a\u8fc7 \u6d88\u606f\u4e8b\u4ef6\u7684\u7fa4\u6d88\u606f \u7684 anonymous \u5b57\u6bb5\u5224\u65ad\u3002 \u5b9a\u4e49\uff1a CQ::anonymous($ignore = 1) 1 2 3 4 5 6 /** * @CQCommand(\"\u533f\u540d\u6d4b\u8bd5\") */ public function anonymousTest() { ctx()->reply(CQ::anonymous().\"\u533f\u540d\u6d4b\u8bd5\"); }","title":"CQ::anonymous() - \u533f\u540d\u53d1\u6d88\u606f"},{"location":"component/bot/cqcode/#cqshare-","text":"\u53d1\u9001\u94fe\u63a5\u5206\u4eab\u5361\u7247\uff0c\u53ef\u81ea\u5b9a\u4e49\u5185\u5bb9\u3002 \u5b9a\u4e49\uff1a CQ::share($url, $title, $content = null, $image = null) \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u53ef\u80fd\u7684\u503c \u8bf4\u660e url \u2713 \u2713 - URL title \u2713 \u2713 - \u6807\u9898 content \u2713 \u2713 - \u53ef\u9009\uff0c\u5185\u5bb9\u63cf\u8ff0 image \u2713 \u2713 - \u53ef\u9009\uff0c\u56fe\u7247 URL 1 2 3 4 5 6 /** * @CQCommand(\"\u94fe\u63a5\u5206\u4eab\u6d4b\u8bd5\") */ public function shareTest() { ctx()->reply(CQ::share(\"https://baidu.com\", \"UC\u5ffd\u60a0\u90e8\", \"\u9707\u60ca\uff01\u6211\u5e02\u4e00\u7537\u5b50\u5728\u5149\u5929\u5316\u65e5\u4e4b\u4e0b...\")); }","title":"CQ::share() - \u94fe\u63a5\u5206\u4eab"},{"location":"component/bot/cqcode/#cqcontact-","text":"\u53d1\u9001\u63a8\u8350\u597d\u53cb\u7684\u5361\u7247\u3002 \u5b9a\u4e49\uff1a CQ::contact($type, $id) \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u53ef\u80fd\u7684\u503c \u8bf4\u660e type \u2713 \u2713 qq \uff0c group \u63a8\u8350\u597d\u53cb\u6216\u7fa4 id \u2713 \u2713 - \u88ab\u63a8\u8350\u4eba\u7684 QQ \u53f7\u6216\u7fa4\u53f7 1 2 3 4 5 6 /** * @CQCommand(\"\u6211\u7684\u540d\u7247\") */ public function myCard() { ctx()->reply(CQ::contact(\"qq\", ctx()->getUserId())); }","title":"CQ::contact() - \u63a8\u8350\u597d\u53cb"},{"location":"component/bot/cqcode/#cqlocation-","text":"\u53d1\u9001\u4f4d\u7f6e\uff0c\u57fa\u4e8e\u7ecf\u7eac\u5ea6\u5750\u6807\u53d1\u7684\u3002 \u5b9a\u4e49\uff1a CQ::location($lat, $lon, $title = \"\", $content = \"\") \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u53ef\u80fd\u7684\u503c \u8bf4\u660e lat \u2713 \u2713 - \u7eac\u5ea6 lon \u2713 \u2713 - \u7ecf\u5ea6 title \u2713 \u2713 - \u53ef\u9009\uff0c\u6807\u9898 content \u2713 \u2713 - \u53ef\u9009\uff0c\u5185\u5bb9\u63cf\u8ff0","title":"CQ::location() - \u53d1\u9001\u4f4d\u7f6e"},{"location":"component/bot/cqcode/#cqmusic-","text":"\u5206\u4eab\u97f3\u4e50\uff0c\u901a\u8fc7\u5361\u7247\u3002 \u53d1\u9001\u97f3\u4e50\u5206\u4eab\u5361\u7247\u3002\u6b64 CQ \u7801\u5982\u679c\u4f34\u968f\u7740\u5176\u4ed6\u6587\u5b57\uff0c\u5219\u6587\u5b57\u5185\u5bb9\u4f1a\u88ab\u4e22\u5f03\u3002 \u5b9a\u4e49\uff1a CQ::music($type, $id_or_url, $audio = null, $title = null, $content = null, $image = null) $type : \u53d1\u9001\u7c7b\u578b $id_or_url : \u97f3\u4e50\u7684 id \u6216 \u97f3\u4e50\u5361\u7247\u70b9\u8fdb\u53bb\u6253\u5f00\u7684\u94fe\u63a5 $audio : \u97f3\u9891\u6587\u4ef6\u7684 HTTP \u5730\u5740 $title : \u97f3\u4e50\u5361\u7247\u7684\u6807\u9898\uff0c\u5efa\u8bae 12 \u5b57\u4ee5\u5185 $content : \u97f3\u4e50\u5361\u7247\u7684\u7b80\u4ecb\u5185\u5bb9\uff08\u53ef\u9009\uff09 $image : \u97f3\u4e50\u5361\u7247\u7684\u56fe\u7247\u7684\u94fe\u63a5\u5730\u5740\uff08\u53ef\u9009\uff09 \u5982\u679c $type \u53c2\u6570\u4e3a qq \u6216 163 \u6216 xiami \uff0c\u5219\u5fc5\u987b\u4e14\u53ea\u548c\u7b2c\u4e8c\u4e2a\u53c2\u6570 $id_or_url \u914d\u5408\u4f7f\u7528\u3002\u8fd9\u4e09\u4e2a\u4e3a\u5185\u7f6e\u5206\u4eab\uff0c\u9700\u8981\u5148\u901a\u8fc7\u641c\u7d22\u529f\u80fd\u83b7\u53d6\u5bf9\u5e94\u5e73\u53f0\u6b4c\u66f2\u7684 id \u540e\u4f7f\u7528\u3002 \u5982\u679c $type \u53c2\u6570\u4e3a custom \uff0c\u5219\u8868\u660e\u6b64\u97f3\u4e50\u5361\u7247\u4e3a\u7528\u6237\u81ea\u5b9a\u4e49\uff0c\u4f60\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u81ea\u5b9a\u4e49\u5361\u7247\u5185\u5bb9\u548c\u97f3\u9891\u3002\u6b64\u65f6\u5fc5\u987b\u586b\u5199 $id_or_url , $audio , $title \u4e09\u4e2a\u53c2\u6570\u3002 1 2 3 4 5 ctx()->reply(CQ::music(\"163\", \"730806\")); //\u4e00\u9996\u6211\u559c\u6b22\u7684\u6b4c // \u4ee5\u5185\u7f6e\u7684\u53d1\u9001\u7c7b\u578b\u53d1\u9001\u97f3\u4e50\u5361\u7247\uff0c\u6211\u8fd9\u91cc\u6311\u4e86\u7f51\u6613\u4e91\u97f3\u4e50\u7684\u4e00\u9996\u6b4c\u3002 ctx()->reply(\"custom\", \"https://baidu.com/\", \"https://zhamao.xin/file/hello.mp3\", \"\u6211\u662fSiri\u8bf4\u51fa\u6765\u7684Hello\", \"\u4e0d\u670d\u6765\u6253\u6211\u5440\uff01\", \"https://zhamao.xin/file/hello.jpg\"); // \u81ea\u5b9a\u4e49\u6574\u4e2a\u5361\u7247\u7684\u6bcf\u4e2a\u5185\u5bb9","title":"CQ::music() - \u97f3\u4e50\u5206\u4eab"},{"location":"component/bot/cqcode/#cqforward-","text":"\u5408\u5e76\u8f6c\u53d1\u6d88\u606f\u3002 \u5b9a\u4e49\uff1a CQ::forward($id) \u53c2\u6570 1 [CQ:forward,id=123456] \u53c2\u6570\u540d \u6536 \u53d1 \u53ef\u80fd\u7684\u503c \u8bf4\u660e id \u2713 \u5fc5\u586b \u5408\u5e76\u8f6c\u53d1 ID\uff0c\u9700\u901a\u8fc7 get_forward_msg API \u83b7\u53d6\u5177\u4f53\u5185\u5bb9","title":"CQ::forward() - \u5408\u5e76\u8f6c\u53d1"},{"location":"component/bot/cqcode/#cqnode-","text":"\u63a5\u6536\u65f6\uff0c\u6b64\u6d88\u606f\u6bb5\u4e0d\u4f1a\u76f4\u63a5\u51fa\u73b0\u5728\u6d88\u606f\u4e8b\u4ef6\u7684 message \u4e2d\uff0c\u9700\u901a\u8fc7 get_forward_msg API \u83b7\u53d6\u3002\u53d1\u9001\u65f6\uff0c\u901a\u8fc7\u83b7\u53d6\u56de\u6765\u7684 API \u8282\u70b9\u4fe1\u606f\u8fdb\u884c\u53d1\u9001\u3002 \u5b9a\u4e49\uff1a CQ::node($user_id, $nickname, $content) \u53c2\u6570 \u53c2\u6570\u540d \u6536 \u53d1 \u53ef\u80fd\u7684\u503c \u8bf4\u660e user_id \u2713 \u2713 - \u53d1\u9001\u8005 QQ \u53f7 nickname \u2713 \u2713 - \u53d1\u9001\u8005\u6635\u79f0 content \u2713 \u2713 - \u6d88\u606f\u5185\u5bb9\uff0c\u652f\u6301\u53d1\u9001\u6d88\u606f\u65f6\u7684 message \u6570\u636e\u7c7b\u578b\uff0c\u89c1 API \u7684\u53c2\u6570 1 2 3 4 5 6 /** * @CQCommand(\"node\u6d4b\u8bd5\") */ public function nodeTest() { ctx()->reply(CQ::node(123456, \"Jack\", \"[CQ:face,id=123]\u54c8\u55bd\uff5e\")); }","title":"CQ::node() - \u5408\u5e76\u8f6c\u53d1\u81ea\u5b9a\u4e49\u8282\u70b9"},{"location":"component/bot/cqcode/#cqxml-xml","text":"\u53d1\u9001 QQ \u517c\u5bb9\u7684 XML \u591a\u5a92\u4f53\u6d88\u606f\u3002 \u5b9a\u4e49\uff1a CQ::xml($data) \u53c2\u6570\uff1a $data \u4e3a xml \u5b57\u7b26\u4e32 1 2 3 4 5 6 /** * @CQCommand(\"xml\u6d4b\u8bd5\") */ public function xmlTest() { ctx()->reply(CQ::xml(\" <? xml ... \")); }","title":"CQ::xml() - XML \u6d88\u606f"},{"location":"component/bot/cqcode/#cqjson-json","text":"\u53d1\u9001 QQ \u517c\u5bb9\u7684 JSON \u591a\u5a92\u4f53\u6d88\u606f\u3002 \u5b9a\u4e49\uff1a CQ::json($data, $resid = 0) \u53c2\u6570\u540c\u4e0a\uff0c\u5185\u542b JSON \u5b57\u7b26\u4e32\u5373\u53ef\u3002 \u5176\u4e2d $resid \u662f\u9762\u5411 go-cqhttp \u6269\u5c55\u7684\u53c2\u6570\uff0c\u9ed8\u8ba4\u4e0d\u586b\u4e3a 0\uff0c\u8d70\u5c0f\u7a0b\u5e8f\u901a\u9053\uff0c\u586b\u4e86\u8d70\u5bcc\u6587\u672c\u901a\u9053\u53d1\u9001\u3002 \u63d0\u793a \u56e0\u4e3a\u67d0\u4e9b\u4f17\u6240\u5468\u77e5\u7684\u539f\u56e0\uff0cXML \u548c JSON \u7684\u8fd4\u56de\u4e0d\u63d0\u4f9b\u5b9e\u4f8b\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u81ea\u884c\u7814\u7a76\u5982\u4f55\u7f16\u5199\uff0c\u6587\u6863\u4e0d\u542b\u4efb\u4f55\u76f8\u5173\u6559\u7a0b\u3002","title":"CQ::json() - JSON \u6d88\u606f"},{"location":"component/bot/cqcode/#cq_custom-cq","text":"\u7528\u4e8e\u517c\u5bb9\u5404\u7c7b\u542b\u6709\u88ab\u652f\u6301\u7684\u6269\u5c55 CQ \u7801\uff0c\u6bd4\u5982 go-cqhttp \u7684 [CQ:gift] \u793c\u7269\u7c7b\u578b\u3002 \u5b9a\u4e49\uff1a CQ::_custom(string $type_name, array $params) \u53c2\u6570\u540d \u8bf4\u660e type_name CQ \u7801\u7c7b\u578b\uff0c\u5982 music \uff0c at params \u53d1\u9001\u7684 CQ \u7801\u4e2d\u7684\u53c2\u6570\u6570\u7ec4\uff0c\u4f8b\u5982 [\"qq\" => \"123456\"] \u4e0b\u9762\u662f\u4e00\u4e2a\u4f8b\u5b50\uff1a 1 2 CQ::_custom(\"at\",[\"qq\" => \"123456\",\"qwe\" => \"asd\"]); // \u8fd4\u56de\uff1a[CQ:at,qq=123456,qwe=asd]","title":"CQ::_custom() - \u6269\u5c55\u81ea\u5b9a\u4e49 CQ \u7801"},{"location":"component/bot/message-util/","text":"MessageUtil \u6d88\u606f\u5904\u7406\u5de5\u5177\u7c7b \u7c7b\u5b9a\u4e49\uff1a \\ZM\\Utils\\MessageUtil 2.3.0 \u7248\u672c\u8d77\u53ef\u7528\u3002 \u8fd9\u91cc\u653e\u7f6e\u4e00\u4e9b\u673a\u5668\u4eba\u804a\u5929\u6d88\u606f\u5904\u7406\u7684\u4fbf\u6377\u9759\u6001\u65b9\u6cd5\uff0c\u4f8b\u5982\u4e0b\u8f7d\u56fe\u7247\u7b49\u3002 \u65b9\u6cd5 downloadCQImage() \u4e0b\u8f7d\u7528\u6237\u6d88\u606f\u4e2d\u6240\u5e26\u7684\u6240\u6709\u56fe\u7247\uff0c\u5e76\u8fd4\u56de\u6587\u4ef6\u8def\u5f84\u3002 \u5b9a\u4e49\uff1a downloadCQImage($msg, $path = null) \u53c2\u6570 $msg \u4e3a\u5e26\u56fe\u7247\u7684\u7528\u6237\u6d88\u606f\uff0c\u4f8b\u5982 \u4f60\u597d\u554a\uff01\\n[CQ:image,file=a.jpg,url=https://zhamao.xin/file/hello.jpg] \u53c2\u6570 $path \u4e3a\u56fe\u7247\u4e0b\u8f7d\u7684\u8def\u5f84\uff0c\u5982\u679c\u4e0d\u586b\uff08\u9ed8\u8ba4 null\uff09\u5219\u6307\u5b9a\u4e3a zm_data/images/ \u76ee\u5f55\uff0c\u4e14\u4e0d\u5b58\u5728\u4f1a\u81ea\u52a8\u521b\u5efa\u3002 1 2 3 4 5 6 $r = MessageUtil::downloadCQImage(\"\u4f60\u597d\u554a\uff01\\n[CQ:image,file=a.jpg,url=https://zhamao.xin/file/hello.jpg]\"); /* $r == [ \"/path-to/zhamao-framework/zm_data/images/a.jpg\" ]; */ \u5982\u679c\u8fd4\u56de\u7684\u662f\u7a7a\u6570\u7ec4 [ ] \uff0c\u5219\u8868\u660e\u6d88\u606f\u4e2d\u6ca1\u6709\u56fe\u7247\u3002\u5982\u679c\u8fd4\u56de\u7684\u662f false \uff0c\u5219\u8868\u660e\u5176\u4e2d\u81f3\u5c11\u4e00\u5f20\u4e0b\u8f7d\u5931\u8d25\u6216\u8def\u5f84\u6709\u8bef\u3002 containsImage() \u68c0\u67e5\u6d88\u606f\u4e2d\u662f\u5426\u542b\u6709\u56fe\u7247\u3002 \u5b9a\u4e49\uff1a containsImage($msg) \u8fd4\u56de\uff1a bool \uff0c\u4f60\u61c2\u7684\uff0ctrue \u5c31\u662f\u6709\uff0cfalse \u5c31\u6ca1\u6709\u3002 1 2 MessageUtil::containsImage(\"[CQ:image,file=a.jpg,url=http://xxx]\"); // true MessageUtil::containsImage(\"[CQ:face,id=140] \u54a6\uff0c\u8fd9\u662f\u4e00\u6761\u5e26\u8868\u60c5\u7684\u6d88\u606f\"); // false getImageCQFromLocal() \u901a\u8fc7\u6587\u4ef6\u8def\u5f84\u83b7\u53d6\u56fe\u7247\u7684\u53d1\u9001 CQ \u7801\u3002 \u5b9a\u4e49\uff1a getImageCQFromLocal($file, $type = 0) \u53c2\u6570 $file \u4e3a\u56fe\u7247\u7684\u7edd\u5bf9\u8def\u5f84\u3002 \u8fd4\u56de\uff1a\u56fe\u7247\u7684 CQ \u7801\uff0c\u5982 [CQ:image,file=xxxxx] \u53c2\u6570 $type \uff1a 0 \uff1a\u4ee5 base64 \u7684\u65b9\u5f0f\u53d1\u9001\u56fe\u7247\uff0c\u8fd4\u56de\u7ed3\u679c\u5982 [CQ:image,file=base64://xxxxxx] 1 \uff1a\u4ee5 file:// \u672c\u5730\u6587\u4ef6\u7684\u65b9\u5f0f\u53d1\u9001\u56fe\u7247\uff0c\u8fd4\u56de\u7ed3\u679c\u5982 [CQ:image,file=file:///path-to/images/a.jpg] 2 \uff1a\u8fd4\u56de\u56fe\u7247\u7684 http:// CQ \u7801\uff08\u9ed8\u8ba4\u4e3a /images/ \u8def\u5f84\u5c31\u662f\u6587\u4ef6\u5bf9\u5e94\u6240\u5728\u7684\u76ee\u5f55\uff09\uff0c\u5982 [CQ:image,file=http://127.0.0.1:20001/images/a.jpg] splitCommand() \u5207\u5272\u7528\u6237\u6d88\u606f\u4e3a\u6570\u7ec4\u5f62\u5f0f\uff08 @CQCommand \u5c31\u662f\u4f7f\u7528\u6b64\u65b9\u5f0f\u5207\u5272\u7684\uff09 \u5b9a\u4e49\uff1a splitCommand($msg): array \u8fd4\u56de\uff1a\u6570\u7ec4\uff0c\u5207\u5206\u540e\u7684\u3002 \u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u4f7f\u7528 explode \u5462 \u56e0\u4e3a explode() \u53ea\u4f1a\u7b80\u5355\u7c97\u66b4\u7684\u5207\u5272\u5b57\u7b26\u4e32\uff0c\u5047\u8bbe\u7528\u6237\u8f93\u5165\u7684\u6d88\u606f\u4e2d\u4e24\u4e2a\u8bcd\u4e2d\u95f4\u6709\u591a\u4e2a\u7a7a\u683c\uff0c\u5219\u4f1a\u6709\u7a7a\u7684\u8bcd\u51fa\u73b0\u3002\u4f8b\u5982 \u4f60\u597d \u6211\u662f\u4e00\u4e2a\u957f\u7a7a\u683c \u3002\u6b64\u51fd\u6570\u4f1a\u5c06\u591a\u4e2a\u7a7a\u683c\u5f53\u4f5c\u4e00\u4e2a\u7a7a\u683c\u6765\u5bf9\u5f85\u3002 1 2 MessageUtil::splitCommand(\"\u4f60\u597d \u6211\u662f\u50bb\u74dc\\n\u6211\u662f\u50bb\u74dc\u4e8c\u53f7\"); // [\"\u4f60\u597d\",\"\u6211\u662f\u50bb\u74dc\",\"\u6211\u662f\u50bb\u74dc\u4e8c\u53f7\"] MessageUtil::splitCommand(\"\u6211\u6709 \u4e09\u4e2a\u7a7a\u683c\"); // [\"\u6211\u6709\",\"\u4e09\u4e2a\u7a7a\u683c\"] matchCommand() \u5339\u914d\u4e00\u6761\u6d88\u606f\u5230 @CQCommand \u89c4\u5219\u7684\u6ce8\u89e3\u4e8b\u4ef6\uff0c\u8fd4\u56de\u8981\u6267\u884c\u7684\u7c7b\u548c\u51fd\u6570\u4f4d\u7f6e\u3002 \u5b9a\u4e49\uff1a matchCommand($msg, $obj) \u53c2\u6570 $msg \u4e3a\u6d88\u606f\u5185\u5bb9\u3002 \u53c2\u6570 $obj \u4e3a\u4e8b\u4ef6\u7684\u5bf9\u8c61\uff0c\u53ef\u4f7f\u7528 ctx()->getData() \u83b7\u53d6\u539f\u5148\u7684\u4e8b\u4ef6\u4f53\uff08\u4ec5\u9650 OneBot \u6d88\u606f\u7c7b\u578b\u4e8b\u4ef6\u4e2d\u4f7f\u7528\uff09 \u8fd4\u56de\uff1a \\ZM\\Entity\\MatchObject \u5bf9\u8c61\uff0c\u542b\u6709\u5339\u914d\u6210\u529f\u4e0e\u5426\uff0c\u5339\u914d\u5230\u7684\u6ce8\u89e3\u5bf9\u8c61\uff0c\u5339\u914d\u5230\u7684\u5206\u5272\u8bcd\u7b49\uff0c\u89c1 [] addShortCommand() \u5feb\u901f\u6dfb\u52a0\u4e00\u6761\u9759\u6001\u6d88\u606f\u56de\u590d\u547d\u4ee4\u3002 \u5b9a\u4e49\uff1a addShortCommand($command, string $reply) \u53c2\u6570 $command \u4e3a\u95ee\u7684\u5185\u5bb9\uff0c\u5982 \u70b8\u6bdb\u4e0d\u806a\u660e \u3002 \u53c2\u6570 $reply \u4e3a\u56de\u590d\u7684\u5185\u5bb9\uff0c\u5982 \u5176\u5b9e\u8fd8\u662f\u5f88\u806a\u660e\u7684\uff01 \u3002 \u8fd9\u4e2a\u547d\u4ee4\u63a8\u8350\u5728 @OnStart \u6ce8\u89e3\u4e0b\u4f7f\u7528\uff0c\u53ef\u4ee5\u7528\u8fd9\u4e2a\u6765\u505a\u4e00\u4e2a\u52a8\u6001\u7684\u8bcd\u5e93\uff0c\u4ece\u6587\u4ef6\u52a0\u8f7d\u540e\u4f7f\u7528\u3002 1 2 3 4 5 6 /** * @OnStart() */ public function onStart() { MessageUtil::addShortCommand(\"\u70b8\u6bdb\u4e0d\u806a\u660e\", \"\u5176\u5b9e\u8fd8\u662f\u5f88\u806a\u660e\u7684\uff01\"); } ) \u70b8\u6bdb\u4e0d\u806a\u660e ( \u5176\u5b9e\u8fd8\u662f\u5f88\u806a\u660e\u7684\uff01","title":"\u673a\u5668\u4eba\u6d88\u606f\u5904\u7406"},{"location":"component/bot/message-util/#messageutil","text":"\u7c7b\u5b9a\u4e49\uff1a \\ZM\\Utils\\MessageUtil 2.3.0 \u7248\u672c\u8d77\u53ef\u7528\u3002 \u8fd9\u91cc\u653e\u7f6e\u4e00\u4e9b\u673a\u5668\u4eba\u804a\u5929\u6d88\u606f\u5904\u7406\u7684\u4fbf\u6377\u9759\u6001\u65b9\u6cd5\uff0c\u4f8b\u5982\u4e0b\u8f7d\u56fe\u7247\u7b49\u3002","title":"MessageUtil \u6d88\u606f\u5904\u7406\u5de5\u5177\u7c7b"},{"location":"component/bot/message-util/#_1","text":"","title":"\u65b9\u6cd5"},{"location":"component/bot/message-util/#downloadcqimage","text":"\u4e0b\u8f7d\u7528\u6237\u6d88\u606f\u4e2d\u6240\u5e26\u7684\u6240\u6709\u56fe\u7247\uff0c\u5e76\u8fd4\u56de\u6587\u4ef6\u8def\u5f84\u3002 \u5b9a\u4e49\uff1a downloadCQImage($msg, $path = null) \u53c2\u6570 $msg \u4e3a\u5e26\u56fe\u7247\u7684\u7528\u6237\u6d88\u606f\uff0c\u4f8b\u5982 \u4f60\u597d\u554a\uff01\\n[CQ:image,file=a.jpg,url=https://zhamao.xin/file/hello.jpg] \u53c2\u6570 $path \u4e3a\u56fe\u7247\u4e0b\u8f7d\u7684\u8def\u5f84\uff0c\u5982\u679c\u4e0d\u586b\uff08\u9ed8\u8ba4 null\uff09\u5219\u6307\u5b9a\u4e3a zm_data/images/ \u76ee\u5f55\uff0c\u4e14\u4e0d\u5b58\u5728\u4f1a\u81ea\u52a8\u521b\u5efa\u3002 1 2 3 4 5 6 $r = MessageUtil::downloadCQImage(\"\u4f60\u597d\u554a\uff01\\n[CQ:image,file=a.jpg,url=https://zhamao.xin/file/hello.jpg]\"); /* $r == [ \"/path-to/zhamao-framework/zm_data/images/a.jpg\" ]; */ \u5982\u679c\u8fd4\u56de\u7684\u662f\u7a7a\u6570\u7ec4 [ ] \uff0c\u5219\u8868\u660e\u6d88\u606f\u4e2d\u6ca1\u6709\u56fe\u7247\u3002\u5982\u679c\u8fd4\u56de\u7684\u662f false \uff0c\u5219\u8868\u660e\u5176\u4e2d\u81f3\u5c11\u4e00\u5f20\u4e0b\u8f7d\u5931\u8d25\u6216\u8def\u5f84\u6709\u8bef\u3002","title":"downloadCQImage()"},{"location":"component/bot/message-util/#containsimage","text":"\u68c0\u67e5\u6d88\u606f\u4e2d\u662f\u5426\u542b\u6709\u56fe\u7247\u3002 \u5b9a\u4e49\uff1a containsImage($msg) \u8fd4\u56de\uff1a bool \uff0c\u4f60\u61c2\u7684\uff0ctrue \u5c31\u662f\u6709\uff0cfalse \u5c31\u6ca1\u6709\u3002 1 2 MessageUtil::containsImage(\"[CQ:image,file=a.jpg,url=http://xxx]\"); // true MessageUtil::containsImage(\"[CQ:face,id=140] \u54a6\uff0c\u8fd9\u662f\u4e00\u6761\u5e26\u8868\u60c5\u7684\u6d88\u606f\"); // false","title":"containsImage()"},{"location":"component/bot/message-util/#getimagecqfromlocal","text":"\u901a\u8fc7\u6587\u4ef6\u8def\u5f84\u83b7\u53d6\u56fe\u7247\u7684\u53d1\u9001 CQ \u7801\u3002 \u5b9a\u4e49\uff1a getImageCQFromLocal($file, $type = 0) \u53c2\u6570 $file \u4e3a\u56fe\u7247\u7684\u7edd\u5bf9\u8def\u5f84\u3002 \u8fd4\u56de\uff1a\u56fe\u7247\u7684 CQ \u7801\uff0c\u5982 [CQ:image,file=xxxxx] \u53c2\u6570 $type \uff1a 0 \uff1a\u4ee5 base64 \u7684\u65b9\u5f0f\u53d1\u9001\u56fe\u7247\uff0c\u8fd4\u56de\u7ed3\u679c\u5982 [CQ:image,file=base64://xxxxxx] 1 \uff1a\u4ee5 file:// \u672c\u5730\u6587\u4ef6\u7684\u65b9\u5f0f\u53d1\u9001\u56fe\u7247\uff0c\u8fd4\u56de\u7ed3\u679c\u5982 [CQ:image,file=file:///path-to/images/a.jpg] 2 \uff1a\u8fd4\u56de\u56fe\u7247\u7684 http:// CQ \u7801\uff08\u9ed8\u8ba4\u4e3a /images/ \u8def\u5f84\u5c31\u662f\u6587\u4ef6\u5bf9\u5e94\u6240\u5728\u7684\u76ee\u5f55\uff09\uff0c\u5982 [CQ:image,file=http://127.0.0.1:20001/images/a.jpg]","title":"getImageCQFromLocal()"},{"location":"component/bot/message-util/#splitcommand","text":"\u5207\u5272\u7528\u6237\u6d88\u606f\u4e3a\u6570\u7ec4\u5f62\u5f0f\uff08 @CQCommand \u5c31\u662f\u4f7f\u7528\u6b64\u65b9\u5f0f\u5207\u5272\u7684\uff09 \u5b9a\u4e49\uff1a splitCommand($msg): array \u8fd4\u56de\uff1a\u6570\u7ec4\uff0c\u5207\u5206\u540e\u7684\u3002 \u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u4f7f\u7528 explode \u5462 \u56e0\u4e3a explode() \u53ea\u4f1a\u7b80\u5355\u7c97\u66b4\u7684\u5207\u5272\u5b57\u7b26\u4e32\uff0c\u5047\u8bbe\u7528\u6237\u8f93\u5165\u7684\u6d88\u606f\u4e2d\u4e24\u4e2a\u8bcd\u4e2d\u95f4\u6709\u591a\u4e2a\u7a7a\u683c\uff0c\u5219\u4f1a\u6709\u7a7a\u7684\u8bcd\u51fa\u73b0\u3002\u4f8b\u5982 \u4f60\u597d \u6211\u662f\u4e00\u4e2a\u957f\u7a7a\u683c \u3002\u6b64\u51fd\u6570\u4f1a\u5c06\u591a\u4e2a\u7a7a\u683c\u5f53\u4f5c\u4e00\u4e2a\u7a7a\u683c\u6765\u5bf9\u5f85\u3002 1 2 MessageUtil::splitCommand(\"\u4f60\u597d \u6211\u662f\u50bb\u74dc\\n\u6211\u662f\u50bb\u74dc\u4e8c\u53f7\"); // [\"\u4f60\u597d\",\"\u6211\u662f\u50bb\u74dc\",\"\u6211\u662f\u50bb\u74dc\u4e8c\u53f7\"] MessageUtil::splitCommand(\"\u6211\u6709 \u4e09\u4e2a\u7a7a\u683c\"); // [\"\u6211\u6709\",\"\u4e09\u4e2a\u7a7a\u683c\"]","title":"splitCommand()"},{"location":"component/bot/message-util/#matchcommand","text":"\u5339\u914d\u4e00\u6761\u6d88\u606f\u5230 @CQCommand \u89c4\u5219\u7684\u6ce8\u89e3\u4e8b\u4ef6\uff0c\u8fd4\u56de\u8981\u6267\u884c\u7684\u7c7b\u548c\u51fd\u6570\u4f4d\u7f6e\u3002 \u5b9a\u4e49\uff1a matchCommand($msg, $obj) \u53c2\u6570 $msg \u4e3a\u6d88\u606f\u5185\u5bb9\u3002 \u53c2\u6570 $obj \u4e3a\u4e8b\u4ef6\u7684\u5bf9\u8c61\uff0c\u53ef\u4f7f\u7528 ctx()->getData() \u83b7\u53d6\u539f\u5148\u7684\u4e8b\u4ef6\u4f53\uff08\u4ec5\u9650 OneBot \u6d88\u606f\u7c7b\u578b\u4e8b\u4ef6\u4e2d\u4f7f\u7528\uff09 \u8fd4\u56de\uff1a \\ZM\\Entity\\MatchObject \u5bf9\u8c61\uff0c\u542b\u6709\u5339\u914d\u6210\u529f\u4e0e\u5426\uff0c\u5339\u914d\u5230\u7684\u6ce8\u89e3\u5bf9\u8c61\uff0c\u5339\u914d\u5230\u7684\u5206\u5272\u8bcd\u7b49\uff0c\u89c1 []","title":"matchCommand()"},{"location":"component/bot/message-util/#addshortcommand","text":"\u5feb\u901f\u6dfb\u52a0\u4e00\u6761\u9759\u6001\u6d88\u606f\u56de\u590d\u547d\u4ee4\u3002 \u5b9a\u4e49\uff1a addShortCommand($command, string $reply) \u53c2\u6570 $command \u4e3a\u95ee\u7684\u5185\u5bb9\uff0c\u5982 \u70b8\u6bdb\u4e0d\u806a\u660e \u3002 \u53c2\u6570 $reply \u4e3a\u56de\u590d\u7684\u5185\u5bb9\uff0c\u5982 \u5176\u5b9e\u8fd8\u662f\u5f88\u806a\u660e\u7684\uff01 \u3002 \u8fd9\u4e2a\u547d\u4ee4\u63a8\u8350\u5728 @OnStart \u6ce8\u89e3\u4e0b\u4f7f\u7528\uff0c\u53ef\u4ee5\u7528\u8fd9\u4e2a\u6765\u505a\u4e00\u4e2a\u52a8\u6001\u7684\u8bcd\u5e93\uff0c\u4ece\u6587\u4ef6\u52a0\u8f7d\u540e\u4f7f\u7528\u3002 1 2 3 4 5 6 /** * @OnStart() */ public function onStart() { MessageUtil::addShortCommand(\"\u70b8\u6bdb\u4e0d\u806a\u660e\", \"\u5176\u5b9e\u8fd8\u662f\u5f88\u806a\u660e\u7684\uff01\"); } ) \u70b8\u6bdb\u4e0d\u806a\u660e ( \u5176\u5b9e\u8fd8\u662f\u5f88\u806a\u660e\u7684\uff01","title":"addShortCommand()"},{"location":"component/bot/robot-api/","text":"\u673a\u5668\u4eba API\uff08ZMRobot\uff09 ZMRobot \u7c7b\u662f\u5c01\u88c5\u597d\u7684 OneBot \u6807\u51c6\u7684 API \u63a5\u53e3\u8c03\u7528\u7c7b\uff0c\u53ef\u4ee5\u5728\u673a\u5668\u4eba\u8fde\u63a5\u540e\u901a\u8fc7\u8fde\u63a5\u6216\u8005\u673a\u5668\u4eba QQ \u53f7\u83b7\u53d6\u5bf9\u8c61\u5e76\u8c03\u7528\u63a5\u53e3\uff08\u5982\u53d1\u9001\u7fa4\u6d88\u606f\u3001\u83b7\u53d6\u7fa4\u5217\u8868\u7b49\u64cd\u4f5c\uff09\u3002 \u5c5e\u6027\u9879 \u5c5e\u6027\u503c \u5907\u6ce8 \u540d\u79f0 ZMRobot \u7c7b\u578b \u5b9e\u4f8b\u5316\u7c7b $r = new ZMRobot($conn) \u547d\u540d\u7a7a\u95f4 ZM\\API\\ZMRobot \u4f7f\u7528\u524d\u5148 use ZM\\API\\ZMRobot; \u5c5e\u6027 \u5bf9\u8c61\u5c5e\u6027\u65b9\u6cd5\u662f\u5bf9 API \u7684\u8c03\u6574\uff0c\u4f8b\u5982\u662f\u5426\u4ee5 _async \u3001 _rate_limited \u540e\u7f00\u53d1\u9001 API\u3001\u8bbe\u7f6e\u534f\u7a0b\u8fd4\u56de\u8fd8\u662f\u5f02\u6b65\u8fd4\u56de\u7ed3\u679c\u7b49\u3002 ZMRobot::API_NORMAL \u4ee5\u9ed8\u8ba4\uff08\u65e0\u540e\u7f00\uff09\u65b9\u5f0f\u8bf7\u6c42 API\u3002 ZMRobot::API_ASYNC \u4ee5\u540e\u7f00 _async \u65b9\u5f0f\u5f02\u6b65\u8bf7\u6c42 API\u3002 ZMRobot::API_RATE_LIMITED \u4ee5\u540e\u7f00 _rate_limited \u65b9\u5f0f\u8bf7\u6c42 API\u3002 \u65b9\u6cd5 setPrefix() \u8bbe\u7f6e\u540e\u7f00\u3002\u76ee\u524d\u652f\u6301 _async \u3001 _rate_limited \u3002 prefix : int \u9ed8\u8ba4:API_NORMAL \uff0c\u53ef\u9009 ZMRobot::API_NORMAL \u3001 ZMRobot::API_ASYNC \u3001 ZMRobot::API_RATE_LIMITED \u8bbe\u7f6e\u540e\u7f00\u540e\uff0c\u8bf7\u6c42\u7684 API \u4f1a\u53d1\u751f\u53d8\u5316\u3002\u4f8b\u5982\u53d1\u9001\u79c1\u804a\u6d88\u606f\uff1a sendPrivateMsg() \uff0c\u8bf7\u6c42\u7684 API \u4e3a send_private_msg_async \uff0c\u8be6\u89c1 OneBot \u6587\u6863 \u3002 setCallback() \u8bbe\u7f6e API \u7ed3\u679c\u8fd4\u56de\u65b9\u5f0f\u3002\u9ed8\u8ba4\u4e3a true\uff0c\u5c31\u662f\u76f4\u63a5\u901a\u8fc7\u6846\u67b6\u5904\u7406\u540e\u63a5\u6536\u56de\u5305\u76f4\u63a5\u8fd4\u56de\u7ed9\u7ed3\u679c\u3002\u5982\u679c\u4e3a false\uff0c\u5219 API \u8bf7\u6c42\u540e\u53ea\u8fd4\u56de\u662f\u5426\u6210\u529f\u63a8\u9001\u51fa WS \u6570\u636e\u5305\u3002 getSelfId() \u83b7\u53d6\u5f53\u524d\u5bf9\u8c61\u7684\u673a\u5668\u4eba QQ \u6216 OneBot \u5b9e\u4f8b\u7684 ID\u3002 1 2 $bot = ZMRobot::get(123456); echo $bot->getSelfId(); //123456 ZMRobot::get() \u9759\u6001\u65b9\u6cd5\uff0c\u7528\u6765\u901a\u8fc7\u673a\u5668\u4eba QQ \u6216 OneBot \u5b9e\u4f8b\u7684 ID \u83b7\u53d6 ZMRobot \u5bf9\u8c61\u3002 \u53c2\u6570\uff1a $robot_id \uff0c\u5fc5\u586b\u3002 1 2 $r = ZMRobot::get(123456); $r->sendPrivateMsg(55555, \"hello\"); ZMRobot::getRandom() \u9759\u6001\u65b9\u6cd5\uff0c\u968f\u673a\u83b7\u53d6\u4e00\u4e2a\u8fde\u63a5\u5230\u6846\u67b6\u7684\u673a\u5668\u4eba\uff08\u591a\u4e2a\u673a\u5668\u4eba\u5b9e\u4f8b\u8fde\u63a5\u5230\u6846\u67b6\u65f6\u9002\u7528\uff09\u3002 \u5982\u679c\u6846\u67b6\u6ca1\u6709\u8fde\u63a5\u5230\u4efb\u4f55\u673a\u5668\u4eba\u5b9e\u4f8b\uff0c\u5219\u4f1a\u629b\u51fa\u4e00\u4e2a\u5f02\u5e38\uff1a ZM\\Exception\\RobotNotFoundException \u3002 1 2 3 4 5 6 try { $bot = ZMRobot::getRandom(); $bot->sendPrivateMsg(55555, \"foo\"); } catch (\\ZM\\Exception\\RobotNotFoundException $e) { echo \"\u8fd8\u6ca1\u6709\u673a\u5668\u4eba\u8fde\u63a5\u5230\u6846\u67b6\uff01\\n\"; } ZMRobot::getAllRobot() \u83b7\u53d6\u6240\u6709\u8fde\u63a5\u5230\u6846\u67b6\u7684\u673a\u5668\u4eba\u7684 ZMRobot \u5bf9\u8c61\u3002 \u8fd4\u56de\u503c\uff1a ZMRobot[] \u3002 1 2 3 4 $all = ZMRobot::getAllRobot(); foreach($all as $v) { $v->sendPrivateMsg(55555, \"\u673a\u5668\u4eba\u8f6e\u6d41\u7ed9\u4e00\u4e2a\u4eba\u53d1\u6d88\u606f\u5566\uff01\"); } __construct() \u6784\u9020\u65b9\u6cd5\u3002 \u53c2\u6570\uff1a $connection \uff1a\u70b8\u6bdb\u6846\u67b6\u5185\u90e8\u7684\u8fde\u63a5\u5bf9\u8c61\uff0c\u5fc5\u586b\u53c2\u6570\u3002 1 2 3 //\u4ece\u4e0a\u4e0b\u6587\u83b7\u53d6 Websocket \u8fde\u63a5\u5bf9\u8c61 $conn = ctx()->getConnection(); $bot = new ZMRobot($conn); \u8fd4\u56de\u7ed3\u679c\u5904\u7406 \u56e0\u4e3a\u6846\u67b6\u7684\u673a\u5668\u4eba\u662f\u517c\u5bb9 OneBot \u6807\u51c6\u7684\uff08\u539f CQHTTP\uff09\uff0c\u6240\u4ee5\u6bcf\u6b21\u63a5\u6536\u53d1\u9001 API \u8bf7\u6c42\u7684\u7ed3\u679c\u90fd\u662f\u5927\u4f53\u4e00\u6837\u7684\u7ed3\u6784\u3002\u6211\u4eec\u4ee5 sendPrivateMsg() \u4e3a\u4f8b\uff0c\u56e0\u4e3a\u53d1\u9001\u51fa\u53bb\u7684\u6bcf\u4e00\u6761\u6d88\u606f\u90fd\u4f1a\u5728 OneBot \u5b9e\u4f8b\uff08\u5982 CQHTTP \u63d2\u4ef6\u3001go-cqhttp \u7b49\uff09\u4e2d\u5bf9\u5e94\u4e00\u4e2a\u6d88\u606f ID\uff0c\u4ee5\u4f9b\u6211\u4eec\u6838\u67e5\u6d88\u606f\u548c\u540e\u7eed\u64a4\u56de\u7b49\u64cd\u4f5c\u9700\u8981\u3002 1 2 3 $bot = ZMRobot::get(\"123456\"); // \u673a\u5668\u4ebaQQ\u53f7 $obj = $bot->sendGroupMsg(\"234567\", \"\u4f60\u597d\"); echo json_encode($obj, 128|256); 1 2 3 4 5 6 7 8 // \u8f93\u51fa\u7ed3\u679c { \"status\" : \"ok\" , \"retcode\" : 0 , \"data\" : { \"message_id\" : 1243 } } \u5982\u4e0a\uff0c $obj \u5c31\u662f\u6211\u4eec\u7684\u56de\u5305\u5185\u5bb9\uff0c\u6211\u4eec\u901a\u8fc7\u8c03\u7528 sendPrivateMsg() \u8fd9\u4e2a API \u540e\uff0c\u4f1a\u62ff\u5230\u673a\u5668\u4eba\u53d1\u9001\u6b64\u6761\u6d88\u606f\u7684\u6d88\u606f ID\uff0c\u7136\u540e\u53ef\u4ee5\u901a\u8fc7\u5b83\u6765\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\uff08\u4f8b\u5982\u64a4\u56de\uff09\u3002 1 2 $result = $bot->deleteMsg($obj[\"data\"][\"message_id\"]); vardump($result[\"retcode\"]); //\u5982\u679c\u6210\u529f\u64a4\u56de\uff0c\u8f93\u51fa int(0) \u72b6\u6001\u7801\u548c Data \u72b6\u6001\u7801\u4e00\u822c\u60c5\u51b5\u6210\u529f\u90fd\u662f 0 \u6216\u8005 200\uff0c\u5728\u8fc7\u53bb\uff0c\u70b8\u6bdb\u6846\u67b6\u517c\u5bb9 CQHTTP \u63d2\u4ef6\u65f6\uff0c\u9519\u8bef\u7801\u7684\u6807\u51c6\u6309\u7167 CYKU \u7ed9\u51fa\u7684\u6807\u51c6\u7f16\u5199\uff0c\u4e0d\u540c\u7684 OneBot \u6807\u51c6\u7684\u5b9e\u73b0\uff0c\u53ef\u80fd\u6709\u4e0d\u540c\u7684\u6570\u503c\uff0c\u9700\u8981\u6839\u636e\u4f60\u5bf9\u63a5\u7684\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u8fdb\u884c\u9002\u914d\u3002 \u7ed3\u679c\u4e2d\u8fd4\u56de\u7684 data \u5b57\u6bb5\u6839\u636e\u4e0b\u65b9\u4e0d\u540c API \u7684\u8c03\u7528\u800c\u4e0d\u540c\uff0c\u5177\u4f53\u67e5\u770b\u6bcf\u4e2a API \u5199\u660e\u7684 \u54cd\u5e94\u6570\u636e \u8868\u683c\u3002 response \u8868 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e status String \"ok\" \u72b6\u6001\u7801\u8bf4\u660e retcode number 0 \u8fd4\u56de\u72b6\u6001\u7801 data array \u89c1 data \u8868 \u6839\u636e\u4e0d\u540c\u7684 API \u8fd4\u56de\u4e0d\u540c \u673a\u5668\u4eba API \u65b9\u6cd5 sendPrivateMsg() \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e user_id number - \u5bf9\u65b9 QQ \u53f7 message message - \u8981\u53d1\u9001\u7684\u5185\u5bb9 auto_escape boolean false \u6d88\u606f\u5185\u5bb9\u662f\u5426\u4f5c\u4e3a\u7eaf\u6587\u672c\u53d1\u9001\uff08\u5373\u4e0d\u89e3\u6790 CQ \u7801\uff09\uff0c\u53ea\u5728 message \u5b57\u6bb5\u662f\u5b57\u7b26\u4e32\u65f6\u6709\u6548 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e message_id number (int32) \u6d88\u606f ID \u4f8b\u5b50 \u4ee3\u7801 1 2 $bot = ZMRobot::get(123456); // 123456\u662f\u4f60\u7684\u673a\u5668\u4ebaQQ $bot->sendPrivateMsg(\"627577391\", \"\u4f60\u597d\u554a\uff01\u4f60\u597d\u4f60\u597d\uff01\"); \u6548\u679c ( \u4f60\u597d\u554a\uff01\u4f60\u597d\u4f60\u597d\uff01 sendGroupMsg() \u53d1\u9001\u7fa4\u7ec4\u6d88\u606f\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 message message - \u8981\u53d1\u9001\u7684\u5185\u5bb9 auto_escape boolean false \u6d88\u606f\u5185\u5bb9\u662f\u5426\u4f5c\u4e3a\u7eaf\u6587\u672c\u53d1\u9001\uff08\u5373\u4e0d\u89e3\u6790 CQ \u7801\uff09\uff0c\u53ea\u5728 message \u5b57\u6bb5\u662f\u5b57\u7b26\u4e32\u65f6\u6709\u6548 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e message_id number (int32) \u6d88\u606f ID sendMsg() \u53d1\u9001\u6d88\u606f\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e message_type string - \u6d88\u606f\u7c7b\u578b\uff0c\u652f\u6301 private \u3001 group \u3001 discuss \uff0c\u5206\u522b\u5bf9\u5e94\u79c1\u804a\u3001\u7fa4\u7ec4\u3001\u8ba8\u8bba\u7ec4\uff0c\u5982\u4e0d\u4f20\u5165\uff0c\u5219\u6839\u636e\u4f20\u5165\u7684 *_id \u53c2\u6570\u5224\u65ad target_id number - \u76ee\u6807\u53f7\u7801\uff0c\u5982 QQ \u53f7\uff0c\u7fa4\u53f7\uff0c\u8ba8\u8bba\u7ec4\u53f7 message message - \u8981\u53d1\u9001\u7684\u5185\u5bb9 auto_escape boolean false \u6d88\u606f\u5185\u5bb9\u662f\u5426\u4f5c\u4e3a\u7eaf\u6587\u672c\u53d1\u9001\uff08\u5373\u4e0d\u89e3\u6790 CQ \u7801\uff09\uff0c\u53ea\u5728 message \u5b57\u6bb5\u662f\u5b57\u7b26\u4e32\u65f6\u6709\u6548 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e message_id number (int32) \u6d88\u606f ID deleteMsg() \u64a4\u56de\u6d88\u606f\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e message_id number (int32) - \u6d88\u606f ID \u54cd\u5e94\u6570\u636e\uff1a\u65e0 getMsg() \u83b7\u53d6\u6d88\u606f\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e message_id number - \u6d88\u606f ID \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e time number (int32) \u53d1\u9001\u65f6\u95f4 message_type string \u6d88\u606f\u7c7b\u578b\uff0c\u540c \u6d88\u606f\u4e8b\u4ef6 message_id number (int32) \u6d88\u606f ID real_id number (int32) \u6d88\u606f\u771f\u5b9e ID sender object \u53d1\u9001\u4eba\u4fe1\u606f\uff0c\u540c \u6d88\u606f\u4e8b\u4ef6 message message \u6d88\u606f\u5185\u5bb9 getForwardMsg() \u83b7\u53d6\u5408\u5e76\u8f6c\u53d1\u6d88\u606f\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e id string \u5408\u5e76\u8f6c\u53d1 ID \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u7c7b\u578b \u8bf4\u660e message message \u6d88\u606f\u5185\u5bb9\uff0c\u4f7f\u7528 \u6d88\u606f\u7684\u6570\u7ec4\u683c\u5f0f \u8868\u793a\uff0c\u6570\u7ec4\u4e2d\u7684\u6d88\u606f\u6bb5\u5168\u90e8\u4e3a node \u6d88\u606f\u6bb5 sendLike() \u53d1\u9001\u597d\u53cb\u8d5e\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e user_id number - \u5bf9\u65b9 QQ \u53f7 times number 1 \u8d5e\u7684\u6b21\u6570\uff0c\u6bcf\u4e2a\u597d\u53cb\u6bcf\u5929\u6700\u591a 10 \u6b21 \u54cd\u5e94\u6570\u636e \u65e0 setGroupKick() \u7fa4\u7ec4\u8e22\u4eba\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 user_id number - \u8981\u8e22\u7684 QQ \u53f7 reject_add_request boolean false \u62d2\u7edd\u6b64\u4eba\u7684\u52a0\u7fa4\u8bf7\u6c42 \u54cd\u5e94\u6570\u636e\uff1a\u65e0 setGroupBan() \u7fa4\u7ec4\u5355\u4eba\u7981\u8a00\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 user_id number - \u8981\u7981\u8a00\u7684 QQ \u53f7 duration number 30 * 60 \u7981\u8a00\u65f6\u957f\uff0c\u5355\u4f4d\u79d2\uff0c0 \u8868\u793a\u53d6\u6d88\u7981\u8a00 \u54cd\u5e94\u6570\u636e\uff1a\u65e0 setGroupAnonymousBan() \u7fa4\u7ec4\u533f\u540d\u7528\u6237\u7981\u8a00\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 anonymous_or_flag object \u6216 string - \u8981\u7981\u8a00\u7684\u533f\u540d\u7528\u6237\u5bf9\u8c61\uff08\u7fa4\u6d88\u606f\u4e0a\u62a5\u7684 anonymous \u5b57\u6bb5\uff09\u6216\u7528\u6237\u7684 flag duration number 30 * 60 \u7981\u8a00\u65f6\u957f\uff0c\u5355\u4f4d\u79d2\uff0c\u65e0\u6cd5\u53d6\u6d88\u533f\u540d\u7528\u6237\u7981\u8a00 \u4e0a\u9762\u7684 anonymous_or_flag \u4e24\u8005\u4efb\u9009\u5176\u4e00\u4f20\u5165\u5373\u53ef\u3002 \u54cd\u5e94\u6570\u636e\uff1a\u65e0 setGroupWholeBan() \u7fa4\u7ec4\u5168\u5458\u7981\u8a00 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 enable boolean true \u662f\u5426\u7981\u8a00 \u54cd\u5e94\u6570\u636e\uff1a\u65e0 setGroupAdmin() \u7fa4\u7ec4\u8bbe\u7f6e\u7ba1\u7406\u5458 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 user_id number - \u8981\u8bbe\u7f6e\u7ba1\u7406\u5458\u7684 QQ \u53f7 enable boolean true true \u4e3a\u8bbe\u7f6e\uff0cfalse \u4e3a\u53d6\u6d88 \u54cd\u5e94\u6570\u636e\uff1a\u65e0 setGroupAnonymous() \u7fa4\u7ec4\u533f\u540d \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 enable boolean true \u662f\u5426\u5141\u8bb8\u533f\u540d\u804a\u5929 \u54cd\u5e94\u6570\u636e\uff1a\u65e0 setGroupCard() \u8bbe\u7f6e\u7fa4\u540d\u7247\uff08\u7fa4\u5907\u6ce8\uff09 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 user_id number - \u8981\u8bbe\u7f6e\u7684 QQ \u53f7 card string \u7a7a \u7fa4\u540d\u7247\u5185\u5bb9\uff0c\u4e0d\u586b\u6216\u7a7a\u5b57\u7b26\u4e32\u8868\u793a\u5220\u9664\u7fa4\u540d\u7247 \u54cd\u5e94\u6570\u636e\uff1a\u65e0 setGroupName() \u8bbe\u7f6e\u7fa4\u540d\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e group_id number (int64) \u7fa4\u53f7 group_name string \u65b0\u7fa4\u540d \u54cd\u5e94\u6570\u636e\uff1a\u65e0 setGroupLeave() \u9000\u51fa\u7fa4\u7ec4 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 is_dismiss boolean false \u662f\u5426\u89e3\u6563\uff0c\u5982\u679c\u767b\u5f55\u53f7\u662f\u7fa4\u4e3b\uff0c\u5219\u4ec5\u5728\u6b64\u9879\u4e3a true \u65f6\u80fd\u591f\u89e3\u6563 \u54cd\u5e94\u6570\u636e\uff1a\u65e0 setGroupSpecialTitle() \u8bbe\u7f6e\u7fa4\u7ec4\u4e13\u5c5e\u5934\u8854 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 user_id number - \u8981\u8bbe\u7f6e\u7684 QQ \u53f7 special_title string \u7a7a \u4e13\u5c5e\u5934\u8854\uff0c\u4e0d\u586b\u6216\u7a7a\u5b57\u7b26\u4e32\u8868\u793a\u5220\u9664\u4e13\u5c5e\u5934\u8854 duration number -1 \u4e13\u5c5e\u5934\u8854\u6709\u6548\u671f\uff0c\u5355\u4f4d\u79d2\uff0c-1 \u8868\u793a\u6c38\u4e45\uff0c\u4e0d\u8fc7\u6b64\u9879\u4f3c\u4e4e\u6ca1\u6709\u6548\u679c\uff0c\u53ef\u80fd\u662f\u53ea\u6709\u67d0\u4e9b\u7279\u6b8a\u7684\u65f6\u95f4\u957f\u5ea6\u6709\u6548\uff0c\u6709\u5f85\u6d4b\u8bd5 \u54cd\u5e94\u6570\u636e\uff1a\u65e0 setFriendAddRequest() \u5904\u7406\u52a0\u597d\u53cb\u8bf7\u6c42 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e flag string - \u52a0\u597d\u53cb\u8bf7\u6c42\u7684 flag\uff08\u9700\u4ece\u4e0a\u62a5\u7684\u6570\u636e\u4e2d\u83b7\u5f97\uff09 approve boolean true \u662f\u5426\u540c\u610f\u8bf7\u6c42 remark string \u7a7a \u6dfb\u52a0\u540e\u7684\u597d\u53cb\u5907\u6ce8\uff08\u4ec5\u5728\u540c\u610f\u65f6\u6709\u6548\uff09 \u54cd\u5e94\u6570\u636e\uff1a\u65e0 setGroupAddRequest() \u5904\u7406\u52a0\u7fa4\u8bf7\u6c42 / \u9080\u8bf7 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e flag string - \u52a0\u7fa4\u8bf7\u6c42\u7684 flag\uff08\u9700\u4ece\u4e0a\u62a5\u7684\u6570\u636e\u4e2d\u83b7\u5f97\uff09 sub_type string - add \u6216 invite \uff0c\u8bf7\u6c42\u7c7b\u578b\uff08\u9700\u8981\u548c\u4e0a\u62a5\u6d88\u606f\u4e2d\u7684 sub_type \u5b57\u6bb5\u76f8\u7b26\uff09 approve boolean true \u662f\u5426\u540c\u610f\u8bf7\u6c42\uff0f\u9080\u8bf7 reason string \u7a7a \u62d2\u7edd\u7406\u7531\uff08\u4ec5\u5728\u62d2\u7edd\u65f6\u6709\u6548\uff09 \u54cd\u5e94\u6570\u636e\u65e0 getLoginInfo() \u83b7\u53d6\u767b\u5f55\u53f7\u4fe1\u606f \u53c2\u6570\uff1a\u65e0 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e user_id number (int64) QQ \u53f7 nickname string QQ \u6635\u79f0 getStrangerInfo() \u83b7\u53d6\u964c\u751f\u4eba\u4fe1\u606f \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e user_id number - QQ \u53f7 no_cache boolean false \u662f\u5426\u4e0d\u4f7f\u7528\u7f13\u5b58\uff08\u4f7f\u7528\u7f13\u5b58\u53ef\u80fd\u66f4\u65b0\u4e0d\u53ca\u65f6\uff0c\u4f46\u54cd\u5e94\u66f4\u5feb\uff09 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e user_id number (int64) QQ \u53f7 nickname string \u6635\u79f0 sex string \u6027\u522b\uff0c male \u6216 female \u6216 unknown age number (int32) \u5e74\u9f84 getFriendList() \u83b7\u53d6\u597d\u53cb\u5217\u8868 \u53c2\u6570\uff1a\u65e0 \u54cd\u5e94\u6570\u636e \u54cd\u5e94\u5185\u5bb9\u4e3a JSON \u6570\u7ec4\uff0c\u6bcf\u4e2a\u5143\u7d20\u5982\u4e0b\uff1a \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e user_id number (int64) QQ \u53f7 nickname string \u6635\u79f0 remark string \u5907\u6ce8\u540d getGroupInfo() \u83b7\u53d6\u7fa4\u4fe1\u606f \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 no_cache boolean false \u662f\u5426\u4e0d\u4f7f\u7528\u7f13\u5b58\uff08\u4f7f\u7528\u7f13\u5b58\u53ef\u80fd\u66f4\u65b0\u4e0d\u53ca\u65f6\uff0c\u4f46\u54cd\u5e94\u66f4\u5feb\uff09 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e group_id number (int64) \u7fa4\u53f7 group_name string \u7fa4\u540d\u79f0 member_count number (int32) \u6210\u5458\u6570 max_member_count number (int32) \u6700\u5927\u6210\u5458\u6570\uff08\u7fa4\u5bb9\u91cf\uff09 getGroupList() \u83b7\u53d6\u7fa4\u5217\u8868 \u53c2\u6570\uff1a\u65e0 \u54cd\u5e94\u6570\u636e \u54cd\u5e94\u5185\u5bb9\u4e3a JSON \u6570\u7ec4\uff0c\u6bcf\u4e2a\u5143\u7d20\u5982\u4e0b\uff1a \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e group_id number (int64) \u7fa4\u53f7 group_name string \u7fa4\u540d\u79f0 getGroupMemberInfo() \u83b7\u53d6\u7fa4\u6210\u5458\u4fe1\u606f \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 user_id number - QQ \u53f7 no_cache boolean false \u662f\u5426\u4e0d\u4f7f\u7528\u7f13\u5b58\uff08\u4f7f\u7528\u7f13\u5b58\u53ef\u80fd\u66f4\u65b0\u4e0d\u53ca\u65f6\uff0c\u4f46\u54cd\u5e94\u66f4\u5feb\uff09 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e group_id number (int64) \u7fa4\u53f7 user_id number (int64) QQ \u53f7 nickname string \u6635\u79f0 card string \u7fa4\u540d\u7247\uff0f\u5907\u6ce8 sex string \u6027\u522b\uff0c male \u6216 female \u6216 unknown age number (int32) \u5e74\u9f84 area string \u5730\u533a join_time number (int32) \u52a0\u7fa4\u65f6\u95f4\u6233 last_sent_time number (int32) \u6700\u540e\u53d1\u8a00\u65f6\u95f4\u6233 level string \u6210\u5458\u7b49\u7ea7 role string \u89d2\u8272\uff0c owner \u6216 admin \u6216 member unfriendly boolean \u662f\u5426\u4e0d\u826f\u8bb0\u5f55\u6210\u5458 title string \u4e13\u5c5e\u5934\u8854 title_expire_time number (int32) \u4e13\u5c5e\u5934\u8854\u8fc7\u671f\u65f6\u95f4\u6233 card_changeable boolean \u662f\u5426\u5141\u8bb8\u4fee\u6539\u7fa4\u540d\u7247 getGroupMemberList() \u83b7\u53d6\u7fa4\u6210\u5458\u5217\u8868 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 \u54cd\u5e94\u6570\u636e \u54cd\u5e94\u5185\u5bb9\u4e3a JSON \u6570\u7ec4\uff0c\u6bcf\u4e2a\u5143\u7d20\u7684\u5185\u5bb9\u548c\u4e0a\u9762\u7684 /get_group_member_info \u63a5\u53e3\u76f8\u540c\uff0c\u4f46\u5bf9\u4e8e\u540c\u4e00\u4e2a\u7fa4\u7ec4\u7684\u540c\u4e00\u4e2a\u6210\u5458\uff0c\u83b7\u53d6\u5217\u8868\u65f6\u548c\u83b7\u53d6\u5355\u72ec\u7684\u6210\u5458\u4fe1\u606f\u65f6\uff0c\u67d0\u4e9b\u5b57\u6bb5\u53ef\u80fd\u6709\u6240\u4e0d\u540c\uff0c\u4f8b\u5982 area \u3001 title \u7b49\u5b57\u6bb5\u5728\u83b7\u53d6\u5217\u8868\u65f6\u65e0\u6cd5\u83b7\u5f97\uff0c\u5177\u4f53\u5e94\u4ee5\u5355\u72ec\u7684\u6210\u5458\u4fe1\u606f\u4e3a\u51c6\u3002 getGroupHonorInfo() \u83b7\u53d6\u7fa4\u8363\u8a89\u4fe1\u606f\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number (int64) - \u7fa4\u53f7 type string - \u8981\u83b7\u53d6\u7684\u7fa4\u8363\u8a89\u7c7b\u578b\uff0c\u53ef\u4f20\u5165 talkative performer legend strong_newbie emotion \u4ee5\u5206\u522b\u83b7\u53d6\u5355\u4e2a\u7c7b\u578b\u7684\u7fa4\u8363\u8a89\u6570\u636e\uff0c\u6216\u4f20\u5165 all \u83b7\u53d6\u6240\u6709\u6570\u636e \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e group_id number (int64) \u7fa4\u53f7 current_talkative object \u5f53\u524d\u9f99\u738b\uff0c\u4ec5 type \u4e3a talkative \u6216 all \u65f6\u6709\u6570\u636e talkative_list array \u5386\u53f2\u9f99\u738b\uff0c\u4ec5 type \u4e3a talkative \u6216 all \u65f6\u6709\u6570\u636e performer_list array \u7fa4\u804a\u4e4b\u706b\uff0c\u4ec5 type \u4e3a performer \u6216 all \u65f6\u6709\u6570\u636e legend_list array \u7fa4\u804a\u70bd\u7130\uff0c\u4ec5 type \u4e3a legend \u6216 all \u65f6\u6709\u6570\u636e strong_newbie_list array \u5192\u5c16\u5c0f\u6625\u7b0b\uff0c\u4ec5 type \u4e3a strong_newbie \u6216 all \u65f6\u6709\u6570\u636e emotion_list array \u5feb\u4e50\u4e4b\u6e90\uff0c\u4ec5 type \u4e3a emotion \u6216 all \u65f6\u6709\u6570\u636e \u5176\u4e2d current_talkative \u5b57\u6bb5\u7684\u5185\u5bb9\u5982\u4e0b\uff1a \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e user_id number (int64) QQ \u53f7 nickname string \u6635\u79f0 avatar string \u5934\u50cf URL day_count number (int32) \u6301\u7eed\u5929\u6570 \u5176\u5b83\u5404 *_list \u7684\u6bcf\u4e2a\u5143\u7d20\u662f\u4e00\u4e2a JSON \u5bf9\u8c61\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e user_id number (int64) QQ \u53f7 nickname string \u6635\u79f0 avatar string \u5934\u50cf URL description string \u8363\u8a89\u63cf\u8ff0 getCookies() \u83b7\u53d6 Cookies\u3002 \u6ce8\u610f \u76ee\u524d\u5f00\u6e90\u7684 mirai \u4e3a\u5e95\u5c42\u7684\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u5747\u4e0d\u652f\u6301\u83b7\u53d6 Cookies \u548c CSRF Token\uff0c\u5305\u62ec go-cqhttp\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e domain string \u7a7a \u9700\u8981\u83b7\u53d6 cookies \u7684\u57df\u540d \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e cookies string Cookies getCsrfToken() \u83b7\u53d6 CSRF Token \u53c2\u6570\uff1a\u65e0 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e token number (int32) CSRF Token getCredentials() \u83b7\u53d6 QQ \u76f8\u5173\u63a5\u53e3\u51ed\u8bc1\uff0c\u5373\u4e0a\u9762\u4e24\u4e2a\u5408\u5e76\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e domain string \u7a7a \u9700\u8981\u83b7\u53d6 cookies \u7684\u57df\u540d \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e cookies string Cookies csrf_token number (int32) CSRF Token getRecord() \u83b7\u53d6\u8bed\u97f3\u3002\u5176\u5b9e\u5e76\u4e0d\u662f\u771f\u7684\u83b7\u53d6\u8bed\u97f3\uff0c\u800c\u662f\u8f6c\u6362\u8bed\u97f3\u5230\u6307\u5b9a\u7684\u683c\u5f0f\u3002 \u63d0\u793a \uff1a\u8981\u4f7f\u7528\u6b64\u63a5\u53e3\uff0c\u901a\u5e38\u9700\u8981\u5b89\u88c5 ffmpeg\uff0c\u8bf7\u53c2\u8003 OneBot \u5b9e\u73b0\u7684\u76f8\u5173\u8bf4\u660e\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e file string - \u6536\u5230\u7684\u8bed\u97f3\u6587\u4ef6\u540d\uff08CQ \u7801\u7684 file \u53c2\u6570\uff09\uff0c\u5982 0B38145AA44505000B38145AA4450500.silk out_format string - \u8981\u8f6c\u6362\u5230\u7684\u683c\u5f0f\uff0c\u76ee\u524d\u652f\u6301 mp3 \u3001 amr \u3001 wma \u3001 m4a \u3001 spx \u3001 ogg \u3001 wav \u3001 flac \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e file string \u8f6c\u6362\u540e\u7684\u8bed\u97f3\u6587\u4ef6\u8def\u5f84\uff0c\u5982 /home/somebody/cqhttp/data/record/0B38145AA44505000B38145AA4450500.mp3 getImage() \u83b7\u53d6\u56fe\u7247\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e file string - \u6536\u5230\u7684\u56fe\u7247\u6587\u4ef6\u540d\uff08CQ \u7801\u7684 file \u53c2\u6570\uff09\uff0c\u5982 6B4DE3DFD1BD271E3297859D41C530F5.jpg \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e file string \u4e0b\u8f7d\u540e\u7684\u56fe\u7247\u6587\u4ef6\u8def\u5f84\uff0c\u5982 /home/somebody/cqhttp/data/image/6B4DE3DFD1BD271E3297859D41C530F5.jpg canSendImage() \u68c0\u67e5\u662f\u5426\u53ef\u4ee5\u53d1\u9001\u56fe\u7247\u3002 \u53c2\u6570\uff1a\u65e0 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e yes boolean \u662f\u6216\u5426 canSendRecord() \u68c0\u67e5\u662f\u5426\u53ef\u4ee5\u53d1\u9001\u8bed\u97f3\uff0c\u8fd4\u56de\u540c\u4e0a\u3002 getStatus() \u83b7\u53d6\u63d2\u4ef6\u8fd0\u884c\u72b6\u6001\u3002 \u53c2\u6570\uff1a\u65e0 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e online boolean \u5f53\u524d QQ \u5728\u7ebf\uff0c null \u8868\u793a\u65e0\u6cd5\u67e5\u8be2\u5230\u5728\u7ebf\u72b6\u6001 good boolean \u72b6\u6001\u7b26\u5408\u9884\u671f\uff0c\u610f\u5473\u7740\u5404\u6a21\u5757\u6b63\u5e38\u8fd0\u884c\u3001\u529f\u80fd\u6b63\u5e38\uff0c\u4e14 QQ \u5728\u7ebf ...... - OneBot \u5b9e\u4f8b\u81ea\u884c\u6dfb\u52a0\u7684\u5176\u4ed6\u5185\u5bb9 \u901a\u5e38\u60c5\u51b5\u4e0b\u5efa\u8bae\u53ea\u4f7f\u7528 online \u548c good \u8fd9\u4e24\u4e2a\u5b57\u6bb5\u6765\u5224\u65ad\u8fd0\u884c\u72b6\u6001\uff0c\u56e0\u4e3a\u6839\u636e OneBot \u5b9e\u73b0\u7684\u4e0d\u540c\uff0c\u5176\u5b83\u5b57\u6bb5\u53ef\u80fd\u5b8c\u5168\u4e0d\u540c\u3002 getVersionInfo() \u83b7\u53d6\u7248\u672c\u4fe1\u606f \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e app_name string \u5e94\u7528\u6807\u8bc6\uff0c\u5982 mirai-native app_version string \u5e94\u7528\u7248\u672c\uff0c\u5982 1.2.3 protocol_version string OneBot \u6807\u51c6\u7248\u672c\uff0c\u5982 v11 \u2026\u2026 - OneBot \u5b9e\u73b0\u81ea\u884c\u6dfb\u52a0\u7684\u5176\u5b83\u5185\u5bb9 setRestartPlugin() \u91cd\u542f OneBot \u5ba2\u6237\u7aef \u7531\u4e8e\u91cd\u542f OneBot \u5b9e\u73b0\u540c\u65f6\u9700\u8981\u91cd\u542f API \u670d\u52a1\uff0c\u8fd9\u610f\u5473\u7740\u5f53\u524d\u7684 API \u8bf7\u6c42\u4f1a\u88ab\u4e2d\u65ad\uff0c\u56e0\u6b64\u9700\u8981\u5f02\u6b65\u5730\u91cd\u542f\uff0c\u63a5\u53e3\u8fd4\u56de\u7684 status \u662f async \u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e delay number 0 \u8981\u5ef6\u8fdf\u7684\u6beb\u79d2\u6570\uff0c\u5982\u679c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u65e0\u6cd5\u91cd\u542f\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u8bbe\u7f6e\u5ef6\u8fdf\u4e3a 2000 \u5de6\u53f3 \u54cd\u5e94\u6570\u636e\uff1a\u65e0 cleanCache() \u6e05\u7406 OneBot \u5ba2\u6237\u7aef\u7684\u7f13\u5b58\u3002 \u53c2\u6570\uff1a\u65e0 \u54cd\u5e94\u6570\u636e\uff1a\u65e0 callExtendedAPI() \uff08\u6269\u5145 API\uff09 \u7528\u6765\u8c03\u7528 OneBot \u6807\u51c6\u4e4b\u5916\u6269\u5c55\u51fa\u6765\u7684\u81ea\u5b9a\u4e49 API\u3002 \u4f7f\u7528\u4e0d\u540c OneBot \u5ba2\u6237\u7aef\u65f6\uff0c\u53ef\u80fd\u6709\u4e00\u4e9b API \u4e0d\u5728\u4e0a\u65b9\u7684 OneBot \u6807\u51c6\u91cc\uff0c\u8fd9\u65f6\u53ef\u4ee5\u4f7f\u7528\u6b64\u65b9\u6cd5\u8fdb\u884c\u989d\u5916\u8c03\u7528\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c action string \u5fc5\u586b params array [] \u4f8b\u5b50 1 2 3 4 $result = $bot->callExtendedAPI(\"get_group_root_files\", [\"group_id\" => 123456]); //\u8fd9\u91cc\u4ee5 go-cqhttp \u6269\u5c55\u7684\u4e00\u4e2a\u83b7\u53d6\u7fa4\u6587\u4ef6\u7684 API \u4e3a\u4f8b var_dump($result[\"data\"]); // \u8f93\u51fa\u7fa4\u6587\u4ef6\u5217\u8868","title":"\u673a\u5668\u4eba API"},{"location":"component/bot/robot-api/#apizmrobot","text":"ZMRobot \u7c7b\u662f\u5c01\u88c5\u597d\u7684 OneBot \u6807\u51c6\u7684 API \u63a5\u53e3\u8c03\u7528\u7c7b\uff0c\u53ef\u4ee5\u5728\u673a\u5668\u4eba\u8fde\u63a5\u540e\u901a\u8fc7\u8fde\u63a5\u6216\u8005\u673a\u5668\u4eba QQ \u53f7\u83b7\u53d6\u5bf9\u8c61\u5e76\u8c03\u7528\u63a5\u53e3\uff08\u5982\u53d1\u9001\u7fa4\u6d88\u606f\u3001\u83b7\u53d6\u7fa4\u5217\u8868\u7b49\u64cd\u4f5c\uff09\u3002 \u5c5e\u6027\u9879 \u5c5e\u6027\u503c \u5907\u6ce8 \u540d\u79f0 ZMRobot \u7c7b\u578b \u5b9e\u4f8b\u5316\u7c7b $r = new ZMRobot($conn) \u547d\u540d\u7a7a\u95f4 ZM\\API\\ZMRobot \u4f7f\u7528\u524d\u5148 use ZM\\API\\ZMRobot;","title":"\u673a\u5668\u4eba API\uff08ZMRobot\uff09"},{"location":"component/bot/robot-api/#_1","text":"\u5bf9\u8c61\u5c5e\u6027\u65b9\u6cd5\u662f\u5bf9 API \u7684\u8c03\u6574\uff0c\u4f8b\u5982\u662f\u5426\u4ee5 _async \u3001 _rate_limited \u540e\u7f00\u53d1\u9001 API\u3001\u8bbe\u7f6e\u534f\u7a0b\u8fd4\u56de\u8fd8\u662f\u5f02\u6b65\u8fd4\u56de\u7ed3\u679c\u7b49\u3002","title":"\u5c5e\u6027"},{"location":"component/bot/robot-api/#zmrobotapi_normal","text":"\u4ee5\u9ed8\u8ba4\uff08\u65e0\u540e\u7f00\uff09\u65b9\u5f0f\u8bf7\u6c42 API\u3002","title":"ZMRobot::API_NORMAL"},{"location":"component/bot/robot-api/#zmrobotapi_async","text":"\u4ee5\u540e\u7f00 _async \u65b9\u5f0f\u5f02\u6b65\u8bf7\u6c42 API\u3002","title":"ZMRobot::API_ASYNC"},{"location":"component/bot/robot-api/#zmrobotapi_rate_limited","text":"\u4ee5\u540e\u7f00 _rate_limited \u65b9\u5f0f\u8bf7\u6c42 API\u3002","title":"ZMRobot::API_RATE_LIMITED"},{"location":"component/bot/robot-api/#_2","text":"","title":"\u65b9\u6cd5"},{"location":"component/bot/robot-api/#setprefix","text":"\u8bbe\u7f6e\u540e\u7f00\u3002\u76ee\u524d\u652f\u6301 _async \u3001 _rate_limited \u3002 prefix : int \u9ed8\u8ba4:API_NORMAL \uff0c\u53ef\u9009 ZMRobot::API_NORMAL \u3001 ZMRobot::API_ASYNC \u3001 ZMRobot::API_RATE_LIMITED \u8bbe\u7f6e\u540e\u7f00\u540e\uff0c\u8bf7\u6c42\u7684 API \u4f1a\u53d1\u751f\u53d8\u5316\u3002\u4f8b\u5982\u53d1\u9001\u79c1\u804a\u6d88\u606f\uff1a sendPrivateMsg() \uff0c\u8bf7\u6c42\u7684 API \u4e3a send_private_msg_async \uff0c\u8be6\u89c1 OneBot \u6587\u6863 \u3002","title":"setPrefix()"},{"location":"component/bot/robot-api/#setcallback","text":"\u8bbe\u7f6e API \u7ed3\u679c\u8fd4\u56de\u65b9\u5f0f\u3002\u9ed8\u8ba4\u4e3a true\uff0c\u5c31\u662f\u76f4\u63a5\u901a\u8fc7\u6846\u67b6\u5904\u7406\u540e\u63a5\u6536\u56de\u5305\u76f4\u63a5\u8fd4\u56de\u7ed9\u7ed3\u679c\u3002\u5982\u679c\u4e3a false\uff0c\u5219 API \u8bf7\u6c42\u540e\u53ea\u8fd4\u56de\u662f\u5426\u6210\u529f\u63a8\u9001\u51fa WS \u6570\u636e\u5305\u3002","title":"setCallback()"},{"location":"component/bot/robot-api/#getselfid","text":"\u83b7\u53d6\u5f53\u524d\u5bf9\u8c61\u7684\u673a\u5668\u4eba QQ \u6216 OneBot \u5b9e\u4f8b\u7684 ID\u3002 1 2 $bot = ZMRobot::get(123456); echo $bot->getSelfId(); //123456","title":"getSelfId()"},{"location":"component/bot/robot-api/#zmrobotget","text":"\u9759\u6001\u65b9\u6cd5\uff0c\u7528\u6765\u901a\u8fc7\u673a\u5668\u4eba QQ \u6216 OneBot \u5b9e\u4f8b\u7684 ID \u83b7\u53d6 ZMRobot \u5bf9\u8c61\u3002 \u53c2\u6570\uff1a $robot_id \uff0c\u5fc5\u586b\u3002 1 2 $r = ZMRobot::get(123456); $r->sendPrivateMsg(55555, \"hello\");","title":"ZMRobot::get()"},{"location":"component/bot/robot-api/#zmrobotgetrandom","text":"\u9759\u6001\u65b9\u6cd5\uff0c\u968f\u673a\u83b7\u53d6\u4e00\u4e2a\u8fde\u63a5\u5230\u6846\u67b6\u7684\u673a\u5668\u4eba\uff08\u591a\u4e2a\u673a\u5668\u4eba\u5b9e\u4f8b\u8fde\u63a5\u5230\u6846\u67b6\u65f6\u9002\u7528\uff09\u3002 \u5982\u679c\u6846\u67b6\u6ca1\u6709\u8fde\u63a5\u5230\u4efb\u4f55\u673a\u5668\u4eba\u5b9e\u4f8b\uff0c\u5219\u4f1a\u629b\u51fa\u4e00\u4e2a\u5f02\u5e38\uff1a ZM\\Exception\\RobotNotFoundException \u3002 1 2 3 4 5 6 try { $bot = ZMRobot::getRandom(); $bot->sendPrivateMsg(55555, \"foo\"); } catch (\\ZM\\Exception\\RobotNotFoundException $e) { echo \"\u8fd8\u6ca1\u6709\u673a\u5668\u4eba\u8fde\u63a5\u5230\u6846\u67b6\uff01\\n\"; }","title":"ZMRobot::getRandom()"},{"location":"component/bot/robot-api/#zmrobotgetallrobot","text":"\u83b7\u53d6\u6240\u6709\u8fde\u63a5\u5230\u6846\u67b6\u7684\u673a\u5668\u4eba\u7684 ZMRobot \u5bf9\u8c61\u3002 \u8fd4\u56de\u503c\uff1a ZMRobot[] \u3002 1 2 3 4 $all = ZMRobot::getAllRobot(); foreach($all as $v) { $v->sendPrivateMsg(55555, \"\u673a\u5668\u4eba\u8f6e\u6d41\u7ed9\u4e00\u4e2a\u4eba\u53d1\u6d88\u606f\u5566\uff01\"); }","title":"ZMRobot::getAllRobot()"},{"location":"component/bot/robot-api/#__construct","text":"\u6784\u9020\u65b9\u6cd5\u3002 \u53c2\u6570\uff1a $connection \uff1a\u70b8\u6bdb\u6846\u67b6\u5185\u90e8\u7684\u8fde\u63a5\u5bf9\u8c61\uff0c\u5fc5\u586b\u53c2\u6570\u3002 1 2 3 //\u4ece\u4e0a\u4e0b\u6587\u83b7\u53d6 Websocket \u8fde\u63a5\u5bf9\u8c61 $conn = ctx()->getConnection(); $bot = new ZMRobot($conn);","title":"__construct()"},{"location":"component/bot/robot-api/#_3","text":"\u56e0\u4e3a\u6846\u67b6\u7684\u673a\u5668\u4eba\u662f\u517c\u5bb9 OneBot \u6807\u51c6\u7684\uff08\u539f CQHTTP\uff09\uff0c\u6240\u4ee5\u6bcf\u6b21\u63a5\u6536\u53d1\u9001 API \u8bf7\u6c42\u7684\u7ed3\u679c\u90fd\u662f\u5927\u4f53\u4e00\u6837\u7684\u7ed3\u6784\u3002\u6211\u4eec\u4ee5 sendPrivateMsg() \u4e3a\u4f8b\uff0c\u56e0\u4e3a\u53d1\u9001\u51fa\u53bb\u7684\u6bcf\u4e00\u6761\u6d88\u606f\u90fd\u4f1a\u5728 OneBot \u5b9e\u4f8b\uff08\u5982 CQHTTP \u63d2\u4ef6\u3001go-cqhttp \u7b49\uff09\u4e2d\u5bf9\u5e94\u4e00\u4e2a\u6d88\u606f ID\uff0c\u4ee5\u4f9b\u6211\u4eec\u6838\u67e5\u6d88\u606f\u548c\u540e\u7eed\u64a4\u56de\u7b49\u64cd\u4f5c\u9700\u8981\u3002 1 2 3 $bot = ZMRobot::get(\"123456\"); // \u673a\u5668\u4ebaQQ\u53f7 $obj = $bot->sendGroupMsg(\"234567\", \"\u4f60\u597d\"); echo json_encode($obj, 128|256); 1 2 3 4 5 6 7 8 // \u8f93\u51fa\u7ed3\u679c { \"status\" : \"ok\" , \"retcode\" : 0 , \"data\" : { \"message_id\" : 1243 } } \u5982\u4e0a\uff0c $obj \u5c31\u662f\u6211\u4eec\u7684\u56de\u5305\u5185\u5bb9\uff0c\u6211\u4eec\u901a\u8fc7\u8c03\u7528 sendPrivateMsg() \u8fd9\u4e2a API \u540e\uff0c\u4f1a\u62ff\u5230\u673a\u5668\u4eba\u53d1\u9001\u6b64\u6761\u6d88\u606f\u7684\u6d88\u606f ID\uff0c\u7136\u540e\u53ef\u4ee5\u901a\u8fc7\u5b83\u6765\u8fdb\u884c\u5176\u4ed6\u64cd\u4f5c\uff08\u4f8b\u5982\u64a4\u56de\uff09\u3002 1 2 $result = $bot->deleteMsg($obj[\"data\"][\"message_id\"]); vardump($result[\"retcode\"]); //\u5982\u679c\u6210\u529f\u64a4\u56de\uff0c\u8f93\u51fa int(0)","title":"\u8fd4\u56de\u7ed3\u679c\u5904\u7406"},{"location":"component/bot/robot-api/#data","text":"\u72b6\u6001\u7801\u4e00\u822c\u60c5\u51b5\u6210\u529f\u90fd\u662f 0 \u6216\u8005 200\uff0c\u5728\u8fc7\u53bb\uff0c\u70b8\u6bdb\u6846\u67b6\u517c\u5bb9 CQHTTP \u63d2\u4ef6\u65f6\uff0c\u9519\u8bef\u7801\u7684\u6807\u51c6\u6309\u7167 CYKU \u7ed9\u51fa\u7684\u6807\u51c6\u7f16\u5199\uff0c\u4e0d\u540c\u7684 OneBot \u6807\u51c6\u7684\u5b9e\u73b0\uff0c\u53ef\u80fd\u6709\u4e0d\u540c\u7684\u6570\u503c\uff0c\u9700\u8981\u6839\u636e\u4f60\u5bf9\u63a5\u7684\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u8fdb\u884c\u9002\u914d\u3002 \u7ed3\u679c\u4e2d\u8fd4\u56de\u7684 data \u5b57\u6bb5\u6839\u636e\u4e0b\u65b9\u4e0d\u540c API \u7684\u8c03\u7528\u800c\u4e0d\u540c\uff0c\u5177\u4f53\u67e5\u770b\u6bcf\u4e2a API \u5199\u660e\u7684 \u54cd\u5e94\u6570\u636e \u8868\u683c\u3002","title":"\u72b6\u6001\u7801\u548c Data"},{"location":"component/bot/robot-api/#response","text":"\u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e status String \"ok\" \u72b6\u6001\u7801\u8bf4\u660e retcode number 0 \u8fd4\u56de\u72b6\u6001\u7801 data array \u89c1 data \u8868 \u6839\u636e\u4e0d\u540c\u7684 API \u8fd4\u56de\u4e0d\u540c","title":"response \u8868"},{"location":"component/bot/robot-api/#api","text":"","title":"\u673a\u5668\u4eba API \u65b9\u6cd5"},{"location":"component/bot/robot-api/#sendprivatemsg","text":"\u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e user_id number - \u5bf9\u65b9 QQ \u53f7 message message - \u8981\u53d1\u9001\u7684\u5185\u5bb9 auto_escape boolean false \u6d88\u606f\u5185\u5bb9\u662f\u5426\u4f5c\u4e3a\u7eaf\u6587\u672c\u53d1\u9001\uff08\u5373\u4e0d\u89e3\u6790 CQ \u7801\uff09\uff0c\u53ea\u5728 message \u5b57\u6bb5\u662f\u5b57\u7b26\u4e32\u65f6\u6709\u6548 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e message_id number (int32) \u6d88\u606f ID \u4f8b\u5b50 \u4ee3\u7801 1 2 $bot = ZMRobot::get(123456); // 123456\u662f\u4f60\u7684\u673a\u5668\u4ebaQQ $bot->sendPrivateMsg(\"627577391\", \"\u4f60\u597d\u554a\uff01\u4f60\u597d\u4f60\u597d\uff01\"); \u6548\u679c ( \u4f60\u597d\u554a\uff01\u4f60\u597d\u4f60\u597d\uff01","title":"sendPrivateMsg()"},{"location":"component/bot/robot-api/#sendgroupmsg","text":"\u53d1\u9001\u7fa4\u7ec4\u6d88\u606f\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 message message - \u8981\u53d1\u9001\u7684\u5185\u5bb9 auto_escape boolean false \u6d88\u606f\u5185\u5bb9\u662f\u5426\u4f5c\u4e3a\u7eaf\u6587\u672c\u53d1\u9001\uff08\u5373\u4e0d\u89e3\u6790 CQ \u7801\uff09\uff0c\u53ea\u5728 message \u5b57\u6bb5\u662f\u5b57\u7b26\u4e32\u65f6\u6709\u6548 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e message_id number (int32) \u6d88\u606f ID","title":"sendGroupMsg()"},{"location":"component/bot/robot-api/#sendmsg","text":"\u53d1\u9001\u6d88\u606f\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e message_type string - \u6d88\u606f\u7c7b\u578b\uff0c\u652f\u6301 private \u3001 group \u3001 discuss \uff0c\u5206\u522b\u5bf9\u5e94\u79c1\u804a\u3001\u7fa4\u7ec4\u3001\u8ba8\u8bba\u7ec4\uff0c\u5982\u4e0d\u4f20\u5165\uff0c\u5219\u6839\u636e\u4f20\u5165\u7684 *_id \u53c2\u6570\u5224\u65ad target_id number - \u76ee\u6807\u53f7\u7801\uff0c\u5982 QQ \u53f7\uff0c\u7fa4\u53f7\uff0c\u8ba8\u8bba\u7ec4\u53f7 message message - \u8981\u53d1\u9001\u7684\u5185\u5bb9 auto_escape boolean false \u6d88\u606f\u5185\u5bb9\u662f\u5426\u4f5c\u4e3a\u7eaf\u6587\u672c\u53d1\u9001\uff08\u5373\u4e0d\u89e3\u6790 CQ \u7801\uff09\uff0c\u53ea\u5728 message \u5b57\u6bb5\u662f\u5b57\u7b26\u4e32\u65f6\u6709\u6548 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e message_id number (int32) \u6d88\u606f ID","title":"sendMsg()"},{"location":"component/bot/robot-api/#deletemsg","text":"\u64a4\u56de\u6d88\u606f\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e message_id number (int32) - \u6d88\u606f ID \u54cd\u5e94\u6570\u636e\uff1a\u65e0","title":"deleteMsg()"},{"location":"component/bot/robot-api/#getmsg","text":"\u83b7\u53d6\u6d88\u606f\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e message_id number - \u6d88\u606f ID \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e time number (int32) \u53d1\u9001\u65f6\u95f4 message_type string \u6d88\u606f\u7c7b\u578b\uff0c\u540c \u6d88\u606f\u4e8b\u4ef6 message_id number (int32) \u6d88\u606f ID real_id number (int32) \u6d88\u606f\u771f\u5b9e ID sender object \u53d1\u9001\u4eba\u4fe1\u606f\uff0c\u540c \u6d88\u606f\u4e8b\u4ef6 message message \u6d88\u606f\u5185\u5bb9","title":"getMsg()"},{"location":"component/bot/robot-api/#getforwardmsg","text":"\u83b7\u53d6\u5408\u5e76\u8f6c\u53d1\u6d88\u606f\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e id string \u5408\u5e76\u8f6c\u53d1 ID \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u7c7b\u578b \u8bf4\u660e message message \u6d88\u606f\u5185\u5bb9\uff0c\u4f7f\u7528 \u6d88\u606f\u7684\u6570\u7ec4\u683c\u5f0f \u8868\u793a\uff0c\u6570\u7ec4\u4e2d\u7684\u6d88\u606f\u6bb5\u5168\u90e8\u4e3a node \u6d88\u606f\u6bb5","title":"getForwardMsg()"},{"location":"component/bot/robot-api/#sendlike","text":"\u53d1\u9001\u597d\u53cb\u8d5e\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e user_id number - \u5bf9\u65b9 QQ \u53f7 times number 1 \u8d5e\u7684\u6b21\u6570\uff0c\u6bcf\u4e2a\u597d\u53cb\u6bcf\u5929\u6700\u591a 10 \u6b21 \u54cd\u5e94\u6570\u636e \u65e0","title":"sendLike()"},{"location":"component/bot/robot-api/#setgroupkick","text":"\u7fa4\u7ec4\u8e22\u4eba\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 user_id number - \u8981\u8e22\u7684 QQ \u53f7 reject_add_request boolean false \u62d2\u7edd\u6b64\u4eba\u7684\u52a0\u7fa4\u8bf7\u6c42 \u54cd\u5e94\u6570\u636e\uff1a\u65e0","title":"setGroupKick()"},{"location":"component/bot/robot-api/#setgroupban","text":"\u7fa4\u7ec4\u5355\u4eba\u7981\u8a00\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 user_id number - \u8981\u7981\u8a00\u7684 QQ \u53f7 duration number 30 * 60 \u7981\u8a00\u65f6\u957f\uff0c\u5355\u4f4d\u79d2\uff0c0 \u8868\u793a\u53d6\u6d88\u7981\u8a00 \u54cd\u5e94\u6570\u636e\uff1a\u65e0","title":"setGroupBan()"},{"location":"component/bot/robot-api/#setgroupanonymousban","text":"\u7fa4\u7ec4\u533f\u540d\u7528\u6237\u7981\u8a00\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 anonymous_or_flag object \u6216 string - \u8981\u7981\u8a00\u7684\u533f\u540d\u7528\u6237\u5bf9\u8c61\uff08\u7fa4\u6d88\u606f\u4e0a\u62a5\u7684 anonymous \u5b57\u6bb5\uff09\u6216\u7528\u6237\u7684 flag duration number 30 * 60 \u7981\u8a00\u65f6\u957f\uff0c\u5355\u4f4d\u79d2\uff0c\u65e0\u6cd5\u53d6\u6d88\u533f\u540d\u7528\u6237\u7981\u8a00 \u4e0a\u9762\u7684 anonymous_or_flag \u4e24\u8005\u4efb\u9009\u5176\u4e00\u4f20\u5165\u5373\u53ef\u3002 \u54cd\u5e94\u6570\u636e\uff1a\u65e0","title":"setGroupAnonymousBan()"},{"location":"component/bot/robot-api/#setgroupwholeban","text":"\u7fa4\u7ec4\u5168\u5458\u7981\u8a00 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 enable boolean true \u662f\u5426\u7981\u8a00 \u54cd\u5e94\u6570\u636e\uff1a\u65e0","title":"setGroupWholeBan()"},{"location":"component/bot/robot-api/#setgroupadmin","text":"\u7fa4\u7ec4\u8bbe\u7f6e\u7ba1\u7406\u5458 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 user_id number - \u8981\u8bbe\u7f6e\u7ba1\u7406\u5458\u7684 QQ \u53f7 enable boolean true true \u4e3a\u8bbe\u7f6e\uff0cfalse \u4e3a\u53d6\u6d88 \u54cd\u5e94\u6570\u636e\uff1a\u65e0","title":"setGroupAdmin()"},{"location":"component/bot/robot-api/#setgroupanonymous","text":"\u7fa4\u7ec4\u533f\u540d \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 enable boolean true \u662f\u5426\u5141\u8bb8\u533f\u540d\u804a\u5929 \u54cd\u5e94\u6570\u636e\uff1a\u65e0","title":"setGroupAnonymous()"},{"location":"component/bot/robot-api/#setgroupcard","text":"\u8bbe\u7f6e\u7fa4\u540d\u7247\uff08\u7fa4\u5907\u6ce8\uff09 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 user_id number - \u8981\u8bbe\u7f6e\u7684 QQ \u53f7 card string \u7a7a \u7fa4\u540d\u7247\u5185\u5bb9\uff0c\u4e0d\u586b\u6216\u7a7a\u5b57\u7b26\u4e32\u8868\u793a\u5220\u9664\u7fa4\u540d\u7247 \u54cd\u5e94\u6570\u636e\uff1a\u65e0","title":"setGroupCard()"},{"location":"component/bot/robot-api/#setgroupname","text":"\u8bbe\u7f6e\u7fa4\u540d\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e group_id number (int64) \u7fa4\u53f7 group_name string \u65b0\u7fa4\u540d \u54cd\u5e94\u6570\u636e\uff1a\u65e0","title":"setGroupName()"},{"location":"component/bot/robot-api/#setgroupleave","text":"\u9000\u51fa\u7fa4\u7ec4 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 is_dismiss boolean false \u662f\u5426\u89e3\u6563\uff0c\u5982\u679c\u767b\u5f55\u53f7\u662f\u7fa4\u4e3b\uff0c\u5219\u4ec5\u5728\u6b64\u9879\u4e3a true \u65f6\u80fd\u591f\u89e3\u6563 \u54cd\u5e94\u6570\u636e\uff1a\u65e0","title":"setGroupLeave()"},{"location":"component/bot/robot-api/#setgroupspecialtitle","text":"\u8bbe\u7f6e\u7fa4\u7ec4\u4e13\u5c5e\u5934\u8854 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 user_id number - \u8981\u8bbe\u7f6e\u7684 QQ \u53f7 special_title string \u7a7a \u4e13\u5c5e\u5934\u8854\uff0c\u4e0d\u586b\u6216\u7a7a\u5b57\u7b26\u4e32\u8868\u793a\u5220\u9664\u4e13\u5c5e\u5934\u8854 duration number -1 \u4e13\u5c5e\u5934\u8854\u6709\u6548\u671f\uff0c\u5355\u4f4d\u79d2\uff0c-1 \u8868\u793a\u6c38\u4e45\uff0c\u4e0d\u8fc7\u6b64\u9879\u4f3c\u4e4e\u6ca1\u6709\u6548\u679c\uff0c\u53ef\u80fd\u662f\u53ea\u6709\u67d0\u4e9b\u7279\u6b8a\u7684\u65f6\u95f4\u957f\u5ea6\u6709\u6548\uff0c\u6709\u5f85\u6d4b\u8bd5 \u54cd\u5e94\u6570\u636e\uff1a\u65e0","title":"setGroupSpecialTitle()"},{"location":"component/bot/robot-api/#setfriendaddrequest","text":"\u5904\u7406\u52a0\u597d\u53cb\u8bf7\u6c42 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e flag string - \u52a0\u597d\u53cb\u8bf7\u6c42\u7684 flag\uff08\u9700\u4ece\u4e0a\u62a5\u7684\u6570\u636e\u4e2d\u83b7\u5f97\uff09 approve boolean true \u662f\u5426\u540c\u610f\u8bf7\u6c42 remark string \u7a7a \u6dfb\u52a0\u540e\u7684\u597d\u53cb\u5907\u6ce8\uff08\u4ec5\u5728\u540c\u610f\u65f6\u6709\u6548\uff09 \u54cd\u5e94\u6570\u636e\uff1a\u65e0","title":"setFriendAddRequest()"},{"location":"component/bot/robot-api/#setgroupaddrequest","text":"\u5904\u7406\u52a0\u7fa4\u8bf7\u6c42 / \u9080\u8bf7 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e flag string - \u52a0\u7fa4\u8bf7\u6c42\u7684 flag\uff08\u9700\u4ece\u4e0a\u62a5\u7684\u6570\u636e\u4e2d\u83b7\u5f97\uff09 sub_type string - add \u6216 invite \uff0c\u8bf7\u6c42\u7c7b\u578b\uff08\u9700\u8981\u548c\u4e0a\u62a5\u6d88\u606f\u4e2d\u7684 sub_type \u5b57\u6bb5\u76f8\u7b26\uff09 approve boolean true \u662f\u5426\u540c\u610f\u8bf7\u6c42\uff0f\u9080\u8bf7 reason string \u7a7a \u62d2\u7edd\u7406\u7531\uff08\u4ec5\u5728\u62d2\u7edd\u65f6\u6709\u6548\uff09 \u54cd\u5e94\u6570\u636e\u65e0","title":"setGroupAddRequest()"},{"location":"component/bot/robot-api/#getlogininfo","text":"\u83b7\u53d6\u767b\u5f55\u53f7\u4fe1\u606f \u53c2\u6570\uff1a\u65e0 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e user_id number (int64) QQ \u53f7 nickname string QQ \u6635\u79f0","title":"getLoginInfo()"},{"location":"component/bot/robot-api/#getstrangerinfo","text":"\u83b7\u53d6\u964c\u751f\u4eba\u4fe1\u606f \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e user_id number - QQ \u53f7 no_cache boolean false \u662f\u5426\u4e0d\u4f7f\u7528\u7f13\u5b58\uff08\u4f7f\u7528\u7f13\u5b58\u53ef\u80fd\u66f4\u65b0\u4e0d\u53ca\u65f6\uff0c\u4f46\u54cd\u5e94\u66f4\u5feb\uff09 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e user_id number (int64) QQ \u53f7 nickname string \u6635\u79f0 sex string \u6027\u522b\uff0c male \u6216 female \u6216 unknown age number (int32) \u5e74\u9f84","title":"getStrangerInfo()"},{"location":"component/bot/robot-api/#getfriendlist","text":"\u83b7\u53d6\u597d\u53cb\u5217\u8868 \u53c2\u6570\uff1a\u65e0 \u54cd\u5e94\u6570\u636e \u54cd\u5e94\u5185\u5bb9\u4e3a JSON \u6570\u7ec4\uff0c\u6bcf\u4e2a\u5143\u7d20\u5982\u4e0b\uff1a \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e user_id number (int64) QQ \u53f7 nickname string \u6635\u79f0 remark string \u5907\u6ce8\u540d","title":"getFriendList()"},{"location":"component/bot/robot-api/#getgroupinfo","text":"\u83b7\u53d6\u7fa4\u4fe1\u606f \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 no_cache boolean false \u662f\u5426\u4e0d\u4f7f\u7528\u7f13\u5b58\uff08\u4f7f\u7528\u7f13\u5b58\u53ef\u80fd\u66f4\u65b0\u4e0d\u53ca\u65f6\uff0c\u4f46\u54cd\u5e94\u66f4\u5feb\uff09 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e group_id number (int64) \u7fa4\u53f7 group_name string \u7fa4\u540d\u79f0 member_count number (int32) \u6210\u5458\u6570 max_member_count number (int32) \u6700\u5927\u6210\u5458\u6570\uff08\u7fa4\u5bb9\u91cf\uff09","title":"getGroupInfo()"},{"location":"component/bot/robot-api/#getgrouplist","text":"\u83b7\u53d6\u7fa4\u5217\u8868 \u53c2\u6570\uff1a\u65e0 \u54cd\u5e94\u6570\u636e \u54cd\u5e94\u5185\u5bb9\u4e3a JSON \u6570\u7ec4\uff0c\u6bcf\u4e2a\u5143\u7d20\u5982\u4e0b\uff1a \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e group_id number (int64) \u7fa4\u53f7 group_name string \u7fa4\u540d\u79f0","title":"getGroupList()"},{"location":"component/bot/robot-api/#getgroupmemberinfo","text":"\u83b7\u53d6\u7fa4\u6210\u5458\u4fe1\u606f \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 user_id number - QQ \u53f7 no_cache boolean false \u662f\u5426\u4e0d\u4f7f\u7528\u7f13\u5b58\uff08\u4f7f\u7528\u7f13\u5b58\u53ef\u80fd\u66f4\u65b0\u4e0d\u53ca\u65f6\uff0c\u4f46\u54cd\u5e94\u66f4\u5feb\uff09 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e group_id number (int64) \u7fa4\u53f7 user_id number (int64) QQ \u53f7 nickname string \u6635\u79f0 card string \u7fa4\u540d\u7247\uff0f\u5907\u6ce8 sex string \u6027\u522b\uff0c male \u6216 female \u6216 unknown age number (int32) \u5e74\u9f84 area string \u5730\u533a join_time number (int32) \u52a0\u7fa4\u65f6\u95f4\u6233 last_sent_time number (int32) \u6700\u540e\u53d1\u8a00\u65f6\u95f4\u6233 level string \u6210\u5458\u7b49\u7ea7 role string \u89d2\u8272\uff0c owner \u6216 admin \u6216 member unfriendly boolean \u662f\u5426\u4e0d\u826f\u8bb0\u5f55\u6210\u5458 title string \u4e13\u5c5e\u5934\u8854 title_expire_time number (int32) \u4e13\u5c5e\u5934\u8854\u8fc7\u671f\u65f6\u95f4\u6233 card_changeable boolean \u662f\u5426\u5141\u8bb8\u4fee\u6539\u7fa4\u540d\u7247","title":"getGroupMemberInfo()"},{"location":"component/bot/robot-api/#getgroupmemberlist","text":"\u83b7\u53d6\u7fa4\u6210\u5458\u5217\u8868 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number - \u7fa4\u53f7 \u54cd\u5e94\u6570\u636e \u54cd\u5e94\u5185\u5bb9\u4e3a JSON \u6570\u7ec4\uff0c\u6bcf\u4e2a\u5143\u7d20\u7684\u5185\u5bb9\u548c\u4e0a\u9762\u7684 /get_group_member_info \u63a5\u53e3\u76f8\u540c\uff0c\u4f46\u5bf9\u4e8e\u540c\u4e00\u4e2a\u7fa4\u7ec4\u7684\u540c\u4e00\u4e2a\u6210\u5458\uff0c\u83b7\u53d6\u5217\u8868\u65f6\u548c\u83b7\u53d6\u5355\u72ec\u7684\u6210\u5458\u4fe1\u606f\u65f6\uff0c\u67d0\u4e9b\u5b57\u6bb5\u53ef\u80fd\u6709\u6240\u4e0d\u540c\uff0c\u4f8b\u5982 area \u3001 title \u7b49\u5b57\u6bb5\u5728\u83b7\u53d6\u5217\u8868\u65f6\u65e0\u6cd5\u83b7\u5f97\uff0c\u5177\u4f53\u5e94\u4ee5\u5355\u72ec\u7684\u6210\u5458\u4fe1\u606f\u4e3a\u51c6\u3002","title":"getGroupMemberList()"},{"location":"component/bot/robot-api/#getgrouphonorinfo","text":"\u83b7\u53d6\u7fa4\u8363\u8a89\u4fe1\u606f\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e group_id number (int64) - \u7fa4\u53f7 type string - \u8981\u83b7\u53d6\u7684\u7fa4\u8363\u8a89\u7c7b\u578b\uff0c\u53ef\u4f20\u5165 talkative performer legend strong_newbie emotion \u4ee5\u5206\u522b\u83b7\u53d6\u5355\u4e2a\u7c7b\u578b\u7684\u7fa4\u8363\u8a89\u6570\u636e\uff0c\u6216\u4f20\u5165 all \u83b7\u53d6\u6240\u6709\u6570\u636e \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e group_id number (int64) \u7fa4\u53f7 current_talkative object \u5f53\u524d\u9f99\u738b\uff0c\u4ec5 type \u4e3a talkative \u6216 all \u65f6\u6709\u6570\u636e talkative_list array \u5386\u53f2\u9f99\u738b\uff0c\u4ec5 type \u4e3a talkative \u6216 all \u65f6\u6709\u6570\u636e performer_list array \u7fa4\u804a\u4e4b\u706b\uff0c\u4ec5 type \u4e3a performer \u6216 all \u65f6\u6709\u6570\u636e legend_list array \u7fa4\u804a\u70bd\u7130\uff0c\u4ec5 type \u4e3a legend \u6216 all \u65f6\u6709\u6570\u636e strong_newbie_list array \u5192\u5c16\u5c0f\u6625\u7b0b\uff0c\u4ec5 type \u4e3a strong_newbie \u6216 all \u65f6\u6709\u6570\u636e emotion_list array \u5feb\u4e50\u4e4b\u6e90\uff0c\u4ec5 type \u4e3a emotion \u6216 all \u65f6\u6709\u6570\u636e \u5176\u4e2d current_talkative \u5b57\u6bb5\u7684\u5185\u5bb9\u5982\u4e0b\uff1a \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e user_id number (int64) QQ \u53f7 nickname string \u6635\u79f0 avatar string \u5934\u50cf URL day_count number (int32) \u6301\u7eed\u5929\u6570 \u5176\u5b83\u5404 *_list \u7684\u6bcf\u4e2a\u5143\u7d20\u662f\u4e00\u4e2a JSON \u5bf9\u8c61\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e user_id number (int64) QQ \u53f7 nickname string \u6635\u79f0 avatar string \u5934\u50cf URL description string \u8363\u8a89\u63cf\u8ff0","title":"getGroupHonorInfo()"},{"location":"component/bot/robot-api/#getcookies","text":"\u83b7\u53d6 Cookies\u3002 \u6ce8\u610f \u76ee\u524d\u5f00\u6e90\u7684 mirai \u4e3a\u5e95\u5c42\u7684\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u5747\u4e0d\u652f\u6301\u83b7\u53d6 Cookies \u548c CSRF Token\uff0c\u5305\u62ec go-cqhttp\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e domain string \u7a7a \u9700\u8981\u83b7\u53d6 cookies \u7684\u57df\u540d \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e cookies string Cookies","title":"getCookies()"},{"location":"component/bot/robot-api/#getcsrftoken","text":"\u83b7\u53d6 CSRF Token \u53c2\u6570\uff1a\u65e0 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e token number (int32) CSRF Token","title":"getCsrfToken()"},{"location":"component/bot/robot-api/#getcredentials","text":"\u83b7\u53d6 QQ \u76f8\u5173\u63a5\u53e3\u51ed\u8bc1\uff0c\u5373\u4e0a\u9762\u4e24\u4e2a\u5408\u5e76\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e domain string \u7a7a \u9700\u8981\u83b7\u53d6 cookies \u7684\u57df\u540d \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e cookies string Cookies csrf_token number (int32) CSRF Token","title":"getCredentials()"},{"location":"component/bot/robot-api/#getrecord","text":"\u83b7\u53d6\u8bed\u97f3\u3002\u5176\u5b9e\u5e76\u4e0d\u662f\u771f\u7684\u83b7\u53d6\u8bed\u97f3\uff0c\u800c\u662f\u8f6c\u6362\u8bed\u97f3\u5230\u6307\u5b9a\u7684\u683c\u5f0f\u3002 \u63d0\u793a \uff1a\u8981\u4f7f\u7528\u6b64\u63a5\u53e3\uff0c\u901a\u5e38\u9700\u8981\u5b89\u88c5 ffmpeg\uff0c\u8bf7\u53c2\u8003 OneBot \u5b9e\u73b0\u7684\u76f8\u5173\u8bf4\u660e\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e file string - \u6536\u5230\u7684\u8bed\u97f3\u6587\u4ef6\u540d\uff08CQ \u7801\u7684 file \u53c2\u6570\uff09\uff0c\u5982 0B38145AA44505000B38145AA4450500.silk out_format string - \u8981\u8f6c\u6362\u5230\u7684\u683c\u5f0f\uff0c\u76ee\u524d\u652f\u6301 mp3 \u3001 amr \u3001 wma \u3001 m4a \u3001 spx \u3001 ogg \u3001 wav \u3001 flac \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e file string \u8f6c\u6362\u540e\u7684\u8bed\u97f3\u6587\u4ef6\u8def\u5f84\uff0c\u5982 /home/somebody/cqhttp/data/record/0B38145AA44505000B38145AA4450500.mp3","title":"getRecord()"},{"location":"component/bot/robot-api/#getimage","text":"\u83b7\u53d6\u56fe\u7247\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e file string - \u6536\u5230\u7684\u56fe\u7247\u6587\u4ef6\u540d\uff08CQ \u7801\u7684 file \u53c2\u6570\uff09\uff0c\u5982 6B4DE3DFD1BD271E3297859D41C530F5.jpg \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e file string \u4e0b\u8f7d\u540e\u7684\u56fe\u7247\u6587\u4ef6\u8def\u5f84\uff0c\u5982 /home/somebody/cqhttp/data/image/6B4DE3DFD1BD271E3297859D41C530F5.jpg","title":"getImage()"},{"location":"component/bot/robot-api/#cansendimage","text":"\u68c0\u67e5\u662f\u5426\u53ef\u4ee5\u53d1\u9001\u56fe\u7247\u3002 \u53c2\u6570\uff1a\u65e0 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e yes boolean \u662f\u6216\u5426","title":"canSendImage()"},{"location":"component/bot/robot-api/#cansendrecord","text":"\u68c0\u67e5\u662f\u5426\u53ef\u4ee5\u53d1\u9001\u8bed\u97f3\uff0c\u8fd4\u56de\u540c\u4e0a\u3002","title":"canSendRecord()"},{"location":"component/bot/robot-api/#getstatus","text":"\u83b7\u53d6\u63d2\u4ef6\u8fd0\u884c\u72b6\u6001\u3002 \u53c2\u6570\uff1a\u65e0 \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e online boolean \u5f53\u524d QQ \u5728\u7ebf\uff0c null \u8868\u793a\u65e0\u6cd5\u67e5\u8be2\u5230\u5728\u7ebf\u72b6\u6001 good boolean \u72b6\u6001\u7b26\u5408\u9884\u671f\uff0c\u610f\u5473\u7740\u5404\u6a21\u5757\u6b63\u5e38\u8fd0\u884c\u3001\u529f\u80fd\u6b63\u5e38\uff0c\u4e14 QQ \u5728\u7ebf ...... - OneBot \u5b9e\u4f8b\u81ea\u884c\u6dfb\u52a0\u7684\u5176\u4ed6\u5185\u5bb9 \u901a\u5e38\u60c5\u51b5\u4e0b\u5efa\u8bae\u53ea\u4f7f\u7528 online \u548c good \u8fd9\u4e24\u4e2a\u5b57\u6bb5\u6765\u5224\u65ad\u8fd0\u884c\u72b6\u6001\uff0c\u56e0\u4e3a\u6839\u636e OneBot \u5b9e\u73b0\u7684\u4e0d\u540c\uff0c\u5176\u5b83\u5b57\u6bb5\u53ef\u80fd\u5b8c\u5168\u4e0d\u540c\u3002","title":"getStatus()"},{"location":"component/bot/robot-api/#getversioninfo","text":"\u83b7\u53d6\u7248\u672c\u4fe1\u606f \u54cd\u5e94\u6570\u636e \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u8bf4\u660e app_name string \u5e94\u7528\u6807\u8bc6\uff0c\u5982 mirai-native app_version string \u5e94\u7528\u7248\u672c\uff0c\u5982 1.2.3 protocol_version string OneBot \u6807\u51c6\u7248\u672c\uff0c\u5982 v11 \u2026\u2026 - OneBot \u5b9e\u73b0\u81ea\u884c\u6dfb\u52a0\u7684\u5176\u5b83\u5185\u5bb9","title":"getVersionInfo()"},{"location":"component/bot/robot-api/#setrestartplugin","text":"\u91cd\u542f OneBot \u5ba2\u6237\u7aef \u7531\u4e8e\u91cd\u542f OneBot \u5b9e\u73b0\u540c\u65f6\u9700\u8981\u91cd\u542f API \u670d\u52a1\uff0c\u8fd9\u610f\u5473\u7740\u5f53\u524d\u7684 API \u8bf7\u6c42\u4f1a\u88ab\u4e2d\u65ad\uff0c\u56e0\u6b64\u9700\u8981\u5f02\u6b65\u5730\u91cd\u542f\uff0c\u63a5\u53e3\u8fd4\u56de\u7684 status \u662f async \u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c \u8bf4\u660e delay number 0 \u8981\u5ef6\u8fdf\u7684\u6beb\u79d2\u6570\uff0c\u5982\u679c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u65e0\u6cd5\u91cd\u542f\uff0c\u53ef\u4ee5\u5c1d\u8bd5\u8bbe\u7f6e\u5ef6\u8fdf\u4e3a 2000 \u5de6\u53f3 \u54cd\u5e94\u6570\u636e\uff1a\u65e0","title":"setRestartPlugin()"},{"location":"component/bot/robot-api/#cleancache","text":"\u6e05\u7406 OneBot \u5ba2\u6237\u7aef\u7684\u7f13\u5b58\u3002 \u53c2\u6570\uff1a\u65e0 \u54cd\u5e94\u6570\u636e\uff1a\u65e0","title":"cleanCache()"},{"location":"component/bot/robot-api/#callextendedapi-api","text":"\u7528\u6765\u8c03\u7528 OneBot \u6807\u51c6\u4e4b\u5916\u6269\u5c55\u51fa\u6765\u7684\u81ea\u5b9a\u4e49 API\u3002 \u4f7f\u7528\u4e0d\u540c OneBot \u5ba2\u6237\u7aef\u65f6\uff0c\u53ef\u80fd\u6709\u4e00\u4e9b API \u4e0d\u5728\u4e0a\u65b9\u7684 OneBot \u6807\u51c6\u91cc\uff0c\u8fd9\u65f6\u53ef\u4ee5\u4f7f\u7528\u6b64\u65b9\u6cd5\u8fdb\u884c\u989d\u5916\u8c03\u7528\u3002 \u53c2\u6570 \u5b57\u6bb5\u540d \u6570\u636e\u7c7b\u578b \u9ed8\u8ba4\u503c action string \u5fc5\u586b params array [] \u4f8b\u5b50 1 2 3 4 $result = $bot->callExtendedAPI(\"get_group_root_files\", [\"group_id\" => 123456]); //\u8fd9\u91cc\u4ee5 go-cqhttp \u6269\u5c55\u7684\u4e00\u4e2a\u83b7\u53d6\u7fa4\u6587\u4ef6\u7684 API \u4e3a\u4f8b var_dump($result[\"data\"]); // \u8f93\u51fa\u7fa4\u6587\u4ef6\u5217\u8868","title":"callExtendedAPI() \uff08\u6269\u5145 API\uff09"},{"location":"component/bot/turing-api/","text":"\u56fe\u7075\u673a\u5668\u4eba API\uff08TuringAPI\uff09 \u7c7b\u5b9a\u4e49\uff1a \\ZM\\API\\TuringAPI \u65b9\u6cd5 TuringAPI::getTuringMsg() \u8bf7\u6c42\u56fe\u7075\u63a5\u53e3\uff0c\u8fd4\u56de\u56de\u590d\u7684\u6d88\u606f\u3002 \u5b9a\u4e49\uff1a getTuringMsg($msg, $user_id, $api) \u53c2\u6570 $msg \u4e3a\u7528\u6237\u7684\u6d88\u606f\u5185\u5bb9\uff0c\u5982\u679c\u542b\u6709\u56fe\u7247 CQ \u7801\uff0c\u5219\u81ea\u52a8\u8f6c\u6362\u4e3a\u56fe\u7075\u517c\u5bb9\u7684\u63a5\u53e3\u6a21\u5f0f\u3002 \u53c2\u6570 $user_id \u4e3a\u7528\u6237 ID\uff0c\u4e00\u822c\u9ed8\u8ba4\u7ed9 QQ \u53f7\u7801\u5c31\u53ef\u4ee5\u4e86\uff0c\u6ce8\u610f\u6700\u597d\u4e0d\u8981\u6709\u7279\u6b8a\u5b57\u7b26\uff08\u5982 ./\\<>* \u7b49\uff09\uff0c\u5426\u5219\u4f1a\u95f4\u65ad\u6027\u8c03\u7528\u5931\u8d25\u3002 \u53c2\u6570 $api \u4e3a\u56fe\u7075\u673a\u5668\u4eba\u7684 apikey \uff0c\u53ef\u4ee5\u5230 http://www.turingapi.com/ \u7533\u8bf7\u514d\u8d39\u6216\u4ed8\u8d39\u7684 API key\u3002 \u5728\u6846\u67b6\u7684\u793a\u4f8b\u6a21\u5757\u4e2d\uff0c\u5df2\u7ecf\u5199\u597d\u4e86\u4e00\u4e2a\u6b63\u5e38\u673a\u5668\u4eba\u54cd\u5e94\u56fe\u7075\u56de\u590d\u7684\u547d\u4ee4\uff0c\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 class Hello { /** * \u56fe\u7075\u673a\u5668\u4eba\u7684\u5185\u7f6e\u5b9e\u73b0\uff0c\u5728www.turingapi.com\u7533\u8bf7\u4e00\u4e2aapikey\u586b\u5165\u4e0b\u65b9\u53d8\u91cf\u5373\u53ef\u3002 * @CQCommand(start_with=\"\u673a\u5668\u4eba\",end_with=\"\u673a\u5668\u4eba\",message_type=\"group\") * @CQMessage(message_type=\"private\",level=1) */ public function turingAPI() { $user_id = ctx()->getUserId(); $api = \"\"; // \u8bf7\u5728\u8fd9\u91cc\u586b\u5165\u4f60\u7684\u56fe\u7075\u673a\u5668\u4eba\u7684apikey if ($api === \"\") return false; //\u5982\u679c\u6ca1\u6709\u586b\u5165apikey\u5219\u6b64\u529f\u80fd\u5173\u95ed if (($this->_running_annotation ?? null) instanceof CQCommand) { $msg = ctx()->getFullArg(\"\u6211\u5728\uff01\u6709\u4ec0\u4e48\u4e8b\u5417\uff1f\"); } else { $msg = ctx()->getMessage(); } ctx()->setMessage($msg); if (MessageUtil::matchCommand($msg, ctx()->getData())->status === false) { return TuringAPI::getTuringMsg($msg, $user_id, $api); } else { QQBot::getInstance()->handle(ctx()->getData(), ctx()->getCache(\"level\") + 1); return true; } } /** * \u54cd\u5e94at\u673a\u5668\u4eba\u7684\u6d88\u606f * @CQBefore(\"message\") */ public function changeAt() { if (MessageUtil::isAtMe(ctx()->getMessage(), ctx()->getRobotId())) { $msg = str_replace(CQ::at(ctx()->getRobotId()), \"\", ctx()->getMessage()); ctx()->setMessage(\"\u673a\u5668\u4eba\" . $msg); Console::info(ctx()->getMessage()); } return true; } } \u5982\u4e0a\u8ff0\u4ee3\u7801\uff0c\u6211\u4eec\u5c06\u7533\u8bf7\u7684 apikey \u586b\u5165\u53d8\u91cf $api \u4e2d\uff0c\u542f\u52a8\u673a\u5668\u4eba\u5373\u53ef\u4f7f\u7528\uff0c\u4ee5\u4e0b\u662f\u5b9e\u6d4b\u6d88\u606f\uff08\u6211\u7528\u81ea\u5df1\u7533\u8bf7\u7684 key \u505a\u6d4b\u8bd5\u56de\u590d\u7684\u6d88\u606f\uff09\u3002 ) \u4f60\u548b\u4e86 ( \u6211\u6ca1\u4e8b\u54e6\uff0c\u8c22\u8c22\u60a8\u7684\u5173\u5fc3\u3002 ) \u4e0a\u6d77\u5929\u6c14 ( \u4e0a\u6d77:\u5468\u4e00 03\u670829\u65e5,\u5c0f\u96e8 \u4e1c\u5357\u98ce\u8f6c\u4e1c\u98ce,\u6700\u4f4e\u6c14\u6e2914\u5ea6\uff0c\u6700\u9ad8\u6c14\u6e2924\u5ea6\u3002 ^ \u5207\u6362\u4e3a\u7fa4\u5185 ) \u673a\u5668\u4eba ( \u6211\u5728\uff01\u6709\u4ec0\u4e48\u4e8b\u5417\uff1f ) \u4f60\u53eb\u5565 ( \u6211\u7684\u540d\u5b57\u53eb\u70b8\u6bdb\uff0c\u8ba4\u8bc6\u4f60\u5f88\u9ad8\u5174\u5462\uff01 \u5728\u9ed8\u8ba4\u793a\u4f8b\u6a21\u5757\u4e2d\u7684\u4f8b\u5b50\u662f\u76f4\u63a5\u53ef\u4ee5\u62ff\u6765\u7528\u7684\uff0c\u8fd9\u6bb5\u4ee3\u7801\u540c\u65f6\u505a\u4e86\u5bf9 at \u7684\u5904\u7406\u3001\u4ee5\u53ca\u517c\u5bb9\u7528\u6237\u81ea\u5b9a\u4e49\u5199\u7684\u5176\u4ed6\u547d\u4ee4\u7684\u65b9\u5f0f\uff0c\u4e0b\u9762\u662f\u9ed8\u8ba4\u6a21\u5757\u586b\u597d apikey \u540e\u53ef\u4ee5\u7528\u7684\u5404\u79cd\u65b9\u5f0f\u63d0\u95ee\uff1a ^ \u5207\u6362\u4e3a\u7fa4\u5185 ) \u6211\u662f\u4e00\u6761\u666e\u901a\u6d88\u606f\uff0c\u8fd9\u6761\u673a\u5668\u4eba\u4e0d\u4f1a\u56de\u590d\u6211 ) @\u673a\u5668\u4eba \u4f60\u53eb\u5565 ( \u6211\u662f\u806a\u660e\u53ef\u7231\u7684\u70b8\u6bdb\uff0c\u8ba4\u8bc6\u4f60\u5f88\u9ad8\u5174\u3002 ) \u673a\u5668\u4eba ( \u6211\u5728\uff01\u6709\u4ec0\u4e48\u4e8b\u5417\uff1f ) \u4e00\u8a00 ( \u591a\u5c11\u4e8b\uff0c\u4ece\u6765\u6025\uff0c\u5929\u5730\u8f6c\uff0c\u5149\u9634\u8feb\uff0c\u4e00\u4e07\u5e74\u592a\u4e45\uff0c\u53ea\u4e89\u671d\u5915\u3002","title":"\u56fe\u7075\u673a\u5668\u4eba API"},{"location":"component/bot/turing-api/#apituringapi","text":"\u7c7b\u5b9a\u4e49\uff1a \\ZM\\API\\TuringAPI","title":"\u56fe\u7075\u673a\u5668\u4eba API\uff08TuringAPI\uff09"},{"location":"component/bot/turing-api/#_1","text":"","title":"\u65b9\u6cd5"},{"location":"component/bot/turing-api/#turingapigetturingmsg","text":"\u8bf7\u6c42\u56fe\u7075\u63a5\u53e3\uff0c\u8fd4\u56de\u56de\u590d\u7684\u6d88\u606f\u3002 \u5b9a\u4e49\uff1a getTuringMsg($msg, $user_id, $api) \u53c2\u6570 $msg \u4e3a\u7528\u6237\u7684\u6d88\u606f\u5185\u5bb9\uff0c\u5982\u679c\u542b\u6709\u56fe\u7247 CQ \u7801\uff0c\u5219\u81ea\u52a8\u8f6c\u6362\u4e3a\u56fe\u7075\u517c\u5bb9\u7684\u63a5\u53e3\u6a21\u5f0f\u3002 \u53c2\u6570 $user_id \u4e3a\u7528\u6237 ID\uff0c\u4e00\u822c\u9ed8\u8ba4\u7ed9 QQ \u53f7\u7801\u5c31\u53ef\u4ee5\u4e86\uff0c\u6ce8\u610f\u6700\u597d\u4e0d\u8981\u6709\u7279\u6b8a\u5b57\u7b26\uff08\u5982 ./\\<>* \u7b49\uff09\uff0c\u5426\u5219\u4f1a\u95f4\u65ad\u6027\u8c03\u7528\u5931\u8d25\u3002 \u53c2\u6570 $api \u4e3a\u56fe\u7075\u673a\u5668\u4eba\u7684 apikey \uff0c\u53ef\u4ee5\u5230 http://www.turingapi.com/ \u7533\u8bf7\u514d\u8d39\u6216\u4ed8\u8d39\u7684 API key\u3002 \u5728\u6846\u67b6\u7684\u793a\u4f8b\u6a21\u5757\u4e2d\uff0c\u5df2\u7ecf\u5199\u597d\u4e86\u4e00\u4e2a\u6b63\u5e38\u673a\u5668\u4eba\u54cd\u5e94\u56fe\u7075\u56de\u590d\u7684\u547d\u4ee4\uff0c\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 class Hello { /** * \u56fe\u7075\u673a\u5668\u4eba\u7684\u5185\u7f6e\u5b9e\u73b0\uff0c\u5728www.turingapi.com\u7533\u8bf7\u4e00\u4e2aapikey\u586b\u5165\u4e0b\u65b9\u53d8\u91cf\u5373\u53ef\u3002 * @CQCommand(start_with=\"\u673a\u5668\u4eba\",end_with=\"\u673a\u5668\u4eba\",message_type=\"group\") * @CQMessage(message_type=\"private\",level=1) */ public function turingAPI() { $user_id = ctx()->getUserId(); $api = \"\"; // \u8bf7\u5728\u8fd9\u91cc\u586b\u5165\u4f60\u7684\u56fe\u7075\u673a\u5668\u4eba\u7684apikey if ($api === \"\") return false; //\u5982\u679c\u6ca1\u6709\u586b\u5165apikey\u5219\u6b64\u529f\u80fd\u5173\u95ed if (($this->_running_annotation ?? null) instanceof CQCommand) { $msg = ctx()->getFullArg(\"\u6211\u5728\uff01\u6709\u4ec0\u4e48\u4e8b\u5417\uff1f\"); } else { $msg = ctx()->getMessage(); } ctx()->setMessage($msg); if (MessageUtil::matchCommand($msg, ctx()->getData())->status === false) { return TuringAPI::getTuringMsg($msg, $user_id, $api); } else { QQBot::getInstance()->handle(ctx()->getData(), ctx()->getCache(\"level\") + 1); return true; } } /** * \u54cd\u5e94at\u673a\u5668\u4eba\u7684\u6d88\u606f * @CQBefore(\"message\") */ public function changeAt() { if (MessageUtil::isAtMe(ctx()->getMessage(), ctx()->getRobotId())) { $msg = str_replace(CQ::at(ctx()->getRobotId()), \"\", ctx()->getMessage()); ctx()->setMessage(\"\u673a\u5668\u4eba\" . $msg); Console::info(ctx()->getMessage()); } return true; } } \u5982\u4e0a\u8ff0\u4ee3\u7801\uff0c\u6211\u4eec\u5c06\u7533\u8bf7\u7684 apikey \u586b\u5165\u53d8\u91cf $api \u4e2d\uff0c\u542f\u52a8\u673a\u5668\u4eba\u5373\u53ef\u4f7f\u7528\uff0c\u4ee5\u4e0b\u662f\u5b9e\u6d4b\u6d88\u606f\uff08\u6211\u7528\u81ea\u5df1\u7533\u8bf7\u7684 key \u505a\u6d4b\u8bd5\u56de\u590d\u7684\u6d88\u606f\uff09\u3002 ) \u4f60\u548b\u4e86 ( \u6211\u6ca1\u4e8b\u54e6\uff0c\u8c22\u8c22\u60a8\u7684\u5173\u5fc3\u3002 ) \u4e0a\u6d77\u5929\u6c14 ( \u4e0a\u6d77:\u5468\u4e00 03\u670829\u65e5,\u5c0f\u96e8 \u4e1c\u5357\u98ce\u8f6c\u4e1c\u98ce,\u6700\u4f4e\u6c14\u6e2914\u5ea6\uff0c\u6700\u9ad8\u6c14\u6e2924\u5ea6\u3002 ^ \u5207\u6362\u4e3a\u7fa4\u5185 ) \u673a\u5668\u4eba ( \u6211\u5728\uff01\u6709\u4ec0\u4e48\u4e8b\u5417\uff1f ) \u4f60\u53eb\u5565 ( \u6211\u7684\u540d\u5b57\u53eb\u70b8\u6bdb\uff0c\u8ba4\u8bc6\u4f60\u5f88\u9ad8\u5174\u5462\uff01 \u5728\u9ed8\u8ba4\u793a\u4f8b\u6a21\u5757\u4e2d\u7684\u4f8b\u5b50\u662f\u76f4\u63a5\u53ef\u4ee5\u62ff\u6765\u7528\u7684\uff0c\u8fd9\u6bb5\u4ee3\u7801\u540c\u65f6\u505a\u4e86\u5bf9 at \u7684\u5904\u7406\u3001\u4ee5\u53ca\u517c\u5bb9\u7528\u6237\u81ea\u5b9a\u4e49\u5199\u7684\u5176\u4ed6\u547d\u4ee4\u7684\u65b9\u5f0f\uff0c\u4e0b\u9762\u662f\u9ed8\u8ba4\u6a21\u5757\u586b\u597d apikey \u540e\u53ef\u4ee5\u7528\u7684\u5404\u79cd\u65b9\u5f0f\u63d0\u95ee\uff1a ^ \u5207\u6362\u4e3a\u7fa4\u5185 ) \u6211\u662f\u4e00\u6761\u666e\u901a\u6d88\u606f\uff0c\u8fd9\u6761\u673a\u5668\u4eba\u4e0d\u4f1a\u56de\u590d\u6211 ) @\u673a\u5668\u4eba \u4f60\u53eb\u5565 ( \u6211\u662f\u806a\u660e\u53ef\u7231\u7684\u70b8\u6bdb\uff0c\u8ba4\u8bc6\u4f60\u5f88\u9ad8\u5174\u3002 ) \u673a\u5668\u4eba ( \u6211\u5728\uff01\u6709\u4ec0\u4e48\u4e8b\u5417\uff1f ) \u4e00\u8a00 ( \u591a\u5c11\u4e8b\uff0c\u4ece\u6765\u6025\uff0c\u5929\u5730\u8f6c\uff0c\u5149\u9634\u8feb\uff0c\u4e00\u4e07\u5e74\u592a\u4e45\uff0c\u53ea\u4e89\u671d\u5915\u3002","title":"TuringAPI::getTuringMsg()"},{"location":"component/module/module-pack/","text":"\u6a21\u5757\u6253\u5305 \u4ece 2.5 \u7248\u672c\u8d77\uff0c\u70b8\u6bdb\u6846\u67b6\u7684\u6a21\u5757\u6e90\u7801\u652f\u6301\u4e86\u6253\u5305\u548c\u5206\u53d1\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u901a\u8fc7\u5c06\u81ea\u5df1\u7684\u529f\u80fd\u7f16\u5199\u6253\u5305\uff0c\u5e76\u901a\u8fc7\u4e92\u8054\u7f51\u8fdb\u884c\u5206\u53d1\uff0c\u4f9b\u5176\u4ed6\u4eba\u4f7f\u7528\u3002\u6b64\u5916\uff0c\u8fd8\u63d0\u4f9b\u4e86\u6a21\u5757\u5305\u70ed\u52a0\u8f7d\uff08\u4e0d\u89e3\u5305\u76f4\u63a5\u8fd0\u884c\uff09\u548c\u6a21\u5757\u5305\u89e3\u5305\u529f\u80fd\u3002 \u6784\u5efa\u6a21\u5757\u5305\u914d\u7f6e\u6587\u4ef6 \u70b8\u6bdb\u6846\u67b6\u7684\u6a21\u5757\u533a\u5206\u662f\u6839\u636e src \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5939\u5b9a\u4e49\u7684\uff0c\u6a21\u5757\u5305\u7684\u914d\u7f6e\u6587\u4ef6\u547d\u540d\u5fc5\u987b\u4e3a zm.json \uff0c\u6b64\u5916\uff0c\u5047\u8bbe\u6211\u4eec\u7f16\u5199\u4e86\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u6a21\u5757\uff0c\u4ee5\u811a\u624b\u67b6\u751f\u6210\u7684 Example \u6a21\u5757\u4e3a\u4f8b\uff0c\u6587\u4ef6\u5939\u7ed3\u6784\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 src/ \u2514\u2500\u2500 Module/ \u251c\u2500\u2500 Example/ \u2502 \u251c\u2500\u2500 Hello.php \u2502 \u2514\u2500\u2500 zm.json \u2514\u2500\u2500 Middleware/ \u2514\u2500\u2500 TimerMiddleware.php \u6211\u4eec\u5728 Example \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a zm.json \u7684\u6587\u4ef6\uff0c\u7f16\u5199\u914d\u7f6e\uff0c\u5373\u4ee3\u8868 src/Module/Example/ \u6587\u4ef6\u5939\u53ca\u91cc\u9762\u7684\u7528\u6237\u6a21\u5757\u6e90\u7801\u4e3a\u4e00\u4e2a\u6a21\u5757\u5305\uff0c\u4e5f\u5c31\u53ef\u4ee5\u88ab\u6846\u67b6\u8bc6\u522b\u5e76\u6253\u5305\u5904\u7406\u3002 \u7f16\u5199\u7684\u914d\u7f6e\u6587\u4ef6\u7ed3\u6784\u5982\u4e0b\uff1a 1 2 3 { \"name\": \"my-first-module\" } \u5bf9\uff01\u4f60\u6ca1\u770b\u9519\uff0c\u53ea\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a name \u5b57\u6bb5\uff0c\u5373\u53ef\u58f0\u660e\u8fd9\u662f\u4e00\u4e2a\u6a21\u5757\u5305\uff01 \u914d\u7f6e\u6587\u4ef6\u53c2\u6570 - description \u7c7b\u578b\uff1a string \u3002 \u542b\u4e49\uff1a\u6a21\u5757\u7684\u63cf\u8ff0\u3002 \u70b9\u6211\u67e5\u770b\u7f16\u5199\u5b9e\u4f8b\uff1a 1 2 3 4 { \"name\" : \"my-first-module\" , \"description\" : \"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\u6253\u5305\u6559\u7a0b\" } - version \u7c7b\u578b\uff1astring\u3002 \u542b\u4e49\uff1a\u6a21\u5757\u7684\u7248\u672c\u3002 \u7248\u672c\u5904\u7406\u65b9\u5f0f\u548c Composer \u57fa\u672c\u4e00\u81f4\uff0c\u5efa\u8bae\u4f7f\u7528\u4e09\u6bb5\u5f0f\uff0c\u4e5f\u5c31\u662f \u5927\u7248\u672c.\u5c0f\u7248\u672c.\u8865\u4e01\u7248\u672c \u3002\u5173\u4e8e\u4e09\u6bb5\u5f0f\u7248\u672c\u7684\u63cf\u8ff0\u548c\u89c4\u8303\uff0c\u89c1 \u5230\u5e95\u4e09\u6bb5\u5f0f\u7248\u672c\u53f7\u662f\u4ec0\u4e48\uff1f \u3002 \u70b9\u6211\u67e5\u770b\u7f16\u5199\u5b9e\u4f8b\uff1a 1 2 3 4 { \"name\" : \"my-first-module\" , \"description\" : \"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\u6253\u5305\u6559\u7a0b\" } - depends \u7c7b\u578b\uff1amap of string\uff08\u4f8b\u5982 {\"foo\":\"bar\",\"baz\":\"zoo\"} \uff09\u3002 \u542b\u4e49\uff1a\u6a21\u5757\u7684\u4f9d\u8d56\u5173\u7cfb\u548c\u7248\u672c\u4f9d\u8d56\u58f0\u660e\u3002 \u6b64\u5904\u7528\u4f5c\u6a21\u5757\u7684\u4f9d\u8d56\u68c0\u6d4b\uff0c\u5047\u8bbe\u6a21\u5757 foo \u4f9d\u8d56\u6a21\u5757 bar \u7684 1.x \u7248\u672c\u4f46\u662f\u4e0d\u517c\u5bb9 bar \u7684 2.x \u7248\u672c\uff0c\u53ef\u4ee5\u50cf Composer \u7684 require \u4e00\u6837\u7f16\u5199\u7248\u672c\u4f9d\u8d56\uff1a ^1.0 \u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528 ~ \u3001 >= \u3001 * \u8fd9\u4e9b\u4e0e Composer \u5305\u7ba1\u7406\u76f8\u540c\u903b\u8f91\u7684\u7248\u672c\u4f9d\u8d56\u5173\u7cfb\uff0c\u8be6\u89c1 Composer - \u5305\u7248\u672c \u3002 \u70b9\u6211\u67e5\u770b\u7f16\u5199\u5b9e\u4f8b\uff1a 1 2 3 4 5 6 7 8 { \"name\" : \"foo\" , \"description\" : \"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\u6253\u5305\u6559\u7a0b\" , \"depends\" : { \"bar\" : \"^1.0\" , \"bsr\" : \"*\" } } - light-cache-store \u7c7b\u578b\uff1aarray of string\uff08\u4f8b\u5982 [\"foo\",\"bar\"] \uff09\u3002 \u542b\u4e49\uff1a\u6253\u5305\u6a21\u5757\u65f6\u8981\u50a8\u5b58\u7684\u6301\u4e45\u5316 LightCache \u952e\u540d\u5217\u8868\u3002 \u8fd9\u91cc\u9700\u8981\u914d\u5408 LightCache \u4f7f\u7528\uff0c\u5982\u679c\u4f60\u6709\u4e00\u4e9b\u9700\u8981\u5168\u5c40\u7f13\u5b58\u7684\u6570\u636e\uff0c\u4f8b\u5982\u52a8\u6001\u914d\u7f6e\u9879\uff0c\u6bd4\u5982\u7fa4\u670d\u52a1\u72b6\u6001\u5217\u8868\uff0c\u53ef\u4ee5\u5148\u4f7f\u7528 LightCache \u5b58\u50a8\u5e76\u4f7f\u7528 addPersistence() \u6301\u4e45\u5316\uff0c\u6b64\u540e\u5728\u4f7f\u7528\u6a21\u5757\u6253\u5305\u65f6\u7f16\u5199\u6b64\u914d\u7f6e\u9879\u3002 \u6211\u4eec\u5047\u8bbe\u5728\u9879\u76ee\u6a21\u5757\u4e2d\u4f7f\u7528\u5230\u4e86 group-status \u8fd9\u4e00\u4e2a LightCache\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u5199 light-cache-store \u914d\u7f6e\u9879\uff0c\u5728\u6a21\u5757\u6253\u5305\u65f6\u5c31\u4f1a\u5c06\u6301\u4e45\u5316\u7684\u6570\u636e\u4e5f\u6253\u5305\u5230 phar \u6a21\u5757\u5305\u5185\u3002 \u70b9\u6211\u67e5\u770b\u7f16\u5199\u5b9e\u4f8b\uff1a 1 2 3 4 5 6 7 { \"name\" : \"foo\" , \"description\" : \"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\u6253\u5305\u6559\u7a0b\" , \"light-cache-store\" : [ \"group-status\" ] } - global-config-override \u7c7b\u578b\uff1astring | false\u3002 \u542b\u4e49\uff1a\u89e3\u5305\u65f6\u662f\u5426\u9700\u8981\u624b\u52a8\u7f16\u8f91\u5168\u5c40\u914d\u7f6e\uff08 global.php \uff09\u3002 \u8fd9\u91cc\u5982\u679c\u5199 string \u7c7b\u578b\u7684\uff0c\u90a3\u4e48\u5c31\u662f\u76f8\u5f53\u4e8e\u5728\u89e3\u5305\u65f6\u4f1a\u63d0\u793a\u6b64\u5904\u7684\u5185\u5bb9\uff0c\u5185\u5bb9\u63a8\u8350\u586b\u5199\u8981\u6c42\u89e3\u5305\u6a21\u5757\u7528\u6237\u9700\u8981\u7f16\u8f91\u7684\u9879\u76ee\uff0c\u6bd4\u5982 \u300c\u8bf7\u5c06 static_file_server \u7684 status \u6539\u4e3a true\uff0c\u4ee5\u4fbf\u4f7f\u7528\u9759\u6001\u6587\u672c\u529f\u80fd\u300d\u3002 \u5982\u679c\u662f false\uff0c\u90a3\u4e48\u548c\u4e0d\u6307\u5b9a\u6b64\u53c2\u6570\u6548\u679c\u662f\u4e00\u6837\u7684\uff0c\u65e0\u9700\u7528\u6237\u4fee\u6539 global.php\u3002 \u70b9\u6211\u67e5\u770b\u7f16\u5199\u5b9e\u4f8b\uff1a 1 2 3 4 5 { \"name\" : \"foo\" , \"description\" : \"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\u6253\u5305\u6559\u7a0b\" , \"global-config-override\" : \"\u8bf7\u5c06 static_file_server \u7684 status \u6539\u4e3a true\" } - allow-hotload \u7c7b\u578b\uff1abool\u3002 \u542b\u4e49\uff1a\u662f\u5426\u5141\u8bb8\u7528\u6237\u65e0\u9700\u89e3\u538b\u76f4\u63a5\u52a0\u8f7d\u6a21\u5757\u5305\u6587\u4ef6\uff08phar\uff09\u3002 \u5f53\u6b64\u9879\u4e3a true \u65f6\uff0c\u53ef\u4ee5\u5c06\u6a21\u5757\u5305\u76f4\u63a5\u653e\u5165 zm_data/modules \u6587\u4ef6\u5939\u4e0b\uff0c\u7136\u540e\u5c06 global.php \u4e2d\u7684 module_loader \u9879\u4e2d\u7684 enable_hotload \u6539\u4e3a true\uff0c\u542f\u52a8\u6846\u67b6\u5373\u53ef\u52a0\u8f7d\u3002 \u70b9\u6211\u67e5\u770b\u7f16\u5199\u5b9e\u4f8b\uff1a 1 2 3 4 5 { \"name\" : \"foo\" , \"description\" : \"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\u6253\u5305\u6559\u7a0b\" , \"allow-hotload\" : true } \u6ce8\u610f \u5982\u679c\u4f7f\u7528\u5141\u8bb8\u70ed\u52a0\u8f7d\uff0c\u90a3\u4e48\u6a21\u5757\u5305\u4e2d\u7684\u914d\u7f6e\u6700\u597d\u4e0d\u8981\u6709 global-config-override \u548c light-cache-store \uff0c\u4ee5\u6b64\u6765\u8fbe\u5230\u6700\u6b63\u786e\u7684\u6548\u679c\uff0c\u4e00\u822c\u70ed\u52a0\u8f7d\u66f4\u9002\u5408 Library\uff08\u5e93\uff09\u7c7b\u578b\u7684\u6a21\u5757\u3002 - zm-data-store \u7c7b\u578b\uff1aarray of string\uff08\u4f8b\u5982 [\"foo\",\"bar\"] \uff09\u3002 \u542b\u4e49\uff1a\u6253\u5305\u65f6\u8981\u6dfb\u52a0\u5230\u6a21\u5757\u5305\u5185\u7684 zm_data \u76ee\u5f55\u4e0b\u7684\u5b50\u76ee\u5f55\u6216\u6587\u4ef6\u3002 \u5176\u4e2d\u9879\u76ee\u5fc5\u987b\u662f\u76f8\u5bf9\u8def\u5f84\uff0c\u4e0d\u80fd\u662f\u7edd\u5bf9\u8def\u5f84\uff0c\u4e14\u5fc5\u987b\u662f\u5728\u914d\u7f6e\u9879 zm_data \u6307\u5b9a\u7684\u76ee\u5f55\uff08\u9ed8\u8ba4\u4f1a\u5728\u6846\u67b6\u9879\u76ee\u7684\u6839\u76ee\u5f55\u4e0b\u7684 zm_data/ \u76ee\u5f55\u3002 \u6211\u4eec\u5047\u8bbe\u8981\u6253\u5305\u4e00\u4e2a {zm_data \u76ee\u5f55}/config/ \u76ee\u5f55\u53ca\u5176\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c\u548c\u4e00\u4e2a main.png \u6587\u4ef6\uff0c\u4e0b\u65b9\u662f\u5b9e\u4f8b\u3002 \u70b9\u6211\u67e5\u770b\u7f16\u5199\u5b9e\u4f8b\uff1a 1 2 3 4 5 6 7 8 { \"name\" : \"foo\" , \"description\" : \"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\u6253\u5305\u6559\u7a0b\" , \"zm-data-store\" : [ \"config/\" , \"main.png\" ] } \u5728\u6253\u5305\u65f6\u6846\u67b6\u4f1a\u81ea\u52a8\u6dfb\u52a0\u8fd9\u4e9b\u6587\u4ef6\u5230 phar \u63d2\u4ef6\u5305\u5185\uff0c\u5230\u89e3\u5305\u65f6\uff0c\u4f1a\u81ea\u52a8\u5c06\u8fd9\u4e9b\u6587\u4ef6\u91ca\u653e\u5230\u5bf9\u5e94\u6846\u67b6\u7684 zm_data \u76ee\u5f55\u4e0b\u3002","title":"\u6a21\u5757\u6253\u5305"},{"location":"component/module/module-pack/#_1","text":"\u4ece 2.5 \u7248\u672c\u8d77\uff0c\u70b8\u6bdb\u6846\u67b6\u7684\u6a21\u5757\u6e90\u7801\u652f\u6301\u4e86\u6253\u5305\u548c\u5206\u53d1\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u901a\u8fc7\u5c06\u81ea\u5df1\u7684\u529f\u80fd\u7f16\u5199\u6253\u5305\uff0c\u5e76\u901a\u8fc7\u4e92\u8054\u7f51\u8fdb\u884c\u5206\u53d1\uff0c\u4f9b\u5176\u4ed6\u4eba\u4f7f\u7528\u3002\u6b64\u5916\uff0c\u8fd8\u63d0\u4f9b\u4e86\u6a21\u5757\u5305\u70ed\u52a0\u8f7d\uff08\u4e0d\u89e3\u5305\u76f4\u63a5\u8fd0\u884c\uff09\u548c\u6a21\u5757\u5305\u89e3\u5305\u529f\u80fd\u3002","title":"\u6a21\u5757\u6253\u5305"},{"location":"component/module/module-pack/#_2","text":"\u70b8\u6bdb\u6846\u67b6\u7684\u6a21\u5757\u533a\u5206\u662f\u6839\u636e src \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5939\u5b9a\u4e49\u7684\uff0c\u6a21\u5757\u5305\u7684\u914d\u7f6e\u6587\u4ef6\u547d\u540d\u5fc5\u987b\u4e3a zm.json \uff0c\u6b64\u5916\uff0c\u5047\u8bbe\u6211\u4eec\u7f16\u5199\u4e86\u4e00\u4e2a\u6700\u7b80\u5355\u7684\u6a21\u5757\uff0c\u4ee5\u811a\u624b\u67b6\u751f\u6210\u7684 Example \u6a21\u5757\u4e3a\u4f8b\uff0c\u6587\u4ef6\u5939\u7ed3\u6784\u5982\u4e0b\uff1a 1 2 3 4 5 6 7 src/ \u2514\u2500\u2500 Module/ \u251c\u2500\u2500 Example/ \u2502 \u251c\u2500\u2500 Hello.php \u2502 \u2514\u2500\u2500 zm.json \u2514\u2500\u2500 Middleware/ \u2514\u2500\u2500 TimerMiddleware.php \u6211\u4eec\u5728 Example \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a zm.json \u7684\u6587\u4ef6\uff0c\u7f16\u5199\u914d\u7f6e\uff0c\u5373\u4ee3\u8868 src/Module/Example/ \u6587\u4ef6\u5939\u53ca\u91cc\u9762\u7684\u7528\u6237\u6a21\u5757\u6e90\u7801\u4e3a\u4e00\u4e2a\u6a21\u5757\u5305\uff0c\u4e5f\u5c31\u53ef\u4ee5\u88ab\u6846\u67b6\u8bc6\u522b\u5e76\u6253\u5305\u5904\u7406\u3002 \u7f16\u5199\u7684\u914d\u7f6e\u6587\u4ef6\u7ed3\u6784\u5982\u4e0b\uff1a 1 2 3 { \"name\": \"my-first-module\" } \u5bf9\uff01\u4f60\u6ca1\u770b\u9519\uff0c\u53ea\u9700\u8981\u5b9a\u4e49\u4e00\u4e2a name \u5b57\u6bb5\uff0c\u5373\u53ef\u58f0\u660e\u8fd9\u662f\u4e00\u4e2a\u6a21\u5757\u5305\uff01","title":"\u6784\u5efa\u6a21\u5757\u5305\u914d\u7f6e\u6587\u4ef6"},{"location":"component/module/module-pack/#_3","text":"","title":"\u914d\u7f6e\u6587\u4ef6\u53c2\u6570"},{"location":"component/module/module-pack/#-description","text":"\u7c7b\u578b\uff1a string \u3002 \u542b\u4e49\uff1a\u6a21\u5757\u7684\u63cf\u8ff0\u3002 \u70b9\u6211\u67e5\u770b\u7f16\u5199\u5b9e\u4f8b\uff1a 1 2 3 4 { \"name\" : \"my-first-module\" , \"description\" : \"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\u6253\u5305\u6559\u7a0b\" }","title":"- description"},{"location":"component/module/module-pack/#-version","text":"\u7c7b\u578b\uff1astring\u3002 \u542b\u4e49\uff1a\u6a21\u5757\u7684\u7248\u672c\u3002 \u7248\u672c\u5904\u7406\u65b9\u5f0f\u548c Composer \u57fa\u672c\u4e00\u81f4\uff0c\u5efa\u8bae\u4f7f\u7528\u4e09\u6bb5\u5f0f\uff0c\u4e5f\u5c31\u662f \u5927\u7248\u672c.\u5c0f\u7248\u672c.\u8865\u4e01\u7248\u672c \u3002\u5173\u4e8e\u4e09\u6bb5\u5f0f\u7248\u672c\u7684\u63cf\u8ff0\u548c\u89c4\u8303\uff0c\u89c1 \u5230\u5e95\u4e09\u6bb5\u5f0f\u7248\u672c\u53f7\u662f\u4ec0\u4e48\uff1f \u3002 \u70b9\u6211\u67e5\u770b\u7f16\u5199\u5b9e\u4f8b\uff1a 1 2 3 4 { \"name\" : \"my-first-module\" , \"description\" : \"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\u6253\u5305\u6559\u7a0b\" }","title":"- version"},{"location":"component/module/module-pack/#-depends","text":"\u7c7b\u578b\uff1amap of string\uff08\u4f8b\u5982 {\"foo\":\"bar\",\"baz\":\"zoo\"} \uff09\u3002 \u542b\u4e49\uff1a\u6a21\u5757\u7684\u4f9d\u8d56\u5173\u7cfb\u548c\u7248\u672c\u4f9d\u8d56\u58f0\u660e\u3002 \u6b64\u5904\u7528\u4f5c\u6a21\u5757\u7684\u4f9d\u8d56\u68c0\u6d4b\uff0c\u5047\u8bbe\u6a21\u5757 foo \u4f9d\u8d56\u6a21\u5757 bar \u7684 1.x \u7248\u672c\u4f46\u662f\u4e0d\u517c\u5bb9 bar \u7684 2.x \u7248\u672c\uff0c\u53ef\u4ee5\u50cf Composer \u7684 require \u4e00\u6837\u7f16\u5199\u7248\u672c\u4f9d\u8d56\uff1a ^1.0 \u3002\u4e5f\u53ef\u4ee5\u4f7f\u7528 ~ \u3001 >= \u3001 * \u8fd9\u4e9b\u4e0e Composer \u5305\u7ba1\u7406\u76f8\u540c\u903b\u8f91\u7684\u7248\u672c\u4f9d\u8d56\u5173\u7cfb\uff0c\u8be6\u89c1 Composer - \u5305\u7248\u672c \u3002 \u70b9\u6211\u67e5\u770b\u7f16\u5199\u5b9e\u4f8b\uff1a 1 2 3 4 5 6 7 8 { \"name\" : \"foo\" , \"description\" : \"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\u6253\u5305\u6559\u7a0b\" , \"depends\" : { \"bar\" : \"^1.0\" , \"bsr\" : \"*\" } }","title":"- depends"},{"location":"component/module/module-pack/#-light-cache-store","text":"\u7c7b\u578b\uff1aarray of string\uff08\u4f8b\u5982 [\"foo\",\"bar\"] \uff09\u3002 \u542b\u4e49\uff1a\u6253\u5305\u6a21\u5757\u65f6\u8981\u50a8\u5b58\u7684\u6301\u4e45\u5316 LightCache \u952e\u540d\u5217\u8868\u3002 \u8fd9\u91cc\u9700\u8981\u914d\u5408 LightCache \u4f7f\u7528\uff0c\u5982\u679c\u4f60\u6709\u4e00\u4e9b\u9700\u8981\u5168\u5c40\u7f13\u5b58\u7684\u6570\u636e\uff0c\u4f8b\u5982\u52a8\u6001\u914d\u7f6e\u9879\uff0c\u6bd4\u5982\u7fa4\u670d\u52a1\u72b6\u6001\u5217\u8868\uff0c\u53ef\u4ee5\u5148\u4f7f\u7528 LightCache \u5b58\u50a8\u5e76\u4f7f\u7528 addPersistence() \u6301\u4e45\u5316\uff0c\u6b64\u540e\u5728\u4f7f\u7528\u6a21\u5757\u6253\u5305\u65f6\u7f16\u5199\u6b64\u914d\u7f6e\u9879\u3002 \u6211\u4eec\u5047\u8bbe\u5728\u9879\u76ee\u6a21\u5757\u4e2d\u4f7f\u7528\u5230\u4e86 group-status \u8fd9\u4e00\u4e2a LightCache\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u5199 light-cache-store \u914d\u7f6e\u9879\uff0c\u5728\u6a21\u5757\u6253\u5305\u65f6\u5c31\u4f1a\u5c06\u6301\u4e45\u5316\u7684\u6570\u636e\u4e5f\u6253\u5305\u5230 phar \u6a21\u5757\u5305\u5185\u3002 \u70b9\u6211\u67e5\u770b\u7f16\u5199\u5b9e\u4f8b\uff1a 1 2 3 4 5 6 7 { \"name\" : \"foo\" , \"description\" : \"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\u6253\u5305\u6559\u7a0b\" , \"light-cache-store\" : [ \"group-status\" ] }","title":"- light-cache-store"},{"location":"component/module/module-pack/#-global-config-override","text":"\u7c7b\u578b\uff1astring | false\u3002 \u542b\u4e49\uff1a\u89e3\u5305\u65f6\u662f\u5426\u9700\u8981\u624b\u52a8\u7f16\u8f91\u5168\u5c40\u914d\u7f6e\uff08 global.php \uff09\u3002 \u8fd9\u91cc\u5982\u679c\u5199 string \u7c7b\u578b\u7684\uff0c\u90a3\u4e48\u5c31\u662f\u76f8\u5f53\u4e8e\u5728\u89e3\u5305\u65f6\u4f1a\u63d0\u793a\u6b64\u5904\u7684\u5185\u5bb9\uff0c\u5185\u5bb9\u63a8\u8350\u586b\u5199\u8981\u6c42\u89e3\u5305\u6a21\u5757\u7528\u6237\u9700\u8981\u7f16\u8f91\u7684\u9879\u76ee\uff0c\u6bd4\u5982 \u300c\u8bf7\u5c06 static_file_server \u7684 status \u6539\u4e3a true\uff0c\u4ee5\u4fbf\u4f7f\u7528\u9759\u6001\u6587\u672c\u529f\u80fd\u300d\u3002 \u5982\u679c\u662f false\uff0c\u90a3\u4e48\u548c\u4e0d\u6307\u5b9a\u6b64\u53c2\u6570\u6548\u679c\u662f\u4e00\u6837\u7684\uff0c\u65e0\u9700\u7528\u6237\u4fee\u6539 global.php\u3002 \u70b9\u6211\u67e5\u770b\u7f16\u5199\u5b9e\u4f8b\uff1a 1 2 3 4 5 { \"name\" : \"foo\" , \"description\" : \"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\u6253\u5305\u6559\u7a0b\" , \"global-config-override\" : \"\u8bf7\u5c06 static_file_server \u7684 status \u6539\u4e3a true\" }","title":"- global-config-override"},{"location":"component/module/module-pack/#-allow-hotload","text":"\u7c7b\u578b\uff1abool\u3002 \u542b\u4e49\uff1a\u662f\u5426\u5141\u8bb8\u7528\u6237\u65e0\u9700\u89e3\u538b\u76f4\u63a5\u52a0\u8f7d\u6a21\u5757\u5305\u6587\u4ef6\uff08phar\uff09\u3002 \u5f53\u6b64\u9879\u4e3a true \u65f6\uff0c\u53ef\u4ee5\u5c06\u6a21\u5757\u5305\u76f4\u63a5\u653e\u5165 zm_data/modules \u6587\u4ef6\u5939\u4e0b\uff0c\u7136\u540e\u5c06 global.php \u4e2d\u7684 module_loader \u9879\u4e2d\u7684 enable_hotload \u6539\u4e3a true\uff0c\u542f\u52a8\u6846\u67b6\u5373\u53ef\u52a0\u8f7d\u3002 \u70b9\u6211\u67e5\u770b\u7f16\u5199\u5b9e\u4f8b\uff1a 1 2 3 4 5 { \"name\" : \"foo\" , \"description\" : \"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\u6253\u5305\u6559\u7a0b\" , \"allow-hotload\" : true } \u6ce8\u610f \u5982\u679c\u4f7f\u7528\u5141\u8bb8\u70ed\u52a0\u8f7d\uff0c\u90a3\u4e48\u6a21\u5757\u5305\u4e2d\u7684\u914d\u7f6e\u6700\u597d\u4e0d\u8981\u6709 global-config-override \u548c light-cache-store \uff0c\u4ee5\u6b64\u6765\u8fbe\u5230\u6700\u6b63\u786e\u7684\u6548\u679c\uff0c\u4e00\u822c\u70ed\u52a0\u8f7d\u66f4\u9002\u5408 Library\uff08\u5e93\uff09\u7c7b\u578b\u7684\u6a21\u5757\u3002","title":"- allow-hotload"},{"location":"component/module/module-pack/#-zm-data-store","text":"\u7c7b\u578b\uff1aarray of string\uff08\u4f8b\u5982 [\"foo\",\"bar\"] \uff09\u3002 \u542b\u4e49\uff1a\u6253\u5305\u65f6\u8981\u6dfb\u52a0\u5230\u6a21\u5757\u5305\u5185\u7684 zm_data \u76ee\u5f55\u4e0b\u7684\u5b50\u76ee\u5f55\u6216\u6587\u4ef6\u3002 \u5176\u4e2d\u9879\u76ee\u5fc5\u987b\u662f\u76f8\u5bf9\u8def\u5f84\uff0c\u4e0d\u80fd\u662f\u7edd\u5bf9\u8def\u5f84\uff0c\u4e14\u5fc5\u987b\u662f\u5728\u914d\u7f6e\u9879 zm_data \u6307\u5b9a\u7684\u76ee\u5f55\uff08\u9ed8\u8ba4\u4f1a\u5728\u6846\u67b6\u9879\u76ee\u7684\u6839\u76ee\u5f55\u4e0b\u7684 zm_data/ \u76ee\u5f55\u3002 \u6211\u4eec\u5047\u8bbe\u8981\u6253\u5305\u4e00\u4e2a {zm_data \u76ee\u5f55}/config/ \u76ee\u5f55\u53ca\u5176\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\uff0c\u548c\u4e00\u4e2a main.png \u6587\u4ef6\uff0c\u4e0b\u65b9\u662f\u5b9e\u4f8b\u3002 \u70b9\u6211\u67e5\u770b\u7f16\u5199\u5b9e\u4f8b\uff1a 1 2 3 4 5 6 7 8 { \"name\" : \"foo\" , \"description\" : \"\u8fd9\u4e2a\u662f\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\u6253\u5305\u6559\u7a0b\" , \"zm-data-store\" : [ \"config/\" , \"main.png\" ] } \u5728\u6253\u5305\u65f6\u6846\u67b6\u4f1a\u81ea\u52a8\u6dfb\u52a0\u8fd9\u4e9b\u6587\u4ef6\u5230 phar \u63d2\u4ef6\u5305\u5185\uff0c\u5230\u89e3\u5305\u65f6\uff0c\u4f1a\u81ea\u52a8\u5c06\u8fd9\u4e9b\u6587\u4ef6\u91ca\u653e\u5230\u5bf9\u5e94\u6846\u67b6\u7684 zm_data \u76ee\u5f55\u4e0b\u3002","title":"- zm-data-store"},{"location":"component/store/atomics/","text":"ZMAtomic \u539f\u5b50\u8ba1\u6570\u5668 \u539f\u5b50\u8ba1\u6570\u5668\u662f\u7528\u4e8e\u591a\u8fdb\u7a0b\u95f4\u8de8\u8fdb\u7a0b\u4f7f\u7528\u7684\u539f\u5b50\u8ba1\u6570\u4f7f\u7528\u7684\uff0c\u6bd4\u5982\u7edf\u8ba1\u5165\u7ad9\u8bf7\u6c42\u6570\u91cf\u7b49\u3002\u6b64\u529f\u80fd\u57fa\u4e8e Swoole \u7684 Atomic\uff0c\u8be6\u60c5\u89c1 Swoole - \u6587\u6863 \u3002 \u914d\u7f6e\u548c\u521d\u59cb\u5316 \u89c1\u914d\u7f6e\u6587\u4ef6\uff1a config/global.php \u4e2d\u7684 init_atomics \u5b57\u6bb5\uff1a 1 2 3 4 5 /** zhamao-framework\u5728\u6846\u67b6\u542f\u52a8\u65f6\u521d\u59cb\u5316\u7684atomic\u4eec */ $config['init_atomics'] = [ 'foo' => 0, 'bar' => 4, ]; \u8fd9\u65f6\u6211\u4eec\u5c31\u6210\u529f\u521d\u59cb\u5316\u4e24\u4e2a\u539f\u5b50\u8ba1\u6570\u5668\uff0c\u540d\u5b57\u5206\u522b\u4e3a foo \u548c bar \u3002 \u6ce8\u610f \u521d\u59cb\u5316\u7684\u503c\u5fc5\u987b\u662f\u4e0d\u5c0f\u4e8e 0 \u7684 int32 \u503c\uff01 \u4f7f\u7528 \u5b9a\u4e49\u548c\u547d\u540d\u7a7a\u95f4\uff1a ZM\\Store\\ZMAtomic \u8fde\u63a5\u8ba1\u6570\u793a\u4f8b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php namespace Module\\Example ; use ZM\\Annotation\\Swoole\\OnRequestEvent ; use ZM\\Store\\ZMAtomic ; class Hello { /** * @OnRequestEvent() */ public function onRequest () { $cnt = ZMAtomic :: get ( \"foo\" ) -> add ( 1 ); ctx () -> getResponse () -> end ( \"\u5f53\u524d\u5df2\u8bbf\u95ee\uff1a\" . $cnt . \"\u6b21\" ); } } ZMAtomic::get()->get() \u83b7\u53d6\u8ba1\u6570\u7684\u6570\u5b57\uff1a dump(ZMAtomic::get(\"bar\")->get()); \u8fd4\u56de 4\u3002 ZMAtomic::get()->add($num) \u52a0\u4e0a\u4e00\u5b9a\u7684\u6570\u5e76\u8fd4\u56de\u7ed3\u679c\uff1a dump(ZMAtomic::get(\"bar\")->add(5)); \u8fd4\u56de 9\u3002 ZMAtomic::get()->sub($num) \u8981\u51cf\u5c11\u7684\u6570\u503c\uff08\u5fc5\u987b\u4e3a\u6b63\u6574\u6570\uff09\uff1a dump(ZMAtomic::get(\"bar\")->sub(5)); \u8fd4\u56de 5\u3002 ZMAtomic::get()->set($num) \u8bbe\u7f6e\u8ba1\u6570\u7684\u6570\u5b57\uff1a ZMAtomic::get(\"bar\")->set(77); \u63d0\u793a \u8fd8\u6709\u4e00\u4e9b\u4e0d\u5e38\u7528\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u770b Swoole \u5b98\u65b9\u7684\u6587\u6863\uff0c\u8fd9\u91cc\u5c31\u4e0d\u4e00\u4e00\u5217\u4e3e\u4e86\u3002","title":"ZMAtomic \u539f\u5b50\u8ba1\u6570\u5668"},{"location":"component/store/atomics/#zmatomic","text":"\u539f\u5b50\u8ba1\u6570\u5668\u662f\u7528\u4e8e\u591a\u8fdb\u7a0b\u95f4\u8de8\u8fdb\u7a0b\u4f7f\u7528\u7684\u539f\u5b50\u8ba1\u6570\u4f7f\u7528\u7684\uff0c\u6bd4\u5982\u7edf\u8ba1\u5165\u7ad9\u8bf7\u6c42\u6570\u91cf\u7b49\u3002\u6b64\u529f\u80fd\u57fa\u4e8e Swoole \u7684 Atomic\uff0c\u8be6\u60c5\u89c1 Swoole - \u6587\u6863 \u3002","title":"ZMAtomic \u539f\u5b50\u8ba1\u6570\u5668"},{"location":"component/store/atomics/#_1","text":"\u89c1\u914d\u7f6e\u6587\u4ef6\uff1a config/global.php \u4e2d\u7684 init_atomics \u5b57\u6bb5\uff1a 1 2 3 4 5 /** zhamao-framework\u5728\u6846\u67b6\u542f\u52a8\u65f6\u521d\u59cb\u5316\u7684atomic\u4eec */ $config['init_atomics'] = [ 'foo' => 0, 'bar' => 4, ]; \u8fd9\u65f6\u6211\u4eec\u5c31\u6210\u529f\u521d\u59cb\u5316\u4e24\u4e2a\u539f\u5b50\u8ba1\u6570\u5668\uff0c\u540d\u5b57\u5206\u522b\u4e3a foo \u548c bar \u3002 \u6ce8\u610f \u521d\u59cb\u5316\u7684\u503c\u5fc5\u987b\u662f\u4e0d\u5c0f\u4e8e 0 \u7684 int32 \u503c\uff01","title":"\u914d\u7f6e\u548c\u521d\u59cb\u5316"},{"location":"component/store/atomics/#_2","text":"\u5b9a\u4e49\u548c\u547d\u540d\u7a7a\u95f4\uff1a ZM\\Store\\ZMAtomic \u8fde\u63a5\u8ba1\u6570\u793a\u4f8b\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php namespace Module\\Example ; use ZM\\Annotation\\Swoole\\OnRequestEvent ; use ZM\\Store\\ZMAtomic ; class Hello { /** * @OnRequestEvent() */ public function onRequest () { $cnt = ZMAtomic :: get ( \"foo\" ) -> add ( 1 ); ctx () -> getResponse () -> end ( \"\u5f53\u524d\u5df2\u8bbf\u95ee\uff1a\" . $cnt . \"\u6b21\" ); } }","title":"\u4f7f\u7528"},{"location":"component/store/atomics/#zmatomicget-get","text":"\u83b7\u53d6\u8ba1\u6570\u7684\u6570\u5b57\uff1a dump(ZMAtomic::get(\"bar\")->get()); \u8fd4\u56de 4\u3002","title":"ZMAtomic::get()-&gt;get()"},{"location":"component/store/atomics/#zmatomicget-addnum","text":"\u52a0\u4e0a\u4e00\u5b9a\u7684\u6570\u5e76\u8fd4\u56de\u7ed3\u679c\uff1a dump(ZMAtomic::get(\"bar\")->add(5)); \u8fd4\u56de 9\u3002","title":"ZMAtomic::get()-&gt;add($num)"},{"location":"component/store/atomics/#zmatomicget-subnum","text":"\u8981\u51cf\u5c11\u7684\u6570\u503c\uff08\u5fc5\u987b\u4e3a\u6b63\u6574\u6570\uff09\uff1a dump(ZMAtomic::get(\"bar\")->sub(5)); \u8fd4\u56de 5\u3002","title":"ZMAtomic::get()-&gt;sub($num)"},{"location":"component/store/atomics/#zmatomicget-setnum","text":"\u8bbe\u7f6e\u8ba1\u6570\u7684\u6570\u5b57\uff1a ZMAtomic::get(\"bar\")->set(77); \u63d0\u793a \u8fd8\u6709\u4e00\u4e9b\u4e0d\u5e38\u7528\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u770b Swoole \u5b98\u65b9\u7684\u6587\u6863\uff0c\u8fd9\u91cc\u5c31\u4e0d\u4e00\u4e00\u5217\u4e3e\u4e86\u3002","title":"ZMAtomic::get()-&gt;set($num)"},{"location":"component/store/data-provider/","text":"\u5b58\u50a8\u7ba1\u7406\uff08\u6587\u4ef6\uff09 DataProvider \u662f\u6846\u67b6\u5185\u63d0\u4f9b\u7684\u4e00\u4e2a\u7b80\u6613\u7684\u6587\u4ef6\u7ba1\u7406\u7c7b\u3002 \u5b9a\u4e49\uff1a \\ZM\\Utils\\DataProvider DataProvider::getWorkingDir() \u540c working_dir() \u3002 DataProvider::getFrameworkLink() \u540c ZMConfig::get(\"global\", \"http_reverse_link\") \uff0c\u83b7\u53d6\u53cd\u5411\u4ee3\u7406\u7684\u94fe\u63a5\u3002 DataProvider::getDataFolder() \u83b7\u53d6\u914d\u7f6e\u9879 zm_data \u6307\u5b9a\u7684\u76ee\u5f55\u3002 \u5982\u679c\u6307\u5b9a\u53c2\u6570 $second \uff0c\u5219\u8fd4\u56de\u4e8c\u7ea7\u76ee\u5f55\u5730\u5740\uff0c\u5982\u679c\u4e8c\u7ea7\u76ee\u5f55\u4e0d\u5b58\u5728\u5219\u81ea\u52a8\u521b\u5efa\u3002 1 DataProvider::getDataFolder(\"TestModule\"); // \u4f8b\u5982\u8fd4\u56de /root/zhamao-framework/zm_data/TestModule/ DataProvider::getFrameworkRootDir() \u8fd4\u56de\u6846\u67b6\u672c\u4f53\u7684\u6839\u76ee\u5f55\u3002 DataProvider::saveToJson() \u5c06\u53d8\u91cf\u5185\u5bb9\u4fdd\u5b58\u4e3a json \u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u5b58\u50a8\u5728 zm_data/config/ \u76ee\u5f55\u4e0b\u6216\u5b50\u76ee\u5f55\u4e0b\u3002 \u5b9a\u4e49\uff1a saveToJson($filename, $file_array) $filename \u662f\u6587\u4ef6\u540d\uff0c\u4e0d\u9700\u8981\u52a0\u540e\u7f00\uff0c\u6bd4\u5982\u4f60\u60f3\u4fdd\u5b58\u6210 foo/bar.json \uff0c\u8fd9\u91cc\u5199 foo/bar \u5c31\u597d\u3002\u5982\u679c\u4e0d\u60f3\u8981\u4e8c\u7ea7\u76ee\u5f55\uff0c\u5c31\u76f4\u63a5\u5199 bar \uff0c\u4e0d\u9700\u8981\u52a0 .json \u540e\u7f00\u3002 \u8fd9\u91cc\u53ea\u652f\u6301\u4e8c\u7ea7\u76ee\u5f55\uff0c\u4e0d\u652f\u6301\u66f4\u591a\u7ea7\u7684\u5b50\u76ee\u5f55\u3002 $file_array \u4e3a\u5185\u5bb9\uff0c\u4e00\u822c\u662f\u6570\u7ec4\uff0c\u6bd4\u5982\u4f60\u7f13\u5b58\u4e86\u4e00\u4e2a API \u63a5\u53e3\u8fd4\u56de\u7684\u6570\u636e\uff0c\u7136\u540e\u76f4\u63a5\u89e3\u6790\u6210\u6570\u7ec4\u540e\u4e22\u7ed9\u5b83\u5c31\u597d\u4e86\u3002 DataProvider::loadFromJson() \u4ece json \u6587\u4ef6\u52a0\u8f7d\u5185\u5bb9\u81f3\u53d8\u91cf\u3002 \u5b9a\u4e49\uff1a loadFromJson($filename) \u6587\u4ef6\u540d\u540c\u4e0a saveToJson() \u7684\u5b9a\u4e49\uff0c\u89e3\u6790\u540e\u7684\u8fd4\u56de\u503c\u4e3a\u539f\u5148\u7684\u5185\u5bb9\u6216 null \uff08\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\u6216 json \u89e3\u6790\u5931\u8d25\uff09\u3002 \u5176\u4ed6\u6587\u4ef6\u8bfb\u53d6 \u6846\u67b6\u6bd4\u8f83\u8d34\u8fd1\u539f\u751f\u7684 PHP\uff0c\u6240\u4ee5\u63a8\u8350\u76f4\u63a5\u4f7f\u7528\u539f\u751f\u7684\u65b9\u6cd5\u6765\u8bfb\u5199\u6587\u4ef6\uff08 file_get_contents \u548c file_put_contents \uff09\u3002\u4f46\u6709\u4e00\u70b9\u8981\u6ce8\u610f\uff0c\u6846\u67b6\u5185\u6700\u597d\u4f7f\u7528 \u5de5\u4f5c\u76ee\u5f55\u6216\u8005\u7edd\u5bf9\u8def\u5f84 \u3002 1 2 3 4 5 // \u8bfb\u53d6\u6846\u67b6\u5de5\u4f5c\u76ee\u5f55\u7684\u6587\u4ef6 composer.json \u6587\u4ef6 $r = file_get_contents(working_dir() . \"/composer.json\"); // \u5199\u5165 Linux \u4e34\u65f6\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6 file_put_contents(\"/tmp/test.txt\", \"hello world\"); \u6ce8\u610f \u5728\u9ed8\u8ba4\u7684\u60c5\u51b5\u91cc\uff0c\u6846\u67b6\u7684\u6839\u76ee\u5f55\u5747\u4e3a\u53ef\u5199\u53ef\u8bfb\u7684\uff0c\u5728\u8bfb\u5199\u6587\u4ef6\u65f6\u52a1\u5fc5\u8981\u6ce8\u610f\u76ee\u5f55\u7684\u4f4d\u7f6e\u548c\u6743\u9650\u3002\u4f7f\u7528 working_dir() \u83b7\u53d6\u76ee\u5f55\u540e\u9762\u9700\u8981\u52a0 / \u518d\u8ffd\u52a0\u81ea\u5df1\u7684\u6587\u4ef6\u540d\u6216\u5b50\u76ee\u5f55\u540d\u3002","title":"\u6587\u4ef6\u7ba1\u7406"},{"location":"component/store/data-provider/#_1","text":"DataProvider \u662f\u6846\u67b6\u5185\u63d0\u4f9b\u7684\u4e00\u4e2a\u7b80\u6613\u7684\u6587\u4ef6\u7ba1\u7406\u7c7b\u3002 \u5b9a\u4e49\uff1a \\ZM\\Utils\\DataProvider","title":"\u5b58\u50a8\u7ba1\u7406\uff08\u6587\u4ef6\uff09"},{"location":"component/store/data-provider/#dataprovidergetworkingdir","text":"\u540c working_dir() \u3002","title":"DataProvider::getWorkingDir()"},{"location":"component/store/data-provider/#dataprovidergetframeworklink","text":"\u540c ZMConfig::get(\"global\", \"http_reverse_link\") \uff0c\u83b7\u53d6\u53cd\u5411\u4ee3\u7406\u7684\u94fe\u63a5\u3002","title":"DataProvider::getFrameworkLink()"},{"location":"component/store/data-provider/#dataprovidergetdatafolder","text":"\u83b7\u53d6\u914d\u7f6e\u9879 zm_data \u6307\u5b9a\u7684\u76ee\u5f55\u3002 \u5982\u679c\u6307\u5b9a\u53c2\u6570 $second \uff0c\u5219\u8fd4\u56de\u4e8c\u7ea7\u76ee\u5f55\u5730\u5740\uff0c\u5982\u679c\u4e8c\u7ea7\u76ee\u5f55\u4e0d\u5b58\u5728\u5219\u81ea\u52a8\u521b\u5efa\u3002 1 DataProvider::getDataFolder(\"TestModule\"); // \u4f8b\u5982\u8fd4\u56de /root/zhamao-framework/zm_data/TestModule/","title":"DataProvider::getDataFolder()"},{"location":"component/store/data-provider/#dataprovidergetframeworkrootdir","text":"\u8fd4\u56de\u6846\u67b6\u672c\u4f53\u7684\u6839\u76ee\u5f55\u3002","title":"DataProvider::getFrameworkRootDir()"},{"location":"component/store/data-provider/#dataprovidersavetojson","text":"\u5c06\u53d8\u91cf\u5185\u5bb9\u4fdd\u5b58\u4e3a json \u683c\u5f0f\u7684\u6587\u4ef6\uff0c\u5b58\u50a8\u5728 zm_data/config/ \u76ee\u5f55\u4e0b\u6216\u5b50\u76ee\u5f55\u4e0b\u3002 \u5b9a\u4e49\uff1a saveToJson($filename, $file_array) $filename \u662f\u6587\u4ef6\u540d\uff0c\u4e0d\u9700\u8981\u52a0\u540e\u7f00\uff0c\u6bd4\u5982\u4f60\u60f3\u4fdd\u5b58\u6210 foo/bar.json \uff0c\u8fd9\u91cc\u5199 foo/bar \u5c31\u597d\u3002\u5982\u679c\u4e0d\u60f3\u8981\u4e8c\u7ea7\u76ee\u5f55\uff0c\u5c31\u76f4\u63a5\u5199 bar \uff0c\u4e0d\u9700\u8981\u52a0 .json \u540e\u7f00\u3002 \u8fd9\u91cc\u53ea\u652f\u6301\u4e8c\u7ea7\u76ee\u5f55\uff0c\u4e0d\u652f\u6301\u66f4\u591a\u7ea7\u7684\u5b50\u76ee\u5f55\u3002 $file_array \u4e3a\u5185\u5bb9\uff0c\u4e00\u822c\u662f\u6570\u7ec4\uff0c\u6bd4\u5982\u4f60\u7f13\u5b58\u4e86\u4e00\u4e2a API \u63a5\u53e3\u8fd4\u56de\u7684\u6570\u636e\uff0c\u7136\u540e\u76f4\u63a5\u89e3\u6790\u6210\u6570\u7ec4\u540e\u4e22\u7ed9\u5b83\u5c31\u597d\u4e86\u3002","title":"DataProvider::saveToJson()"},{"location":"component/store/data-provider/#dataproviderloadfromjson","text":"\u4ece json \u6587\u4ef6\u52a0\u8f7d\u5185\u5bb9\u81f3\u53d8\u91cf\u3002 \u5b9a\u4e49\uff1a loadFromJson($filename) \u6587\u4ef6\u540d\u540c\u4e0a saveToJson() \u7684\u5b9a\u4e49\uff0c\u89e3\u6790\u540e\u7684\u8fd4\u56de\u503c\u4e3a\u539f\u5148\u7684\u5185\u5bb9\u6216 null \uff08\u5982\u679c\u6587\u4ef6\u4e0d\u5b58\u5728\u6216 json \u89e3\u6790\u5931\u8d25\uff09\u3002","title":"DataProvider::loadFromJson()"},{"location":"component/store/data-provider/#_2","text":"\u6846\u67b6\u6bd4\u8f83\u8d34\u8fd1\u539f\u751f\u7684 PHP\uff0c\u6240\u4ee5\u63a8\u8350\u76f4\u63a5\u4f7f\u7528\u539f\u751f\u7684\u65b9\u6cd5\u6765\u8bfb\u5199\u6587\u4ef6\uff08 file_get_contents \u548c file_put_contents \uff09\u3002\u4f46\u6709\u4e00\u70b9\u8981\u6ce8\u610f\uff0c\u6846\u67b6\u5185\u6700\u597d\u4f7f\u7528 \u5de5\u4f5c\u76ee\u5f55\u6216\u8005\u7edd\u5bf9\u8def\u5f84 \u3002 1 2 3 4 5 // \u8bfb\u53d6\u6846\u67b6\u5de5\u4f5c\u76ee\u5f55\u7684\u6587\u4ef6 composer.json \u6587\u4ef6 $r = file_get_contents(working_dir() . \"/composer.json\"); // \u5199\u5165 Linux \u4e34\u65f6\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6 file_put_contents(\"/tmp/test.txt\", \"hello world\"); \u6ce8\u610f \u5728\u9ed8\u8ba4\u7684\u60c5\u51b5\u91cc\uff0c\u6846\u67b6\u7684\u6839\u76ee\u5f55\u5747\u4e3a\u53ef\u5199\u53ef\u8bfb\u7684\uff0c\u5728\u8bfb\u5199\u6587\u4ef6\u65f6\u52a1\u5fc5\u8981\u6ce8\u610f\u76ee\u5f55\u7684\u4f4d\u7f6e\u548c\u6743\u9650\u3002\u4f7f\u7528 working_dir() \u83b7\u53d6\u76ee\u5f55\u540e\u9762\u9700\u8981\u52a0 / \u518d\u8ffd\u52a0\u81ea\u5df1\u7684\u6587\u4ef6\u540d\u6216\u5b50\u76ee\u5f55\u540d\u3002","title":"\u5176\u4ed6\u6587\u4ef6\u8bfb\u53d6"},{"location":"component/store/light-cache/","text":"LightCache \u8f7b\u91cf\u7f13\u5b58 \u5728\u70b8\u6bdb\u6846\u67b6 1.x \u65f6\u4ee3\uff0c\u6846\u67b6\u91cc\u6709\u975e\u5e38\u65b9\u4fbf\u4f7f\u7528\u7684 ZMBuf \u7f13\u5b58\uff0c\u4f46\u662f\u7531\u4e8e 2.x \u7248\u672c\u6846\u67b6\u52a0\u5165\u4e86\u591a\u8fdb\u7a0b\u6a21\u5f0f\uff0c\u6240\u4ee5\u4e0d\u80fd\u518d\u4ee5\u4f20\u7edf\u7684\u5b58\u5230\u5168\u5c40\u53d8\u91cf\u7684\u65b9\u5f0f\u6765\u6784\u5efa\u548c\u7ba1\u7406\u7f13\u5b58\u4e86\uff0cLightCache \u5c31\u662f\u66ff\u4ee3\u65b9\u6848\u3002LightCache \u4f9d\u65e7\u662f key-value \u952e\u503c\u5bf9\u5f62\u5f0f\u7684\u5b58\u50a8\uff0c\u652f\u6301\u591a\u79cd\u7c7b\u578b\u7684\u53d8\u91cf\u3002 \u5b9a\u4e49\uff1a ZM\\Store\\LightCache \u3002 \u4e0e ZMBuf \u7684\u4e0d\u540c \u4ece\u5b58\u50a8\u5185\u5bb9\u89d2\u5ea6\uff0cLightCache \u5b58\u5165\u7684\u662f Swoole \u521d\u59cb\u5316\u7684\u5171\u4eab\u5185\u5b58\uff0c\u57fa\u4e8e Swoole/Table \u7f16\u5199\u3002\u4f18\u52bf\u5728\u4e8e\u591a\u8fdb\u7a0b\u4e0b\u7684\u6027\u80fd\u6781\u4f73\uff0c\u800c\u4e14\u6ca1\u6709\u6570\u636e\u540c\u6b65\u95ee\u9898\uff1b\u52a3\u52bf\u5728\u4e8e\u5b83\u9700\u8981\u5728\u542f\u52a8\u6846\u67b6\u524d\u5c31\u58f0\u660e\u603b\u5927\u5c0f\uff0c\u4e0d\u80fd\u6839\u636e\u5b58\u50a8\u6570\u636e\u7684\u5927\u5c0f\u6765\u5212\u5b9a\uff0c\u9700\u63d0\u524d\u6307\u5b9a\u6700\u5927\u80fd\u5b58\u50a8\u7684\u5bb9\u91cf\u3002\u800c ZMBuf \u57fa\u4e8e\u76f4\u63a5\u628a\u53d8\u91cf\u5b58\u5230\u9759\u6001\u6210\u5458\u4e2d public static $data \u7c7b\u4f3c\u8fd9\u6837\uff0c\u4e14 1.x \u6846\u67b6\u57fa\u4e8e\u5355\u8fdb\u7a0b\u5355\u7ebf\u7a0b\uff0c\u65e0\u4efb\u4f55\u6570\u636e\u540c\u6b65\u7684\u95ee\u9898\u3002 \u603b\u4e4b\u6765\u8bf4\uff0cLightCache \u662f\u8ba9\u7528\u6237\u5728\u6d89\u53ca\u591a\u8fdb\u7a0b\u7f16\u7a0b\u65f6\uff0c\u4e00\u4e2a\u6298\u4e2d\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u63d0\u51fa\u548c\u89e3\u51b3\u4e86\u5f88\u591a\u591a\u8fdb\u7a0b\u5f00\u53d1\u65f6\u5b58\u50a8\u6570\u636e\u9047\u5230\u7684\u95ee\u9898\uff1a\u6570\u636e\u540c\u6b65\u3001\u8fdb\u7a0b\u95f4\u901a\u4fe1\u6548\u7387\u3001\u6570\u636e\u662f\u5426\u9700\u8981\u4e0a\u9501\u7b49\u3002 \u6570\u636e\u540c\u6b65\uff1a\u591a\u8fdb\u7a0b\u4e0b\u56e0\u4e3a\u662f\u56fa\u5b9a\u7684\u5185\u5b58\u5927\u5c0f\u533a\u57df\uff0c\u6240\u4ee5\u6bcf\u4e2a\u8fdb\u7a0b\u8bfb\u53d6\u548c\u5199\u5165\u90fd\u662f\u53ea\u6709\u4e00\u4efd\u6570\u636e\u7684\uff0c\u4e0d\u5b58\u5728\u6570\u636e\u4e0d\u540c\u6b65\u7684\u95ee\u9898\u3002 \u8fdb\u7a0b\u95f4\u901a\u4fe1\uff1a\u56e0\u4e3a\u591a\u4e2a\u8fdb\u7a0b\u5171\u4eab\u4e00\u7247\u533a\u57df\u7684\u5185\u5b58\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u65e0\u534f\u7a0b\u5207\u6362\u3002 \u9540\u9521\u662f\u5426\u9700\u8981\u4e0a\u9501\uff1a\u770b\u60c5\u51b5\u3002\u4e00\u822c\u60c5\u51b5\u4e0b Swoole/Table \u6a21\u5757\u81ea\u5e26\u4e00\u4e2a\u884c\u9501\uff0c\u53ea\u6709\u4e24\u4e2a\u8fdb\u7a0b\u5728\u4e24\u4e2a CPU \u4e0a\u540c\u65f6\u8bfb\u53d6\u4e00\u884c\u6570\u636e\u65f6\u624d\u4f1a\u53d1\u751f\u62a2\u9501\uff0c\u4f5c\u4e3a\u6846\u67b6\u7684\u4f7f\u7528\u8005\uff0c\u5982\u679c\u53ea\u5199\u6216\u53ea\u8bfb\uff0c\u662f\u65e0\u9700\u624b\u52a8\u4e0a\u4efb\u4f55\u9501\u7684\u3002\u53ea\u6709\u5728\u5148 get() \u518d set() \u8fd9\u6837\u7684\u60c5\u51b5\u624d\u9700\u8981\u4e0a\u81ea\u65cb\u9501\u3002\u540e\u9762\u7684\u6bb5\u4f1a\u8be6\u7ec6\u8bb2\u8ff0\u3002 \u4f7f\u7528\u4f53\u9a8c\u4e0a\uff0c\u57fa\u672c\u548c ZMBuf \u65e0\u5dee\uff0c\u5982\u679c\u6ca1\u6709\u7528\u8fc7 1.x \u7684\u7248\u672c\uff0c\u53ef\u65e0\u89c6\u6b64\u6bb5\u8bdd\u3002 \u4f7f\u7528 \u914d\u7f6e\u548c\u521d\u59cb\u5316 \u914d\u7f6e\u6587\u4ef6\u8fd8\u662f\u5728 config/global.php \u6587\u4ef6\u91cc\uff0c\u5b57\u6bb5\u662f light_cache \u3002 1 2 3 4 5 6 7 8 /** \u8f7b\u91cf\u5b57\u7b26\u4e32\u7f13\u5b58\uff0c\u9ed8\u8ba4\u5f00\u542f */ $config['light_cache'] = [ 'size' => 512, //\u6700\u591a\u5141\u8bb8\u50a8\u5b58\u7684\u6761\u6570\uff08\u9700\u89812\u7684\u500d\u6570\uff09 'max_strlen' => 32768, //\u5355\u884c\u5b57\u7b26\u4e32\u6700\u5927\u957f\u5ea6\uff08\u9700\u89812\u7684\u500d\u6570\uff09 'hash_conflict_proportion' => 0.6, //Hash\u51b2\u7a81\u7387\uff08\u8d8a\u5927\u8d8a\u597d\uff0c\u4f46\u662f\u9700\u8981\u7684\u5185\u5b58\u66f4\u591a\uff09 'persistence_path' => $config['zm_data'].'_cache.json', 'auto_save_interval' => 900 ]; \u5176\u4e2d $size \u662f\u6700\u591a\u4fdd\u5b58\u7684\u952e\u503c\u5bf9\u6570\u76ee\uff0c\u586b\u5199\u975e 2 \u7684\u500d\u6570\u65f6\u5e95\u5c42\u4f1a\u81ea\u52a8\u4fee\u6b63\u4e3a 2 \u7684\u500d\u6570\u503c\u3002 $max_strlen \u4e3a\u5355\u6761\u503c\u6700\u957f\u4fdd\u5b58\u7684\u957f\u5ea6\u3002\u56e0\u4e3a Swoole/Table \u53ea\u80fd\u5b58\u6570\u5b57\u3001\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5\u5728\u5b58\u53d6\u6570\u7ec4\u7b49\u53d8\u91cf\u65f6\u4f1a\u5148\u5c06\u5176\u5e8f\u5217\u5316\u4e3a\u5b57\u7b26\u4e32\u5f62\u5f0f\u4fdd\u5b58\uff0cget \u65f6\u81ea\u52a8\u53cd\u5e8f\u5217\u5316\u56de\u6765\u3002\u5728\u5b58\u6570\u7ec4\u7b49\u975e\u5b57\u7b26\u4e32\u53d8\u91cf\u65f6\uff0c\u8bf7\u5148\u81ea\u884c\u8ba1\u7b97\u4f60\u8981\u5b58\u53d6\u7684\u5185\u5bb9\u5e8f\u5217\u5316\u540e\u7684\u6700\u5927\u957f\u5ea6\u3002\u5982\u679c\u957f\u5ea6\u8d85\u51fa\u6700\u5927\u957f\u5ea6\uff0c\u5219\u65e0\u6cd5\u4fdd\u5b58\uff0c set() \u5c06\u8fd4\u56de false\u3002 hash_conflict_proportion \uff1aTable \u6a21\u5757\u5e95\u5c42\u4f7f\u7528 hash \u8868\uff0c\u4f1a\u5b58\u5728 hash \u51b2\u7a81\uff0c\u8c03\u5927 Hash \u51b2\u7a81\u7387\u4f1a\u63d0\u5347 size \u6307\u5b9a\u6761\u76ee\u6570\u7684\u51c6\u786e\u6027\uff0c\u4f46\u4e5f\u5c06\u589e\u52a0\u7269\u7406\u5185\u5b58\u7684\u4f7f\u7528\u3002\u8fd9\u91cc\u5355\u4f4d\u662f\u767e\u5206\u6bd4\uff0c 0.6 \u4e3a 60% \u3002 persistence_path \u662f\u6301\u4e45\u5316\u4fdd\u5b58\u53d8\u91cf\u7684\u6587\u4ef6\u4fdd\u5b58\u4f4d\u7f6e\uff0c\u9ed8\u8ba4\u5728 zm_data/_cache.json \u6587\u4ef6\u3002 auto_save_interval \u662f\u6301\u4e45\u5316\u4fdd\u5b58\u53d8\u91cf\u7684\u81ea\u52a8\u4fdd\u5b58\u65f6\u95f4\uff0c\u5355\u4f4d\u79d2\u3002 LightCache::set() \u8bbe\u7f6e\u5185\u5bb9\u3002 \u5b9a\u4e49\uff1a LightCache::set($key, $value, $expire = -1) \u8fd4\u56de\u503c\uff1a bool \u3002\u5f53 value \u8d85\u51fa\u4e86\u6700\u5927\u957f\u5ea6\u6216\u5185\u5b58\u4e0d\u8db3\u65f6\uff0c\u8fd4\u56de false\uff0c\u5176\u4f59 true\u3002 \u53c2\u6570\uff1a $key \u7684\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7 64 \u5b57\u8282\uff0c\u4e14\u4e0d\u80fd\u5b58\u5165\u4e8c\u8fdb\u5236\u5185\u5bb9\u3002 $value \u53ef\u5b58\u5165 bool \u3001 string \u3001 int \u3001 array \u7b49\u53ef\u88ab json_encode() \u7684\u53d8\u91cf\uff0c\u95ed\u5305\u51fd\u6570\u548c\u5bf9\u8c61\u4e0d\u53ef\u5b58\u5165\u3002 $expire \u662f int \uff0c\u8d85\u65f6\u65f6\u95f4\uff08\u79d2\uff09\u3002\u5982\u679c\u8bbe\u5b9a\u4e86\u5927\u4e8e 0 \u7684\u503c\uff0c\u5219\u8868\u660e\u662f\u5728 $expire \u79d2\u540e\u81ea\u52a8\u5220\u9664\uff08\u6846\u67b6\u4e2d\u9014\u505c\u6b62\u4e0d\u53d7\u5f71\u54cd\uff09\u3002\u5982\u679c\u4e3a -1 \u5219\u4ec0\u4e48\u90fd\u4e0d\u505a\u3002\u6846\u67b6\u505c\u6b62\u540e\u81ea\u52a8\u88ab\u6e05\u9664\u3002 \u6ce8\u610f\uff1a\u5982\u679c\u524d\u9762\u4f7f\u7528\u4e86 set() \uff0c\u540e\u9762\u518d\u6b21\u4f7f\u7528 set() \u4f1a\u91cd\u7f6e expire \u8fc7\u671f\u65f6\u95f4\u4e3a -1\uff08-1 \u662f\u6846\u67b6\u8fd0\u884c\u65f6\u4e0d\u8fc7\u671f\uff0c\u5173\u95ed\u6846\u67b6\u5220\u9664\u7684\u72b6\u6001\uff09\uff0c\u5982\u679c\u53ea\u9700\u8981\u66f4\u65b0\u503c\uff0c\u8bf7\u4f7f\u7528 update()\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // use ZM\\Store\\LightCache; /** * @CQCommand(\"store\") */ public function store() { LightCache::set(\"key1\", [\"value1\" => \"strOrInt\", \"value2\" => 123]); return \"OK!\"; } /** * @CQCommand(\"storeAfterRemove\") */ public function storeAfterRemove() { LightCache::set(\"store1\", \"remove1\", 30); ctx()->reply(LightCache::get(\"store1\") !== null ? \"\u5185\u5bb9\u5b58\u5728\uff01\" : \"\u5185\u5bb9\u4e0d\u5b58\u5728\uff01\"); zm_sleep(30); ctx()->reply(LightCache::get(\"store1\") !== null ? \"\u5185\u5bb9\u5b58\u5728\uff01\" : \"\u5185\u5bb9\u4e0d\u5b58\u5728\uff01\"); } ) store ( OK\uff01 ) storeAfterRemove ( \u5185\u5bb9\u5b58\u5728\uff01 ^ \u7b49\u5f85 30 \u79d2 ( \u5185\u5bb9\u4e0d\u5b58\u5728\uff01 LightCache::update() \u66f4\u65b0\u503c\u800c\u4e0d\u66f4\u65b0\u72b6\u6001\u3002\u5982\u679c\u952e\u503c\u5bf9\u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56de false\u3002 \u5b9a\u4e49\uff1a LightCache::update(string $key, $value) \u53c2\u6570\u540c set() \uff0c\u53ef\u53c2\u8003\u3002 LightCache::get() \u83b7\u53d6\u5185\u5bb9\u3002 \u8fd4\u56de\u503c\uff1a mixed|null \u3002\u5f53\u65e0\u5185\u5bb9\u6216\u8fc7\u671f\u65f6\u8fd4\u56de null\uff0c\u5269\u4f59\u60c5\u51b5\u8fd4\u56de\u539f\u6570\u636e\u3002 LightCache::getExpire() \u83b7\u53d6\u5b58\u50a8\u9879\u5269\u4f59\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09\u3002 \u5b9a\u4e49\uff1a LightCache::getExpire(string $key) 1 2 3 $s = LightCache::set(\"test\", \"hello\", 20); zm_sleep(10); dump(LightCache::getExpire(\"test\")); // \u8fd4\u56de 10 LightCache::getExpireTS() \u83b7\u53d6\u5b58\u50a8\u9879\u8981\u8fc7\u671f\u7684\u65f6\u95f4\u6233\u3002\uff082.4.3 \u8d77\u53ef\u7528\uff09 \u5b9a\u4e49\uff1a LightCache::getExpireTS(string $key) 1 2 3 4 5 $s = LightCache::set(\"test\", \"hello\", 20); //\u5047\u8bbe\u8fd9\u6761\u4ee3\u7801\u6267\u884c\u65f6\u65f6\u95f4\u6233\u662f 1616838482 zm_sleep(10); dump(LightCache::getExpire(\"test\")); // \u8fd4\u56de 1616838502 zm_sleep(10); dump(LightCache::getExpire(\"test\")); // \u8fd4\u56de null LightCache::getMemoryUsage() \u83b7\u53d6\u8f7b\u91cf\u7f13\u5b58\u4f7f\u7528\u7684\u603b\u7a7a\u95f4\u5927\u5c0f\uff08\u5b57\u8282\uff09 1 LightCache::getMemoryUsage(); \u8f7b\u91cf\u7f13\u5b58\u7684\u5185\u5b58\u624b\u5de5\u8ba1\u7b97\u65b9\u5f0f\uff1a(Table \u7ed3\u6784\u4f53\u957f\u5ea6 + KEY \u957f\u5ea6 64 \u5b57\u8282 + $size ) * (1 + $conflict_proportion ) * \u5217\u5c3a\u5bf8\u3002 Table \u7ed3\u6784\u4f53\u957f\u5ea6\u6839\u636e\u4f60\u6240\u8bbe\u5b9a\u7684 max_strlen \u4f1a\u53d8\u5316\u3002 \u6846\u67b6\u9ed8\u8ba4\u914d\u7f6e\u4e0b\u7684\u8f7b\u91cf\u7f13\u5b58\u542f\u52a8\u540e\u5927\u7ea6\u5360\u7528\u5185\u5b58 25MB \u5de6\u53f3\u3002 LightCache::isset() \u5224\u65ad\u67d0\u9879\u662f\u5426\u5b58\u5728\u3002 1 2 LightCache::set(\"foo\", \"bar\"); dump(LightCache::isset(\"foo\")); // true LightCache::unset() \u5220\u9664\u67d0\u9879\u3002 1 2 3 LightCache::set(\"foo\", \"bar\"); LightCache::unset(\"foo\"); dump(LightCache::isset(\"foo\")); // false LightCache::getAll() \u83b7\u53d6\u6240\u6709\u9879\u3002 1 2 3 4 5 6 7 8 9 10 11 LightCache::set(\"k1\", [\"I\", \"am\", \"array\"]); LightCache::set(\"k2\", \"v2\"); LightCache::set(\"k3\", 20001); dump(LightCache::getAll()); /* { \"k1\": [\"I\", \"am\", \"array\"], \"k2\": \"v2\", \"k3\": 20001 } */ LightCache::addPersistence() \u6dfb\u52a0\u6301\u4e45\u5316\u5b58\u50a8\u7684\u952e\u3002 \u7528\u6cd5\uff1a LightCache::addPersistence($key) \u3002 \u6ce8\uff1a\u53ea\u9700\u8c03\u7528\u4e00\u6b21\u5373\u53ef\uff0c\u65e0\u9700\u591a\u6b21\u91cd\u590d\u8c03\u7528\uff0c\u4e5f\u4e0d\u9700\u8981\u8bbe\u7f6e expire \u4e3a -2 \u4e86\u3002\uff082.4.2 \u8d77\u53ef\u7528\u6b64\u65b9\u6cd5\uff09\u3002 \u8be6\u89c1\u4e0b\u65b9 \u6301\u4e45\u5316 \u3002 LightCache::removePersistence() \u5220\u9664\u6301\u4e45\u5316\u7684\u952e\u3002 \u7528\u6cd5\uff1a LightCache::removePersistence($key) \u3002 \u6ce8\uff1a\u53ea\u9700\u8c03\u7528\u4e00\u6b21\u5373\u53ef\uff0c\u65e0\u9700\u591a\u6b21\u91cd\u590d\u8c03\u7528\uff0c\u4e5f\u4e0d\u9700\u8981\u8bbe\u7f6e expire \u4e3a\u975e -2 \u4e86\u3002\uff082.4.2 \u8d77\u53ef\u7528\u6b64\u65b9\u6cd5\uff09\u3002 \u6301\u4e45\u5316 \u4f7f\u7528 LightCache::addPersistence($key) \u6dfb\u52a0\u5bf9\u5e94\u9700\u8981\u6301\u4e45\u5316\u7684\u952e\u540d\u5373\u53ef\u3002 1 2 3 4 5 6 7 8 9 10 11 12 /** * @OnStart() */ public function onStart() { LightCache::addPersistence(\"msg_time\"); } /** * @CQCommand(\"getStore\") */ public function getStore() { return \"\u5b58\u50a8\u65f6\u95f4\uff1a\".date(\"Y-m-d H:i:s\", LightCache::get(\"msg_time\")); } ^ \u6211\u5728 2021-01-05 15:21:00 \u53d1\u9001\u8fd9\u6761\u6d88\u606f ) getStore ( 2021-01-05 15:20:00 ^ \u8fd9\u65f6\u6211\u7528 Ctrl+C \u505c\u6b62\u6846\u67b6\uff0c\u8fc7\u4e00\u4f1a\u513f\u518d\u542f\u52a8 ) getStore ( \u5b58\u50a8\u65f6\u95f4\uff1a2021-01-05 15:20:00 \u6570\u636e\u52a0\u9501 \u5728\u7279\u5b9a\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 LightCache \u5fc5\u987b\u914d\u5408\u9501\u4f7f\u7528\uff0c\u5426\u5219\u4f1a\u51fa\u73b0\u6570\u636e\u9519\u4e71\u3002\u6211\u4eec\u6765\u770b\u4e0b\u9762\u7684\u4f8b\u5b50\uff1a 1 2 3 4 5 6 7 8 9 10 /** * @RequestMapping(\"/test\") */ public function test() { $s = LightCache::get(\"web_count\"); if($s === null) $s = 1; else $s += 1; LightCache::set(\"web_count\", $s); return \"<h1>It works!</h1>\"; } \u6211\u4eec\u4f7f\u7528\u538b\u6d4b\u5de5\u5177\uff0c\u4f8b\u5982 ab \uff0c\u5bf9\u6b64\u8def\u7531\u63a5\u53e3\u5f00\u5f88\u591a\u5f88\u591a\u7ebf\u7a0b\u8fdb\u884c\u6d4b\u8bd5\uff0c\u5047\u8bbe\u6211\u4eec\u8bbe\u7f6e\u8bf7\u6c42\u603b\u6570\u4e3a 200000 \u6b21\uff0c\u6846\u67b6\u7684\u5de5\u4f5c\u8fdb\u7a0b\u6570\u4e3a 8\uff08\u6211\u7528\u7684\u662f 2020 \u5e74\u672b\u7684 i5 MacBook Pro 13 inch\uff09\u3002 \u61d2\u5f97\u518d\u6d4b\u4e86\uff0c\u4e0b\u9762\u5c31\u53e3\u8ff0\u8fc7\u7a0b\u5427\u3002 \u5728\u8fd0\u884c\u5b8c\u6d4b\u8bd5\u540e\uff0c\u901a\u8fc7 LightCache::get(\"web_count\") \uff0c\u83b7\u53d6\u5230\u7684\u6570\u4f60\u4f1a\u53d1\u73b0\u4e0d\u662f 200000\u3002\u600e\u4e48\u56de\u4e8b\u5462\uff1f\u8bf7\u81ea\u884c\u7ffb\u9605\u591a\u8fdb\u7a0b\u5f00\u53d1\u76f8\u5173\u7684\u4e66\u7c4d\u54e6\uff01\uff08\u6216\u8005\u7b80\u5355\u7406\u89e3\u4e3a\uff0c\u6709\u4e00\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8fdb\u7a0b 1 \u6267\u884c\u5230\u4e86 if-else \u8bed\u53e5\uff0c\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u4e5f\u6267\u884c\u5230\u4e86\u8fd9\u91cc\uff0c\u4e24\u6b21\u5728\u4ee3\u7801\u5c42\u9762\u52a0\u7684\u6570\u662f\u76f8\u540c\u7684\uff0c\u5219\u867d\u7136\u8bf7\u6c42\u4e86\u4e24\u6b21\uff0c\u4f46\u662f\u540e\u6267\u884c set \u7684\u90a3\u4e2a\u8fdb\u7a0b\u53c8\u8986\u76d6\u4e86\u524d\u4e00\u4e2a\u8fdb\u7a0b\u6267\u884c\u7684\u503c\uff0c\u5bfc\u81f4\u6700\u7ec8\u7ed3\u679c\u52a0\u4e86 1 \u800c\u4e0d\u662f 2\uff09 \u63d0\u793a \u540c\u6837\u7684\u573a\u666f\uff0c\u4f7f\u7528 ZMAtomic \u5c31\u4e0d\u9700\u8981\u4f7f\u7528\u9501\u4e86\u3002Atomic \u662f\u4e00\u53e5\u8bdd\uff1a add(1) \u7acb\u5373\u52a0\u503c\u7684\u3002\u800c LightCache \u9700\u8981\u52a0\u9501\u7684\u60c5\u51b5\u4e00\u822c\u90fd\u662f get->\u6539\u503c->set \u8fd9\u6837\u7684\u4ee3\u7801\u3002 \u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0c\u5c31\u9700\u8981\u7528\u5230\u9501\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u9996\u5148\u8003\u8651\u7684\u662f\u81ea\u65cb\u9501\uff0c\u6846\u67b6\u4e5f\u56e0\u6b64\u5185\u7f6e\u4e86\u4e00\u4e2a\u65b9\u4fbf\u4f7f\u7528\u7684\u81ea\u65cb\u9501\u7ec4\u4ef6\u3002\u8be6\u89c1\u4e0b\u4e00\u7ae0\uff1a\u81ea\u65cb\u9501\u3002 \u5982\u4f55\u4e34\u65f6\u7f13\u5b58\u5927\u53d8\u91cf \u7531\u4e8e LightCache \u9700\u8981\u63d0\u524d\u58f0\u660e\u6700\u5927\u5927\u5c0f\uff0c\u6240\u4ee5\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6bd4\u5982\u7b2c\u4e09\u65b9 API \u63a5\u53e3\u7ed3\u679c\u4e34\u65f6\u7f13\u5b58\uff0c\u53ef\u80fd\u4e0d\u592a\u9002\u5408\u4f7f\u7528\uff0c\u8fd9\u65f6\u5bf9\u4e8e 2.x \u7248\u672c\u7684\u591a\u8fdb\u7a0b\u70b8\u6bdb\u6846\u67b6\u662f\u4e00\u4e2a\u65b0\u7684\u95ee\u9898\u3002 \u89e3\u51b3\u65b9\u6848\u6709\u4e09\u79cd\uff1a \u5c06 global.php \u4e2d\u7684 swoole.worker_num \u8c03\u6574\u4e3a 1 \u5373\u53ef\uff0c\u6240\u6709\u9664\u6240\u6709\u4e3b handler \u4e8b\u4ef6\u7684\u7528\u6237\u7c7b\u5916\u5176\u4ed6\u7c7b\u5747\u53ef\u4f7f\u7528\u5982 Hello::$store \u7c7b\u4f3c\u7684\u9759\u6001\u53d8\u91cf\u5168\u5c40\u5b58\u53d6 \u4f7f\u7528 WorkerCache\uff08\u9700\u8981 2.2.0 \u4ee5\u4e0a\u7248\u672c\uff09 \u4f7f\u7528 Redis\uff08\u9700\u8981\u5b89\u88c5 redis \u6269\u5c55\uff09 \u4ee5\u4e0a\uff0cWorkerCache \u662f\u4e3a\u4e86\u5f25\u8865 LightCache \u7684\u4e0d\u8db3\u800c\u8bde\u751f\u7684\uff0c\u4ee5\u4e0b\u5c31\u662f WorkerCache \u7684\u5177\u4f53\u5185\u5bb9\u3002 WorkerCache \u8de8\u8fdb\u7a0b\u5927\u7f13\u5b58 WorkerCache \u548c LightCache \u51e0\u4e4e\u5b8c\u5168\u4e0d\u540c\uff0cWorkerCache \u5b58\u50a8\u7684\u65b9\u5f0f\u8bf4\u767d\u4e86\u5c31\u662f PHP \u7684\u9759\u6001\u53d8\u91cf\uff0c\u4e0d\u8fc7\u6846\u67b6\u652f\u6301\u4f7f\u7528\u5c01\u88c5\u597d\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u8fdb\u884c\u8de8\u8fdb\u7a0b\u8bfb\u53d6\u3002\u4f46\u7531\u4e8e\u9700\u8981\u8bbe\u7f6e\u4e00\u4e2a\u5b58\u50a8\u53d8\u91cf\u7684\u8fdb\u7a0b\uff0c\u6240\u4ee5\u914d\u7f6e\u6587\u4ef6\u5fc5\u987b\u5148\u6307\u5b9a\u8981\u5c06\u6570\u636e\u5b58\u5230\u54ea\u4e2a Worker/TaskWorker \u8fdb\u7a0b\u4e2d\u3002\u5173\u4e8e\u6846\u67b6\u5185\u591a\u8fdb\u7a0b\u7684\u8bf4\u660e\uff0c\u8bf7\u89c1 \u8fdb\u9636 - \u591a\u8fdb\u7a0b Hack \u3002 \u5b9a\u4e49\uff1a ZM\\Store\\WorkerCache \u3002 \u914d\u7f6e \u89c1 \u57fa\u672c\u914d\u7f6e \u3002 WorkerCache::get() \u5b9a\u4e49\uff1a get($key) \u3002 $key \u4e3a\u6307\u5b9a\u8981\u83b7\u53d6\u7684\u952e\u503c\u5bf9\u7684\u503c\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5219\u8fd4\u56de null\u3002 WorkerCache::set() \u5b9a\u4e49\uff1a set($key, $value, $async = false) \u3002 \u8bbe\u7f6e\u53d8\u91cf\uff0c\u4f60\u61c2\u7684\u3002 \u6ce8\u610f\uff0c $value \u53ef\u4ee5\u662f\u88ab\u65e0\u635f json_encode \u548c json_decode \u7684\u53d8\u91cf\uff0c\u95ed\u5305\uff08Closure\uff09\u3001\u8d44\u6e90\uff08resource\uff09\u7b49\u7c7b\u578b\u4e0d\u652f\u6301\u5b58\u50a8\u3002 $async \u9ed8\u8ba4\u4e3a false\uff0c\u5f53\u4e3a true \u65f6\u5019\uff0c\u4e0d\u4f1a\u8fd4\u56de\u662f\u5426\u6210\u529f\u8bbe\u7f6e\u4e0e\u5426\uff0c\u5426\u5219\u4f1a\u534f\u7a0b\u7b49\u5f85\u662f\u5426\u76ee\u6807\u8fdb\u7a0b\u5b58\u50a8\u6210\u529f\u3002 WorkerCache::unset() \u5b9a\u4e49\uff1a unset($key, $async = false) \u5220\u9664\u952e\u5bf9\u5e94\u7684\u503c\u3002 $async \u7684\u610f\u4e49\u540c\u4e0a\u3002 WorkerCache::add() \u5b9a\u4e49\uff1a add($key, int $value, $async = false) \u7ed9 int \u7c7b\u578b\u7684\u503c\u52a0\u4e00\uff0c\u5982\u679c\u503c\u4e0d\u5b58\u5728\uff0c\u5219\u9ed8\u8ba4\u4e3a 0 \u4e14\u52a0\u4e0a\u76ee\u6807\u7684 $value \u3002 WorkerCache::sub() \u5b9a\u4e49\uff1a sub($key, int $value, $async = false) \u7ed9 int \u7c7b\u578b\u7684\u503c\u51cf\u4e00\uff0c\u5982\u679c\u503c\u4e0d\u5b58\u5728\uff0c\u5219\u9ed8\u8ba4\u4e3a 0 \u4e14\u51cf\u53bb\u76ee\u6807\u7684 $value \u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 <?php namespace Module\\Example ; use ZM\\Store\\WorkerCache ; use ZM\\Annotation\\CQ\\CQCommand ; class Hello { /** * @CQCommand(\"set_store\") */ public function setStorage () { $arg1 = ctx () -> getNextArg ( \"\u8bf7\u8f93\u5165\u8981\u8bbe\u7f6e\u7684\u5185\u5bb9\u540d\u79f0\" ); $arg2 = ctx () -> getFullArg ( \"\u8bf7\u8f93\u5165\u8981\u8bbe\u7f6e\u7684\u5185\u5bb9\" ); WorkerCache :: set ( $arg1 , $arg2 ); return \"\u6210\u529f\uff01\" ; } /** * @CQCommand(\"get_store\") */ public function getStorage () { $arg1 = ctx () -> getFullArg ( \"\u8bf7\u8f93\u5165\u8981\u83b7\u53d6\u7684\u5185\u5bb9\u540d\u79f0\" ); $data = WorkerCache :: get ( $arg1 ); return $data ?? \"\u5185\u5bb9\u4e0d\u5b58\u5728\uff01\" ; } } ) set_store hello world ( \u6210\u529f\uff01 ) get_store hello ( world ) get_store foo ( \u5185\u5bb9\u4e0d\u5b58\u5728\uff01","title":"LightCache \u8f7b\u91cf\u7f13\u5b58"},{"location":"component/store/light-cache/#lightcache","text":"\u5728\u70b8\u6bdb\u6846\u67b6 1.x \u65f6\u4ee3\uff0c\u6846\u67b6\u91cc\u6709\u975e\u5e38\u65b9\u4fbf\u4f7f\u7528\u7684 ZMBuf \u7f13\u5b58\uff0c\u4f46\u662f\u7531\u4e8e 2.x \u7248\u672c\u6846\u67b6\u52a0\u5165\u4e86\u591a\u8fdb\u7a0b\u6a21\u5f0f\uff0c\u6240\u4ee5\u4e0d\u80fd\u518d\u4ee5\u4f20\u7edf\u7684\u5b58\u5230\u5168\u5c40\u53d8\u91cf\u7684\u65b9\u5f0f\u6765\u6784\u5efa\u548c\u7ba1\u7406\u7f13\u5b58\u4e86\uff0cLightCache \u5c31\u662f\u66ff\u4ee3\u65b9\u6848\u3002LightCache \u4f9d\u65e7\u662f key-value \u952e\u503c\u5bf9\u5f62\u5f0f\u7684\u5b58\u50a8\uff0c\u652f\u6301\u591a\u79cd\u7c7b\u578b\u7684\u53d8\u91cf\u3002 \u5b9a\u4e49\uff1a ZM\\Store\\LightCache \u3002","title":"LightCache \u8f7b\u91cf\u7f13\u5b58"},{"location":"component/store/light-cache/#zmbuf","text":"\u4ece\u5b58\u50a8\u5185\u5bb9\u89d2\u5ea6\uff0cLightCache \u5b58\u5165\u7684\u662f Swoole \u521d\u59cb\u5316\u7684\u5171\u4eab\u5185\u5b58\uff0c\u57fa\u4e8e Swoole/Table \u7f16\u5199\u3002\u4f18\u52bf\u5728\u4e8e\u591a\u8fdb\u7a0b\u4e0b\u7684\u6027\u80fd\u6781\u4f73\uff0c\u800c\u4e14\u6ca1\u6709\u6570\u636e\u540c\u6b65\u95ee\u9898\uff1b\u52a3\u52bf\u5728\u4e8e\u5b83\u9700\u8981\u5728\u542f\u52a8\u6846\u67b6\u524d\u5c31\u58f0\u660e\u603b\u5927\u5c0f\uff0c\u4e0d\u80fd\u6839\u636e\u5b58\u50a8\u6570\u636e\u7684\u5927\u5c0f\u6765\u5212\u5b9a\uff0c\u9700\u63d0\u524d\u6307\u5b9a\u6700\u5927\u80fd\u5b58\u50a8\u7684\u5bb9\u91cf\u3002\u800c ZMBuf \u57fa\u4e8e\u76f4\u63a5\u628a\u53d8\u91cf\u5b58\u5230\u9759\u6001\u6210\u5458\u4e2d public static $data \u7c7b\u4f3c\u8fd9\u6837\uff0c\u4e14 1.x \u6846\u67b6\u57fa\u4e8e\u5355\u8fdb\u7a0b\u5355\u7ebf\u7a0b\uff0c\u65e0\u4efb\u4f55\u6570\u636e\u540c\u6b65\u7684\u95ee\u9898\u3002 \u603b\u4e4b\u6765\u8bf4\uff0cLightCache \u662f\u8ba9\u7528\u6237\u5728\u6d89\u53ca\u591a\u8fdb\u7a0b\u7f16\u7a0b\u65f6\uff0c\u4e00\u4e2a\u6298\u4e2d\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u63d0\u51fa\u548c\u89e3\u51b3\u4e86\u5f88\u591a\u591a\u8fdb\u7a0b\u5f00\u53d1\u65f6\u5b58\u50a8\u6570\u636e\u9047\u5230\u7684\u95ee\u9898\uff1a\u6570\u636e\u540c\u6b65\u3001\u8fdb\u7a0b\u95f4\u901a\u4fe1\u6548\u7387\u3001\u6570\u636e\u662f\u5426\u9700\u8981\u4e0a\u9501\u7b49\u3002 \u6570\u636e\u540c\u6b65\uff1a\u591a\u8fdb\u7a0b\u4e0b\u56e0\u4e3a\u662f\u56fa\u5b9a\u7684\u5185\u5b58\u5927\u5c0f\u533a\u57df\uff0c\u6240\u4ee5\u6bcf\u4e2a\u8fdb\u7a0b\u8bfb\u53d6\u548c\u5199\u5165\u90fd\u662f\u53ea\u6709\u4e00\u4efd\u6570\u636e\u7684\uff0c\u4e0d\u5b58\u5728\u6570\u636e\u4e0d\u540c\u6b65\u7684\u95ee\u9898\u3002 \u8fdb\u7a0b\u95f4\u901a\u4fe1\uff1a\u56e0\u4e3a\u591a\u4e2a\u8fdb\u7a0b\u5171\u4eab\u4e00\u7247\u533a\u57df\u7684\u5185\u5b58\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u65e0\u534f\u7a0b\u5207\u6362\u3002 \u9540\u9521\u662f\u5426\u9700\u8981\u4e0a\u9501\uff1a\u770b\u60c5\u51b5\u3002\u4e00\u822c\u60c5\u51b5\u4e0b Swoole/Table \u6a21\u5757\u81ea\u5e26\u4e00\u4e2a\u884c\u9501\uff0c\u53ea\u6709\u4e24\u4e2a\u8fdb\u7a0b\u5728\u4e24\u4e2a CPU \u4e0a\u540c\u65f6\u8bfb\u53d6\u4e00\u884c\u6570\u636e\u65f6\u624d\u4f1a\u53d1\u751f\u62a2\u9501\uff0c\u4f5c\u4e3a\u6846\u67b6\u7684\u4f7f\u7528\u8005\uff0c\u5982\u679c\u53ea\u5199\u6216\u53ea\u8bfb\uff0c\u662f\u65e0\u9700\u624b\u52a8\u4e0a\u4efb\u4f55\u9501\u7684\u3002\u53ea\u6709\u5728\u5148 get() \u518d set() \u8fd9\u6837\u7684\u60c5\u51b5\u624d\u9700\u8981\u4e0a\u81ea\u65cb\u9501\u3002\u540e\u9762\u7684\u6bb5\u4f1a\u8be6\u7ec6\u8bb2\u8ff0\u3002 \u4f7f\u7528\u4f53\u9a8c\u4e0a\uff0c\u57fa\u672c\u548c ZMBuf \u65e0\u5dee\uff0c\u5982\u679c\u6ca1\u6709\u7528\u8fc7 1.x \u7684\u7248\u672c\uff0c\u53ef\u65e0\u89c6\u6b64\u6bb5\u8bdd\u3002","title":"\u4e0e ZMBuf \u7684\u4e0d\u540c"},{"location":"component/store/light-cache/#_1","text":"","title":"\u4f7f\u7528"},{"location":"component/store/light-cache/#_2","text":"\u914d\u7f6e\u6587\u4ef6\u8fd8\u662f\u5728 config/global.php \u6587\u4ef6\u91cc\uff0c\u5b57\u6bb5\u662f light_cache \u3002 1 2 3 4 5 6 7 8 /** \u8f7b\u91cf\u5b57\u7b26\u4e32\u7f13\u5b58\uff0c\u9ed8\u8ba4\u5f00\u542f */ $config['light_cache'] = [ 'size' => 512, //\u6700\u591a\u5141\u8bb8\u50a8\u5b58\u7684\u6761\u6570\uff08\u9700\u89812\u7684\u500d\u6570\uff09 'max_strlen' => 32768, //\u5355\u884c\u5b57\u7b26\u4e32\u6700\u5927\u957f\u5ea6\uff08\u9700\u89812\u7684\u500d\u6570\uff09 'hash_conflict_proportion' => 0.6, //Hash\u51b2\u7a81\u7387\uff08\u8d8a\u5927\u8d8a\u597d\uff0c\u4f46\u662f\u9700\u8981\u7684\u5185\u5b58\u66f4\u591a\uff09 'persistence_path' => $config['zm_data'].'_cache.json', 'auto_save_interval' => 900 ]; \u5176\u4e2d $size \u662f\u6700\u591a\u4fdd\u5b58\u7684\u952e\u503c\u5bf9\u6570\u76ee\uff0c\u586b\u5199\u975e 2 \u7684\u500d\u6570\u65f6\u5e95\u5c42\u4f1a\u81ea\u52a8\u4fee\u6b63\u4e3a 2 \u7684\u500d\u6570\u503c\u3002 $max_strlen \u4e3a\u5355\u6761\u503c\u6700\u957f\u4fdd\u5b58\u7684\u957f\u5ea6\u3002\u56e0\u4e3a Swoole/Table \u53ea\u80fd\u5b58\u6570\u5b57\u3001\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5\u5728\u5b58\u53d6\u6570\u7ec4\u7b49\u53d8\u91cf\u65f6\u4f1a\u5148\u5c06\u5176\u5e8f\u5217\u5316\u4e3a\u5b57\u7b26\u4e32\u5f62\u5f0f\u4fdd\u5b58\uff0cget \u65f6\u81ea\u52a8\u53cd\u5e8f\u5217\u5316\u56de\u6765\u3002\u5728\u5b58\u6570\u7ec4\u7b49\u975e\u5b57\u7b26\u4e32\u53d8\u91cf\u65f6\uff0c\u8bf7\u5148\u81ea\u884c\u8ba1\u7b97\u4f60\u8981\u5b58\u53d6\u7684\u5185\u5bb9\u5e8f\u5217\u5316\u540e\u7684\u6700\u5927\u957f\u5ea6\u3002\u5982\u679c\u957f\u5ea6\u8d85\u51fa\u6700\u5927\u957f\u5ea6\uff0c\u5219\u65e0\u6cd5\u4fdd\u5b58\uff0c set() \u5c06\u8fd4\u56de false\u3002 hash_conflict_proportion \uff1aTable \u6a21\u5757\u5e95\u5c42\u4f7f\u7528 hash \u8868\uff0c\u4f1a\u5b58\u5728 hash \u51b2\u7a81\uff0c\u8c03\u5927 Hash \u51b2\u7a81\u7387\u4f1a\u63d0\u5347 size \u6307\u5b9a\u6761\u76ee\u6570\u7684\u51c6\u786e\u6027\uff0c\u4f46\u4e5f\u5c06\u589e\u52a0\u7269\u7406\u5185\u5b58\u7684\u4f7f\u7528\u3002\u8fd9\u91cc\u5355\u4f4d\u662f\u767e\u5206\u6bd4\uff0c 0.6 \u4e3a 60% \u3002 persistence_path \u662f\u6301\u4e45\u5316\u4fdd\u5b58\u53d8\u91cf\u7684\u6587\u4ef6\u4fdd\u5b58\u4f4d\u7f6e\uff0c\u9ed8\u8ba4\u5728 zm_data/_cache.json \u6587\u4ef6\u3002 auto_save_interval \u662f\u6301\u4e45\u5316\u4fdd\u5b58\u53d8\u91cf\u7684\u81ea\u52a8\u4fdd\u5b58\u65f6\u95f4\uff0c\u5355\u4f4d\u79d2\u3002","title":"\u914d\u7f6e\u548c\u521d\u59cb\u5316"},{"location":"component/store/light-cache/#lightcacheset","text":"\u8bbe\u7f6e\u5185\u5bb9\u3002 \u5b9a\u4e49\uff1a LightCache::set($key, $value, $expire = -1) \u8fd4\u56de\u503c\uff1a bool \u3002\u5f53 value \u8d85\u51fa\u4e86\u6700\u5927\u957f\u5ea6\u6216\u5185\u5b58\u4e0d\u8db3\u65f6\uff0c\u8fd4\u56de false\uff0c\u5176\u4f59 true\u3002 \u53c2\u6570\uff1a $key \u7684\u957f\u5ea6\u4e0d\u80fd\u8d85\u8fc7 64 \u5b57\u8282\uff0c\u4e14\u4e0d\u80fd\u5b58\u5165\u4e8c\u8fdb\u5236\u5185\u5bb9\u3002 $value \u53ef\u5b58\u5165 bool \u3001 string \u3001 int \u3001 array \u7b49\u53ef\u88ab json_encode() \u7684\u53d8\u91cf\uff0c\u95ed\u5305\u51fd\u6570\u548c\u5bf9\u8c61\u4e0d\u53ef\u5b58\u5165\u3002 $expire \u662f int \uff0c\u8d85\u65f6\u65f6\u95f4\uff08\u79d2\uff09\u3002\u5982\u679c\u8bbe\u5b9a\u4e86\u5927\u4e8e 0 \u7684\u503c\uff0c\u5219\u8868\u660e\u662f\u5728 $expire \u79d2\u540e\u81ea\u52a8\u5220\u9664\uff08\u6846\u67b6\u4e2d\u9014\u505c\u6b62\u4e0d\u53d7\u5f71\u54cd\uff09\u3002\u5982\u679c\u4e3a -1 \u5219\u4ec0\u4e48\u90fd\u4e0d\u505a\u3002\u6846\u67b6\u505c\u6b62\u540e\u81ea\u52a8\u88ab\u6e05\u9664\u3002 \u6ce8\u610f\uff1a\u5982\u679c\u524d\u9762\u4f7f\u7528\u4e86 set() \uff0c\u540e\u9762\u518d\u6b21\u4f7f\u7528 set() \u4f1a\u91cd\u7f6e expire \u8fc7\u671f\u65f6\u95f4\u4e3a -1\uff08-1 \u662f\u6846\u67b6\u8fd0\u884c\u65f6\u4e0d\u8fc7\u671f\uff0c\u5173\u95ed\u6846\u67b6\u5220\u9664\u7684\u72b6\u6001\uff09\uff0c\u5982\u679c\u53ea\u9700\u8981\u66f4\u65b0\u503c\uff0c\u8bf7\u4f7f\u7528 update()\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 // use ZM\\Store\\LightCache; /** * @CQCommand(\"store\") */ public function store() { LightCache::set(\"key1\", [\"value1\" => \"strOrInt\", \"value2\" => 123]); return \"OK!\"; } /** * @CQCommand(\"storeAfterRemove\") */ public function storeAfterRemove() { LightCache::set(\"store1\", \"remove1\", 30); ctx()->reply(LightCache::get(\"store1\") !== null ? \"\u5185\u5bb9\u5b58\u5728\uff01\" : \"\u5185\u5bb9\u4e0d\u5b58\u5728\uff01\"); zm_sleep(30); ctx()->reply(LightCache::get(\"store1\") !== null ? \"\u5185\u5bb9\u5b58\u5728\uff01\" : \"\u5185\u5bb9\u4e0d\u5b58\u5728\uff01\"); } ) store ( OK\uff01 ) storeAfterRemove ( \u5185\u5bb9\u5b58\u5728\uff01 ^ \u7b49\u5f85 30 \u79d2 ( \u5185\u5bb9\u4e0d\u5b58\u5728\uff01","title":"LightCache::set()"},{"location":"component/store/light-cache/#lightcacheupdate","text":"\u66f4\u65b0\u503c\u800c\u4e0d\u66f4\u65b0\u72b6\u6001\u3002\u5982\u679c\u952e\u503c\u5bf9\u4e0d\u5b58\u5728\uff0c\u5219\u8fd4\u56de false\u3002 \u5b9a\u4e49\uff1a LightCache::update(string $key, $value) \u53c2\u6570\u540c set() \uff0c\u53ef\u53c2\u8003\u3002","title":"LightCache::update()"},{"location":"component/store/light-cache/#lightcacheget","text":"\u83b7\u53d6\u5185\u5bb9\u3002 \u8fd4\u56de\u503c\uff1a mixed|null \u3002\u5f53\u65e0\u5185\u5bb9\u6216\u8fc7\u671f\u65f6\u8fd4\u56de null\uff0c\u5269\u4f59\u60c5\u51b5\u8fd4\u56de\u539f\u6570\u636e\u3002","title":"LightCache::get()"},{"location":"component/store/light-cache/#lightcachegetexpire","text":"\u83b7\u53d6\u5b58\u50a8\u9879\u5269\u4f59\u8fc7\u671f\u65f6\u95f4\uff08\u79d2\uff09\u3002 \u5b9a\u4e49\uff1a LightCache::getExpire(string $key) 1 2 3 $s = LightCache::set(\"test\", \"hello\", 20); zm_sleep(10); dump(LightCache::getExpire(\"test\")); // \u8fd4\u56de 10","title":"LightCache::getExpire()"},{"location":"component/store/light-cache/#lightcachegetexpirets","text":"\u83b7\u53d6\u5b58\u50a8\u9879\u8981\u8fc7\u671f\u7684\u65f6\u95f4\u6233\u3002\uff082.4.3 \u8d77\u53ef\u7528\uff09 \u5b9a\u4e49\uff1a LightCache::getExpireTS(string $key) 1 2 3 4 5 $s = LightCache::set(\"test\", \"hello\", 20); //\u5047\u8bbe\u8fd9\u6761\u4ee3\u7801\u6267\u884c\u65f6\u65f6\u95f4\u6233\u662f 1616838482 zm_sleep(10); dump(LightCache::getExpire(\"test\")); // \u8fd4\u56de 1616838502 zm_sleep(10); dump(LightCache::getExpire(\"test\")); // \u8fd4\u56de null","title":"LightCache::getExpireTS()"},{"location":"component/store/light-cache/#lightcachegetmemoryusage","text":"\u83b7\u53d6\u8f7b\u91cf\u7f13\u5b58\u4f7f\u7528\u7684\u603b\u7a7a\u95f4\u5927\u5c0f\uff08\u5b57\u8282\uff09 1 LightCache::getMemoryUsage(); \u8f7b\u91cf\u7f13\u5b58\u7684\u5185\u5b58\u624b\u5de5\u8ba1\u7b97\u65b9\u5f0f\uff1a(Table \u7ed3\u6784\u4f53\u957f\u5ea6 + KEY \u957f\u5ea6 64 \u5b57\u8282 + $size ) * (1 + $conflict_proportion ) * \u5217\u5c3a\u5bf8\u3002 Table \u7ed3\u6784\u4f53\u957f\u5ea6\u6839\u636e\u4f60\u6240\u8bbe\u5b9a\u7684 max_strlen \u4f1a\u53d8\u5316\u3002 \u6846\u67b6\u9ed8\u8ba4\u914d\u7f6e\u4e0b\u7684\u8f7b\u91cf\u7f13\u5b58\u542f\u52a8\u540e\u5927\u7ea6\u5360\u7528\u5185\u5b58 25MB \u5de6\u53f3\u3002","title":"LightCache::getMemoryUsage()"},{"location":"component/store/light-cache/#lightcacheisset","text":"\u5224\u65ad\u67d0\u9879\u662f\u5426\u5b58\u5728\u3002 1 2 LightCache::set(\"foo\", \"bar\"); dump(LightCache::isset(\"foo\")); // true","title":"LightCache::isset()"},{"location":"component/store/light-cache/#lightcacheunset","text":"\u5220\u9664\u67d0\u9879\u3002 1 2 3 LightCache::set(\"foo\", \"bar\"); LightCache::unset(\"foo\"); dump(LightCache::isset(\"foo\")); // false","title":"LightCache::unset()"},{"location":"component/store/light-cache/#lightcachegetall","text":"\u83b7\u53d6\u6240\u6709\u9879\u3002 1 2 3 4 5 6 7 8 9 10 11 LightCache::set(\"k1\", [\"I\", \"am\", \"array\"]); LightCache::set(\"k2\", \"v2\"); LightCache::set(\"k3\", 20001); dump(LightCache::getAll()); /* { \"k1\": [\"I\", \"am\", \"array\"], \"k2\": \"v2\", \"k3\": 20001 } */","title":"LightCache::getAll()"},{"location":"component/store/light-cache/#lightcacheaddpersistence","text":"\u6dfb\u52a0\u6301\u4e45\u5316\u5b58\u50a8\u7684\u952e\u3002 \u7528\u6cd5\uff1a LightCache::addPersistence($key) \u3002 \u6ce8\uff1a\u53ea\u9700\u8c03\u7528\u4e00\u6b21\u5373\u53ef\uff0c\u65e0\u9700\u591a\u6b21\u91cd\u590d\u8c03\u7528\uff0c\u4e5f\u4e0d\u9700\u8981\u8bbe\u7f6e expire \u4e3a -2 \u4e86\u3002\uff082.4.2 \u8d77\u53ef\u7528\u6b64\u65b9\u6cd5\uff09\u3002 \u8be6\u89c1\u4e0b\u65b9 \u6301\u4e45\u5316 \u3002","title":"LightCache::addPersistence()"},{"location":"component/store/light-cache/#lightcacheremovepersistence","text":"\u5220\u9664\u6301\u4e45\u5316\u7684\u952e\u3002 \u7528\u6cd5\uff1a LightCache::removePersistence($key) \u3002 \u6ce8\uff1a\u53ea\u9700\u8c03\u7528\u4e00\u6b21\u5373\u53ef\uff0c\u65e0\u9700\u591a\u6b21\u91cd\u590d\u8c03\u7528\uff0c\u4e5f\u4e0d\u9700\u8981\u8bbe\u7f6e expire \u4e3a\u975e -2 \u4e86\u3002\uff082.4.2 \u8d77\u53ef\u7528\u6b64\u65b9\u6cd5\uff09\u3002","title":"LightCache::removePersistence()"},{"location":"component/store/light-cache/#_3","text":"\u4f7f\u7528 LightCache::addPersistence($key) \u6dfb\u52a0\u5bf9\u5e94\u9700\u8981\u6301\u4e45\u5316\u7684\u952e\u540d\u5373\u53ef\u3002 1 2 3 4 5 6 7 8 9 10 11 12 /** * @OnStart() */ public function onStart() { LightCache::addPersistence(\"msg_time\"); } /** * @CQCommand(\"getStore\") */ public function getStore() { return \"\u5b58\u50a8\u65f6\u95f4\uff1a\".date(\"Y-m-d H:i:s\", LightCache::get(\"msg_time\")); } ^ \u6211\u5728 2021-01-05 15:21:00 \u53d1\u9001\u8fd9\u6761\u6d88\u606f ) getStore ( 2021-01-05 15:20:00 ^ \u8fd9\u65f6\u6211\u7528 Ctrl+C \u505c\u6b62\u6846\u67b6\uff0c\u8fc7\u4e00\u4f1a\u513f\u518d\u542f\u52a8 ) getStore ( \u5b58\u50a8\u65f6\u95f4\uff1a2021-01-05 15:20:00","title":"\u6301\u4e45\u5316"},{"location":"component/store/light-cache/#_4","text":"\u5728\u7279\u5b9a\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 LightCache \u5fc5\u987b\u914d\u5408\u9501\u4f7f\u7528\uff0c\u5426\u5219\u4f1a\u51fa\u73b0\u6570\u636e\u9519\u4e71\u3002\u6211\u4eec\u6765\u770b\u4e0b\u9762\u7684\u4f8b\u5b50\uff1a 1 2 3 4 5 6 7 8 9 10 /** * @RequestMapping(\"/test\") */ public function test() { $s = LightCache::get(\"web_count\"); if($s === null) $s = 1; else $s += 1; LightCache::set(\"web_count\", $s); return \"<h1>It works!</h1>\"; } \u6211\u4eec\u4f7f\u7528\u538b\u6d4b\u5de5\u5177\uff0c\u4f8b\u5982 ab \uff0c\u5bf9\u6b64\u8def\u7531\u63a5\u53e3\u5f00\u5f88\u591a\u5f88\u591a\u7ebf\u7a0b\u8fdb\u884c\u6d4b\u8bd5\uff0c\u5047\u8bbe\u6211\u4eec\u8bbe\u7f6e\u8bf7\u6c42\u603b\u6570\u4e3a 200000 \u6b21\uff0c\u6846\u67b6\u7684\u5de5\u4f5c\u8fdb\u7a0b\u6570\u4e3a 8\uff08\u6211\u7528\u7684\u662f 2020 \u5e74\u672b\u7684 i5 MacBook Pro 13 inch\uff09\u3002 \u61d2\u5f97\u518d\u6d4b\u4e86\uff0c\u4e0b\u9762\u5c31\u53e3\u8ff0\u8fc7\u7a0b\u5427\u3002 \u5728\u8fd0\u884c\u5b8c\u6d4b\u8bd5\u540e\uff0c\u901a\u8fc7 LightCache::get(\"web_count\") \uff0c\u83b7\u53d6\u5230\u7684\u6570\u4f60\u4f1a\u53d1\u73b0\u4e0d\u662f 200000\u3002\u600e\u4e48\u56de\u4e8b\u5462\uff1f\u8bf7\u81ea\u884c\u7ffb\u9605\u591a\u8fdb\u7a0b\u5f00\u53d1\u76f8\u5173\u7684\u4e66\u7c4d\u54e6\uff01\uff08\u6216\u8005\u7b80\u5355\u7406\u89e3\u4e3a\uff0c\u6709\u4e00\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8fdb\u7a0b 1 \u6267\u884c\u5230\u4e86 if-else \u8bed\u53e5\uff0c\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u4e5f\u6267\u884c\u5230\u4e86\u8fd9\u91cc\uff0c\u4e24\u6b21\u5728\u4ee3\u7801\u5c42\u9762\u52a0\u7684\u6570\u662f\u76f8\u540c\u7684\uff0c\u5219\u867d\u7136\u8bf7\u6c42\u4e86\u4e24\u6b21\uff0c\u4f46\u662f\u540e\u6267\u884c set \u7684\u90a3\u4e2a\u8fdb\u7a0b\u53c8\u8986\u76d6\u4e86\u524d\u4e00\u4e2a\u8fdb\u7a0b\u6267\u884c\u7684\u503c\uff0c\u5bfc\u81f4\u6700\u7ec8\u7ed3\u679c\u52a0\u4e86 1 \u800c\u4e0d\u662f 2\uff09 \u63d0\u793a \u540c\u6837\u7684\u573a\u666f\uff0c\u4f7f\u7528 ZMAtomic \u5c31\u4e0d\u9700\u8981\u4f7f\u7528\u9501\u4e86\u3002Atomic \u662f\u4e00\u53e5\u8bdd\uff1a add(1) \u7acb\u5373\u52a0\u503c\u7684\u3002\u800c LightCache \u9700\u8981\u52a0\u9501\u7684\u60c5\u51b5\u4e00\u822c\u90fd\u662f get->\u6539\u503c->set \u8fd9\u6837\u7684\u4ee3\u7801\u3002 \u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0c\u5c31\u9700\u8981\u7528\u5230\u9501\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u9996\u5148\u8003\u8651\u7684\u662f\u81ea\u65cb\u9501\uff0c\u6846\u67b6\u4e5f\u56e0\u6b64\u5185\u7f6e\u4e86\u4e00\u4e2a\u65b9\u4fbf\u4f7f\u7528\u7684\u81ea\u65cb\u9501\u7ec4\u4ef6\u3002\u8be6\u89c1\u4e0b\u4e00\u7ae0\uff1a\u81ea\u65cb\u9501\u3002","title":"\u6570\u636e\u52a0\u9501"},{"location":"component/store/light-cache/#_5","text":"\u7531\u4e8e LightCache \u9700\u8981\u63d0\u524d\u58f0\u660e\u6700\u5927\u5927\u5c0f\uff0c\u6240\u4ee5\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6bd4\u5982\u7b2c\u4e09\u65b9 API \u63a5\u53e3\u7ed3\u679c\u4e34\u65f6\u7f13\u5b58\uff0c\u53ef\u80fd\u4e0d\u592a\u9002\u5408\u4f7f\u7528\uff0c\u8fd9\u65f6\u5bf9\u4e8e 2.x \u7248\u672c\u7684\u591a\u8fdb\u7a0b\u70b8\u6bdb\u6846\u67b6\u662f\u4e00\u4e2a\u65b0\u7684\u95ee\u9898\u3002 \u89e3\u51b3\u65b9\u6848\u6709\u4e09\u79cd\uff1a \u5c06 global.php \u4e2d\u7684 swoole.worker_num \u8c03\u6574\u4e3a 1 \u5373\u53ef\uff0c\u6240\u6709\u9664\u6240\u6709\u4e3b handler \u4e8b\u4ef6\u7684\u7528\u6237\u7c7b\u5916\u5176\u4ed6\u7c7b\u5747\u53ef\u4f7f\u7528\u5982 Hello::$store \u7c7b\u4f3c\u7684\u9759\u6001\u53d8\u91cf\u5168\u5c40\u5b58\u53d6 \u4f7f\u7528 WorkerCache\uff08\u9700\u8981 2.2.0 \u4ee5\u4e0a\u7248\u672c\uff09 \u4f7f\u7528 Redis\uff08\u9700\u8981\u5b89\u88c5 redis \u6269\u5c55\uff09 \u4ee5\u4e0a\uff0cWorkerCache \u662f\u4e3a\u4e86\u5f25\u8865 LightCache \u7684\u4e0d\u8db3\u800c\u8bde\u751f\u7684\uff0c\u4ee5\u4e0b\u5c31\u662f WorkerCache \u7684\u5177\u4f53\u5185\u5bb9\u3002","title":"\u5982\u4f55\u4e34\u65f6\u7f13\u5b58\u5927\u53d8\u91cf"},{"location":"component/store/light-cache/#workercache","text":"WorkerCache \u548c LightCache \u51e0\u4e4e\u5b8c\u5168\u4e0d\u540c\uff0cWorkerCache \u5b58\u50a8\u7684\u65b9\u5f0f\u8bf4\u767d\u4e86\u5c31\u662f PHP \u7684\u9759\u6001\u53d8\u91cf\uff0c\u4e0d\u8fc7\u6846\u67b6\u652f\u6301\u4f7f\u7528\u5c01\u88c5\u597d\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u8fdb\u884c\u8de8\u8fdb\u7a0b\u8bfb\u53d6\u3002\u4f46\u7531\u4e8e\u9700\u8981\u8bbe\u7f6e\u4e00\u4e2a\u5b58\u50a8\u53d8\u91cf\u7684\u8fdb\u7a0b\uff0c\u6240\u4ee5\u914d\u7f6e\u6587\u4ef6\u5fc5\u987b\u5148\u6307\u5b9a\u8981\u5c06\u6570\u636e\u5b58\u5230\u54ea\u4e2a Worker/TaskWorker \u8fdb\u7a0b\u4e2d\u3002\u5173\u4e8e\u6846\u67b6\u5185\u591a\u8fdb\u7a0b\u7684\u8bf4\u660e\uff0c\u8bf7\u89c1 \u8fdb\u9636 - \u591a\u8fdb\u7a0b Hack \u3002 \u5b9a\u4e49\uff1a ZM\\Store\\WorkerCache \u3002","title":"WorkerCache \u8de8\u8fdb\u7a0b\u5927\u7f13\u5b58"},{"location":"component/store/light-cache/#_6","text":"\u89c1 \u57fa\u672c\u914d\u7f6e \u3002","title":"\u914d\u7f6e"},{"location":"component/store/light-cache/#workercacheget","text":"\u5b9a\u4e49\uff1a get($key) \u3002 $key \u4e3a\u6307\u5b9a\u8981\u83b7\u53d6\u7684\u952e\u503c\u5bf9\u7684\u503c\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5219\u8fd4\u56de null\u3002","title":"WorkerCache::get()"},{"location":"component/store/light-cache/#workercacheset","text":"\u5b9a\u4e49\uff1a set($key, $value, $async = false) \u3002 \u8bbe\u7f6e\u53d8\u91cf\uff0c\u4f60\u61c2\u7684\u3002 \u6ce8\u610f\uff0c $value \u53ef\u4ee5\u662f\u88ab\u65e0\u635f json_encode \u548c json_decode \u7684\u53d8\u91cf\uff0c\u95ed\u5305\uff08Closure\uff09\u3001\u8d44\u6e90\uff08resource\uff09\u7b49\u7c7b\u578b\u4e0d\u652f\u6301\u5b58\u50a8\u3002 $async \u9ed8\u8ba4\u4e3a false\uff0c\u5f53\u4e3a true \u65f6\u5019\uff0c\u4e0d\u4f1a\u8fd4\u56de\u662f\u5426\u6210\u529f\u8bbe\u7f6e\u4e0e\u5426\uff0c\u5426\u5219\u4f1a\u534f\u7a0b\u7b49\u5f85\u662f\u5426\u76ee\u6807\u8fdb\u7a0b\u5b58\u50a8\u6210\u529f\u3002","title":"WorkerCache::set()"},{"location":"component/store/light-cache/#workercacheunset","text":"\u5b9a\u4e49\uff1a unset($key, $async = false) \u5220\u9664\u952e\u5bf9\u5e94\u7684\u503c\u3002 $async \u7684\u610f\u4e49\u540c\u4e0a\u3002","title":"WorkerCache::unset()"},{"location":"component/store/light-cache/#workercacheadd","text":"\u5b9a\u4e49\uff1a add($key, int $value, $async = false) \u7ed9 int \u7c7b\u578b\u7684\u503c\u52a0\u4e00\uff0c\u5982\u679c\u503c\u4e0d\u5b58\u5728\uff0c\u5219\u9ed8\u8ba4\u4e3a 0 \u4e14\u52a0\u4e0a\u76ee\u6807\u7684 $value \u3002","title":"WorkerCache::add()"},{"location":"component/store/light-cache/#workercachesub","text":"\u5b9a\u4e49\uff1a sub($key, int $value, $async = false) \u7ed9 int \u7c7b\u578b\u7684\u503c\u51cf\u4e00\uff0c\u5982\u679c\u503c\u4e0d\u5b58\u5728\uff0c\u5219\u9ed8\u8ba4\u4e3a 0 \u4e14\u51cf\u53bb\u76ee\u6807\u7684 $value \u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 <?php namespace Module\\Example ; use ZM\\Store\\WorkerCache ; use ZM\\Annotation\\CQ\\CQCommand ; class Hello { /** * @CQCommand(\"set_store\") */ public function setStorage () { $arg1 = ctx () -> getNextArg ( \"\u8bf7\u8f93\u5165\u8981\u8bbe\u7f6e\u7684\u5185\u5bb9\u540d\u79f0\" ); $arg2 = ctx () -> getFullArg ( \"\u8bf7\u8f93\u5165\u8981\u8bbe\u7f6e\u7684\u5185\u5bb9\" ); WorkerCache :: set ( $arg1 , $arg2 ); return \"\u6210\u529f\uff01\" ; } /** * @CQCommand(\"get_store\") */ public function getStorage () { $arg1 = ctx () -> getFullArg ( \"\u8bf7\u8f93\u5165\u8981\u83b7\u53d6\u7684\u5185\u5bb9\u540d\u79f0\" ); $data = WorkerCache :: get ( $arg1 ); return $data ?? \"\u5185\u5bb9\u4e0d\u5b58\u5728\uff01\" ; } } ) set_store hello world ( \u6210\u529f\uff01 ) get_store hello ( world ) get_store foo ( \u5185\u5bb9\u4e0d\u5b58\u5728\uff01","title":"WorkerCache::sub()"},{"location":"component/store/mysql/","text":"MySQL \u6570\u636e\u5e93 \u914d\u7f6e \u70b8\u6bdb\u6846\u67b6\u7684\u6570\u636e\u5e93\u7ec4\u4ef6\u652f\u6301\u539f\u751f SQL\u3001\u67e5\u8be2\u6784\u9020\u5668\uff0c\u53bb\u6389\u4e86\u590d\u6742\u7684\u5bf9\u8c61\u6a21\u578b\u5173\u8054\uff0c\u540c\u65f6\u9ed8\u8ba4\u4e3a\u6570\u636e\u5e93\u8fde\u63a5\u6c60\uff0c\u4f7f\u5f00\u53d1\u53d8\u5f97\u7b80\u5355\u3002 \u6570\u636e\u5e93\u7684\u914d\u7f6e\u4f4d\u4e8e config/global.php \u6587\u4ef6\u7684 sql_config \u6bb5\u3002 \u6570\u636e\u5e93\u64cd\u4f5c\u7684\u552f\u4e00\u6838\u5fc3\u5de5\u5177\u7c7b\u548c\u529f\u80fd\u7c7b\u4e3a \\ZM\\DB\\DB \uff0c\u4f7f\u7528\u524d\u9700\u8981\u914d\u7f6e host \u548c use \u6b64\u7c7b\u3002 \u67e5\u8be2\u6784\u9020\u5668 \u5728 \u70b8\u6bdb\u6846\u67b6 \u4e2d\uff0c\u6570\u636e\u5e93\u67e5\u8be2\u6784\u9020\u5668\u4e3a\u521b\u5efa\u548c\u6267\u884c\u6570\u636e\u5e93\u67e5\u8be2\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b9\u4fbf\u7684\u63a5\u53e3\uff0c\u5b83\u53ef\u7528\u4e8e\u6267\u884c\u5e94\u7528\u7a0b\u5e8f\u4e2d\u5927\u90e8\u5206\u6570\u636e\u5e93\u64cd\u4f5c\u3002\u540c\u65f6\uff0c\u67e5\u8be2\u6784\u9020\u5668\u4f7f\u7528 prepare \u9884\u5904\u7406\u6765\u4fdd\u62a4\u7a0b\u5e8f\u514d\u53d7 SQL \u6ce8\u5165\u653b\u51fb\uff0c\u56e0\u6b64\u6ca1\u6709\u5fc5\u8981\u8f6c\u4e49\u4efb\u4f55\u4f20\u5165\u7684\u5b57\u7b26\u4e32\u3002 \u65b0\u589e\u6570\u636e 1 2 DB::table(\"admin\")->insert(['admin_name', 'admin_password'])->save(); // INSERT INTO admin VALUES ('admin_name', 'admin_password') \u5176\u4e2d insert \u7684\u53c2\u6570\u662f\u63d2\u5165\u6761\u76ee\u7684\u6570\u636e\u5217\u8868\u3002\u5047\u8bbe admin \u8868\u6709 name \uff0c password \u4e24\u5217\u3002 \u81ea\u589e ID \u63d2\u5165 0 \u5373\u53ef\u3002 \u5220\u9664\u6570\u636e 1 2 DB::table(\"admin\")->delete()->where(\"name\", \"admin_name\")->save(); // DELETE FROM admin WHERE name = 'admin_name' \u5176\u4e2d where \u8bed\u53e5\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u5217\u540d\uff0c\u5f53\u53ea\u6709\u4e24\u4e2a\u53c2\u6570\u65f6\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u503c\uff0c\u6548\u679c\u7b49\u540c\u4e8e SQL \u8bed\u53e5\uff1a WHERE name = 'admin_name' \uff0c\u5f53\u542b\u6709\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e14\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a = \uff0c != \uff0c LIKE \u7684\u65f6\u5019\uff0c\u6548\u679c\u5c31\u662f WHERE \u7b2c\u4e00\u4e2a\u53c2\u6570 \u7b2c\u4e8c\u4e2a\u53c2\u6570\u7684\u64cd\u4f5c\u7b26 \u7b2c\u4e09\u4e2a\u53c2\u6570 \u3002 \u66f4\u65b0\u6570\u636e 1 2 DB::table(\"admin\")->update([\"name\" => \"fake_admin\"])->where(\"name\", \"admin_name\")->save(); // UPDATE admin SET name = 'fake_admin' WHERE name = 'admin_name' update() \u65b9\u6cd5\u4e2d\u662f\u8981 SET \u7684\u5185\u5bb9\u7684\u952e\u503c\u5bf9\uff0c\u4f8b\u5982\u4e0a\u9762\u628a name \u5217\u7684\u503c\u6539\u4e3a fake_admin \u3002 \u67e5\u8be2\u6570\u636e 1 2 3 4 5 $r = DB::table(\"admin\")->select([\"name\"])->where(\"name\", \"fake_admin\")->fetchFirst(); // SELECT name FROM admin WHERE name = 'fake_admin' echo $r[\"name\"]; echo DB::table(\"admin\")->where(\"name\", \"fake_admin\")->value(\"name\"); // SELECT * FROM admin WHERE name = 'fake_admin' select() \u65b9\u6cd5\u7684\u53c2\u6570\u662f\u8981\u67e5\u8be2\u7684\u5217\uff0c\u9ed8\u8ba4\u7559\u7a7a\u4e3a [\"*\"] \uff0c\u4e5f\u5c31\u662f\u6240\u6709\u5217\u90fd\u83b7\u53d6\uff0c\u4e5f\u53ef\u4ee5\u5728 table \u540e\u76f4\u63a5 where \u67e5\u8be2\u3002 \u5176\u4e2d fetchFirst() \u83b7\u53d6\u7b2c\u4e00\u884c\u6570\u636e\u3002 \u5982\u679c\u53ea\u9700\u83b7\u53d6\u4e00\u884c\u4e2d\u7684\u4e00\u4e2a\u5b57\u6bb5\u503c\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4e0a\u9762\u6240\u793a\u7684 value() \u65b9\u6cd5\u76f4\u63a5\u83b7\u53d6\u3002 \u591a\u5217\u6570\u636e\u83b7\u53d6\u9700\u8981\u4f7f\u7528 fetchAll() 1 2 3 4 5 $r = DB::table(\"admin\")->select()->fetchAll(); // SELECT * FROM admin WHERE 1 foreach($r as $k => $v) { echo $v[\"name\"].PHP_EOL; } \u67e5\u8be2\u6761\u6570 1 2 DB::table(\"admin\")->where(\"name\", \"fake_admin\")->count(); //SELECT count(*) FROM admin WHERE name = 'fake_admin' \u76f4\u63a5\u6267\u884c SQL \u5728\u67e5\u8be2\u5668\u5916\u6267\u884c\u7684 SQL \u8bed\u53e5\u90fd\u4e0d\u4f1a\u88ab\u7f13\u5b58\uff0c\u90fd\u662f\u4e00\u5b9a\u4f1a\u8bf7\u6c42\u6570\u636e\u5e93\u7684\u3002 DB::rawQuery() \u7528\u9014\uff1a\u76f4\u63a5\u6267\u884c\u6a21\u677f\u67e5\u8be2\u7684\u88f8 SQL \u8bed\u53e5\u3002 \u53c2\u6570\uff1a $line \uff0c $params \u8fd4\u56de\uff1a\u67e5\u5230\u7684\u884c\u7684\u6570\u7ec4 $line \u4e3a\u8bf7\u6c42\u7684 SQL \u8bed\u53e5\uff0c $params \u4e3a\u6a21\u677f\u53c2\u6570\u3002 1 2 3 $r = DB::rawQuery(\"SELECT * FROM admin WHERE name = ?\", [\"fake_admin\"]); //SELECT * FROM admin WHERE name = 'fake_admin' echo $r[0][\"password\"]; \u53c2\u6570\u67e5\u8be2\u5df2\u7ecf\u4ece\u6839\u672c\u4e0a\u675c\u7edd\u4e86 SQL \u6ce8\u5165\u7684\u95ee\u9898\u3002","title":"MySQL \u6570\u636e\u5e93"},{"location":"component/store/mysql/#mysql","text":"","title":"MySQL \u6570\u636e\u5e93"},{"location":"component/store/mysql/#_1","text":"\u70b8\u6bdb\u6846\u67b6\u7684\u6570\u636e\u5e93\u7ec4\u4ef6\u652f\u6301\u539f\u751f SQL\u3001\u67e5\u8be2\u6784\u9020\u5668\uff0c\u53bb\u6389\u4e86\u590d\u6742\u7684\u5bf9\u8c61\u6a21\u578b\u5173\u8054\uff0c\u540c\u65f6\u9ed8\u8ba4\u4e3a\u6570\u636e\u5e93\u8fde\u63a5\u6c60\uff0c\u4f7f\u5f00\u53d1\u53d8\u5f97\u7b80\u5355\u3002 \u6570\u636e\u5e93\u7684\u914d\u7f6e\u4f4d\u4e8e config/global.php \u6587\u4ef6\u7684 sql_config \u6bb5\u3002 \u6570\u636e\u5e93\u64cd\u4f5c\u7684\u552f\u4e00\u6838\u5fc3\u5de5\u5177\u7c7b\u548c\u529f\u80fd\u7c7b\u4e3a \\ZM\\DB\\DB \uff0c\u4f7f\u7528\u524d\u9700\u8981\u914d\u7f6e host \u548c use \u6b64\u7c7b\u3002","title":"\u914d\u7f6e"},{"location":"component/store/mysql/#_2","text":"\u5728 \u70b8\u6bdb\u6846\u67b6 \u4e2d\uff0c\u6570\u636e\u5e93\u67e5\u8be2\u6784\u9020\u5668\u4e3a\u521b\u5efa\u548c\u6267\u884c\u6570\u636e\u5e93\u67e5\u8be2\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b9\u4fbf\u7684\u63a5\u53e3\uff0c\u5b83\u53ef\u7528\u4e8e\u6267\u884c\u5e94\u7528\u7a0b\u5e8f\u4e2d\u5927\u90e8\u5206\u6570\u636e\u5e93\u64cd\u4f5c\u3002\u540c\u65f6\uff0c\u67e5\u8be2\u6784\u9020\u5668\u4f7f\u7528 prepare \u9884\u5904\u7406\u6765\u4fdd\u62a4\u7a0b\u5e8f\u514d\u53d7 SQL \u6ce8\u5165\u653b\u51fb\uff0c\u56e0\u6b64\u6ca1\u6709\u5fc5\u8981\u8f6c\u4e49\u4efb\u4f55\u4f20\u5165\u7684\u5b57\u7b26\u4e32\u3002","title":"\u67e5\u8be2\u6784\u9020\u5668"},{"location":"component/store/mysql/#_3","text":"1 2 DB::table(\"admin\")->insert(['admin_name', 'admin_password'])->save(); // INSERT INTO admin VALUES ('admin_name', 'admin_password') \u5176\u4e2d insert \u7684\u53c2\u6570\u662f\u63d2\u5165\u6761\u76ee\u7684\u6570\u636e\u5217\u8868\u3002\u5047\u8bbe admin \u8868\u6709 name \uff0c password \u4e24\u5217\u3002 \u81ea\u589e ID \u63d2\u5165 0 \u5373\u53ef\u3002","title":"\u65b0\u589e\u6570\u636e"},{"location":"component/store/mysql/#_4","text":"1 2 DB::table(\"admin\")->delete()->where(\"name\", \"admin_name\")->save(); // DELETE FROM admin WHERE name = 'admin_name' \u5176\u4e2d where \u8bed\u53e5\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a\u5217\u540d\uff0c\u5f53\u53ea\u6709\u4e24\u4e2a\u53c2\u6570\u65f6\uff0c\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u503c\uff0c\u6548\u679c\u7b49\u540c\u4e8e SQL \u8bed\u53e5\uff1a WHERE name = 'admin_name' \uff0c\u5f53\u542b\u6709\u7b2c\u4e09\u4e2a\u53c2\u6570\u4e14\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a = \uff0c != \uff0c LIKE \u7684\u65f6\u5019\uff0c\u6548\u679c\u5c31\u662f WHERE \u7b2c\u4e00\u4e2a\u53c2\u6570 \u7b2c\u4e8c\u4e2a\u53c2\u6570\u7684\u64cd\u4f5c\u7b26 \u7b2c\u4e09\u4e2a\u53c2\u6570 \u3002","title":"\u5220\u9664\u6570\u636e"},{"location":"component/store/mysql/#_5","text":"1 2 DB::table(\"admin\")->update([\"name\" => \"fake_admin\"])->where(\"name\", \"admin_name\")->save(); // UPDATE admin SET name = 'fake_admin' WHERE name = 'admin_name' update() \u65b9\u6cd5\u4e2d\u662f\u8981 SET \u7684\u5185\u5bb9\u7684\u952e\u503c\u5bf9\uff0c\u4f8b\u5982\u4e0a\u9762\u628a name \u5217\u7684\u503c\u6539\u4e3a fake_admin \u3002","title":"\u66f4\u65b0\u6570\u636e"},{"location":"component/store/mysql/#_6","text":"1 2 3 4 5 $r = DB::table(\"admin\")->select([\"name\"])->where(\"name\", \"fake_admin\")->fetchFirst(); // SELECT name FROM admin WHERE name = 'fake_admin' echo $r[\"name\"]; echo DB::table(\"admin\")->where(\"name\", \"fake_admin\")->value(\"name\"); // SELECT * FROM admin WHERE name = 'fake_admin' select() \u65b9\u6cd5\u7684\u53c2\u6570\u662f\u8981\u67e5\u8be2\u7684\u5217\uff0c\u9ed8\u8ba4\u7559\u7a7a\u4e3a [\"*\"] \uff0c\u4e5f\u5c31\u662f\u6240\u6709\u5217\u90fd\u83b7\u53d6\uff0c\u4e5f\u53ef\u4ee5\u5728 table \u540e\u76f4\u63a5 where \u67e5\u8be2\u3002 \u5176\u4e2d fetchFirst() \u83b7\u53d6\u7b2c\u4e00\u884c\u6570\u636e\u3002 \u5982\u679c\u53ea\u9700\u83b7\u53d6\u4e00\u884c\u4e2d\u7684\u4e00\u4e2a\u5b57\u6bb5\u503c\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u4e0a\u9762\u6240\u793a\u7684 value() \u65b9\u6cd5\u76f4\u63a5\u83b7\u53d6\u3002 \u591a\u5217\u6570\u636e\u83b7\u53d6\u9700\u8981\u4f7f\u7528 fetchAll() 1 2 3 4 5 $r = DB::table(\"admin\")->select()->fetchAll(); // SELECT * FROM admin WHERE 1 foreach($r as $k => $v) { echo $v[\"name\"].PHP_EOL; }","title":"\u67e5\u8be2\u6570\u636e"},{"location":"component/store/mysql/#_7","text":"1 2 DB::table(\"admin\")->where(\"name\", \"fake_admin\")->count(); //SELECT count(*) FROM admin WHERE name = 'fake_admin'","title":"\u67e5\u8be2\u6761\u6570"},{"location":"component/store/mysql/#sql","text":"\u5728\u67e5\u8be2\u5668\u5916\u6267\u884c\u7684 SQL \u8bed\u53e5\u90fd\u4e0d\u4f1a\u88ab\u7f13\u5b58\uff0c\u90fd\u662f\u4e00\u5b9a\u4f1a\u8bf7\u6c42\u6570\u636e\u5e93\u7684\u3002","title":"\u76f4\u63a5\u6267\u884c SQL"},{"location":"component/store/mysql/#dbrawquery","text":"\u7528\u9014\uff1a\u76f4\u63a5\u6267\u884c\u6a21\u677f\u67e5\u8be2\u7684\u88f8 SQL \u8bed\u53e5\u3002 \u53c2\u6570\uff1a $line \uff0c $params \u8fd4\u56de\uff1a\u67e5\u5230\u7684\u884c\u7684\u6570\u7ec4 $line \u4e3a\u8bf7\u6c42\u7684 SQL \u8bed\u53e5\uff0c $params \u4e3a\u6a21\u677f\u53c2\u6570\u3002 1 2 3 $r = DB::rawQuery(\"SELECT * FROM admin WHERE name = ?\", [\"fake_admin\"]); //SELECT * FROM admin WHERE name = 'fake_admin' echo $r[0][\"password\"]; \u53c2\u6570\u67e5\u8be2\u5df2\u7ecf\u4ece\u6839\u672c\u4e0a\u675c\u7edd\u4e86 SQL \u6ce8\u5165\u7684\u95ee\u9898\u3002","title":"DB::rawQuery()"},{"location":"component/store/redis/","text":"Redis \u70b8\u6bdb\u6846\u67b6\u5185\u7f6e\u4e86 Redis \u8fde\u63a5\u6c60\uff0c\u4f9b\u5f00\u53d1\u8005\u4f7f\u7528\u3002\u4f7f\u7528\u524d\u9700\u8981\u5148\u5b89\u88c5 redis \u6269\u5c55\uff1a 1 pecl install redis \u5982\u679c\u662f Docker \u73af\u5883\uff0c\u5219\u9ed8\u8ba4\u5df2\u5b89\u88c5\u3002 \u914d\u7f6e \u914d\u7f6e\u6587\u4ef6\u5728 config/global.php \u7684\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u4e0b\uff0c\u8be6\u60c5\u89c1 \u914d\u7f6e \u3002 \u793a\u4f8b\u914d\u7f6e\uff08\u5047\u8bbe Redis Server \u5f00\u5230\u4e86\u672c\u5730\uff09\uff1a 1 2 3 4 5 6 7 8 /** Redis\u8fde\u63a5\u4fe1\u606f\uff0chost\u7559\u7a7a\u5219\u542f\u52a8\u65f6\u4e0d\u521b\u5efaRedis\u8fde\u63a5\u6c60 */ $config['redis_config'] = [ 'host' => '127.0.0.1', 'port' => 6379, 'timeout' => 1, 'db_index' => 0, 'auth' => '' ]; \u4f7f\u7528 \u5f53\u5199\u597d\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u4e0d\u53ef\u4ee5\u4f7f\u7528 reload \u8fdb\u884c\u91cd\u8f7d\uff0c\u56e0\u4e3a\u8fde\u63a5\u6c60\u9700\u8981\u5728\u4e3b\u8fdb\u7a0b\u4e2d\u58f0\u660e\u914d\u7f6e\uff0c\u624d\u53ef\u4ee5\u5e94\u7528\u5230\u591a\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u4e2d\u3002\u6240\u4ee5\u5fc5\u987b\u8f93\u5165 stop \u6216 Ctrl+C \u505c\u6b62\u540e\u518d\u542f\u52a8\u6846\u67b6\u3002 \u5b9a\u4e49\uff1a ZM\\Store\\Redis\\ZMRedis \u56e0\u4e3a\u4f7f\u7528\u7684\u662f\u8fde\u63a5\u6c60\uff0c\u6240\u4ee5\u6bcf\u6b21\u4f7f\u7528\u5b8c\u4e00\u4e2a\u8fde\u63a5\u9700\u8981\u5f52\u8fd8\u8fde\u63a5\u7ed9\u8fde\u63a5\u6c60\u3002\u6846\u67b6\u5c01\u88c5\u4e86\u4e24\u79cd\u65b9\u5f0f\u81ea\u52a8\u5f52\u8fd8\uff0c\u4f60\u53ef\u4ee5\u9009\u62e9\u4e0b\u9762\u5176\u4e2d\u7684\u4efb\u610f\u4e00\u79cd\u3002 \u4ee5\u4e0b\u7684\u65b9\u5f0f\u83b7\u53d6\u7684 $redis \u90fd\u662f redis \u6269\u5c55\u7684\u5bf9\u8c61 \\Redis \uff0c\u5173\u4e8e redis \u6269\u5c55\u7684\u65b9\u6cd5\u6587\u6863\uff0c\u8be6\u60c5\u89c1\uff1a Redis \u6587\u6863 \u3002 \u5bf9\u8c61\u6a21\u5f0f 1 2 3 $obj = new ZMRedis(); $redis = $obj->get(); ctx()->reply($redis->ping(\"123\")); \u56de\u8c03\u6a21\u5f0f 1 2 3 4 5 6 7 // \u524d\u9762\u7684\u4ee3\u7801 ZMRedis::call(function($redis) { $redis->set(\"key1\", \"hello world\"); $result = $redis->get(\"key1\"); ctx()->reply($result); }); // \u540e\u9762\u7684\u4ee3\u7801 \u4e8c\u8005\u7684\u533a\u522b \u9009\u4e00\u4e2a\u559c\u6b22\u7684\u5c31\u597d\u3002\u786c\u8981\u662f\u8bf4\u533a\u522b\u7684\u8bdd\uff0c\u5bf9\u8c61\u6a21\u5f0f\u662f\u5728 PHP \u81ea\u52a8\u56de\u6536\u8fd9\u4e2a ZMRedis \u5bf9\u8c61\u65f6\u4f1a\u5f52\u8fd8\u8fde\u63a5\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u624b\u52a8 unset($obj) \u8fdb\u884c\u56de\u6536\uff0c\u5426\u5219\u5c31\u4f1a\u6267\u884c\u5230\u51fd\u6570\u7ed3\u5c3e\u81ea\u52a8\u56de\u6536\u3002\u5207\u8bb0\u4e0d\u53ef\u5c06 $obj \u5bf9\u8c61\u6301\u4e45\u5316\u5b58\u5230\u9759\u6001\u6216\u5168\u5c40\u53d8\u91cf\u7b49\u3002 \u56de\u8c03\u6a21\u5f0f\u770b\u4f3c\u662f\u56de\u8c03\uff0c\u4f46\u662f\u662f\u540c\u6b65\u6267\u884c\u7684\uff0c\u4e0d\u4f1a\u53d1\u751f\u987a\u5e8f\u9519\u4e71\u3002\u4e5f\u5c31\u662f\u8bf4\u5230\u4e86 ZMRedis::call() \u65b9\u6cd5\u91cc\u9762\u7684\u65f6\u5019\uff0c\u540e\u9762\u7684\u4ee3\u7801\u4e0d\u4f1a\u63d0\u524d\u6267\u884c\uff0c\u662f\u987a\u5e8f\u6267\u884c\u7684\u3002\u56de\u8c03\u7684\u4f5c\u7528\u4ec5\u4ec5\u662f\u7528\u4f5c\u81ea\u52a8\u56de\u6536\u8fde\u63a5\u5bf9\u8c61\u3002","title":"Redis \u6570\u636e\u5e93"},{"location":"component/store/redis/#redis","text":"\u70b8\u6bdb\u6846\u67b6\u5185\u7f6e\u4e86 Redis \u8fde\u63a5\u6c60\uff0c\u4f9b\u5f00\u53d1\u8005\u4f7f\u7528\u3002\u4f7f\u7528\u524d\u9700\u8981\u5148\u5b89\u88c5 redis \u6269\u5c55\uff1a 1 pecl install redis \u5982\u679c\u662f Docker \u73af\u5883\uff0c\u5219\u9ed8\u8ba4\u5df2\u5b89\u88c5\u3002","title":"Redis"},{"location":"component/store/redis/#_1","text":"\u914d\u7f6e\u6587\u4ef6\u5728 config/global.php \u7684\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u4e0b\uff0c\u8be6\u60c5\u89c1 \u914d\u7f6e \u3002 \u793a\u4f8b\u914d\u7f6e\uff08\u5047\u8bbe Redis Server \u5f00\u5230\u4e86\u672c\u5730\uff09\uff1a 1 2 3 4 5 6 7 8 /** Redis\u8fde\u63a5\u4fe1\u606f\uff0chost\u7559\u7a7a\u5219\u542f\u52a8\u65f6\u4e0d\u521b\u5efaRedis\u8fde\u63a5\u6c60 */ $config['redis_config'] = [ 'host' => '127.0.0.1', 'port' => 6379, 'timeout' => 1, 'db_index' => 0, 'auth' => '' ];","title":"\u914d\u7f6e"},{"location":"component/store/redis/#_2","text":"\u5f53\u5199\u597d\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u4e0d\u53ef\u4ee5\u4f7f\u7528 reload \u8fdb\u884c\u91cd\u8f7d\uff0c\u56e0\u4e3a\u8fde\u63a5\u6c60\u9700\u8981\u5728\u4e3b\u8fdb\u7a0b\u4e2d\u58f0\u660e\u914d\u7f6e\uff0c\u624d\u53ef\u4ee5\u5e94\u7528\u5230\u591a\u4e2a\u5de5\u4f5c\u8fdb\u7a0b\u4e2d\u3002\u6240\u4ee5\u5fc5\u987b\u8f93\u5165 stop \u6216 Ctrl+C \u505c\u6b62\u540e\u518d\u542f\u52a8\u6846\u67b6\u3002 \u5b9a\u4e49\uff1a ZM\\Store\\Redis\\ZMRedis \u56e0\u4e3a\u4f7f\u7528\u7684\u662f\u8fde\u63a5\u6c60\uff0c\u6240\u4ee5\u6bcf\u6b21\u4f7f\u7528\u5b8c\u4e00\u4e2a\u8fde\u63a5\u9700\u8981\u5f52\u8fd8\u8fde\u63a5\u7ed9\u8fde\u63a5\u6c60\u3002\u6846\u67b6\u5c01\u88c5\u4e86\u4e24\u79cd\u65b9\u5f0f\u81ea\u52a8\u5f52\u8fd8\uff0c\u4f60\u53ef\u4ee5\u9009\u62e9\u4e0b\u9762\u5176\u4e2d\u7684\u4efb\u610f\u4e00\u79cd\u3002 \u4ee5\u4e0b\u7684\u65b9\u5f0f\u83b7\u53d6\u7684 $redis \u90fd\u662f redis \u6269\u5c55\u7684\u5bf9\u8c61 \\Redis \uff0c\u5173\u4e8e redis \u6269\u5c55\u7684\u65b9\u6cd5\u6587\u6863\uff0c\u8be6\u60c5\u89c1\uff1a Redis \u6587\u6863 \u3002","title":"\u4f7f\u7528"},{"location":"component/store/redis/#_3","text":"1 2 3 $obj = new ZMRedis(); $redis = $obj->get(); ctx()->reply($redis->ping(\"123\"));","title":"\u5bf9\u8c61\u6a21\u5f0f"},{"location":"component/store/redis/#_4","text":"1 2 3 4 5 6 7 // \u524d\u9762\u7684\u4ee3\u7801 ZMRedis::call(function($redis) { $redis->set(\"key1\", \"hello world\"); $result = $redis->get(\"key1\"); ctx()->reply($result); }); // \u540e\u9762\u7684\u4ee3\u7801","title":"\u56de\u8c03\u6a21\u5f0f"},{"location":"component/store/redis/#_5","text":"\u9009\u4e00\u4e2a\u559c\u6b22\u7684\u5c31\u597d\u3002\u786c\u8981\u662f\u8bf4\u533a\u522b\u7684\u8bdd\uff0c\u5bf9\u8c61\u6a21\u5f0f\u662f\u5728 PHP \u81ea\u52a8\u56de\u6536\u8fd9\u4e2a ZMRedis \u5bf9\u8c61\u65f6\u4f1a\u5f52\u8fd8\u8fde\u63a5\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u624b\u52a8 unset($obj) \u8fdb\u884c\u56de\u6536\uff0c\u5426\u5219\u5c31\u4f1a\u6267\u884c\u5230\u51fd\u6570\u7ed3\u5c3e\u81ea\u52a8\u56de\u6536\u3002\u5207\u8bb0\u4e0d\u53ef\u5c06 $obj \u5bf9\u8c61\u6301\u4e45\u5316\u5b58\u5230\u9759\u6001\u6216\u5168\u5c40\u53d8\u91cf\u7b49\u3002 \u56de\u8c03\u6a21\u5f0f\u770b\u4f3c\u662f\u56de\u8c03\uff0c\u4f46\u662f\u662f\u540c\u6b65\u6267\u884c\u7684\uff0c\u4e0d\u4f1a\u53d1\u751f\u987a\u5e8f\u9519\u4e71\u3002\u4e5f\u5c31\u662f\u8bf4\u5230\u4e86 ZMRedis::call() \u65b9\u6cd5\u91cc\u9762\u7684\u65f6\u5019\uff0c\u540e\u9762\u7684\u4ee3\u7801\u4e0d\u4f1a\u63d0\u524d\u6267\u884c\uff0c\u662f\u987a\u5e8f\u6267\u884c\u7684\u3002\u56de\u8c03\u7684\u4f5c\u7528\u4ec5\u4ec5\u662f\u7528\u4f5c\u81ea\u52a8\u56de\u6536\u8fde\u63a5\u5bf9\u8c61\u3002","title":"\u4e8c\u8005\u7684\u533a\u522b"},{"location":"component/store/spin-lock/","text":"SpinLock \u81ea\u65cb\u9501 \u524d\u9762\u8bb2\u5230 LightCache \u8f7b\u91cf\u7f13\u5b58\u5728\u7279\u5b9a\u7684\u60c5\u51b5\u4e0b\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u4e0d\u88ab\u591a\u8fdb\u7a0b\u7684\u56e0\u7d20\u5bfc\u81f4\u4e22\u5931\u6216\u8986\u76d6\uff0c\u5728\u9ad8\u5e76\u53d1\u60c5\u51b5\u4e0b\u4fee\u6539\u6570\u636e\u9700\u8981\u52a0\u9501\uff0c\u6240\u4ee5\u70b8\u6bdb\u6846\u67b6\u5185\u7f6e\u4e86 SpinLock \u81ea\u65cb\u9501\u3002 \u914d\u7f6e \u81ea\u65cb\u9501\u4f7f\u7528\u65e0\u9700\u914d\u7f6e\uff0c\u548c LightCache \u540c\u6e90\u3002 \u4f7f\u7528 \u5b9a\u4e49\uff1a ZM\\Store\\Lock\\SpinLock SpinLock::lock($key) \u7ed9\u4fe1\u53f7\u91cf $key \u4e0a\u9501\u3002\u5982\u679c\u8be5\u4fe1\u53f7\u91cf\u5df2\u7ecf\u88ab\u4e0a\u9501\uff0c\u5219\u539f\u5730\u7b49\u5f85\u76f4\u5230\u5176\u4ed6\u8d44\u6e90\u91ca\u653e\u9501\u3002 1 SpinLock::lock(\"foo\"); SpinLock::unlock($key) \u7ed9\u4fe1\u53f7\u91cf $key \u91ca\u653e\u9501\u3002 1 SpinLock::unlock(\"foo\"); SpinLock::tryLock($key) \u7ed9\u4fe1\u53f7\u91cf $key \u4e0a\u9501\u3002\u5982\u679c\u8be5\u4fe1\u53f7\u91cf\u5df2\u7ecf\u88ab\u4e0a\u9501\uff0c\u5219\u7acb\u523b\u8fd4\u56de false\u3002 1 SpinLock::trylock(\"foo\"); \u7efc\u5408\u5b9e\u4f8b \u6211\u4eec\u8fd9\u91cc\u4ee5\u4e4b\u524d\u5728 LightCache \u4e2d\u7684\u5b9e\u4f8b\u8fdb\u884c\u7ee7\u7eed\u8bb2\u89e3\uff0c\u5982\u4f55\u7ed9\u4e4b\u524d\u90a3\u6837\u7684\u60c5\u51b5\u52a0\u9501\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 /** * @RequestMapping(\"/test\") */ public function test() { SpinLock::lock(\"web_count\"); // \u52a0\u4e0a\u8fd9\u884c $s = LightCache::get(\"web_count\"); if($s === null) $s = 1; else $s += 1; LightCache::set(\"web_count\", $s); SpinLock::unlock(\"web_count\"); // \u518d\u52a0\u4e0a\u8fd9\u884c return \"<h1>It works!</h1>\"; } \u52a0\u4e24\u884c\u5c31 OK\u3002\u8fd9\u65f6\u518d\u4f7f\u7528\u538b\u6d4b\u5de5\u5177\u8bf7\u6c42 200000 \u6b21\uff0c\u503c\u5c31\u4f1a\u662f 200000 \u4e86\uff01 \u539f\u7406\u5256\u6790\uff1a\u5728 LightCache \u83b7\u53d6\u524d\uff0c\u5148\u5bf9\u6b64\u5185\u5bb9\u4e0a\u9501\uff0c\u8fd9\u65f6\u5982\u679c\u5176\u4ed6\u8fdb\u7a0b\u6709\u540c\u65f6\u4e5f\u5728\u6267\u884c\u8fd9\u4e2a\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5728 SpinLock::lock() \u8fd9\u884c\u4ee3\u7801\u5904\u539f\u5730\u7b49\u5f85\uff0c\u9632\u6b62\u7ee7\u7eed\u6267\u884c\u3002\u7b49\u524d\u9762\u7684\u90a3\u4e2a\u8fdb\u7a0b\u6267\u884c\u5230 SpinLock::unlock() \u91ca\u653e\u9501\u65f6\uff0c\u5176\u4ed6\u8fdb\u7a0b\u624d\u53ef\u7ee7\u7eed\u6267\u884c\uff0c\u4ece\u800c\u907f\u514d\u4e86\u591a\u4e2a\u8fdb\u7a0b\u5e76\u884c\u6267\u884c\u8fd9\u6bb5\u4ee3\u7801\u5bfc\u81f4\u7684\u6570\u636e\u9519\u4e71\u3002 \u8b66\u544a \u4f7f\u7528\u9501\u65f6\u52a1\u5fc5\u8c28\u614e\uff0c\u5982\u679c\u4e0d\u6309\u7167\u4e0b\u9762\u7684\u89c4\u5219\u4f7f\u7528\u81ea\u65cb\u9501\u53ef\u80fd\u5bfc\u81f4 CPU \u5360\u7528\u7387\u4e0a\u5347\u3002 \u81ea\u65cb\u9501\u4f7f\u7528\u7ea6\u5b9a\uff1a \u4f7f\u7528 SpinLock::lock() \u6307\u5b9a\u4fe1\u53f7\u91cf\u540d\u79f0\u65f6\u5fc5\u987b\u6307\u5b9a\u4e3a\u5b57\u7b26\u4e32\uff0c\u4e14\u6700\u597d\u4e0e\u4f60\u7684 LightCache \u7f13\u5b58\u540d\u79f0\u76f8\u540c\u3002 \u4f7f\u7528 lock() \u65f6\u6700\u597d\u7d27\u8ddf\u5728 LightCache::get() \u4ee3\u7801\u524d\u3002 \u4f7f\u7528\u81ea\u65cb\u9501\u540e\uff0c LightCache::get() \u5230 LightCache::set() \u4e4b\u95f4\u7684\u4ee3\u7801\u6bb5\u4e00\u5b9a\u4e0d\u80fd\u6709 \u8bfb\u5199\u6587\u4ef6\u3001\u6570\u636e\u5e93\u64cd\u4f5c\u548c\u7f51\u7edc\u8bf7\u6c42 \u7b49\u4ee3\u7801\uff0c\u6700\u597d\u4e3a\u7eaf PHP \u903b\u8f91\u4ee3\u7801\uff0c\u4e14\u8d8a\u77ed\u8d8a\u597d\uff0c\u5982\u793a\u4f8b\u4ee3\u7801\u3002 \u5728 LightCache::set() \u540e\u6700\u597d\u7d27\u8ddf SpinLock::unlock() \u3002 \u6027\u80fd \u4f7f\u7528\u81ea\u65cb\u9501\u51e0\u4e4e\u6ca1\u6709\u6027\u80fd\u635f\u5931\uff0c\u81ea\u65cb\u9501\u8981\u6bd4\u5176\u4ed6\u7c7b\u578b\u7684\u9501\u6027\u80fd\u5f3a\u5f88\u591a\uff0c\u5728\u4e0a\u65b9\u4e3e\u4f8b\u4f7f\u7528\u7684 ab \u538b\u6d4b\u5de5\u5177\u6d4b\u8bd5 100\u4e07\u8bf7\u6c42 \u4e0b\uff0c\u4f7f\u7528\u81ea\u65cb\u9501\u548c\u4e0d\u9002\u7528\u81ea\u65cb\u9501\u7684\u6d4b\u8bd5\u6210\u7ee9\u65f6\u95f4\u5206\u522b\u4e3a\uff1a7.4s \u548c 6.9s\u3002","title":"SpinLock \u81ea\u65cb\u9501"},{"location":"component/store/spin-lock/#spinlock","text":"\u524d\u9762\u8bb2\u5230 LightCache \u8f7b\u91cf\u7f13\u5b58\u5728\u7279\u5b9a\u7684\u60c5\u51b5\u4e0b\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u4e0d\u88ab\u591a\u8fdb\u7a0b\u7684\u56e0\u7d20\u5bfc\u81f4\u4e22\u5931\u6216\u8986\u76d6\uff0c\u5728\u9ad8\u5e76\u53d1\u60c5\u51b5\u4e0b\u4fee\u6539\u6570\u636e\u9700\u8981\u52a0\u9501\uff0c\u6240\u4ee5\u70b8\u6bdb\u6846\u67b6\u5185\u7f6e\u4e86 SpinLock \u81ea\u65cb\u9501\u3002","title":"SpinLock \u81ea\u65cb\u9501"},{"location":"component/store/spin-lock/#_1","text":"\u81ea\u65cb\u9501\u4f7f\u7528\u65e0\u9700\u914d\u7f6e\uff0c\u548c LightCache \u540c\u6e90\u3002","title":"\u914d\u7f6e"},{"location":"component/store/spin-lock/#_2","text":"\u5b9a\u4e49\uff1a ZM\\Store\\Lock\\SpinLock","title":"\u4f7f\u7528"},{"location":"component/store/spin-lock/#spinlocklockkey","text":"\u7ed9\u4fe1\u53f7\u91cf $key \u4e0a\u9501\u3002\u5982\u679c\u8be5\u4fe1\u53f7\u91cf\u5df2\u7ecf\u88ab\u4e0a\u9501\uff0c\u5219\u539f\u5730\u7b49\u5f85\u76f4\u5230\u5176\u4ed6\u8d44\u6e90\u91ca\u653e\u9501\u3002 1 SpinLock::lock(\"foo\");","title":"SpinLock::lock($key)"},{"location":"component/store/spin-lock/#spinlockunlockkey","text":"\u7ed9\u4fe1\u53f7\u91cf $key \u91ca\u653e\u9501\u3002 1 SpinLock::unlock(\"foo\");","title":"SpinLock::unlock($key)"},{"location":"component/store/spin-lock/#spinlocktrylockkey","text":"\u7ed9\u4fe1\u53f7\u91cf $key \u4e0a\u9501\u3002\u5982\u679c\u8be5\u4fe1\u53f7\u91cf\u5df2\u7ecf\u88ab\u4e0a\u9501\uff0c\u5219\u7acb\u523b\u8fd4\u56de false\u3002 1 SpinLock::trylock(\"foo\");","title":"SpinLock::tryLock($key)"},{"location":"component/store/spin-lock/#_3","text":"\u6211\u4eec\u8fd9\u91cc\u4ee5\u4e4b\u524d\u5728 LightCache \u4e2d\u7684\u5b9e\u4f8b\u8fdb\u884c\u7ee7\u7eed\u8bb2\u89e3\uff0c\u5982\u4f55\u7ed9\u4e4b\u524d\u90a3\u6837\u7684\u60c5\u51b5\u52a0\u9501\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 /** * @RequestMapping(\"/test\") */ public function test() { SpinLock::lock(\"web_count\"); // \u52a0\u4e0a\u8fd9\u884c $s = LightCache::get(\"web_count\"); if($s === null) $s = 1; else $s += 1; LightCache::set(\"web_count\", $s); SpinLock::unlock(\"web_count\"); // \u518d\u52a0\u4e0a\u8fd9\u884c return \"<h1>It works!</h1>\"; } \u52a0\u4e24\u884c\u5c31 OK\u3002\u8fd9\u65f6\u518d\u4f7f\u7528\u538b\u6d4b\u5de5\u5177\u8bf7\u6c42 200000 \u6b21\uff0c\u503c\u5c31\u4f1a\u662f 200000 \u4e86\uff01 \u539f\u7406\u5256\u6790\uff1a\u5728 LightCache \u83b7\u53d6\u524d\uff0c\u5148\u5bf9\u6b64\u5185\u5bb9\u4e0a\u9501\uff0c\u8fd9\u65f6\u5982\u679c\u5176\u4ed6\u8fdb\u7a0b\u6709\u540c\u65f6\u4e5f\u5728\u6267\u884c\u8fd9\u4e2a\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5728 SpinLock::lock() \u8fd9\u884c\u4ee3\u7801\u5904\u539f\u5730\u7b49\u5f85\uff0c\u9632\u6b62\u7ee7\u7eed\u6267\u884c\u3002\u7b49\u524d\u9762\u7684\u90a3\u4e2a\u8fdb\u7a0b\u6267\u884c\u5230 SpinLock::unlock() \u91ca\u653e\u9501\u65f6\uff0c\u5176\u4ed6\u8fdb\u7a0b\u624d\u53ef\u7ee7\u7eed\u6267\u884c\uff0c\u4ece\u800c\u907f\u514d\u4e86\u591a\u4e2a\u8fdb\u7a0b\u5e76\u884c\u6267\u884c\u8fd9\u6bb5\u4ee3\u7801\u5bfc\u81f4\u7684\u6570\u636e\u9519\u4e71\u3002 \u8b66\u544a \u4f7f\u7528\u9501\u65f6\u52a1\u5fc5\u8c28\u614e\uff0c\u5982\u679c\u4e0d\u6309\u7167\u4e0b\u9762\u7684\u89c4\u5219\u4f7f\u7528\u81ea\u65cb\u9501\u53ef\u80fd\u5bfc\u81f4 CPU \u5360\u7528\u7387\u4e0a\u5347\u3002 \u81ea\u65cb\u9501\u4f7f\u7528\u7ea6\u5b9a\uff1a \u4f7f\u7528 SpinLock::lock() \u6307\u5b9a\u4fe1\u53f7\u91cf\u540d\u79f0\u65f6\u5fc5\u987b\u6307\u5b9a\u4e3a\u5b57\u7b26\u4e32\uff0c\u4e14\u6700\u597d\u4e0e\u4f60\u7684 LightCache \u7f13\u5b58\u540d\u79f0\u76f8\u540c\u3002 \u4f7f\u7528 lock() \u65f6\u6700\u597d\u7d27\u8ddf\u5728 LightCache::get() \u4ee3\u7801\u524d\u3002 \u4f7f\u7528\u81ea\u65cb\u9501\u540e\uff0c LightCache::get() \u5230 LightCache::set() \u4e4b\u95f4\u7684\u4ee3\u7801\u6bb5\u4e00\u5b9a\u4e0d\u80fd\u6709 \u8bfb\u5199\u6587\u4ef6\u3001\u6570\u636e\u5e93\u64cd\u4f5c\u548c\u7f51\u7edc\u8bf7\u6c42 \u7b49\u4ee3\u7801\uff0c\u6700\u597d\u4e3a\u7eaf PHP \u903b\u8f91\u4ee3\u7801\uff0c\u4e14\u8d8a\u77ed\u8d8a\u597d\uff0c\u5982\u793a\u4f8b\u4ee3\u7801\u3002 \u5728 LightCache::set() \u540e\u6700\u597d\u7d27\u8ddf SpinLock::unlock() \u3002","title":"\u7efc\u5408\u5b9e\u4f8b"},{"location":"component/store/spin-lock/#_4","text":"\u4f7f\u7528\u81ea\u65cb\u9501\u51e0\u4e4e\u6ca1\u6709\u6027\u80fd\u635f\u5931\uff0c\u81ea\u65cb\u9501\u8981\u6bd4\u5176\u4ed6\u7c7b\u578b\u7684\u9501\u6027\u80fd\u5f3a\u5f88\u591a\uff0c\u5728\u4e0a\u65b9\u4e3e\u4f8b\u4f7f\u7528\u7684 ab \u538b\u6d4b\u5de5\u5177\u6d4b\u8bd5 100\u4e07\u8bf7\u6c42 \u4e0b\uff0c\u4f7f\u7528\u81ea\u65cb\u9501\u548c\u4e0d\u9002\u7528\u81ea\u65cb\u9501\u7684\u6d4b\u8bd5\u6210\u7ee9\u65f6\u95f4\u5206\u522b\u4e3a\uff1a7.4s \u548c 6.9s\u3002","title":"\u6027\u80fd"},{"location":"event/","text":"\u4e8b\u4ef6\u548c\u6ce8\u89e3 \u6ce8\u89e3\u4e8b\u4ef6\u6982\u5ff5 \u6211\u4eec\u77e5\u9053\u4e8b\u4ef6\uff0c\u662f\u4e00\u4e2a\u5e95\u5c42\u7684 event loop \u6536\u5230\u6d88\u606f\u540e\u8c03\u7528\u5bf9\u5e94\u7684\u5404\u7c7b\u65b9\u6cd5\u7684\u4e00\u4e2a\u6a21\u578b\uff0c\u6bd4\u5982\u7ed9\u673a\u5668\u4eba\u53d1\u9001\u6d88\u606f\u540e\u6846\u67b6\u8981\u505a\u7684\u5c31\u662f\u6307\u5b9a\u5230\u4e00\u4e2a\u4f60\u5b9a\u4e49\u7684\u51fd\u6570\u4e0a\uff0c\u5904\u7406\u4f60\u7684\u4e1a\u52a1\u903b\u8f91\u4ee3\u7801\u3002\u6bd4\u5982\u5728\u9ed8\u8ba4\u6a21\u5757\u4e2d\uff0c\u63d0\u4f9b\u4e86 \u4f60\u597d \u7684\u56de\u590d\uff1a \u4f60\u597d\u554a\uff0c\u6211\u662f\u7531\u70b8\u6bdb\u6846\u67b6\u6784\u5efa\u7684\u673a\u5668\u4eba\uff01 \u3002\u8fd9\u9879\u7b80\u5355\u56de\u590d\u7684\u4efb\u52a1\u5c31\u662f\u4e00\u4e2a\u4e8b\u4ef6\u7684\u89e6\u53d1\u5230\u54cd\u5e94\u7684\u5168\u8fc7\u7a0b\u3002 \u6ce8\u89e3 \uff08Annotation\uff09\u53c8\u79f0\u6807\u6ce8\uff0cJava \u6700\u65e9\u5728 2004 \u5e74\u7684 JDK 5 \u4e2d\u5f15\u5165\u7684\u4e00\u79cd\u6ce8\u91ca\u673a\u5236\u3002\u76ee\u524d PHP \u5b98\u65b9\u7248\u672c\u5e76\u672a\u63d0\u4f9b\u5185\u7f6e\u5143\u6ce8\u89e3\u548c\u6ce8\u89e3\u6982\u5ff5\uff0c\u4f46\u6211\u4eec\u901a\u8fc7 ReflectionClass \u53cd\u5c04\u7c7b\u89e3\u6790 PHP \u4ee3\u7801\u6ce8\u91ca\u4ece\u800c\u5b9e\u73b0\u4e86\u81ea\u5df1\u7684\u4e00\u5957\u6ce8\u89e3\u673a\u5236\u3002\u5982\u679c\u4f60\u6ca1\u6709\u5199\u8fc7 Java\uff0c\u5e76\u4e14\u4e0d\u4e86\u89e3\u6ce8\u89e3\u662f\u4ec0\u4e48\uff0c\u4f60\u53ef\u4ee5\u7406\u89e3\u4e3a\u5bf9 function \u6216 class \u7684\u4e00\u4e2a\u4fee\u9970\uff0c\u56e0\u4e3a\u4f20\u7edf\u7684 PHP \u4ee3\u7801\u903b\u8f91\u6211\u4eec\u90fd\u77e5\u9053\uff0c\u4e0d\u80fd\u7b80\u5355\u7ed9\u539f\u5148\u5b58\u5728\u7684\u51fd\u6570\u8d34\u6807\u7b7e\uff0c\u5c31\u6bd4\u5982\uff0c\u4f60\u4e0d\u80fd\u5728\u539f\u672c\u7684 PHP \u4ee3\u7801\u4e2d\u7ed9\u51fd\u6570\u8d34\u4e0a\u4e00\u4e2a\u53ef\u4ee5\u5f71\u54cd\u5b83\u4e00\u751f\u5e76\u4e14\u6539\u53d8\u5b83\u884c\u4e3a\u7684\u6807\u7b7e\uff0c\u800c\u6709\u4e86\u6ce8\u89e3\uff0c\u5c31\u76f8\u5f53\u4e8e\u6709\u4e86\u7ed9\u51fd\u6570\u8d34\u6807\u7b7e\u7684\u673a\u4f1a\u3002 \u5728\u5e38\u89c1\u6846\u67b6\u5982 Spring\uff0cSwoft \u7b49\u4ee3\u7801\u7ed3\u6784\u91cc\u9762\uff0c\u6ce8\u89e3\u66f4\u662f\u5176\u6838\u5fc3\u7684\u5b58\u5728\u3002 \u5728\u70b8\u6bdb\u6846\u67b6\u4e2d\uff0c\u6211\u4eec\u6240\u6709\u4e8b\u4ef6\u7684\u7ed1\u5b9a\u5747\u91c7\u7528\u8fd9\u4e00\u65b9\u5f0f\u8fdb\u884c\u8c03\u7528\u6a21\u5757\u5185\u5404\u4e2a\u65b9\u6cd5\u3002\u5305\u62ec Swoole \u81ea\u8eab\u7684\u6846\u67b6\u542f\u52a8\u4e8b\u4ef6\u3001WebSocket \u8fde\u63a5\u63e1\u624b\u4e8b\u4ef6\u3001HTTP \u8bf7\u6c42\u4e8b\u4ef6\u7b49\u7b49\uff0c\u4e5f\u5305\u62ec CQHTTP \u53d1\u6765\u7684\u4e8b\u4ef6\uff0c\u5982 message \uff0c notice \uff0c request \u7b49\u3002 \u5982\u4f55\u4f7f\u7528\u6ce8\u89e3 \u5c31\u50cf\u6211\u4eec\u65e5\u5e38\u5f00\u53d1\u5199\u6ce8\u91ca\u4e00\u6837\uff0c\u53ea\u9700\u5728\u7c7b\u3001\u65b9\u6cd5\u6216\u6210\u5458\u53d8\u91cf\u4e0a\u65b9\u6309\u89c4\u5219\u6dfb\u52a0\u6ce8\u91ca\u5373\u53ef\uff0c\u8fd9\u91cc\u4ee5\u9ed8\u8ba4\u81ea\u5e26\u7684 Hello \u6a21\u5757\u7c7b\u4e3a\u4f8b\u5b50\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 <?php namespace Module\\Example ; use ZM\\Annotation\\CQ\\CQCommand ; class Hello { /** * @CQCommand(match=\"\u4f60\u597d\") * @return string */ public function hello (){ return \"\u4f60\u597d\u554a\uff0c\u6211\u662f\u7531\u70b8\u6bdb\u6846\u67b6\u6784\u5efa\u7684\u673a\u5668\u4eba\uff01\" ; } } \u5176\u4e2d @CQCommand() \u5c31\u662f\u4e00\u4e2a\u57fa\u672c\u7684\u6ce8\u89e3\u5e94\u7528\u3002\u6ce8\u610f\u9700\u5f15\u5165\u76f8\u5173\u6ce8\u89e3\uff08Annotation\uff09\u7c7b\uff0c \u4e14\u5fc5\u987b \u4ee5 /** \u5f00\u59cb\u5e76\u4ee5 */ \u7ed3\u675f\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u65e0\u6cd5\u89e3\u6790\uff01\u4e0a\u65b9 @return \u4e3a IDE \u81ea\u52a8\u751f\u6210\u7684 PHPDoc\uff0c\u4e0d\u9700\u8981\u7ba1\u3002 \u6709\u4ec0\u4e48\u7528\uff1f\u5927\u6709\u5999\u7528\uff01\u8fd9\u4e2a\u4f8b\u5b50\u5185\u6ce8\u89e3\u7c7b\u7684\u7528\u9014\u662f\u6536\u5230 QQ \u6d88\u606f\u540e\u5982\u679c\u6d88\u606f\u7b2c\u4e00\u4e2a\u8bcd\u5339\u914d\u5230 \u4f60\u597d \u7684\u8bdd\uff0c\u6846\u67b6\u5c31\u4f1a\u81ea\u52a8\u5904\u7406\uff0c\u6700\u7ec8\u6267\u884c\u8c03\u7528\u6b64 hello() \u65b9\u6cd5\u3002\u6ce8\u610f CQCommand \u548c\u5176\u4ed6\u4efb\u4f55\u540e\u9762\u8bb2\u5230\u7684\u6ce8\u89e3\u7c7b\u4e00\u6837\uff0c\u9700\u5148 use ZM\\Annotation\\ \u4e0b\u7684\u5bf9\u5e94\u6ce8\u89e3\u7c7b\uff0c\u5426\u5219\u4e5f\u4e0d\u80fd\u6b63\u5e38\u4f7f\u7528\u3002 \u57fa\u672c\u8bed\u6cd5 \u5148 use\uff01\u5148 use\uff01\u5148 use\uff01\u91cd\u8981\u7684\u4e8b\u60c5\u8bf4\u4e09\u904d\uff01 use ZM\\Annotation\\xxxx; \u5fc5\u987b \u4ee5 /** \u5f00\u59cb\u5e76\u4ee5 */ \u7ed3\u675f\u3002 1 @\u6ce8\u89e3\u7c7b\u540d(\u53c2\u6570\u540d1=\"\u53c2\u65701\u7684\u503c\"[,\u53c2\u6570\u540d2=\"\u53c2\u65702\u7684\u503c\"]) \u5bf9\u4e8e\u53ea\u4f7f\u7528\u6216\u53ea\u6709\u4e00\u4e2a\u53c2\u6570\u7684\u6ce8\u89e3\u7c7b\uff0c @\u6ce8\u89e3\u7c7b\u540d(\"\u53c2\u6570\u7684\u503c\") \u53ef\u4ee5\u7701\u7565\u53c2\u6570\u540d\u3002 \u5bf9\u4e8e\u6ca1\u6709\u53c2\u6570\u7684\u6ce8\u89e3\u7c7b\uff0c @\u53c2\u6570\u540d() \u76f4\u63a5\u4f7f\u7528\u5373\u53ef\u3002 \u6ce8\u89e3\u548c\u4e8b\u4ef6\u7684\u5173\u7cfb \u5728\u70b8\u6bdb\u6846\u67b6\u91cc\uff0c\u6ce8\u89e3\u5e38\u5e38\u88ab\u5f53\u4f5c\u4e8b\u4ef6\u5206\u53d1\u7684\u4e00\u4e2a\u91cd\u8981\u89d2\u8272\uff0c\u4f46\u6ce8\u89e3\u672c\u8eab\u53c8\u4e0d\u662f\u4e8b\u4ef6\uff0c\u66f4\u6070\u5f53\u7684\u8bf4\uff0c\u662f\u6ce8\u89e3\u4ee3\u8868\u4e86\u4e8b\u4ef6\u3002 \u673a\u5668\u4eba\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u5e38\u89c1\u7684 @CQCommand \uff0c\u6216\u8005\u662f HTTP \u670d\u52a1\u5668\u8def\u7531\u7ed1\u5b9a @RequestMapping \u90fd\u662f\u76f8\u5f53\u4e8e\u7531\u5bf9\u5e94\u6ce8\u89e3\u4ee3\u8868\u4e86\u4e8b\u4ef6\uff0c\u800c @Middleware \uff0c @Closed \u7b49\u8fd9\u7c7b\u6ce8\u89e3\u663e\u7136\u4e0d\u4ee3\u8868\u4efb\u4f55\u4e8b\u4ef6\uff0c\u53ea\u80fd\u5f53\u4f5c\u8fd9\u4e2a\u51fd\u6570\u6216\u7c7b\u7684\u4fee\u9970\u5c5e\u6027\u800c\u5df2\u3002\u4ee3\u8868\u4e86\u4e8b\u4ef6\u7684\u6ce8\u89e3\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a \u6ce8\u89e3\u4e8b\u4ef6 \uff0c\u5b83\u4f1a\u5728\u67d0\u79cd\u4e8b\u4ef6\u8fbe\u6210\u6761\u4ef6\u540e\u89e6\u53d1\u6ce8\u89e3\u4e0b\u65b9\u7684\u51fd\u6570\u672c\u8eab\u3002 \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u6ce8\u89e3\u4e8b\u4ef6\u672c\u8eab\u6982\u5ff5\u662f\u6211\u51ed\u7a7a\u634f\u9020\u7684\uff0c\u6211\u4e0d\u597d\u89e3\u91ca\u6240\u4ee5\u53ea\u80fd\u521b\u9020\u8fd9\u4e48\u4e00\u4e2a\u8bcd\u6765\u4ee3\u6307\u8fd9\u4e00\u62bd\u8c61\u7684\u6982\u5ff5\uff0c\u786c\u8981\u89e3\u91ca\u7684\u8bdd\uff0c\u5927\u81f4\u5c31\u597d\u6bd4\u4e00\u4e2a\u793e\u533a\u91cc\u6709\u4e00\u4e2a\u5356\u725b\u5976\u7684\uff0c\u6709\u51e0\u5bb6\u4eba\u8ba2\u9605\u4e86\u6bcf\u65e5\u4e0a\u95e8\u9001\u725b\u5976\u7684\u670d\u52a1\uff0c\u53ea\u8981\u4f60\u6253\u4e86\u201c\u7ed9\u6211\u914d\u9001\u725b\u5976\u201d\u7684\u6ce8\u89e3\uff0c\u4ed6\u5c31\u4f1a\u4e0a\u95e8\u3002\u800c\u5b83\u9001\u7684\u4e0d\u6b62\u4e00\u79cd\u5976\uff0c\u53ef\u4ee5\u7ed9\u4f60\u4e2a\u6027\u5316\u5b9a\u5236\uff0c\u6bd4\u5982\u8ba9\u5356\u725b\u5976\u7684\u7ed9\u4f60\u5e26\u5305\u7cd6\u5e26\u74f6\u6c34\uff0c\u800c\u63cf\u8ff0\u8fd9\u4e2a\u7684\u6ce8\u89e3\u5c31\u53ea\u80fd\u505a\u4e00\u4e2a\u4e4b\u524d\u6ce8\u89e3\u7684\u4fee\u9970\u3002\u5047\u8bbe\u4f60\u53ea\u5199\u4e86\u5e26\u5305\u7cd6\u7684\u6ce8\u89e3\uff0c\u6ca1\u6709\u5199\u7ed9\u6211\u914d\u9001\u725b\u5976\u7684\u6ce8\u89e3\uff0c\u90a3\u4ed6\u6c38\u8fdc\u4e5f\u4e0d\u4f1a\u7ed9\u4f60\u9001\u725b\u5976\u548c\u7cd6\u8fc7\u6765\u3002 \u963b\u65ad\u4e8b\u4ef6 \u7531\u4e8e\u70b8\u6bdb\u6846\u67b6\u5185\u7684\u6ce8\u89e3\u4e8b\u4ef6\u7edf\u4e00\u7531\u4e00\u4e2a\u901a\u7528\u7684\u4e8b\u4ef6\u5206\u53d1\u5668\u8fdb\u884c\u5206\u53d1\uff0c\u6240\u4ee5\u4f60\u5728\u4efb\u4f55\u6ce8\u89e3\u4e8b\u4ef6\u5185\u90fd\u53ef\u4ee5\u7528\u901a\u7528\u7684\u65b9\u5f0f\u963b\u65ad\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u4e8b\u4ef6\u3002 \u9996\u5148\u5c31\u662f\u8981\u8bb0\u5f97\u5148 use \u4e8b\u4ef6\u5206\u53d1\u5668\u7684\u7c7b\uff1a use ZM\\Event\\EventDispatcher; \u3002 1 2 EventDispatcher::interrupt(); EventDispatcher::interrupt($data); // \u4e5f\u53ef\u4ee5\u5e26\u8fd4\u56de\u503c\uff0c\u81ea\u5b9a\u4e49\u6ce8\u89e3\u4e8b\u4ef6\u65f6\u6709\u7528\u3002","title":"\u4e8b\u4ef6\u548c\u6ce8\u89e3"},{"location":"event/#_1","text":"","title":"\u4e8b\u4ef6\u548c\u6ce8\u89e3"},{"location":"event/#_2","text":"\u6211\u4eec\u77e5\u9053\u4e8b\u4ef6\uff0c\u662f\u4e00\u4e2a\u5e95\u5c42\u7684 event loop \u6536\u5230\u6d88\u606f\u540e\u8c03\u7528\u5bf9\u5e94\u7684\u5404\u7c7b\u65b9\u6cd5\u7684\u4e00\u4e2a\u6a21\u578b\uff0c\u6bd4\u5982\u7ed9\u673a\u5668\u4eba\u53d1\u9001\u6d88\u606f\u540e\u6846\u67b6\u8981\u505a\u7684\u5c31\u662f\u6307\u5b9a\u5230\u4e00\u4e2a\u4f60\u5b9a\u4e49\u7684\u51fd\u6570\u4e0a\uff0c\u5904\u7406\u4f60\u7684\u4e1a\u52a1\u903b\u8f91\u4ee3\u7801\u3002\u6bd4\u5982\u5728\u9ed8\u8ba4\u6a21\u5757\u4e2d\uff0c\u63d0\u4f9b\u4e86 \u4f60\u597d \u7684\u56de\u590d\uff1a \u4f60\u597d\u554a\uff0c\u6211\u662f\u7531\u70b8\u6bdb\u6846\u67b6\u6784\u5efa\u7684\u673a\u5668\u4eba\uff01 \u3002\u8fd9\u9879\u7b80\u5355\u56de\u590d\u7684\u4efb\u52a1\u5c31\u662f\u4e00\u4e2a\u4e8b\u4ef6\u7684\u89e6\u53d1\u5230\u54cd\u5e94\u7684\u5168\u8fc7\u7a0b\u3002 \u6ce8\u89e3 \uff08Annotation\uff09\u53c8\u79f0\u6807\u6ce8\uff0cJava \u6700\u65e9\u5728 2004 \u5e74\u7684 JDK 5 \u4e2d\u5f15\u5165\u7684\u4e00\u79cd\u6ce8\u91ca\u673a\u5236\u3002\u76ee\u524d PHP \u5b98\u65b9\u7248\u672c\u5e76\u672a\u63d0\u4f9b\u5185\u7f6e\u5143\u6ce8\u89e3\u548c\u6ce8\u89e3\u6982\u5ff5\uff0c\u4f46\u6211\u4eec\u901a\u8fc7 ReflectionClass \u53cd\u5c04\u7c7b\u89e3\u6790 PHP \u4ee3\u7801\u6ce8\u91ca\u4ece\u800c\u5b9e\u73b0\u4e86\u81ea\u5df1\u7684\u4e00\u5957\u6ce8\u89e3\u673a\u5236\u3002\u5982\u679c\u4f60\u6ca1\u6709\u5199\u8fc7 Java\uff0c\u5e76\u4e14\u4e0d\u4e86\u89e3\u6ce8\u89e3\u662f\u4ec0\u4e48\uff0c\u4f60\u53ef\u4ee5\u7406\u89e3\u4e3a\u5bf9 function \u6216 class \u7684\u4e00\u4e2a\u4fee\u9970\uff0c\u56e0\u4e3a\u4f20\u7edf\u7684 PHP \u4ee3\u7801\u903b\u8f91\u6211\u4eec\u90fd\u77e5\u9053\uff0c\u4e0d\u80fd\u7b80\u5355\u7ed9\u539f\u5148\u5b58\u5728\u7684\u51fd\u6570\u8d34\u6807\u7b7e\uff0c\u5c31\u6bd4\u5982\uff0c\u4f60\u4e0d\u80fd\u5728\u539f\u672c\u7684 PHP \u4ee3\u7801\u4e2d\u7ed9\u51fd\u6570\u8d34\u4e0a\u4e00\u4e2a\u53ef\u4ee5\u5f71\u54cd\u5b83\u4e00\u751f\u5e76\u4e14\u6539\u53d8\u5b83\u884c\u4e3a\u7684\u6807\u7b7e\uff0c\u800c\u6709\u4e86\u6ce8\u89e3\uff0c\u5c31\u76f8\u5f53\u4e8e\u6709\u4e86\u7ed9\u51fd\u6570\u8d34\u6807\u7b7e\u7684\u673a\u4f1a\u3002 \u5728\u5e38\u89c1\u6846\u67b6\u5982 Spring\uff0cSwoft \u7b49\u4ee3\u7801\u7ed3\u6784\u91cc\u9762\uff0c\u6ce8\u89e3\u66f4\u662f\u5176\u6838\u5fc3\u7684\u5b58\u5728\u3002 \u5728\u70b8\u6bdb\u6846\u67b6\u4e2d\uff0c\u6211\u4eec\u6240\u6709\u4e8b\u4ef6\u7684\u7ed1\u5b9a\u5747\u91c7\u7528\u8fd9\u4e00\u65b9\u5f0f\u8fdb\u884c\u8c03\u7528\u6a21\u5757\u5185\u5404\u4e2a\u65b9\u6cd5\u3002\u5305\u62ec Swoole \u81ea\u8eab\u7684\u6846\u67b6\u542f\u52a8\u4e8b\u4ef6\u3001WebSocket \u8fde\u63a5\u63e1\u624b\u4e8b\u4ef6\u3001HTTP \u8bf7\u6c42\u4e8b\u4ef6\u7b49\u7b49\uff0c\u4e5f\u5305\u62ec CQHTTP \u53d1\u6765\u7684\u4e8b\u4ef6\uff0c\u5982 message \uff0c notice \uff0c request \u7b49\u3002","title":"\u6ce8\u89e3\u4e8b\u4ef6\u6982\u5ff5"},{"location":"event/#_3","text":"\u5c31\u50cf\u6211\u4eec\u65e5\u5e38\u5f00\u53d1\u5199\u6ce8\u91ca\u4e00\u6837\uff0c\u53ea\u9700\u5728\u7c7b\u3001\u65b9\u6cd5\u6216\u6210\u5458\u53d8\u91cf\u4e0a\u65b9\u6309\u89c4\u5219\u6dfb\u52a0\u6ce8\u91ca\u5373\u53ef\uff0c\u8fd9\u91cc\u4ee5\u9ed8\u8ba4\u81ea\u5e26\u7684 Hello \u6a21\u5757\u7c7b\u4e3a\u4f8b\u5b50\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 <?php namespace Module\\Example ; use ZM\\Annotation\\CQ\\CQCommand ; class Hello { /** * @CQCommand(match=\"\u4f60\u597d\") * @return string */ public function hello (){ return \"\u4f60\u597d\u554a\uff0c\u6211\u662f\u7531\u70b8\u6bdb\u6846\u67b6\u6784\u5efa\u7684\u673a\u5668\u4eba\uff01\" ; } } \u5176\u4e2d @CQCommand() \u5c31\u662f\u4e00\u4e2a\u57fa\u672c\u7684\u6ce8\u89e3\u5e94\u7528\u3002\u6ce8\u610f\u9700\u5f15\u5165\u76f8\u5173\u6ce8\u89e3\uff08Annotation\uff09\u7c7b\uff0c \u4e14\u5fc5\u987b \u4ee5 /** \u5f00\u59cb\u5e76\u4ee5 */ \u7ed3\u675f\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u65e0\u6cd5\u89e3\u6790\uff01\u4e0a\u65b9 @return \u4e3a IDE \u81ea\u52a8\u751f\u6210\u7684 PHPDoc\uff0c\u4e0d\u9700\u8981\u7ba1\u3002 \u6709\u4ec0\u4e48\u7528\uff1f\u5927\u6709\u5999\u7528\uff01\u8fd9\u4e2a\u4f8b\u5b50\u5185\u6ce8\u89e3\u7c7b\u7684\u7528\u9014\u662f\u6536\u5230 QQ \u6d88\u606f\u540e\u5982\u679c\u6d88\u606f\u7b2c\u4e00\u4e2a\u8bcd\u5339\u914d\u5230 \u4f60\u597d \u7684\u8bdd\uff0c\u6846\u67b6\u5c31\u4f1a\u81ea\u52a8\u5904\u7406\uff0c\u6700\u7ec8\u6267\u884c\u8c03\u7528\u6b64 hello() \u65b9\u6cd5\u3002\u6ce8\u610f CQCommand \u548c\u5176\u4ed6\u4efb\u4f55\u540e\u9762\u8bb2\u5230\u7684\u6ce8\u89e3\u7c7b\u4e00\u6837\uff0c\u9700\u5148 use ZM\\Annotation\\ \u4e0b\u7684\u5bf9\u5e94\u6ce8\u89e3\u7c7b\uff0c\u5426\u5219\u4e5f\u4e0d\u80fd\u6b63\u5e38\u4f7f\u7528\u3002","title":"\u5982\u4f55\u4f7f\u7528\u6ce8\u89e3"},{"location":"event/#_4","text":"\u5148 use\uff01\u5148 use\uff01\u5148 use\uff01\u91cd\u8981\u7684\u4e8b\u60c5\u8bf4\u4e09\u904d\uff01 use ZM\\Annotation\\xxxx; \u5fc5\u987b \u4ee5 /** \u5f00\u59cb\u5e76\u4ee5 */ \u7ed3\u675f\u3002 1 @\u6ce8\u89e3\u7c7b\u540d(\u53c2\u6570\u540d1=\"\u53c2\u65701\u7684\u503c\"[,\u53c2\u6570\u540d2=\"\u53c2\u65702\u7684\u503c\"]) \u5bf9\u4e8e\u53ea\u4f7f\u7528\u6216\u53ea\u6709\u4e00\u4e2a\u53c2\u6570\u7684\u6ce8\u89e3\u7c7b\uff0c @\u6ce8\u89e3\u7c7b\u540d(\"\u53c2\u6570\u7684\u503c\") \u53ef\u4ee5\u7701\u7565\u53c2\u6570\u540d\u3002 \u5bf9\u4e8e\u6ca1\u6709\u53c2\u6570\u7684\u6ce8\u89e3\u7c7b\uff0c @\u53c2\u6570\u540d() \u76f4\u63a5\u4f7f\u7528\u5373\u53ef\u3002","title":"\u57fa\u672c\u8bed\u6cd5"},{"location":"event/#_5","text":"\u5728\u70b8\u6bdb\u6846\u67b6\u91cc\uff0c\u6ce8\u89e3\u5e38\u5e38\u88ab\u5f53\u4f5c\u4e8b\u4ef6\u5206\u53d1\u7684\u4e00\u4e2a\u91cd\u8981\u89d2\u8272\uff0c\u4f46\u6ce8\u89e3\u672c\u8eab\u53c8\u4e0d\u662f\u4e8b\u4ef6\uff0c\u66f4\u6070\u5f53\u7684\u8bf4\uff0c\u662f\u6ce8\u89e3\u4ee3\u8868\u4e86\u4e8b\u4ef6\u3002 \u673a\u5668\u4eba\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u5e38\u89c1\u7684 @CQCommand \uff0c\u6216\u8005\u662f HTTP \u670d\u52a1\u5668\u8def\u7531\u7ed1\u5b9a @RequestMapping \u90fd\u662f\u76f8\u5f53\u4e8e\u7531\u5bf9\u5e94\u6ce8\u89e3\u4ee3\u8868\u4e86\u4e8b\u4ef6\uff0c\u800c @Middleware \uff0c @Closed \u7b49\u8fd9\u7c7b\u6ce8\u89e3\u663e\u7136\u4e0d\u4ee3\u8868\u4efb\u4f55\u4e8b\u4ef6\uff0c\u53ea\u80fd\u5f53\u4f5c\u8fd9\u4e2a\u51fd\u6570\u6216\u7c7b\u7684\u4fee\u9970\u5c5e\u6027\u800c\u5df2\u3002\u4ee3\u8868\u4e86\u4e8b\u4ef6\u7684\u6ce8\u89e3\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a \u6ce8\u89e3\u4e8b\u4ef6 \uff0c\u5b83\u4f1a\u5728\u67d0\u79cd\u4e8b\u4ef6\u8fbe\u6210\u6761\u4ef6\u540e\u89e6\u53d1\u6ce8\u89e3\u4e0b\u65b9\u7684\u51fd\u6570\u672c\u8eab\u3002 \u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u6ce8\u89e3\u4e8b\u4ef6\u672c\u8eab\u6982\u5ff5\u662f\u6211\u51ed\u7a7a\u634f\u9020\u7684\uff0c\u6211\u4e0d\u597d\u89e3\u91ca\u6240\u4ee5\u53ea\u80fd\u521b\u9020\u8fd9\u4e48\u4e00\u4e2a\u8bcd\u6765\u4ee3\u6307\u8fd9\u4e00\u62bd\u8c61\u7684\u6982\u5ff5\uff0c\u786c\u8981\u89e3\u91ca\u7684\u8bdd\uff0c\u5927\u81f4\u5c31\u597d\u6bd4\u4e00\u4e2a\u793e\u533a\u91cc\u6709\u4e00\u4e2a\u5356\u725b\u5976\u7684\uff0c\u6709\u51e0\u5bb6\u4eba\u8ba2\u9605\u4e86\u6bcf\u65e5\u4e0a\u95e8\u9001\u725b\u5976\u7684\u670d\u52a1\uff0c\u53ea\u8981\u4f60\u6253\u4e86\u201c\u7ed9\u6211\u914d\u9001\u725b\u5976\u201d\u7684\u6ce8\u89e3\uff0c\u4ed6\u5c31\u4f1a\u4e0a\u95e8\u3002\u800c\u5b83\u9001\u7684\u4e0d\u6b62\u4e00\u79cd\u5976\uff0c\u53ef\u4ee5\u7ed9\u4f60\u4e2a\u6027\u5316\u5b9a\u5236\uff0c\u6bd4\u5982\u8ba9\u5356\u725b\u5976\u7684\u7ed9\u4f60\u5e26\u5305\u7cd6\u5e26\u74f6\u6c34\uff0c\u800c\u63cf\u8ff0\u8fd9\u4e2a\u7684\u6ce8\u89e3\u5c31\u53ea\u80fd\u505a\u4e00\u4e2a\u4e4b\u524d\u6ce8\u89e3\u7684\u4fee\u9970\u3002\u5047\u8bbe\u4f60\u53ea\u5199\u4e86\u5e26\u5305\u7cd6\u7684\u6ce8\u89e3\uff0c\u6ca1\u6709\u5199\u7ed9\u6211\u914d\u9001\u725b\u5976\u7684\u6ce8\u89e3\uff0c\u90a3\u4ed6\u6c38\u8fdc\u4e5f\u4e0d\u4f1a\u7ed9\u4f60\u9001\u725b\u5976\u548c\u7cd6\u8fc7\u6765\u3002","title":"\u6ce8\u89e3\u548c\u4e8b\u4ef6\u7684\u5173\u7cfb"},{"location":"event/#_6","text":"\u7531\u4e8e\u70b8\u6bdb\u6846\u67b6\u5185\u7684\u6ce8\u89e3\u4e8b\u4ef6\u7edf\u4e00\u7531\u4e00\u4e2a\u901a\u7528\u7684\u4e8b\u4ef6\u5206\u53d1\u5668\u8fdb\u884c\u5206\u53d1\uff0c\u6240\u4ee5\u4f60\u5728\u4efb\u4f55\u6ce8\u89e3\u4e8b\u4ef6\u5185\u90fd\u53ef\u4ee5\u7528\u901a\u7528\u7684\u65b9\u5f0f\u963b\u65ad\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u4e8b\u4ef6\u3002 \u9996\u5148\u5c31\u662f\u8981\u8bb0\u5f97\u5148 use \u4e8b\u4ef6\u5206\u53d1\u5668\u7684\u7c7b\uff1a use ZM\\Event\\EventDispatcher; \u3002 1 2 EventDispatcher::interrupt(); EventDispatcher::interrupt($data); // \u4e5f\u53ef\u4ee5\u5e26\u8fd4\u56de\u503c\uff0c\u81ea\u5b9a\u4e49\u6ce8\u89e3\u4e8b\u4ef6\u65f6\u6709\u7528\u3002","title":"\u963b\u65ad\u4e8b\u4ef6"},{"location":"event/custom-annotations/","text":"\u81ea\u5b9a\u4e49\u6ce8\u89e3 TODO\uff1a\u5e08\u5085\uff0c\u83ab\u50ac\uff0c\u5feb\u809d\u5b8c\u4e86\uff01","title":"\u81ea\u5b9a\u4e49\u6ce8\u89e3"},{"location":"event/custom-annotations/#_1","text":"TODO\uff1a\u5e08\u5085\uff0c\u83ab\u50ac\uff0c\u5feb\u809d\u5b8c\u4e86\uff01","title":"\u81ea\u5b9a\u4e49\u6ce8\u89e3"},{"location":"event/event-dispatcher/","text":"\u4e8b\u4ef6\u5206\u53d1\u5668\uff08\u8fdb\u9636\uff09 \u4e8b\u4ef6\u5206\u53d1\u5668\u662f\u4ee5\u4e0a\u6240\u6709\u6ce8\u89e3\u4e8b\u4ef6\u6267\u884c\u51fd\u6570\u7684\u4e00\u4e2a\u5206\u53d1\u5668\uff0c\u5982\u679c\u4f60\u5728\u4e0a\u4e00\u7ae0\u5df2\u7ecf\u5b66\u4f1a\u4e86\u5982\u4f55\u521b\u5efa\u81ea\u5b9a\u4e49\u6ce8\u89e3\uff0c\u90a3\u4e48\u672c\u7ae0\u5c31\u6765\u8bf4\u660e\u5982\u4f55\u7528\u5185\u7f6e\u7684\u4e8b\u4ef6\u5206\u53d1\u5668\u8fdb\u884c\u5206\u53d1\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u3002 \u5982\u679c\u4f60\u4e0d\u9700\u8981\u4e86\u89e3\u6216\u81ea\u5b9a\u4e49\u6709\u5173\u4e8b\u4ef6\u5206\u53d1\u7684\u529f\u80fd\uff0c\u6b64\u5904\u53ef\u65e0\u9700\u9605\u8bfb\u3002 \u5c5e\u6027 \u7c7b\u540d\uff1a ZM\\Event\\EventDispatcher \u65b9\u6cd5 EventDispatcher::interrupt() \u963b\u65ad\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u4e8b\u4ef6\uff0c\u53ea\u80fd\u5728\u4e8b\u4ef6\u5185\u90e8\u88ab\u8c03\u7528\u7684\u51fd\u6570\u4e2d\u5b9e\u73b0\u3002 __construct() \u6784\u9020\u65b9\u6cd5\u3002 1 EventDispatcher::__construct(string $class = '') \u521d\u59cb\u5316\u4e00\u4e2a\u4e8b\u4ef6\u5206\u53d1\u5668\uff0c\u53ef\u8fdb\u884c\u4e00\u7cfb\u5217\u8bbe\u7f6e\uff0c\u5bf9\u4e8b\u4ef6\u5206\u53d1\u505a\u9650\u5b9a\u3002 \u53c2\u6570 $class \uff1a\u8bbe\u7f6e\u8981\u5206\u53d1\u7684\u4e8b\u4ef6\u5bf9\u5e94\u7684\u6ce8\u89e3\u7c7b\u540d\uff0c\u652f\u6301\u81ea\u5b9a\u4e49\u6ce8\u89e3\uff08\u4f8b\u5982 CQMessage::class \uff09 setRuleFunction() \u8bbe\u7f6e\u51fd\u6570\u89e6\u53d1\u89c4\u5219\u5224\u5b9a\u7684\u51fd\u6570\uff08\u5c31\u662f\u5728\u6267\u884c\u4e8b\u4ef6\u51fd\u6570\u524d\u6267\u884c\u7684\u89c4\u5219\u5224\u5b9a\uff09 1 setRuleFunction(callable $rule = null) \u53c2\u6570 $rule \uff1a\u652f\u6301\u56de\u8c03\u6216\u95ed\u5305\u3002\u95ed\u5305\u7684\u53c2\u6570\u4e3a\u6267\u884c\u5bf9\u5e94\u4e8b\u4ef6\u51fd\u6570\u6240\u7ed1\u5b9a\u7684\u6ce8\u89e3\u4e8b\u4ef6\u5bf9\u8c61\u3002 1 2 3 4 $dispatcher = new EventDispatcher(CustomEvent::class); $dispatcher->setRuleFunction(function($obj) { return $obj->name == \"zhamao\" ? true : false; }); \u4e0a\u65b9\u7684 $obj \u5c31\u662f CustomEvent \u7c7b\u7684\u5b9e\u4f8b\uff0c\u53c2\u6570\u7ed1\u5b9a\u4e3a\u6ce8\u89e3\u4e2d\u5bf9\u5e94\u7684\u53c2\u6570\u3002 setResultFunction() \u8bbe\u7f6e\u4e8b\u4ef6\u51fd\u6570\u8fd4\u56de\u503c\u5904\u7406\u7684\u56de\u8c03\u51fd\u6570\u3002 1 setReturnFunction(callable $return_func) \u53c2\u6570 $return_func \uff1a\u8bbe\u7f6e\u4e8b\u4ef6\u51fd\u6570\u8fd4\u56de\u503c\u5904\u7406\u7684\u56de\u8c03\u51fd\u6570\uff0c\u56de\u8c03\u53c2\u6570\u7ed1\u5b9a\u4e3a\u5bf9\u5e94\u5355\u72ec\u4e8b\u4ef6\u51fd\u6570\u7684\u8fd4\u56de\u503c\u3002 1 2 3 4 $dispatcher = new EventDispatcher(CustomEvent::class); $dispatcher->setReturnFunction(function($return) { if (is_string($return)) Console::info(\"\u51fd\u6570\u8fd4\u56de\u4e86 \".$return); }); dispatchEvents() \u5f00\u59cb\u5206\u53d1\u4e8b\u4ef6\u3002 1 dispatchEvents(...$params) \u53c2\u6570 \u81ea\u5b9a\u4e49\u53c2\u6570\uff0c\u8fd9\u91cc\u586b\u5165\u7684\u53c2\u6570\u5c06\u88ab\u586b\u5165\u88ab\u5206\u53d1\u7684\u51fd\u6570\u53c2\u6570\u4e2d\u3002 1 $dispatcher->dispatchEvents(\"foo\", \"bar\"); 1 2 3 4 5 6 7 8 9 <?php class Test { /** * @CustomEvent(\"zhamao\") */ public function test ( $arg1 , $arg2 ) { echo \" $arg1 : $arg2 \" ; //\u5c06\u8f93\u51fa \"foo: bar\" } } \u673a\u5236 \u4e8b\u4ef6\u5206\u53d1\u5668\u7684\u673a\u5236\u8bf4\u7b80\u5355\u4e0d\u7b80\u5355\uff0c\u8bf4\u590d\u6742\u4e5f\u4e0d\u590d\u6742\uff0c\u5b83\u548c\u4e2d\u95f4\u4ef6\u6709\u7740\u975e\u5e38\u5927\u7684\u5173\u7cfb\uff0c\u56e0\u4e3a\u5b83\u4f1a\u81ea\u52a8\u68c0\u6d4b\u548c\u8bc6\u522b\u6240\u8981\u6267\u884c\u7684\u51fd\u6570\u6709\u6ca1\u6709\u4e2d\u95f4\u4ef6\uff0c\u5e76\u4e14\u6839\u636e\u987a\u5e8f\u8fdb\u884c\u6267\u884c\u3002 \u5728\u70b8\u6bdb\u6846\u67b6\u5185\u90e8\uff0c\u4e00\u4e2a\u5b8c\u6574\u7684\u4e8b\u4ef6\u6d41\u7a0b\u548c\u4e2d\u95f4\u4ef6\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a \u5bf9\u4e8e\u540c\u4e00\u4e8b\u4ef6\u7684\u4f18\u5148\u7ea7\u548c\u54cd\u5e94\u987a\u5e8f\uff0c\u4f18\u5148\u7ea7\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a \u5bf9\u4e8e\u4e8b\u4ef6\u5185\u5355\u4e2a\u4e8b\u4ef6\u88ab\u8c03\u7528\u7684\u5355\u4e2a\u51fd\u6570\u4e0b\u5982\u679c\u5b58\u5728\u591a\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u4e2d\u95f4\u4ef6\u6a21\u578b\u548c\u4e8b\u4ef6\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a \u5b9e\u6218\u4f8b\u5b50 \u6211\u4eec\u5047\u8bbe CustomEvent \u662f\u6211\u4eec\u7684\u81ea\u5b9a\u4e49\u6ce8\u89e3\u3002\u8fd8\u6ca1\u5199\u5b8c\uff0c\u8fd9\u90e8\u5206\u592a\u590d\u6742\u4e86\uff0c\u800c\u4e14\u4e3e\u4f8b\u5b50\u4e5f\u4e0d\u597d\u4e3e\u4f8b\uff0c\u8fd9\u5757\u5e94\u8be5\u4e5f\u4e0d\u7528\u7740\u6025\u66f4\u65b0\u3002 TODO\uff1a\u5f85\u5b8c\u6210","title":"\u4e8b\u4ef6\u5206\u53d1\u5668"},{"location":"event/event-dispatcher/#_1","text":"\u4e8b\u4ef6\u5206\u53d1\u5668\u662f\u4ee5\u4e0a\u6240\u6709\u6ce8\u89e3\u4e8b\u4ef6\u6267\u884c\u51fd\u6570\u7684\u4e00\u4e2a\u5206\u53d1\u5668\uff0c\u5982\u679c\u4f60\u5728\u4e0a\u4e00\u7ae0\u5df2\u7ecf\u5b66\u4f1a\u4e86\u5982\u4f55\u521b\u5efa\u81ea\u5b9a\u4e49\u6ce8\u89e3\uff0c\u90a3\u4e48\u672c\u7ae0\u5c31\u6765\u8bf4\u660e\u5982\u4f55\u7528\u5185\u7f6e\u7684\u4e8b\u4ef6\u5206\u53d1\u5668\u8fdb\u884c\u5206\u53d1\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u3002 \u5982\u679c\u4f60\u4e0d\u9700\u8981\u4e86\u89e3\u6216\u81ea\u5b9a\u4e49\u6709\u5173\u4e8b\u4ef6\u5206\u53d1\u7684\u529f\u80fd\uff0c\u6b64\u5904\u53ef\u65e0\u9700\u9605\u8bfb\u3002","title":"\u4e8b\u4ef6\u5206\u53d1\u5668\uff08\u8fdb\u9636\uff09"},{"location":"event/event-dispatcher/#_2","text":"\u7c7b\u540d\uff1a ZM\\Event\\EventDispatcher","title":"\u5c5e\u6027"},{"location":"event/event-dispatcher/#_3","text":"","title":"\u65b9\u6cd5"},{"location":"event/event-dispatcher/#eventdispatcherinterrupt","text":"\u963b\u65ad\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u4e8b\u4ef6\uff0c\u53ea\u80fd\u5728\u4e8b\u4ef6\u5185\u90e8\u88ab\u8c03\u7528\u7684\u51fd\u6570\u4e2d\u5b9e\u73b0\u3002","title":"EventDispatcher::interrupt()"},{"location":"event/event-dispatcher/#__construct","text":"\u6784\u9020\u65b9\u6cd5\u3002 1 EventDispatcher::__construct(string $class = '') \u521d\u59cb\u5316\u4e00\u4e2a\u4e8b\u4ef6\u5206\u53d1\u5668\uff0c\u53ef\u8fdb\u884c\u4e00\u7cfb\u5217\u8bbe\u7f6e\uff0c\u5bf9\u4e8b\u4ef6\u5206\u53d1\u505a\u9650\u5b9a\u3002","title":"__construct()"},{"location":"event/event-dispatcher/#_4","text":"$class \uff1a\u8bbe\u7f6e\u8981\u5206\u53d1\u7684\u4e8b\u4ef6\u5bf9\u5e94\u7684\u6ce8\u89e3\u7c7b\u540d\uff0c\u652f\u6301\u81ea\u5b9a\u4e49\u6ce8\u89e3\uff08\u4f8b\u5982 CQMessage::class \uff09","title":"\u53c2\u6570"},{"location":"event/event-dispatcher/#setrulefunction","text":"\u8bbe\u7f6e\u51fd\u6570\u89e6\u53d1\u89c4\u5219\u5224\u5b9a\u7684\u51fd\u6570\uff08\u5c31\u662f\u5728\u6267\u884c\u4e8b\u4ef6\u51fd\u6570\u524d\u6267\u884c\u7684\u89c4\u5219\u5224\u5b9a\uff09 1 setRuleFunction(callable $rule = null)","title":"setRuleFunction()"},{"location":"event/event-dispatcher/#_5","text":"$rule \uff1a\u652f\u6301\u56de\u8c03\u6216\u95ed\u5305\u3002\u95ed\u5305\u7684\u53c2\u6570\u4e3a\u6267\u884c\u5bf9\u5e94\u4e8b\u4ef6\u51fd\u6570\u6240\u7ed1\u5b9a\u7684\u6ce8\u89e3\u4e8b\u4ef6\u5bf9\u8c61\u3002 1 2 3 4 $dispatcher = new EventDispatcher(CustomEvent::class); $dispatcher->setRuleFunction(function($obj) { return $obj->name == \"zhamao\" ? true : false; }); \u4e0a\u65b9\u7684 $obj \u5c31\u662f CustomEvent \u7c7b\u7684\u5b9e\u4f8b\uff0c\u53c2\u6570\u7ed1\u5b9a\u4e3a\u6ce8\u89e3\u4e2d\u5bf9\u5e94\u7684\u53c2\u6570\u3002","title":"\u53c2\u6570"},{"location":"event/event-dispatcher/#setresultfunction","text":"\u8bbe\u7f6e\u4e8b\u4ef6\u51fd\u6570\u8fd4\u56de\u503c\u5904\u7406\u7684\u56de\u8c03\u51fd\u6570\u3002 1 setReturnFunction(callable $return_func)","title":"setResultFunction()"},{"location":"event/event-dispatcher/#_6","text":"$return_func \uff1a\u8bbe\u7f6e\u4e8b\u4ef6\u51fd\u6570\u8fd4\u56de\u503c\u5904\u7406\u7684\u56de\u8c03\u51fd\u6570\uff0c\u56de\u8c03\u53c2\u6570\u7ed1\u5b9a\u4e3a\u5bf9\u5e94\u5355\u72ec\u4e8b\u4ef6\u51fd\u6570\u7684\u8fd4\u56de\u503c\u3002 1 2 3 4 $dispatcher = new EventDispatcher(CustomEvent::class); $dispatcher->setReturnFunction(function($return) { if (is_string($return)) Console::info(\"\u51fd\u6570\u8fd4\u56de\u4e86 \".$return); });","title":"\u53c2\u6570"},{"location":"event/event-dispatcher/#dispatchevents","text":"\u5f00\u59cb\u5206\u53d1\u4e8b\u4ef6\u3002 1 dispatchEvents(...$params)","title":"dispatchEvents()"},{"location":"event/event-dispatcher/#_7","text":"\u81ea\u5b9a\u4e49\u53c2\u6570\uff0c\u8fd9\u91cc\u586b\u5165\u7684\u53c2\u6570\u5c06\u88ab\u586b\u5165\u88ab\u5206\u53d1\u7684\u51fd\u6570\u53c2\u6570\u4e2d\u3002 1 $dispatcher->dispatchEvents(\"foo\", \"bar\"); 1 2 3 4 5 6 7 8 9 <?php class Test { /** * @CustomEvent(\"zhamao\") */ public function test ( $arg1 , $arg2 ) { echo \" $arg1 : $arg2 \" ; //\u5c06\u8f93\u51fa \"foo: bar\" } }","title":"\u53c2\u6570"},{"location":"event/event-dispatcher/#_8","text":"\u4e8b\u4ef6\u5206\u53d1\u5668\u7684\u673a\u5236\u8bf4\u7b80\u5355\u4e0d\u7b80\u5355\uff0c\u8bf4\u590d\u6742\u4e5f\u4e0d\u590d\u6742\uff0c\u5b83\u548c\u4e2d\u95f4\u4ef6\u6709\u7740\u975e\u5e38\u5927\u7684\u5173\u7cfb\uff0c\u56e0\u4e3a\u5b83\u4f1a\u81ea\u52a8\u68c0\u6d4b\u548c\u8bc6\u522b\u6240\u8981\u6267\u884c\u7684\u51fd\u6570\u6709\u6ca1\u6709\u4e2d\u95f4\u4ef6\uff0c\u5e76\u4e14\u6839\u636e\u987a\u5e8f\u8fdb\u884c\u6267\u884c\u3002 \u5728\u70b8\u6bdb\u6846\u67b6\u5185\u90e8\uff0c\u4e00\u4e2a\u5b8c\u6574\u7684\u4e8b\u4ef6\u6d41\u7a0b\u548c\u4e2d\u95f4\u4ef6\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a \u5bf9\u4e8e\u540c\u4e00\u4e8b\u4ef6\u7684\u4f18\u5148\u7ea7\u548c\u54cd\u5e94\u987a\u5e8f\uff0c\u4f18\u5148\u7ea7\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a \u5bf9\u4e8e\u4e8b\u4ef6\u5185\u5355\u4e2a\u4e8b\u4ef6\u88ab\u8c03\u7528\u7684\u5355\u4e2a\u51fd\u6570\u4e0b\u5982\u679c\u5b58\u5728\u591a\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u4e2d\u95f4\u4ef6\u6a21\u578b\u548c\u4e8b\u4ef6\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a","title":"\u673a\u5236"},{"location":"event/event-dispatcher/#_9","text":"\u6211\u4eec\u5047\u8bbe CustomEvent \u662f\u6211\u4eec\u7684\u81ea\u5b9a\u4e49\u6ce8\u89e3\u3002\u8fd8\u6ca1\u5199\u5b8c\uff0c\u8fd9\u90e8\u5206\u592a\u590d\u6742\u4e86\uff0c\u800c\u4e14\u4e3e\u4f8b\u5b50\u4e5f\u4e0d\u597d\u4e3e\u4f8b\uff0c\u8fd9\u5757\u5e94\u8be5\u4e5f\u4e0d\u7528\u7740\u6025\u66f4\u65b0\u3002 TODO\uff1a\u5f85\u5b8c\u6210","title":"\u5b9e\u6218\u4f8b\u5b50"},{"location":"event/framework-annotations/","text":"\u6846\u67b6\u6838\u5fc3\u6ce8\u89e3\u4e8b\u4ef6 \u6846\u67b6\u6838\u5fc3\u6ce8\u89e3\u4e8b\u4ef6\u533a\u522b\u4e8e\u673a\u5668\u4eba\u548c\u8def\u7531\u6ce8\u89e3\u4e8b\u4ef6\uff0c\u8fd9\u91cc\u6846\u67b6\u6ce8\u89e3\u4e8b\u4ef6\u90fd\u662f \u76f4\u63a5 \u6216\u5c01\u88c5\u8c03\u7528 Swoole \u7684\u56de\u8c03\u4e8b\u4ef6\u7684\uff0c\u6240\u4ee5\u5bf9\u4e00\u4e9b\u6bd4\u8f83\u5e95\u5c42\u6216\u8005\u57fa\u7840\u7684\u64cd\u4f5c\u90fd\u5728\u8fd9\u91cc\u505a\uff0c\u4f8b\u5982\u6536\u5230 HTTP \u6216 WebSocket \u8fde\u63a5\u540e\u6267\u884c\u7684\u4e8b\u4ef6\u51fd\u6570\u3002 OnOpenEvent() \u5f53\u6709 WebSocket \u8fde\u63a5\u63a5\u5165\u6846\u67b6\u65f6\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6\u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @OnOpenEvent \u89e6\u53d1\u524d\u63d0 \u5f53\u6709 WebSocket \u8fde\u63a5\u63a5\u5165\u6846\u67b6\u65f6\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnOpenEvent \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0 \u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 connect_type string \u9650\u5b9a\u8fde\u63a5\u7684\u7c7b\u578b\uff0c\u901a\u8fc7\u70b8\u6bdb\u6846\u67b6\u652f\u6301\u7684\u65b9\u5f0f\u6307\u5b9a\u4f20\u5165\u7c7b\u578b\uff0c\u8be6\u89c1 \u8fdb\u9636 - \u63a5\u5165 WebSocket \u5ba2\u6237\u7aef \u7528\u6cd5 1 2 @OnOpenEvent ( \"foo\" ) @OnOpenEvent ( connect_type = \"default\" ) \u4e8b\u4ef6\u7ed1\u5b9a\u53c2\u6570 $conn : ConnectionObject \u7c7b\u578b\uff0c\u8fd4\u56de\u4e00\u4e2a\u5f53\u524d WS \u8fde\u63a5\u7684\u8fde\u63a5\u5bf9\u8c61\u3002 OnCloseEvent() \u5f53\u6709 WebSocket \u8fde\u63a5\u65ad\u5f00\u6846\u67b6\u65f6\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6\u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @OnCloseEvent \u89e6\u53d1\u524d\u63d0 \u5f53\u6709 WebSocket \u8fde\u63a5\u65ad\u5f00\u6846\u67b6\u65f6\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnCloseEvent \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0 \u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 connect_type string \u9650\u5b9a\u8fde\u63a5\u7684\u7c7b\u578b\uff0c\u901a\u8fc7\u70b8\u6bdb\u6846\u67b6\u652f\u6301\u7684\u65b9\u5f0f\u6307\u5b9a\u4f20\u5165\u7c7b\u578b\uff0c\u8be6\u89c1 \u8fdb\u9636 - \u63a5\u5165 WebSocket \u5ba2\u6237\u7aef \u7528\u6cd5 1 2 @OnCloseEvent ( \"foo\" ) @OnCloseEvent ( connect_type = \"default\" ) \u4e8b\u4ef6\u7ed1\u5b9a\u53c2\u6570 $conn : ConnectionObject \u7c7b\u578b\uff0c\u8fd4\u56de\u4e00\u4e2a\u5f53\u524d WS \u8fde\u63a5\u7684\u8fde\u63a5\u5bf9\u8c61\u3002 OnRequestEvent() \u5f53 HTTP \u8bf7\u6c42\u63a5\u5165\u65f6\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6\u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @OnRequestEvent \u89e6\u53d1\u524d\u63d0 \u5f53 HTTP \u8bf7\u6c42\u63a5\u5165\u65f6\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnRequestEvent \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0 \u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 rule string \uff0c\u5fc5\u987b\u662f\u53ef\u6267\u884c\u4e14\u8fd4\u56de bool \u7684 PHP \u4ee3\u7801 \u524d\u7f6e\u6761\u4ef6 \u7a7a\uff0crule \u4e3a true level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20 OnMessageEvent() \u5f53\u6709 WebSocket \u8fde\u63a5\u63a5\u5165\u6846\u67b6\u540e\u53d1\u9001\u8fc7\u6765\u6d88\u606f\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6\u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @OnMessageEvent \u89e6\u53d1\u524d\u63d0 \u5f53\u6709 WebSocket \u8fde\u63a5\u63a5\u5165\u6846\u67b6\u540e\u53d1\u9001\u8fc7\u6765\u6d88\u606f\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnMessageEvent \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0 \u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 connect_type string \u9650\u5b9a\u8fde\u63a5\u7684\u7c7b\u578b\uff0c\u901a\u8fc7\u70b8\u6bdb\u6846\u67b6\u652f\u6301\u7684\u65b9\u5f0f\u6307\u5b9a\u4f20\u5165\u7c7b\u578b\uff0c\u8be6\u89c1 \u8fdb\u9636 - \u63a5\u5165 WebSocket \u5ba2\u6237\u7aef \u7528\u6cd5 1 2 @OnMessageEvent ( \"foo\" ) @OnMessageEvent ( connect_type = \"default\" ) \u4e8b\u4ef6\u7ed1\u5b9a\u53c2\u6570 $conn : ConnectionObject \u7c7b\u578b\uff0c\u8fd4\u56de\u4e00\u4e2a\u5f53\u524d WS \u8fde\u63a5\u7684\u8fde\u63a5\u5bf9\u8c61\u3002 OnPipeMessageEvent() \u5f53\u6709 \u5176\u4ed6 Worker \u8fdb\u7a0b\u901a\u4fe1\u53d1\u6765\u6307\u4ee4\uff0c\u6fc0\u6d3b\u54cd\u5e94\u3002\uff082.2.0 \u7248\u672c\u53ef\u7528\uff09 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @OnPipeMessageEvent \u89e6\u53d1\u524d\u63d0 \u5f53\u6709 WebSocket \u8fde\u63a5\u63a5\u5165\u6846\u67b6\u540e\u53d1\u9001\u8fc7\u6765\u6d88\u606f\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnPipeMessageEvent \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0 \u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 action string \u9650\u5b9a\u52a8\u4f5c\u540d\u79f0 \u7528\u6cd5 1 2 @OnPipeMessageEvent ( \"foo\" ) @OnPipeMessageEvent ( action = \"bar\" ) \u4e8b\u4ef6\u7ed1\u5b9a\u53c2\u6570 $data : \u6570\u7ec4\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a 1 2 3 4 [ \"action\" => \"\u4f60\u7684\u4e0a\u9762\u7684\u540d\u79f0\", ... //\u5176\u4ed6\u81ea\u5df1\u53d1\u9001\u65f6\u968f\u4fbf\u5b9a\u4e49\uff0c\u5e26\u4ec0\u4e48\u90fd\u884c ] OnSwooleEvent() \u7ed1\u5b9a Swoole \u6240\u76f8\u5173\u7684\u4e8b\u4ef6\uff0c\u4f8b\u5982 WebSocket \u63a5\u5165\u3001\u6536\u5230 WS \u6d88\u606f\u3001\u5173\u95ed WS \u8fde\u63a5\uff0cHTTP \u8bf7\u6c42\u5230\u8fbe\u7b49\u3002\u8fd9\u4e2a\u662f\u65e7\u7684\u7edf\u4e00\u7684 Swoole \u4e8b\u4ef6\u5206\u53d1\u6ce8\u89e3\u3002 \u8bf7\u5c3d\u91cf\u4f7f\u7528\u4e0a\u9762\u51e0\u4e2a\u65b0\u7684\u6ce8\u89e3 \u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @OnSwooleEvent \u89e6\u53d1\u524d\u63d0 \u5f53\u53c2\u6570\u6307\u5b9a\u7684 type \u5bf9\u5e94\u7684\u4e8b\u4ef6\u88ab\u89e6\u53d1\u540e\u6fc0\u6d3b \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnSwooleEvent \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0 \u6ce8\u89e3\u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 type string \uff0c\u652f\u6301\u586b\u5165 open \uff0c request \uff0c close \uff0c message \u9650\u5b9a\u4e8b\u4ef6\u7684\u7c7b\u578b\uff0c \u5fc5\u586b rule string \uff0c\u5fc5\u987b\u662f\u53ef\u6267\u884c\u4e14\u8fd4\u56de bool \u7684 PHP \u4ee3\u7801 \u4f8b\u5982\u5224\u65ad\u8fde\u63a5\u662f\u5426\u4e3a QQ \u673a\u5668\u4eba\uff08 connectIsQQ() \uff09 \u7a7a\uff0crule \u4e3a true level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20 \u4e8b\u4ef6\u7ed1\u5b9a\u53c2\u6570 $conn : ConnectionObject \u7c7b\u578b\uff0c\u8fd4\u56de\u4e00\u4e2a\u5f53\u524d WS \u8fde\u63a5\u7684\u8fde\u63a5\u5bf9\u8c61\u3002 OnStart() \u5728\u6846\u67b6\u52a0\u8f7d\u540e\u6267\u884c\u7684\u6ce8\u89e3\u4e8b\u4ef6\uff0c\u7528\u4e8e\u521d\u59cb\u5316 Worker \u8fdb\u7a0b\uff0c\u6b64\u6ce8\u89e3\u4e8b\u4ef6\u4f1a\u5728 Worker \u8fdb\u7a0b\u4e2d\u6267\u884c\uff0c\u4e14\u53ef\u4ee5\u6307\u5b9a\u5728\u54ea\u4e2a Worker \u8fdb\u7a0b\u4e2d\u6267\u884c\u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @OnStart \u89e6\u53d1\u524d\u63d0 \u5728\u6846\u67b6\u52a0\u8f7d\u540e\u6fc0\u6d3b \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnStart \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0 \u6ce8\u89e3\u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 worker_id int \uff0c\u8981\u5728\u54ea\u4e2a Worker \u8fdb\u7a0b\u4e0a\u6267\u884c\uff0c\u9ed8\u8ba4\u4e3a 0\uff0c\u8303\u56f4\u662f 0\uff5e{\u4f60\u8bbe\u5b9a\u7684 Worker \u6570\u91cf-1}\uff0c\u5982\u679c\u662f -1 \u7684\u8bdd\uff0c\u5219\u4f1a\u5728\u6240\u6709 Worker \u8fdb\u7a0b\u4e0a\u89e6\u53d1\u3002 \u9650\u5b9a\u53ea\u6267\u884c\u7684 Worker \u8fdb\u7a0b OnTick() \u5728\u6846\u67b6\u52a0\u8f7d\u540e\u521b\u5efa\u6beb\u79d2\u8ba1\u65f6\u5668\u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @OnTick \u89e6\u53d1\u524d\u63d0 \u5728\u6846\u67b6\u52a0\u8f7d\u540e\u6fc0\u6d3b \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnTick \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0 \u6ce8\u89e3\u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 tick_ms int \uff0c \u5fc5\u586b \uff0c\u95f4\u9694\u7684\u6beb\u79d2\u6570\uff0c\u4f8b\u5982 1 \u79d2\u95f4\u9694\u4e3a 1000 \uff0c\u8303\u56f4\u5927\u4e8e 0\uff0c\u5c0f\u4e8e 86400000\u3002 worker_id int \uff0c\u8981\u5728\u54ea\u4e2a Worker \u8fdb\u7a0b\u4e0a\u6267\u884c\uff0c\u9ed8\u8ba4\u4e3a 0\uff0c\u8303\u56f4\u662f 0\uff5e{\u4f60\u8bbe\u5b9a\u7684 Worker \u6570\u91cf-1}\uff0c\u5982\u679c\u662f -1 \u7684\u8bdd\uff0c\u5219\u4f1a\u5728\u6240\u6709 Worker \u8fdb\u7a0b\u4e0a\u89e6\u53d1\u3002 \u9650\u5b9a\u53ea\u6267\u884c\u7684 Worker \u8fdb\u7a0b OnTask() \u5b9a\u4e49\u4e00\u4e2a\u5728\u5de5\u4f5c\u8fdb\u7a0b\u4e2d\u8fd0\u884c\u7684\u4efb\u52a1\u51fd\u6570\u3002\u8be6\u60c5\u89c1 \u8fdb\u9636 - \u4f7f\u7528 TaskWorker \u8fdb\u7a0b\u5904\u7406\u5bc6\u96c6\u8fd0\u7b97 \u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @OnTask \u89e6\u53d1\u524d\u63d0 \u5728\u6846\u67b6\u52a0\u8f7d\u540e\u6fc0\u6d3b \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnTask \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u6709\uff0c\u8fd4\u56de Worker \u8fdb\u7a0b\u7684\u7ed3\u679c \u6ce8\u89e3\u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 task_name string \uff0c \u5fc5\u586b \uff0c\u4efb\u52a1\u51fd\u6570\u7684\u540d\u79f0\uff0c\u4e0d\u5efa\u8bae\u91cd\u590d\u3002 rule \u8bbe\u7f6e\u89e6\u53d1\u524d\u63d0\uff0cPHP \u4ee3\u7801\uff0c\u8fd4\u56de bool \u503c\u5373\u53ef\uff0c\u53c2\u8003 OnRequestEvent \u9650\u5b9a\u662f\u5426\u6267\u884c \u7a7a OnSetup() \u5728\u6846\u67b6\u52a0\u8f7d\u524d\u6267\u884c\u7684\u4ee3\u7801\u3002\u6b64\u90e8\u5206\u4ee3\u7801\u662f\u5728\u4e3b\u8fdb\u7a0b\u6267\u884c\u7684\uff0c\u4e0d\u53ef\u5728\u6b64\u4e8b\u4ef6\u4e2d\u4f7f\u7528\u4efb\u4f55\u534f\u7a0b\u76f8\u5173\u7684\u529f\u80fd\u3002 \u6bd4\u5982\u6211\u4eec\u8981\u6539\u53d8\u6240\u6709\u8fdb\u7a0b\u7684 ini \u8bbe\u7f6e\uff0c\u8fd9\u65f6\u4f7f\u7528 @OnStart(-1) \u8fd9\u6837\u53ea\u8bbe\u7f6e\u4e86 Worker \u8fdb\u7a0b\u7684\u5185\u5bb9\uff0c\u800c\u4e3b\u8fdb\u7a0b\u548c\u7ba1\u7406\u8fdb\u7a0b\u65e0\u6cd5\u88ab\u8986\u76d6\u5230\u3002\u5982\u679c\u9700\u8981\u8bbe\u7f6e\u5168\u5c40\u7684\u4e00\u4e9b\u914d\u7f6e\uff0c\u52a1\u5fc5\u5728\u6b64 @OnSetup \u6ce8\u89e3\u4e0b\u6267\u884c\u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @OnSetup \u89e6\u53d1\u524d\u63d0 \u5728\u6846\u67b6\u52a0\u8f7d\u524d\u6fc0\u6d3b \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnSetup \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0 \u6ce8\u89e3\u53c2\u6570 \u65e0\u3002 TerminalCommand() \u6dfb\u52a0\u4e00\u4e2a\u8fdc\u7a0b\u7ec8\u7aef\u7684\u81ea\u5b9a\u4e49\u547d\u4ee4\u3002\uff082.4.0 \u7248\u672c\u8d77\u53ef\u7528\uff09 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @TerminalCommand \u89e6\u53d1\u524d\u63d0 \u8fde\u63a5\u5230\u8fdc\u7a0b\u7ec8\u7aef\u53ef\u89e6\u53d1 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Command\\TerminalCommand \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0 \u6ce8\u89e3\u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u9ed8\u8ba4 command string \uff0c \u5fc5\u586b \uff0c\u547d\u4ee4\u5b57\u7b26\u4e32 alias string \uff0c\u53ef\u9009\uff0c\u547d\u4ee4\u7684\u522b\u540d description string \uff0c\u8981\u663e\u793a\u7684\u5e2e\u52a9\u6587\u672c \u7a7a \u793a\u4f8b1\uff08\u673a\u5668\u4eba\u8fde\u63a5\u6846\u67b6\u540e\u8f93\u51fa\u4fe1\u606f\uff09 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php namespace Module\\Example ; use ZM\\Annotation\\Swoole\\OnOpenEvent ; use ZM\\ConnectionManager\\ConnectionObject ; use ZM\\Console\\Console ; class Hello { /** * \u5728\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u8fde\u63a5\u6846\u67b6\u540e\u5411\u7ec8\u7aef\u8f93\u51fa\u4fe1\u606f * @OnOpenEvent(\"qq\") * @param $conn */ public function onConnect ( ConnectionObject $conn ) { Console :: info ( \"\u673a\u5668\u4eba \" . $conn -> getOption ( \"connect_id\" ) . \" \u5df2\u8fde\u63a5\uff01\" ); } } \u8fd9\u91cc\u7684 Console \u662f\u7ec8\u7aef\u8f93\u51fa\u7ec4\u4ef6\uff0c\u8be6\u60c5\u89c1\u7ec4\u4ef6\u4e00\u680f\u5bf9\u5e94\u7684\u6587\u6863\u67e5\u8be2\u3002 \u793a\u4f8b2\uff08\u963b\u65ad Chrome \u8bbf\u95ee\u6846\u67b6\u65f6\u591a\u8bbf\u95ee\u4e00\u6b21\u7684\u95ee\u9898\uff09 1 2 3 4 5 6 7 8 9 10 11 12 13 <?php namespace Module\\Example ; use ZM\\Annotation\\Swoole\\OnSwooleEvent ; use ZM\\Event\\EventDispatcher ; class Hello { /** * \u963b\u6b62 Chrome \u81ea\u52a8\u8bf7\u6c42 /favicon.ico \u5bfc\u81f4\u7684\u591a\u6761\u8bf7\u6c42\u5e76\u53d1\u548c\u5e72\u6270 * @OnRequestEvent(rule=\"ctx()->getRequest()->server['request_uri'] == '/favicon.ico'\",level=200) */ public function onRequest () { EventDispatcher :: interrupt (); } } \u5176\u4e2d EventDispatcher \u4e3a\u4e8b\u4ef6\u5206\u53d1\u5668\uff0cinterrupt \u662f\u901a\u7528\u963b\u65ad\u65b9\u6cd5\uff0c\u5982\u679c\u4f60\u5e73\u5e38\u53ea\u4f7f\u7528\u963b\u65ad\uff0c\u5219\u53ea\u9700\u638c\u63e1\u8fd9\u4e00\u4e2a\u65b9\u6cd5\u5373\u53ef\uff0c EventDispatcher::interrupt() \u5728\u6240\u6709\u4e8b\u4ef6\u5185\u53ef\u7528\u3002 \u793a\u4f8b3\uff08\u63a5\u6536 WS \u5ba2\u6237\u7aef\u53d1\u6765\u7684\u6570\u636e\uff09 \u89c1 \u63a5\u5165 WebSocket \u5ba2\u6237\u7aef \u3002 \u793a\u4f8b4\uff08\u4f7f\u7528 OnStart \u7ed9\u6240\u6709 Worker \u8fdb\u7a0b\u5199\u5165\u7f13\u5b58\u63d0\u901f\uff09 \u5982\u679c\u4f60\u6709\u4e00\u4e9b\u6570\u636e\u5b58\u5230\u4e86\u6587\u4ef6\u3001\u6570\u636e\u5e93\u4e2d\uff0c\u4e14\u662f\u53ea\u8bfb\u4e0d\u5199\u7684\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u4f7f\u7528\u6b64\u65b9\u6cd5\u5c06\u8fd9\u4e2a\u6587\u4ef6\u6216\u8005\u6570\u636e\u5e93\u7684\u5185\u5bb9\u8bfb\u5165 Worker \u8fdb\u7a0b\u7684\u5185\u5b58\u4e2d\u8fdb\u884c\u4f7f\u7528\u6765\u63d0\u901f\u3002 \u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u5927\u6587\u4ef6 json\uff0c\u91cc\u9762\u5b58\u7740\u4e00\u4efd\u9898\u5e93\uff0c\u4f8b\u5982\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 { \"0\" : { \"question\" : \"\u6cd5\u7684\u8c03\u6574\u5bf9\u8c61\u662f\uff08 \uff09\u3002\" , \"answer\" : { \"A\" : \"\u884c\u4e3a\u5173\u7cfb\" , \"B\" : \"\u601d\u60f3\u5173\u7cfb\" , \"C\" : \"\u5229\u76ca\u5173\u7cfb\" , \"D\" : \"\u5404\u79cd\u793e\u4f1a\u8d44\u6e90\" }, \"key\" : \"A\" , \"answer_type\" : 0 }, \"1\" : { \"question\" : \"\u6cd5\u5f8b\u4e0e\u5176\u4ed6\u793e\u4f1a\u89c4\u8303\u7684\u533a\u522b\u5728\u4e8e\uff08 \uff09\u3002\" , \"answer\" : { \"A\" : \"\u662f\u8c03\u6574\u4eba\u4eec\u884c\u4e3a\u7684\u89c4\u8303\" , \"B\" : \"\u6709\u7ea6\u675f\u529b\" , \"C\" : \"\u7531\u56fd\u5bb6\u5f3a\u5236\u529b\u4fdd\u8bc1\u6267\u884c\" , \"D\" : \"\u89c4\u5b9a\u5236\u88c1\u63aa\u65bd\" }, \"key\" : \"C\" , \"answer_type\" : 0 }, ..... } \u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 OnStart \u6765\u5b9e\u73b0\u4e00\u4e2a\uff0c\u5c06\u6b64\u6587\u4ef6\u8bfb\u53d6\u5230\u6bcf\u4e2a Worker \u8fdb\u7a0b\u4e2d\uff0c\u5e76\u4e14\u5feb\u901f\u53d6\u7528\u7684\u529f\u80fd\uff08\u4ee5\u4e0b\u505a\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u67e5\u9898\u529f\u80fd\uff09\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 <?php namespace Module\\Example ; use ZM\\Annotation\\Swoole\\OnStart ; use ZM\\Annotation\\CQ\\CQCommand ; use ZM\\Console\\Console ; class Hello { public static $tiku = []; /** * @OnStart(-1) */ public function onStart () { // \u6ce8\u610f\uff0c\u6b64\u51fd\u6570\u5c06\u4f1a\u5728\u6bcf\u4e2a Worker \u6267\u884c\u4e00\u6b21 $file = file_get_contents ( \"tiku.json\" ); //\u4ece\u6587\u4ef6\u8bfb\u53d6json $json = json_decode ( $file , true ); //json\u89e3\u6790 Hello :: $tiku = $json ; //\u5c06\u89e3\u6790\u540e\u7684\u6570\u7ec4\u4ee5\u9759\u6001\u53d8\u91cf\u7684\u65b9\u5f0f\u5b58\u5230\u6bcf\u4e2a Worker \u7684\u5185\u5b58\u4e2d Console :: success ( \"\u52a0\u8f7d\u9898\u5e93\u5b8c\u6210\uff01\" ); } /** * @CQCommand(\"\u627e\u9898\") */ public function findQuestion () { $tiku_id = ctx () -> getNumArg ( \"\u8bf7\u8f93\u5165\u9898\u76ee\u7684\u5e8f\u53f7\" ); if ( ! isset ( Hello :: $tiku [ $tiku_id ])) return \"\u9898\u76eeid\u4e3a\" . $tiku_id . \"\u7684\u9898\u76ee\u4e0d\u5b58\u5728\uff01\" ; $timu = Hello :: $tiku [ $tiku_id ]; $msg = \"\u9898\u76ee\u540d\u79f0\uff1a\" . $timu [ \"question\" ]; foreach ( $timu [ \"answer\" ] as $k => $v ) { $msg .= \" \\n \" . $k . \". \" . $v ; } $msg .= \" \\n \u6b63\u786e\u7b54\u6848\uff1a\" . $timu [ \"key\" ]; return $msg ; } } \u7ec8\u7aef\u6548\u679c\uff1a\uff08\u6211\u4eec\u5047\u8bbe\u8fd0\u884c\u6846\u67b6\u7684\u7535\u8111\u662f\u56db\u6838 CPU\uff09 1 2 3 4 [14:28:00] [S] [#0] \u52a0\u8f7d\u9898\u5e93\u5b8c\u6210\uff01 [14:28:00] [S] [#2] \u52a0\u8f7d\u9898\u5e93\u5b8c\u6210\uff01 [14:28:00] [S] [#1] \u52a0\u8f7d\u9898\u5e93\u5b8c\u6210\uff01 [14:28:00] [S] [#3] \u52a0\u8f7d\u9898\u5e93\u5b8c\u6210\uff01 \u804a\u5929\u6548\u679c\uff1a ) \u627e\u9898 1 ( \u9898\u76ee\u540d\u79f0\uff1a\u6cd5\u5f8b\u4e0e\u5176\u4ed6\u793e\u4f1a\u89c4\u8303\u7684\u533a\u522b\u5728\u4e8e\uff08 \uff09\u3002\\nA. \u662f\u8c03\u6574\u4eba\u4eec\u884c\u4e3a\u7684\u89c4\u8303\\nB. \u6709\u7ea6\u675f\u529b\\nC. \u7531\u56fd\u5bb6\u5f3a\u5236\u529b\u4fdd\u8bc1\u6267\u884c\\nD. \u89c4\u5b9a\u5236\u88c1\u63aa\u65bd\\n\u6b63\u786e\u7b54\u6848\uff1aC \u793a\u4f8b5\uff08\u521b\u5efa\u6bcf\u5206\u949f\u81ea\u52a8\u6267\u884c\u7684\u722c\u866b\uff09 1 2 3 4 5 6 7 /** * @OnTick(tick_ms=60000,worker_id=0) */ public function onCrawl() { $data = Foo::bar(); //\u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u5199\u7684\u8981\u722c\u7684\u63a5\u53e3\u7b49\u7b49\u4e00\u7cfb\u5217\u64cd\u4f5c LightCache::set(\"your_data_key_name\", $data); //\u5c06\u722c\u866b\u6570\u636e\u5b58\u5165 LightCache \u8f7b\u91cf\u7f13\u5b58 } \u793a\u4f8b6\uff08\u521b\u5efa\u4e00\u4e2a\u8fdc\u7a0b\u7ec8\u7aef\u547d\u4ee4\u5e76\u8c03\u8bd5\u6846\u67b6\uff09 \u5f00\u4e2a\u5751\uff0c\u4ee5\u540e\u586b\u3002\uff08 \u586b\u5751\u6807\u8bb0 \uff09","title":"\u6846\u67b6\u6838\u5fc3\u6ce8\u89e3\u4e8b\u4ef6"},{"location":"event/framework-annotations/#_1","text":"\u6846\u67b6\u6838\u5fc3\u6ce8\u89e3\u4e8b\u4ef6\u533a\u522b\u4e8e\u673a\u5668\u4eba\u548c\u8def\u7531\u6ce8\u89e3\u4e8b\u4ef6\uff0c\u8fd9\u91cc\u6846\u67b6\u6ce8\u89e3\u4e8b\u4ef6\u90fd\u662f \u76f4\u63a5 \u6216\u5c01\u88c5\u8c03\u7528 Swoole \u7684\u56de\u8c03\u4e8b\u4ef6\u7684\uff0c\u6240\u4ee5\u5bf9\u4e00\u4e9b\u6bd4\u8f83\u5e95\u5c42\u6216\u8005\u57fa\u7840\u7684\u64cd\u4f5c\u90fd\u5728\u8fd9\u91cc\u505a\uff0c\u4f8b\u5982\u6536\u5230 HTTP \u6216 WebSocket \u8fde\u63a5\u540e\u6267\u884c\u7684\u4e8b\u4ef6\u51fd\u6570\u3002","title":"\u6846\u67b6\u6838\u5fc3\u6ce8\u89e3\u4e8b\u4ef6"},{"location":"event/framework-annotations/#onopenevent","text":"\u5f53\u6709 WebSocket \u8fde\u63a5\u63a5\u5165\u6846\u67b6\u65f6\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6\u3002","title":"OnOpenEvent()"},{"location":"event/framework-annotations/#_2","text":"\u7c7b\u578b \u503c \u540d\u79f0 @OnOpenEvent \u89e6\u53d1\u524d\u63d0 \u5f53\u6709 WebSocket \u8fde\u63a5\u63a5\u5165\u6846\u67b6\u65f6\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnOpenEvent \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0","title":"\u5c5e\u6027"},{"location":"event/framework-annotations/#_3","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 connect_type string \u9650\u5b9a\u8fde\u63a5\u7684\u7c7b\u578b\uff0c\u901a\u8fc7\u70b8\u6bdb\u6846\u67b6\u652f\u6301\u7684\u65b9\u5f0f\u6307\u5b9a\u4f20\u5165\u7c7b\u578b\uff0c\u8be6\u89c1 \u8fdb\u9636 - \u63a5\u5165 WebSocket \u5ba2\u6237\u7aef","title":"\u53c2\u6570"},{"location":"event/framework-annotations/#_4","text":"1 2 @OnOpenEvent ( \"foo\" ) @OnOpenEvent ( connect_type = \"default\" )","title":"\u7528\u6cd5"},{"location":"event/framework-annotations/#_5","text":"$conn : ConnectionObject \u7c7b\u578b\uff0c\u8fd4\u56de\u4e00\u4e2a\u5f53\u524d WS \u8fde\u63a5\u7684\u8fde\u63a5\u5bf9\u8c61\u3002","title":"\u4e8b\u4ef6\u7ed1\u5b9a\u53c2\u6570"},{"location":"event/framework-annotations/#oncloseevent","text":"\u5f53\u6709 WebSocket \u8fde\u63a5\u65ad\u5f00\u6846\u67b6\u65f6\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6\u3002","title":"OnCloseEvent()"},{"location":"event/framework-annotations/#_6","text":"\u7c7b\u578b \u503c \u540d\u79f0 @OnCloseEvent \u89e6\u53d1\u524d\u63d0 \u5f53\u6709 WebSocket \u8fde\u63a5\u65ad\u5f00\u6846\u67b6\u65f6\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnCloseEvent \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0","title":"\u5c5e\u6027"},{"location":"event/framework-annotations/#_7","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 connect_type string \u9650\u5b9a\u8fde\u63a5\u7684\u7c7b\u578b\uff0c\u901a\u8fc7\u70b8\u6bdb\u6846\u67b6\u652f\u6301\u7684\u65b9\u5f0f\u6307\u5b9a\u4f20\u5165\u7c7b\u578b\uff0c\u8be6\u89c1 \u8fdb\u9636 - \u63a5\u5165 WebSocket \u5ba2\u6237\u7aef","title":"\u53c2\u6570"},{"location":"event/framework-annotations/#_8","text":"1 2 @OnCloseEvent ( \"foo\" ) @OnCloseEvent ( connect_type = \"default\" )","title":"\u7528\u6cd5"},{"location":"event/framework-annotations/#_9","text":"$conn : ConnectionObject \u7c7b\u578b\uff0c\u8fd4\u56de\u4e00\u4e2a\u5f53\u524d WS \u8fde\u63a5\u7684\u8fde\u63a5\u5bf9\u8c61\u3002","title":"\u4e8b\u4ef6\u7ed1\u5b9a\u53c2\u6570"},{"location":"event/framework-annotations/#onrequestevent","text":"\u5f53 HTTP \u8bf7\u6c42\u63a5\u5165\u65f6\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6\u3002","title":"OnRequestEvent()"},{"location":"event/framework-annotations/#_10","text":"\u7c7b\u578b \u503c \u540d\u79f0 @OnRequestEvent \u89e6\u53d1\u524d\u63d0 \u5f53 HTTP \u8bf7\u6c42\u63a5\u5165\u65f6\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnRequestEvent \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0","title":"\u5c5e\u6027"},{"location":"event/framework-annotations/#_11","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 rule string \uff0c\u5fc5\u987b\u662f\u53ef\u6267\u884c\u4e14\u8fd4\u56de bool \u7684 PHP \u4ee3\u7801 \u524d\u7f6e\u6761\u4ef6 \u7a7a\uff0crule \u4e3a true level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20","title":"\u53c2\u6570"},{"location":"event/framework-annotations/#onmessageevent","text":"\u5f53\u6709 WebSocket \u8fde\u63a5\u63a5\u5165\u6846\u67b6\u540e\u53d1\u9001\u8fc7\u6765\u6d88\u606f\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6\u3002","title":"OnMessageEvent()"},{"location":"event/framework-annotations/#_12","text":"\u7c7b\u578b \u503c \u540d\u79f0 @OnMessageEvent \u89e6\u53d1\u524d\u63d0 \u5f53\u6709 WebSocket \u8fde\u63a5\u63a5\u5165\u6846\u67b6\u540e\u53d1\u9001\u8fc7\u6765\u6d88\u606f\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnMessageEvent \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0","title":"\u5c5e\u6027"},{"location":"event/framework-annotations/#_13","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 connect_type string \u9650\u5b9a\u8fde\u63a5\u7684\u7c7b\u578b\uff0c\u901a\u8fc7\u70b8\u6bdb\u6846\u67b6\u652f\u6301\u7684\u65b9\u5f0f\u6307\u5b9a\u4f20\u5165\u7c7b\u578b\uff0c\u8be6\u89c1 \u8fdb\u9636 - \u63a5\u5165 WebSocket \u5ba2\u6237\u7aef","title":"\u53c2\u6570"},{"location":"event/framework-annotations/#_14","text":"1 2 @OnMessageEvent ( \"foo\" ) @OnMessageEvent ( connect_type = \"default\" )","title":"\u7528\u6cd5"},{"location":"event/framework-annotations/#_15","text":"$conn : ConnectionObject \u7c7b\u578b\uff0c\u8fd4\u56de\u4e00\u4e2a\u5f53\u524d WS \u8fde\u63a5\u7684\u8fde\u63a5\u5bf9\u8c61\u3002","title":"\u4e8b\u4ef6\u7ed1\u5b9a\u53c2\u6570"},{"location":"event/framework-annotations/#onpipemessageevent","text":"\u5f53\u6709 \u5176\u4ed6 Worker \u8fdb\u7a0b\u901a\u4fe1\u53d1\u6765\u6307\u4ee4\uff0c\u6fc0\u6d3b\u54cd\u5e94\u3002\uff082.2.0 \u7248\u672c\u53ef\u7528\uff09","title":"OnPipeMessageEvent()"},{"location":"event/framework-annotations/#_16","text":"\u7c7b\u578b \u503c \u540d\u79f0 @OnPipeMessageEvent \u89e6\u53d1\u524d\u63d0 \u5f53\u6709 WebSocket \u8fde\u63a5\u63a5\u5165\u6846\u67b6\u540e\u53d1\u9001\u8fc7\u6765\u6d88\u606f\uff0c\u89e6\u53d1\u6ce8\u89e3\u4e8b\u4ef6 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnPipeMessageEvent \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0","title":"\u5c5e\u6027"},{"location":"event/framework-annotations/#_17","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 action string \u9650\u5b9a\u52a8\u4f5c\u540d\u79f0","title":"\u53c2\u6570"},{"location":"event/framework-annotations/#_18","text":"1 2 @OnPipeMessageEvent ( \"foo\" ) @OnPipeMessageEvent ( action = \"bar\" )","title":"\u7528\u6cd5"},{"location":"event/framework-annotations/#_19","text":"$data : \u6570\u7ec4\uff0c\u5185\u5bb9\u5982\u4e0b\uff1a 1 2 3 4 [ \"action\" => \"\u4f60\u7684\u4e0a\u9762\u7684\u540d\u79f0\", ... //\u5176\u4ed6\u81ea\u5df1\u53d1\u9001\u65f6\u968f\u4fbf\u5b9a\u4e49\uff0c\u5e26\u4ec0\u4e48\u90fd\u884c ]","title":"\u4e8b\u4ef6\u7ed1\u5b9a\u53c2\u6570"},{"location":"event/framework-annotations/#onswooleevent","text":"\u7ed1\u5b9a Swoole \u6240\u76f8\u5173\u7684\u4e8b\u4ef6\uff0c\u4f8b\u5982 WebSocket \u63a5\u5165\u3001\u6536\u5230 WS \u6d88\u606f\u3001\u5173\u95ed WS \u8fde\u63a5\uff0cHTTP \u8bf7\u6c42\u5230\u8fbe\u7b49\u3002\u8fd9\u4e2a\u662f\u65e7\u7684\u7edf\u4e00\u7684 Swoole \u4e8b\u4ef6\u5206\u53d1\u6ce8\u89e3\u3002 \u8bf7\u5c3d\u91cf\u4f7f\u7528\u4e0a\u9762\u51e0\u4e2a\u65b0\u7684\u6ce8\u89e3 \u3002","title":"OnSwooleEvent()"},{"location":"event/framework-annotations/#_20","text":"\u7c7b\u578b \u503c \u540d\u79f0 @OnSwooleEvent \u89e6\u53d1\u524d\u63d0 \u5f53\u53c2\u6570\u6307\u5b9a\u7684 type \u5bf9\u5e94\u7684\u4e8b\u4ef6\u88ab\u89e6\u53d1\u540e\u6fc0\u6d3b \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnSwooleEvent \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0","title":"\u5c5e\u6027"},{"location":"event/framework-annotations/#_21","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 type string \uff0c\u652f\u6301\u586b\u5165 open \uff0c request \uff0c close \uff0c message \u9650\u5b9a\u4e8b\u4ef6\u7684\u7c7b\u578b\uff0c \u5fc5\u586b rule string \uff0c\u5fc5\u987b\u662f\u53ef\u6267\u884c\u4e14\u8fd4\u56de bool \u7684 PHP \u4ee3\u7801 \u4f8b\u5982\u5224\u65ad\u8fde\u63a5\u662f\u5426\u4e3a QQ \u673a\u5668\u4eba\uff08 connectIsQQ() \uff09 \u7a7a\uff0crule \u4e3a true level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20","title":"\u6ce8\u89e3\u53c2\u6570"},{"location":"event/framework-annotations/#_22","text":"$conn : ConnectionObject \u7c7b\u578b\uff0c\u8fd4\u56de\u4e00\u4e2a\u5f53\u524d WS \u8fde\u63a5\u7684\u8fde\u63a5\u5bf9\u8c61\u3002","title":"\u4e8b\u4ef6\u7ed1\u5b9a\u53c2\u6570"},{"location":"event/framework-annotations/#onstart","text":"\u5728\u6846\u67b6\u52a0\u8f7d\u540e\u6267\u884c\u7684\u6ce8\u89e3\u4e8b\u4ef6\uff0c\u7528\u4e8e\u521d\u59cb\u5316 Worker \u8fdb\u7a0b\uff0c\u6b64\u6ce8\u89e3\u4e8b\u4ef6\u4f1a\u5728 Worker \u8fdb\u7a0b\u4e2d\u6267\u884c\uff0c\u4e14\u53ef\u4ee5\u6307\u5b9a\u5728\u54ea\u4e2a Worker \u8fdb\u7a0b\u4e2d\u6267\u884c\u3002","title":"OnStart()"},{"location":"event/framework-annotations/#_23","text":"\u7c7b\u578b \u503c \u540d\u79f0 @OnStart \u89e6\u53d1\u524d\u63d0 \u5728\u6846\u67b6\u52a0\u8f7d\u540e\u6fc0\u6d3b \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnStart \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0","title":"\u5c5e\u6027"},{"location":"event/framework-annotations/#_24","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 worker_id int \uff0c\u8981\u5728\u54ea\u4e2a Worker \u8fdb\u7a0b\u4e0a\u6267\u884c\uff0c\u9ed8\u8ba4\u4e3a 0\uff0c\u8303\u56f4\u662f 0\uff5e{\u4f60\u8bbe\u5b9a\u7684 Worker \u6570\u91cf-1}\uff0c\u5982\u679c\u662f -1 \u7684\u8bdd\uff0c\u5219\u4f1a\u5728\u6240\u6709 Worker \u8fdb\u7a0b\u4e0a\u89e6\u53d1\u3002 \u9650\u5b9a\u53ea\u6267\u884c\u7684 Worker \u8fdb\u7a0b","title":"\u6ce8\u89e3\u53c2\u6570"},{"location":"event/framework-annotations/#ontick","text":"\u5728\u6846\u67b6\u52a0\u8f7d\u540e\u521b\u5efa\u6beb\u79d2\u8ba1\u65f6\u5668\u3002","title":"OnTick()"},{"location":"event/framework-annotations/#_25","text":"\u7c7b\u578b \u503c \u540d\u79f0 @OnTick \u89e6\u53d1\u524d\u63d0 \u5728\u6846\u67b6\u52a0\u8f7d\u540e\u6fc0\u6d3b \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnTick \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0","title":"\u5c5e\u6027"},{"location":"event/framework-annotations/#_26","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 tick_ms int \uff0c \u5fc5\u586b \uff0c\u95f4\u9694\u7684\u6beb\u79d2\u6570\uff0c\u4f8b\u5982 1 \u79d2\u95f4\u9694\u4e3a 1000 \uff0c\u8303\u56f4\u5927\u4e8e 0\uff0c\u5c0f\u4e8e 86400000\u3002 worker_id int \uff0c\u8981\u5728\u54ea\u4e2a Worker \u8fdb\u7a0b\u4e0a\u6267\u884c\uff0c\u9ed8\u8ba4\u4e3a 0\uff0c\u8303\u56f4\u662f 0\uff5e{\u4f60\u8bbe\u5b9a\u7684 Worker \u6570\u91cf-1}\uff0c\u5982\u679c\u662f -1 \u7684\u8bdd\uff0c\u5219\u4f1a\u5728\u6240\u6709 Worker \u8fdb\u7a0b\u4e0a\u89e6\u53d1\u3002 \u9650\u5b9a\u53ea\u6267\u884c\u7684 Worker \u8fdb\u7a0b","title":"\u6ce8\u89e3\u53c2\u6570"},{"location":"event/framework-annotations/#ontask","text":"\u5b9a\u4e49\u4e00\u4e2a\u5728\u5de5\u4f5c\u8fdb\u7a0b\u4e2d\u8fd0\u884c\u7684\u4efb\u52a1\u51fd\u6570\u3002\u8be6\u60c5\u89c1 \u8fdb\u9636 - \u4f7f\u7528 TaskWorker \u8fdb\u7a0b\u5904\u7406\u5bc6\u96c6\u8fd0\u7b97 \u3002","title":"OnTask()"},{"location":"event/framework-annotations/#_27","text":"\u7c7b\u578b \u503c \u540d\u79f0 @OnTask \u89e6\u53d1\u524d\u63d0 \u5728\u6846\u67b6\u52a0\u8f7d\u540e\u6fc0\u6d3b \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnTask \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u6709\uff0c\u8fd4\u56de Worker \u8fdb\u7a0b\u7684\u7ed3\u679c","title":"\u5c5e\u6027"},{"location":"event/framework-annotations/#_28","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 task_name string \uff0c \u5fc5\u586b \uff0c\u4efb\u52a1\u51fd\u6570\u7684\u540d\u79f0\uff0c\u4e0d\u5efa\u8bae\u91cd\u590d\u3002 rule \u8bbe\u7f6e\u89e6\u53d1\u524d\u63d0\uff0cPHP \u4ee3\u7801\uff0c\u8fd4\u56de bool \u503c\u5373\u53ef\uff0c\u53c2\u8003 OnRequestEvent \u9650\u5b9a\u662f\u5426\u6267\u884c \u7a7a","title":"\u6ce8\u89e3\u53c2\u6570"},{"location":"event/framework-annotations/#onsetup","text":"\u5728\u6846\u67b6\u52a0\u8f7d\u524d\u6267\u884c\u7684\u4ee3\u7801\u3002\u6b64\u90e8\u5206\u4ee3\u7801\u662f\u5728\u4e3b\u8fdb\u7a0b\u6267\u884c\u7684\uff0c\u4e0d\u53ef\u5728\u6b64\u4e8b\u4ef6\u4e2d\u4f7f\u7528\u4efb\u4f55\u534f\u7a0b\u76f8\u5173\u7684\u529f\u80fd\u3002 \u6bd4\u5982\u6211\u4eec\u8981\u6539\u53d8\u6240\u6709\u8fdb\u7a0b\u7684 ini \u8bbe\u7f6e\uff0c\u8fd9\u65f6\u4f7f\u7528 @OnStart(-1) \u8fd9\u6837\u53ea\u8bbe\u7f6e\u4e86 Worker \u8fdb\u7a0b\u7684\u5185\u5bb9\uff0c\u800c\u4e3b\u8fdb\u7a0b\u548c\u7ba1\u7406\u8fdb\u7a0b\u65e0\u6cd5\u88ab\u8986\u76d6\u5230\u3002\u5982\u679c\u9700\u8981\u8bbe\u7f6e\u5168\u5c40\u7684\u4e00\u4e9b\u914d\u7f6e\uff0c\u52a1\u5fc5\u5728\u6b64 @OnSetup \u6ce8\u89e3\u4e0b\u6267\u884c\u3002","title":"OnSetup()"},{"location":"event/framework-annotations/#_29","text":"\u7c7b\u578b \u503c \u540d\u79f0 @OnSetup \u89e6\u53d1\u524d\u63d0 \u5728\u6846\u67b6\u52a0\u8f7d\u524d\u6fc0\u6d3b \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Swoole\\OnSetup \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0","title":"\u5c5e\u6027"},{"location":"event/framework-annotations/#_30","text":"\u65e0\u3002","title":"\u6ce8\u89e3\u53c2\u6570"},{"location":"event/framework-annotations/#terminalcommand","text":"\u6dfb\u52a0\u4e00\u4e2a\u8fdc\u7a0b\u7ec8\u7aef\u7684\u81ea\u5b9a\u4e49\u547d\u4ee4\u3002\uff082.4.0 \u7248\u672c\u8d77\u53ef\u7528\uff09","title":"TerminalCommand()"},{"location":"event/framework-annotations/#_31","text":"\u7c7b\u578b \u503c \u540d\u79f0 @TerminalCommand \u89e6\u53d1\u524d\u63d0 \u8fde\u63a5\u5230\u8fdc\u7a0b\u7ec8\u7aef\u53ef\u89e6\u53d1 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Command\\TerminalCommand \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0","title":"\u5c5e\u6027"},{"location":"event/framework-annotations/#_32","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u9ed8\u8ba4 command string \uff0c \u5fc5\u586b \uff0c\u547d\u4ee4\u5b57\u7b26\u4e32 alias string \uff0c\u53ef\u9009\uff0c\u547d\u4ee4\u7684\u522b\u540d description string \uff0c\u8981\u663e\u793a\u7684\u5e2e\u52a9\u6587\u672c \u7a7a","title":"\u6ce8\u89e3\u53c2\u6570"},{"location":"event/framework-annotations/#1","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php namespace Module\\Example ; use ZM\\Annotation\\Swoole\\OnOpenEvent ; use ZM\\ConnectionManager\\ConnectionObject ; use ZM\\Console\\Console ; class Hello { /** * \u5728\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u8fde\u63a5\u6846\u67b6\u540e\u5411\u7ec8\u7aef\u8f93\u51fa\u4fe1\u606f * @OnOpenEvent(\"qq\") * @param $conn */ public function onConnect ( ConnectionObject $conn ) { Console :: info ( \"\u673a\u5668\u4eba \" . $conn -> getOption ( \"connect_id\" ) . \" \u5df2\u8fde\u63a5\uff01\" ); } } \u8fd9\u91cc\u7684 Console \u662f\u7ec8\u7aef\u8f93\u51fa\u7ec4\u4ef6\uff0c\u8be6\u60c5\u89c1\u7ec4\u4ef6\u4e00\u680f\u5bf9\u5e94\u7684\u6587\u6863\u67e5\u8be2\u3002","title":"\u793a\u4f8b1\uff08\u673a\u5668\u4eba\u8fde\u63a5\u6846\u67b6\u540e\u8f93\u51fa\u4fe1\u606f\uff09"},{"location":"event/framework-annotations/#2-chrome","text":"1 2 3 4 5 6 7 8 9 10 11 12 13 <?php namespace Module\\Example ; use ZM\\Annotation\\Swoole\\OnSwooleEvent ; use ZM\\Event\\EventDispatcher ; class Hello { /** * \u963b\u6b62 Chrome \u81ea\u52a8\u8bf7\u6c42 /favicon.ico \u5bfc\u81f4\u7684\u591a\u6761\u8bf7\u6c42\u5e76\u53d1\u548c\u5e72\u6270 * @OnRequestEvent(rule=\"ctx()->getRequest()->server['request_uri'] == '/favicon.ico'\",level=200) */ public function onRequest () { EventDispatcher :: interrupt (); } } \u5176\u4e2d EventDispatcher \u4e3a\u4e8b\u4ef6\u5206\u53d1\u5668\uff0cinterrupt \u662f\u901a\u7528\u963b\u65ad\u65b9\u6cd5\uff0c\u5982\u679c\u4f60\u5e73\u5e38\u53ea\u4f7f\u7528\u963b\u65ad\uff0c\u5219\u53ea\u9700\u638c\u63e1\u8fd9\u4e00\u4e2a\u65b9\u6cd5\u5373\u53ef\uff0c EventDispatcher::interrupt() \u5728\u6240\u6709\u4e8b\u4ef6\u5185\u53ef\u7528\u3002","title":"\u793a\u4f8b2\uff08\u963b\u65ad Chrome \u8bbf\u95ee\u6846\u67b6\u65f6\u591a\u8bbf\u95ee\u4e00\u6b21\u7684\u95ee\u9898\uff09"},{"location":"event/framework-annotations/#3-ws","text":"\u89c1 \u63a5\u5165 WebSocket \u5ba2\u6237\u7aef \u3002","title":"\u793a\u4f8b3\uff08\u63a5\u6536 WS \u5ba2\u6237\u7aef\u53d1\u6765\u7684\u6570\u636e\uff09"},{"location":"event/framework-annotations/#4-onstart-worker","text":"\u5982\u679c\u4f60\u6709\u4e00\u4e9b\u6570\u636e\u5b58\u5230\u4e86\u6587\u4ef6\u3001\u6570\u636e\u5e93\u4e2d\uff0c\u4e14\u662f\u53ea\u8bfb\u4e0d\u5199\u7684\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u4f7f\u7528\u6b64\u65b9\u6cd5\u5c06\u8fd9\u4e2a\u6587\u4ef6\u6216\u8005\u6570\u636e\u5e93\u7684\u5185\u5bb9\u8bfb\u5165 Worker \u8fdb\u7a0b\u7684\u5185\u5b58\u4e2d\u8fdb\u884c\u4f7f\u7528\u6765\u63d0\u901f\u3002 \u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u5927\u6587\u4ef6 json\uff0c\u91cc\u9762\u5b58\u7740\u4e00\u4efd\u9898\u5e93\uff0c\u4f8b\u5982\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 { \"0\" : { \"question\" : \"\u6cd5\u7684\u8c03\u6574\u5bf9\u8c61\u662f\uff08 \uff09\u3002\" , \"answer\" : { \"A\" : \"\u884c\u4e3a\u5173\u7cfb\" , \"B\" : \"\u601d\u60f3\u5173\u7cfb\" , \"C\" : \"\u5229\u76ca\u5173\u7cfb\" , \"D\" : \"\u5404\u79cd\u793e\u4f1a\u8d44\u6e90\" }, \"key\" : \"A\" , \"answer_type\" : 0 }, \"1\" : { \"question\" : \"\u6cd5\u5f8b\u4e0e\u5176\u4ed6\u793e\u4f1a\u89c4\u8303\u7684\u533a\u522b\u5728\u4e8e\uff08 \uff09\u3002\" , \"answer\" : { \"A\" : \"\u662f\u8c03\u6574\u4eba\u4eec\u884c\u4e3a\u7684\u89c4\u8303\" , \"B\" : \"\u6709\u7ea6\u675f\u529b\" , \"C\" : \"\u7531\u56fd\u5bb6\u5f3a\u5236\u529b\u4fdd\u8bc1\u6267\u884c\" , \"D\" : \"\u89c4\u5b9a\u5236\u88c1\u63aa\u65bd\" }, \"key\" : \"C\" , \"answer_type\" : 0 }, ..... } \u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 OnStart \u6765\u5b9e\u73b0\u4e00\u4e2a\uff0c\u5c06\u6b64\u6587\u4ef6\u8bfb\u53d6\u5230\u6bcf\u4e2a Worker \u8fdb\u7a0b\u4e2d\uff0c\u5e76\u4e14\u5feb\u901f\u53d6\u7528\u7684\u529f\u80fd\uff08\u4ee5\u4e0b\u505a\u4e86\u4e00\u4e2a\u7b80\u5355\u7684\u67e5\u9898\u529f\u80fd\uff09\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 <?php namespace Module\\Example ; use ZM\\Annotation\\Swoole\\OnStart ; use ZM\\Annotation\\CQ\\CQCommand ; use ZM\\Console\\Console ; class Hello { public static $tiku = []; /** * @OnStart(-1) */ public function onStart () { // \u6ce8\u610f\uff0c\u6b64\u51fd\u6570\u5c06\u4f1a\u5728\u6bcf\u4e2a Worker \u6267\u884c\u4e00\u6b21 $file = file_get_contents ( \"tiku.json\" ); //\u4ece\u6587\u4ef6\u8bfb\u53d6json $json = json_decode ( $file , true ); //json\u89e3\u6790 Hello :: $tiku = $json ; //\u5c06\u89e3\u6790\u540e\u7684\u6570\u7ec4\u4ee5\u9759\u6001\u53d8\u91cf\u7684\u65b9\u5f0f\u5b58\u5230\u6bcf\u4e2a Worker \u7684\u5185\u5b58\u4e2d Console :: success ( \"\u52a0\u8f7d\u9898\u5e93\u5b8c\u6210\uff01\" ); } /** * @CQCommand(\"\u627e\u9898\") */ public function findQuestion () { $tiku_id = ctx () -> getNumArg ( \"\u8bf7\u8f93\u5165\u9898\u76ee\u7684\u5e8f\u53f7\" ); if ( ! isset ( Hello :: $tiku [ $tiku_id ])) return \"\u9898\u76eeid\u4e3a\" . $tiku_id . \"\u7684\u9898\u76ee\u4e0d\u5b58\u5728\uff01\" ; $timu = Hello :: $tiku [ $tiku_id ]; $msg = \"\u9898\u76ee\u540d\u79f0\uff1a\" . $timu [ \"question\" ]; foreach ( $timu [ \"answer\" ] as $k => $v ) { $msg .= \" \\n \" . $k . \". \" . $v ; } $msg .= \" \\n \u6b63\u786e\u7b54\u6848\uff1a\" . $timu [ \"key\" ]; return $msg ; } } \u7ec8\u7aef\u6548\u679c\uff1a\uff08\u6211\u4eec\u5047\u8bbe\u8fd0\u884c\u6846\u67b6\u7684\u7535\u8111\u662f\u56db\u6838 CPU\uff09 1 2 3 4 [14:28:00] [S] [#0] \u52a0\u8f7d\u9898\u5e93\u5b8c\u6210\uff01 [14:28:00] [S] [#2] \u52a0\u8f7d\u9898\u5e93\u5b8c\u6210\uff01 [14:28:00] [S] [#1] \u52a0\u8f7d\u9898\u5e93\u5b8c\u6210\uff01 [14:28:00] [S] [#3] \u52a0\u8f7d\u9898\u5e93\u5b8c\u6210\uff01 \u804a\u5929\u6548\u679c\uff1a ) \u627e\u9898 1 ( \u9898\u76ee\u540d\u79f0\uff1a\u6cd5\u5f8b\u4e0e\u5176\u4ed6\u793e\u4f1a\u89c4\u8303\u7684\u533a\u522b\u5728\u4e8e\uff08 \uff09\u3002\\nA. \u662f\u8c03\u6574\u4eba\u4eec\u884c\u4e3a\u7684\u89c4\u8303\\nB. \u6709\u7ea6\u675f\u529b\\nC. \u7531\u56fd\u5bb6\u5f3a\u5236\u529b\u4fdd\u8bc1\u6267\u884c\\nD. \u89c4\u5b9a\u5236\u88c1\u63aa\u65bd\\n\u6b63\u786e\u7b54\u6848\uff1aC","title":"\u793a\u4f8b4\uff08\u4f7f\u7528 OnStart \u7ed9\u6240\u6709 Worker \u8fdb\u7a0b\u5199\u5165\u7f13\u5b58\u63d0\u901f\uff09"},{"location":"event/framework-annotations/#5","text":"1 2 3 4 5 6 7 /** * @OnTick(tick_ms=60000,worker_id=0) */ public function onCrawl() { $data = Foo::bar(); //\u8fd9\u91cc\u662f\u4f60\u81ea\u5df1\u5199\u7684\u8981\u722c\u7684\u63a5\u53e3\u7b49\u7b49\u4e00\u7cfb\u5217\u64cd\u4f5c LightCache::set(\"your_data_key_name\", $data); //\u5c06\u722c\u866b\u6570\u636e\u5b58\u5165 LightCache \u8f7b\u91cf\u7f13\u5b58 }","title":"\u793a\u4f8b5\uff08\u521b\u5efa\u6bcf\u5206\u949f\u81ea\u52a8\u6267\u884c\u7684\u722c\u866b\uff09"},{"location":"event/framework-annotations/#6","text":"\u5f00\u4e2a\u5751\uff0c\u4ee5\u540e\u586b\u3002\uff08 \u586b\u5751\u6807\u8bb0 \uff09","title":"\u793a\u4f8b6\uff08\u521b\u5efa\u4e00\u4e2a\u8fdc\u7a0b\u7ec8\u7aef\u547d\u4ee4\u5e76\u8c03\u8bd5\u6846\u67b6\uff09"},{"location":"event/middleware/","text":"\u4e2d\u95f4\u4ef6\u6ce8\u89e3 \u5bf9\u4e8e @RequestMapping \u7b49\u6ce8\u89e3\u7ed1\u5b9a\u7684\u4e8b\u4ef6\u51fd\u6570\uff0c\u8fd8\u652f\u6301\u4e2d\u95f4\u4ef6\uff0c\u53ef\u4ee5\u5b8c\u6210 Session \u4f1a\u8bdd\u3001\u8ba4\u8bc1\u3001\u65e5\u5fd7\u8bb0\u5f55\u7b49\u529f\u80fd\u3002\u4e2d\u95f4\u4ef6\u662f\u7528\u4e8e\u63a7\u5236 \u8bf7\u6c42\u5230\u8fbe \u548c \u54cd\u5e94\u8bf7\u6c42 \u7684\u6574\u4e2a\u6d41\u7a0b\u7684\u3002\u4ece\u4e00\u5b9a\u610f\u4e49\u4e0a\u6765\u8bf4\u76f8\u5f53\u4e8e\u5207\u9762\u7f16\u7a0b\uff08AOP\uff09\u3002 \u5728\u70b8\u6bdb\u6846\u67b6\u4e2d\uff0c\u4e2d\u95f4\u4ef6\u6700\u76f4\u767d\u7684\u610f\u601d\u5c31\u662f\u6ce8\u89e3\u4e8b\u4ef6\u6267\u884c\u524d\u3001\u6267\u884c\u540e\u3001\u6267\u884c\u8fc7\u7a0b\u4e2d\u53ef\u8fdb\u884c\u63d2\u5165\u4ee3\u7801\u4f46\u4e0d\u7834\u574f\u539f\u6709\u4ee3\u7801\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @\u4e2d\u95f4\u4ef61 @\u5e26\u6761\u4ef6\u7684\u6ce8\u89e31 function \u6211\u7684\u65b9\u6cd5() { blablabla... } //\u63d2\u5165\u4e2d\u95f4\u4ef6\uff0c\u4e0b\u9762\u662f\u6267\u884c\u6d41\u7a0b -> \u5224\u65ad\u6ce8\u89e31\u7684\u6267\u884c\u6761\u4ef6\u662f\u5426\u4e3atrue -> \u4e2d\u95f4\u4ef61\u7684\u524d\u7f6e\u63d2\u5165\u4ee3\u7801 -> \u6211\u7684\u65b9\u6cd5 -> \u4e2d\u95f4\u4ef61\u7684\u540e\u7f6e\u63d2\u5165\u4ee3\u7801 X -> \u6211\u7684\u65b9\u6cd5\u6709\u5f02\u5e38\u65f6\u6267\u884c\u4e2d\u95f4\u4ef61\u7684\u5f02\u5e38\u5904\u7406 //\u4e0d\u63d2\u5165\u4e2d\u95f4\u4ef6\uff0c\u4e0b\u9762\u662f\u6267\u884c\u6d41\u7a0b -> \u5224\u65ad\u6ce8\u89e31\u7684\u6267\u884c\u6761\u4ef6\u662f\u5426\u4e3atrue -> \u6211\u7684\u65b9\u6cd5 X -> \u6709\u5f02\u5e38\u5219\u76f4\u63a5\u8df3\u5230\u6700\u5916\u5c42\u88ab\u6846\u67b6\u6355\u83b7 \u4e2d\u95f4\u4ef6\u548c\u4e8b\u4ef6\u5206\u53d1\u5668\u662f\u7d27\u5bc6\u76f8\u8fde\u7684\uff0c\u70b8\u6bdb\u6846\u67b6\u7684\u5185\u90e8\u5206\u53d1\u5668\u5728\u5206\u53d1\u6ce8\u89e3\u4e8b\u4ef6\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u5224\u65ad\u5c06\u8981\u6267\u884c\u7684\u4e8b\u4ef6\u662f\u5426\u542b\u6709\u4e2d\u95f4\u4ef6\uff0c\u6846\u67b6\u5185\u90e8\u6267\u884c\u6d41\u7a0b\u56fe\u89c1\u4e0b\u4e00\u7ae0\uff1a\u4e8b\u4ef6\u5206\u53d1\u5668\u3002 \u5b9a\u4e49\u4e2d\u95f4\u4ef6 \u4e0b\u65b9\u5c31\u662f\u4e00\u4e2a\u53ef\u4ee5\u5728\u7ec8\u7aef\u6253\u5370\u8def\u7531\u51fd\u6570\u8fd0\u884c\u7684\u603b\u65f6\u95f4\u7684\u4e2d\u95f4\u4ef6\uff0c\u53ea\u9700\u7ed9\u4e2d\u95f4\u4ef6\u6807\u660e\u91cc\u9762\u7684 @MiddlewareClass \u5230\u4e2d\u95f4\u4ef6\u7684\u7c7b\u4e0a\u5c31\u53ef\u4ee5\u4e86\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 <?php namespace Module\\Middleware ; use Exception ; use ZM\\Annotation\\Http\\HandleAfter ; use ZM\\Annotation\\Http\\HandleBefore ; use ZM\\Annotation\\Http\\HandleException ; use ZM\\Annotation\\Http\\MiddlewareClass ; use ZM\\Console\\Console ; use ZM\\Http\\MiddlewareInterface ; /** * @MiddlewareClass(\"timer\") */ class TimerMiddleware implements MiddlewareInterface { private $starttime ; /** * @HandleBefore() * @return bool */ public function onBefore () { $this -> starttime = microtime ( true ); return true ; } /** * @HandleAfter() */ public function onAfter () { Console :: info ( \"Using \" . round (( microtime ( true ) - $this -> starttime ) * 1000 , 2 ) . \" ms.\" ); } /** * @HandleException(\\Exception::class) * @param Exception $e * @throws Exception */ public function onException ( Exception $e ) { Console :: error ( \"Using \" . round (( microtime ( true ) - $this -> starttime ) * 1000 , 2 ) . \" ms but an Exception occurred.\" ); throw $e ; } } \u6280\u672f\u8981\u7d20\uff1a \u5c06\u9700\u8981\u58f0\u660e\u4e3a\u4e2d\u95f4\u4ef6\u7684 class \u7c7b\u6807\u4e0a\u6ce8\u89e3 @MiddlewareClass \uff0c\u5e76\u5e26\u6709\u53c2\u6570\uff0c\u53c2\u6570\u4e3a\u4e2d\u95f4\u4ef6\u540d\u79f0\uff0c\u5b57\u7b26\u4e32\u5373\u53ef\u3002 \u4f7f\u7528 @MiddlewareClass \u7684\u9700\u8981\u5148 use\uff1a use ZM\\Annotation\\Http\\MiddlewareClass; \u3002 \u7c7b\u6210\u5458\u4e2d\u58f0\u660e\u6267\u884c\u524d\u63d2\u5165\u3001\u6267\u884c\u540e\u63d2\u5165\u548c\u5f02\u5e38\u6355\u83b7\u51fd\u6570\u4e5f\u9700\u8981\u6ce8\u89e3\uff0c\u5206\u522b\u662f @HandleBefore \uff0c @HandleAfter \uff0c @HandleException \uff0c\u90fd\u5728 ZM\\Annotation\\Http \u547d\u540d\u7a7a\u95f4\u4e0b\u3002 @HandleBefore \u7c7b\u4f3c @CQBefore \uff0c\u9700\u8981\u8fd4\u56de bool \u7c7b\u578b\u503c\uff0c\u5982\u679c\u4e0d\u8fd4\u56de\uff0c\u9ed8\u8ba4\u4e3a true\u3002\u5f53\u4e3a true \u65f6\uff0c\u5219\u4e0d\u4f1a\u963b\u65ad\u6267\u884c\u4e8b\u4ef6\u51fd\u6570\u672c\u8eab\u3002 \u4e2d\u95f4\u4ef6\u5185\u7684\u51fd\u6570\u4e0d\u53ef\u88ab\u7ed1\u5b9a\u4e3a\u6ce8\u89e3\u4e8b\u4ef6\u3002 @HandleException \u53ef\u4ee5\u5199\u591a\u4e2a\uff0c\u4f46\u5176\u4e2d\u7684\u53c2\u6570\u53ea\u80fd\u5199\u60f3\u8981\u6355\u83b7\u7684\u5f02\u5e38\u7684\u7c7b\u5168\u79f0\uff0c\u4f8b\u5982 \\Exception::class \u8fd4\u56de\u7684\u5c31\u662f \\\\Exception \uff0c \\ZM\\Exception\\InterruptException::class \u8fd4\u56de\u7684\u662f ZM\\\\Exception\\\\InterruptException \uff0c\u4e3e\u7684\u8fd9\u4e24\u4e2a\u4f8b\u5b50\u8fd9\u6837\u5199\u90fd\u662f\u53ef\u4ee5\u7684\u3002 \u5982\u679c @HandleException \u6709\u591a\u4e2a\u7684\u8bdd\uff0c\u5219\u4f1a\u6309\u7167\u58f0\u660e\u987a\u5e8f\u4f9d\u6b21\u8ba9\u5176\u6355\u83b7\uff0c\u770b\u5176\u662f\u5426\u4e3a\u8981\u88ab\u6355\u83b7\u7684\u9519\u8bef\u7684\u7c7b\u6216\u7236\u7c7b\u3002\u4f8b\u5982\u5728\u6700\u540e\u4e00\u4e2a @HandleException \u6355\u83b7 \\Throwable \u5219\u6700\u7ec8\u6b64\u4e2d\u95f4\u4ef6\u4f1a\u6355\u83b7\u6240\u6709\u5f02\u5e38\u3002 \u4e2d\u95f4\u4ef6\u5185\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u548c\u6ce8\u89e3\u4e8b\u4ef6\u6267\u884c\u7684\u5185\u5bb9\u540c\u4e00\u4e0a\u4e0b\u6587\uff0c\u4f8b\u5982 @RequestMapping \u4e0b\u4f60\u53ef\u4ee5\u4f7f\u7528 ctx()->getRequest() \uff0c @CQMessage \u53ef\u4ee5\u4f7f\u7528 ctx()->getMessage() \u7b49\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002 \u4f7f\u7528\u4e2d\u95f4\u4ef6 \u5982\u4e0a\u56fe\uff0c\u6211\u4eec\u4e3e\u4e86\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u6253\u5370\u51fa\u51fd\u6570\u6267\u884c\u7684\u65f6\u95f4\u3002\u6211\u4eec\u5047\u8bbe\u4e00\u4e2a\u9700\u8981\u8017\u65f6\u8f83\u957f\u7684\u51fd\u6570\uff1a 1 2 3 4 5 6 7 8 /** * @RequestMapping(\"/testTime\") * @Middleware(\"timer\") */ public function testTime() { zm_sleep(3); //\u7b49\u5f853\u79d2\u518d\u8fd4\u56de return \"OK!\"; } \u5728\u6267\u884c\u540e\uff0c\u4f60\u7684\u6267\u884c\u7ed3\u679c\u53ef\u80fd\u4e3a\uff1a 1 [11:18:56] [I] [#0] Using 3000.07 ms \u6216\u8005\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u5199\u5230\u7c7b\u4e0a\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 /** * @Middleware(\"timer\") */ class Hello { /** * @RequestMapping(\"/test/ping\") */ public function ping(){ return \"pong\"; } /** * @RequestMapping(\"/test/ping2\") */ public function ping2(){ return \"pong2\"; } } \u6548\u679c\u7b49\u540c\u4e8e\u7ed9\u6b64\u7c7b\u4e0b\u6bcf\u4e2a\u6ce8\u89e3\u4e8b\u4ef6\u5199\u4e00\u4e2a @Middleware \u3002 \u4f7f\u7528\u591a\u4e2a\u4e2d\u95f4\u4ef6 \u591a\u4e2a\u4f7f\u7528\u4e2d\u95f4\u4ef6\u53ef\u4ee5\u540c\u65f6\u751f\u6548\u591a\u4e2a\u6d41\u7a0b\u7684\u4e2d\u95f4\u4ef6\u3002\u8fd9\u91cc\u8981\u6ce8\u610f\uff0c\u591a\u4e2a\u4e2d\u95f4\u4ef6\u4e2d\uff0c @HandleBefore \u65b9\u6cd5\u4e2d\u5982\u679c\u8fd4\u56de\u4e86 false \uff0c\u5219\u4e0d\u4f1a\u6267\u884c\u63a5\u4e0b\u6765\u7684\u4e2d\u95f4\u4ef6\u548c\u4e8b\u4ef6\u672c\u8eab\u8981\u89e6\u53d1\u7684\u51fd\u6570\uff0c\u76f4\u63a5\u8df3\u5230\u6700\u540e\u6b64\u4e2d\u95f4\u4ef6\u7684 @HandleAfter \u65b9\u6cd5\u3002 1 2 3 4 5 6 /** * @CQCommand(\"\u4f60\u597d\") * @Middleware(\"timer1\") * @Middleware(\"timer2\") */ public function hello() { return \"\u6210\u529f\u6267\u884c\uff01\"; } \u4f7f\u7528\u4e2d\u95f4\u4ef6\u6355\u83b7\u5f02\u5e38 \u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u7528\u6237\u5b9a\u4e49\u7684\u51fd\u6570\u5185\u629b\u51fa\u4e86\u5f02\u5e38\uff08\u5305\u62ec message \u7b49\u4e8b\u4ef6\uff09\uff0c\u4f1a\u8fd4\u56de\u5230\u6846\u67b6\u57fa\u5c42\u53bb\u8fd4\u56de\u9ed8\u8ba4\u5b9a\u4e49\u7684\u5185\u5bb9\u3002\u5982\u679c\u60f3\u81ea\u5df1\u6355\u83b7\u53ef\u4ee5\u4f7f\u7528 try/catch \uff0c\u4f46\u4e0d\u65b9\u4fbf\u590d\u7528\uff0c\u591a\u5904\u4f7f\u7528\u7684\u8bdd\u5c31\u9700\u8981\u91cd\u590d\u5199\u4ee3\u7801\u3002\u8fd9\u91cc\u53ef\u4ee5\u4f7f\u7528\u4e2d\u95f4\u4ef6\u7684\u5f02\u5e38\u5904\u7406\u65b9\u4fbf\u5730\u6355\u83b7\u9519\u8bef\u3002\u8fd9\u4e2a\u51fd\u6570\u5199\u5230\u4e2d\u95f4\u4ef6\u7c7b\u91cc\u5373\u53ef 1 2 3 4 5 6 7 /** * @HandleException(\\Exception::class) * @param Exception|null $e */ public function onThrowing(?Exception $e) { ctx()->getResponse()->endWithStatus(500, \"Error on this.\"); } \u8fd9\u91cc\u7684 @HandleException \u4e2d\u7684\u53c2\u6570\u4e3a\u8981\u6355\u83b7\u7684\u7c7b\u540d\uff0c\u6ce8\u610f\u8fd9\u91cc\u9762\u7684\u7c7b\u540d\u7684\u547d\u540d\u7a7a\u95f4\u9700\u8981\u5199\u5168\u79f0\uff0c\u4e0d\u80fd\u4e0a\u9762 use \u518d\u4f7f\u7528\uff0c\u5426\u5219\u4f1a\u65e0\u6cd5\u627e\u5230\u5f02\u5e38\u7c7b\u3002 ctx() \u4e3a\u83b7\u53d6\u5f53\u524d\u534f\u7a0b\u7a7a\u95f4\u7ed1\u5b9a\u7684 request \u548c response \u5bf9\u8c61\u3002","title":"\u4e2d\u95f4\u4ef6\u6ce8\u89e3"},{"location":"event/middleware/#_1","text":"\u5bf9\u4e8e @RequestMapping \u7b49\u6ce8\u89e3\u7ed1\u5b9a\u7684\u4e8b\u4ef6\u51fd\u6570\uff0c\u8fd8\u652f\u6301\u4e2d\u95f4\u4ef6\uff0c\u53ef\u4ee5\u5b8c\u6210 Session \u4f1a\u8bdd\u3001\u8ba4\u8bc1\u3001\u65e5\u5fd7\u8bb0\u5f55\u7b49\u529f\u80fd\u3002\u4e2d\u95f4\u4ef6\u662f\u7528\u4e8e\u63a7\u5236 \u8bf7\u6c42\u5230\u8fbe \u548c \u54cd\u5e94\u8bf7\u6c42 \u7684\u6574\u4e2a\u6d41\u7a0b\u7684\u3002\u4ece\u4e00\u5b9a\u610f\u4e49\u4e0a\u6765\u8bf4\u76f8\u5f53\u4e8e\u5207\u9762\u7f16\u7a0b\uff08AOP\uff09\u3002 \u5728\u70b8\u6bdb\u6846\u67b6\u4e2d\uff0c\u4e2d\u95f4\u4ef6\u6700\u76f4\u767d\u7684\u610f\u601d\u5c31\u662f\u6ce8\u89e3\u4e8b\u4ef6\u6267\u884c\u524d\u3001\u6267\u884c\u540e\u3001\u6267\u884c\u8fc7\u7a0b\u4e2d\u53ef\u8fdb\u884c\u63d2\u5165\u4ee3\u7801\u4f46\u4e0d\u7834\u574f\u539f\u6709\u4ee3\u7801\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 @\u4e2d\u95f4\u4ef61 @\u5e26\u6761\u4ef6\u7684\u6ce8\u89e31 function \u6211\u7684\u65b9\u6cd5() { blablabla... } //\u63d2\u5165\u4e2d\u95f4\u4ef6\uff0c\u4e0b\u9762\u662f\u6267\u884c\u6d41\u7a0b -> \u5224\u65ad\u6ce8\u89e31\u7684\u6267\u884c\u6761\u4ef6\u662f\u5426\u4e3atrue -> \u4e2d\u95f4\u4ef61\u7684\u524d\u7f6e\u63d2\u5165\u4ee3\u7801 -> \u6211\u7684\u65b9\u6cd5 -> \u4e2d\u95f4\u4ef61\u7684\u540e\u7f6e\u63d2\u5165\u4ee3\u7801 X -> \u6211\u7684\u65b9\u6cd5\u6709\u5f02\u5e38\u65f6\u6267\u884c\u4e2d\u95f4\u4ef61\u7684\u5f02\u5e38\u5904\u7406 //\u4e0d\u63d2\u5165\u4e2d\u95f4\u4ef6\uff0c\u4e0b\u9762\u662f\u6267\u884c\u6d41\u7a0b -> \u5224\u65ad\u6ce8\u89e31\u7684\u6267\u884c\u6761\u4ef6\u662f\u5426\u4e3atrue -> \u6211\u7684\u65b9\u6cd5 X -> \u6709\u5f02\u5e38\u5219\u76f4\u63a5\u8df3\u5230\u6700\u5916\u5c42\u88ab\u6846\u67b6\u6355\u83b7 \u4e2d\u95f4\u4ef6\u548c\u4e8b\u4ef6\u5206\u53d1\u5668\u662f\u7d27\u5bc6\u76f8\u8fde\u7684\uff0c\u70b8\u6bdb\u6846\u67b6\u7684\u5185\u90e8\u5206\u53d1\u5668\u5728\u5206\u53d1\u6ce8\u89e3\u4e8b\u4ef6\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u5224\u65ad\u5c06\u8981\u6267\u884c\u7684\u4e8b\u4ef6\u662f\u5426\u542b\u6709\u4e2d\u95f4\u4ef6\uff0c\u6846\u67b6\u5185\u90e8\u6267\u884c\u6d41\u7a0b\u56fe\u89c1\u4e0b\u4e00\u7ae0\uff1a\u4e8b\u4ef6\u5206\u53d1\u5668\u3002","title":"\u4e2d\u95f4\u4ef6\u6ce8\u89e3"},{"location":"event/middleware/#_2","text":"\u4e0b\u65b9\u5c31\u662f\u4e00\u4e2a\u53ef\u4ee5\u5728\u7ec8\u7aef\u6253\u5370\u8def\u7531\u51fd\u6570\u8fd0\u884c\u7684\u603b\u65f6\u95f4\u7684\u4e2d\u95f4\u4ef6\uff0c\u53ea\u9700\u7ed9\u4e2d\u95f4\u4ef6\u6807\u660e\u91cc\u9762\u7684 @MiddlewareClass \u5230\u4e2d\u95f4\u4ef6\u7684\u7c7b\u4e0a\u5c31\u53ef\u4ee5\u4e86\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 <?php namespace Module\\Middleware ; use Exception ; use ZM\\Annotation\\Http\\HandleAfter ; use ZM\\Annotation\\Http\\HandleBefore ; use ZM\\Annotation\\Http\\HandleException ; use ZM\\Annotation\\Http\\MiddlewareClass ; use ZM\\Console\\Console ; use ZM\\Http\\MiddlewareInterface ; /** * @MiddlewareClass(\"timer\") */ class TimerMiddleware implements MiddlewareInterface { private $starttime ; /** * @HandleBefore() * @return bool */ public function onBefore () { $this -> starttime = microtime ( true ); return true ; } /** * @HandleAfter() */ public function onAfter () { Console :: info ( \"Using \" . round (( microtime ( true ) - $this -> starttime ) * 1000 , 2 ) . \" ms.\" ); } /** * @HandleException(\\Exception::class) * @param Exception $e * @throws Exception */ public function onException ( Exception $e ) { Console :: error ( \"Using \" . round (( microtime ( true ) - $this -> starttime ) * 1000 , 2 ) . \" ms but an Exception occurred.\" ); throw $e ; } } \u6280\u672f\u8981\u7d20\uff1a \u5c06\u9700\u8981\u58f0\u660e\u4e3a\u4e2d\u95f4\u4ef6\u7684 class \u7c7b\u6807\u4e0a\u6ce8\u89e3 @MiddlewareClass \uff0c\u5e76\u5e26\u6709\u53c2\u6570\uff0c\u53c2\u6570\u4e3a\u4e2d\u95f4\u4ef6\u540d\u79f0\uff0c\u5b57\u7b26\u4e32\u5373\u53ef\u3002 \u4f7f\u7528 @MiddlewareClass \u7684\u9700\u8981\u5148 use\uff1a use ZM\\Annotation\\Http\\MiddlewareClass; \u3002 \u7c7b\u6210\u5458\u4e2d\u58f0\u660e\u6267\u884c\u524d\u63d2\u5165\u3001\u6267\u884c\u540e\u63d2\u5165\u548c\u5f02\u5e38\u6355\u83b7\u51fd\u6570\u4e5f\u9700\u8981\u6ce8\u89e3\uff0c\u5206\u522b\u662f @HandleBefore \uff0c @HandleAfter \uff0c @HandleException \uff0c\u90fd\u5728 ZM\\Annotation\\Http \u547d\u540d\u7a7a\u95f4\u4e0b\u3002 @HandleBefore \u7c7b\u4f3c @CQBefore \uff0c\u9700\u8981\u8fd4\u56de bool \u7c7b\u578b\u503c\uff0c\u5982\u679c\u4e0d\u8fd4\u56de\uff0c\u9ed8\u8ba4\u4e3a true\u3002\u5f53\u4e3a true \u65f6\uff0c\u5219\u4e0d\u4f1a\u963b\u65ad\u6267\u884c\u4e8b\u4ef6\u51fd\u6570\u672c\u8eab\u3002 \u4e2d\u95f4\u4ef6\u5185\u7684\u51fd\u6570\u4e0d\u53ef\u88ab\u7ed1\u5b9a\u4e3a\u6ce8\u89e3\u4e8b\u4ef6\u3002 @HandleException \u53ef\u4ee5\u5199\u591a\u4e2a\uff0c\u4f46\u5176\u4e2d\u7684\u53c2\u6570\u53ea\u80fd\u5199\u60f3\u8981\u6355\u83b7\u7684\u5f02\u5e38\u7684\u7c7b\u5168\u79f0\uff0c\u4f8b\u5982 \\Exception::class \u8fd4\u56de\u7684\u5c31\u662f \\\\Exception \uff0c \\ZM\\Exception\\InterruptException::class \u8fd4\u56de\u7684\u662f ZM\\\\Exception\\\\InterruptException \uff0c\u4e3e\u7684\u8fd9\u4e24\u4e2a\u4f8b\u5b50\u8fd9\u6837\u5199\u90fd\u662f\u53ef\u4ee5\u7684\u3002 \u5982\u679c @HandleException \u6709\u591a\u4e2a\u7684\u8bdd\uff0c\u5219\u4f1a\u6309\u7167\u58f0\u660e\u987a\u5e8f\u4f9d\u6b21\u8ba9\u5176\u6355\u83b7\uff0c\u770b\u5176\u662f\u5426\u4e3a\u8981\u88ab\u6355\u83b7\u7684\u9519\u8bef\u7684\u7c7b\u6216\u7236\u7c7b\u3002\u4f8b\u5982\u5728\u6700\u540e\u4e00\u4e2a @HandleException \u6355\u83b7 \\Throwable \u5219\u6700\u7ec8\u6b64\u4e2d\u95f4\u4ef6\u4f1a\u6355\u83b7\u6240\u6709\u5f02\u5e38\u3002 \u4e2d\u95f4\u4ef6\u5185\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u548c\u6ce8\u89e3\u4e8b\u4ef6\u6267\u884c\u7684\u5185\u5bb9\u540c\u4e00\u4e0a\u4e0b\u6587\uff0c\u4f8b\u5982 @RequestMapping \u4e0b\u4f60\u53ef\u4ee5\u4f7f\u7528 ctx()->getRequest() \uff0c @CQMessage \u53ef\u4ee5\u4f7f\u7528 ctx()->getMessage() \u7b49\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002","title":"\u5b9a\u4e49\u4e2d\u95f4\u4ef6"},{"location":"event/middleware/#_3","text":"\u5982\u4e0a\u56fe\uff0c\u6211\u4eec\u4e3e\u4e86\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u6253\u5370\u51fa\u51fd\u6570\u6267\u884c\u7684\u65f6\u95f4\u3002\u6211\u4eec\u5047\u8bbe\u4e00\u4e2a\u9700\u8981\u8017\u65f6\u8f83\u957f\u7684\u51fd\u6570\uff1a 1 2 3 4 5 6 7 8 /** * @RequestMapping(\"/testTime\") * @Middleware(\"timer\") */ public function testTime() { zm_sleep(3); //\u7b49\u5f853\u79d2\u518d\u8fd4\u56de return \"OK!\"; } \u5728\u6267\u884c\u540e\uff0c\u4f60\u7684\u6267\u884c\u7ed3\u679c\u53ef\u80fd\u4e3a\uff1a 1 [11:18:56] [I] [#0] Using 3000.07 ms \u6216\u8005\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c06\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u5199\u5230\u7c7b\u4e0a\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 /** * @Middleware(\"timer\") */ class Hello { /** * @RequestMapping(\"/test/ping\") */ public function ping(){ return \"pong\"; } /** * @RequestMapping(\"/test/ping2\") */ public function ping2(){ return \"pong2\"; } } \u6548\u679c\u7b49\u540c\u4e8e\u7ed9\u6b64\u7c7b\u4e0b\u6bcf\u4e2a\u6ce8\u89e3\u4e8b\u4ef6\u5199\u4e00\u4e2a @Middleware \u3002","title":"\u4f7f\u7528\u4e2d\u95f4\u4ef6"},{"location":"event/middleware/#_4","text":"\u591a\u4e2a\u4f7f\u7528\u4e2d\u95f4\u4ef6\u53ef\u4ee5\u540c\u65f6\u751f\u6548\u591a\u4e2a\u6d41\u7a0b\u7684\u4e2d\u95f4\u4ef6\u3002\u8fd9\u91cc\u8981\u6ce8\u610f\uff0c\u591a\u4e2a\u4e2d\u95f4\u4ef6\u4e2d\uff0c @HandleBefore \u65b9\u6cd5\u4e2d\u5982\u679c\u8fd4\u56de\u4e86 false \uff0c\u5219\u4e0d\u4f1a\u6267\u884c\u63a5\u4e0b\u6765\u7684\u4e2d\u95f4\u4ef6\u548c\u4e8b\u4ef6\u672c\u8eab\u8981\u89e6\u53d1\u7684\u51fd\u6570\uff0c\u76f4\u63a5\u8df3\u5230\u6700\u540e\u6b64\u4e2d\u95f4\u4ef6\u7684 @HandleAfter \u65b9\u6cd5\u3002 1 2 3 4 5 6 /** * @CQCommand(\"\u4f60\u597d\") * @Middleware(\"timer1\") * @Middleware(\"timer2\") */ public function hello() { return \"\u6210\u529f\u6267\u884c\uff01\"; }","title":"\u4f7f\u7528\u591a\u4e2a\u4e2d\u95f4\u4ef6"},{"location":"event/middleware/#_5","text":"\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u7528\u6237\u5b9a\u4e49\u7684\u51fd\u6570\u5185\u629b\u51fa\u4e86\u5f02\u5e38\uff08\u5305\u62ec message \u7b49\u4e8b\u4ef6\uff09\uff0c\u4f1a\u8fd4\u56de\u5230\u6846\u67b6\u57fa\u5c42\u53bb\u8fd4\u56de\u9ed8\u8ba4\u5b9a\u4e49\u7684\u5185\u5bb9\u3002\u5982\u679c\u60f3\u81ea\u5df1\u6355\u83b7\u53ef\u4ee5\u4f7f\u7528 try/catch \uff0c\u4f46\u4e0d\u65b9\u4fbf\u590d\u7528\uff0c\u591a\u5904\u4f7f\u7528\u7684\u8bdd\u5c31\u9700\u8981\u91cd\u590d\u5199\u4ee3\u7801\u3002\u8fd9\u91cc\u53ef\u4ee5\u4f7f\u7528\u4e2d\u95f4\u4ef6\u7684\u5f02\u5e38\u5904\u7406\u65b9\u4fbf\u5730\u6355\u83b7\u9519\u8bef\u3002\u8fd9\u4e2a\u51fd\u6570\u5199\u5230\u4e2d\u95f4\u4ef6\u7c7b\u91cc\u5373\u53ef 1 2 3 4 5 6 7 /** * @HandleException(\\Exception::class) * @param Exception|null $e */ public function onThrowing(?Exception $e) { ctx()->getResponse()->endWithStatus(500, \"Error on this.\"); } \u8fd9\u91cc\u7684 @HandleException \u4e2d\u7684\u53c2\u6570\u4e3a\u8981\u6355\u83b7\u7684\u7c7b\u540d\uff0c\u6ce8\u610f\u8fd9\u91cc\u9762\u7684\u7c7b\u540d\u7684\u547d\u540d\u7a7a\u95f4\u9700\u8981\u5199\u5168\u79f0\uff0c\u4e0d\u80fd\u4e0a\u9762 use \u518d\u4f7f\u7528\uff0c\u5426\u5219\u4f1a\u65e0\u6cd5\u627e\u5230\u5f02\u5e38\u7c7b\u3002 ctx() \u4e3a\u83b7\u53d6\u5f53\u524d\u534f\u7a0b\u7a7a\u95f4\u7ed1\u5b9a\u7684 request \u548c response \u5bf9\u8c61\u3002","title":"\u4f7f\u7528\u4e2d\u95f4\u4ef6\u6355\u83b7\u5f02\u5e38"},{"location":"event/robot-annotations/","text":"\u673a\u5668\u4eba\u6ce8\u89e3\u4e8b\u4ef6 QQ \u673a\u5668\u4eba\u4e8b\u4ef6\u662f\u6307 CQHTTP \u63d2\u4ef6\u53d1\u6765\u7684 Event \u4e8b\u4ef6\uff0c\u88ab\u6846\u67b6\u5904\u7406\u540e\u89e6\u53d1\u5230\u5355\u4e2a\u7c7b\u4e2d\u65b9\u6cd5\u7684\u4e8b\u4ef6\u3002 \u4e3a\u4e86\u4fbf\u4e8e\u5f00\u53d1\uff0c\u8fd9\u91cc\u7684\u6ce8\u89e3\u7c7b\u5bf9\u5e94 CQHTTP \u63d2\u4ef6\u8fd4\u56de\u7684 post_type \u7c7b\u578b\uff0c\u5bf9\u53f7\u5165\u5ea7\u5373\u53ef\u3002 \u63d0\u793a \u5728\u4f7f\u7528\u6ce8\u89e3\u7ed1\u5b9a\u4e8b\u4ef6\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u65e0 \u5fc5\u9700 \u53c2\u6570\uff0c\u53ef\u4e00\u4e2a\u53c2\u6570\u4e5f\u4e0d\u5199\uff0c\u6548\u679c\u5c31\u662f\u6b64\u4e8b\u4ef6\u4efb\u4f55\u60c5\u51b5\u4e0b\u90fd\u4f1a\u8c03\u7528\u6b64\u65b9\u6cd5\u3002\u4f8b\u5982\uff1a @CQMessage() \u4e8b\u4ef6\u662f\u7528\u6237\u9700\u8981\u4ece OneBot \u88ab\u52a8\u63a5\u6536\u7684\u6570\u636e\uff0c\u6709\u4ee5\u4e0b\u51e0\u4e2a\u5927\u7c7b\uff1a \u6d88\u606f\u4e8b\u4ef6 \uff0c\u5305\u62ec\u79c1\u804a\u6d88\u606f\u3001\u7fa4\u6d88\u606f\u7b49\uff0c\u88ab @CQCommand \uff0c @CQMessage \u6ce8\u89e3\u5904\u7406\u3002 \u901a\u77e5\u4e8b\u4ef6 \uff0c\u5305\u62ec\u7fa4\u6210\u5458\u53d8\u52a8\u3001\u597d\u53cb\u53d8\u52a8\u7b49\uff0c\u88ab @CQNotice \u6ce8\u89e3\u4e8b\u4ef6\u5904\u7406\u3002 \u8bf7\u6c42\u4e8b\u4ef6 \uff0c\u5305\u62ec\u52a0\u7fa4\u8bf7\u6c42\u3001\u52a0\u597d\u53cb\u8bf7\u6c42\u7b49\uff0c\u88ab @CQRequest \u6ce8\u89e3\u4e8b\u4ef6\u5904\u7406\u3002 \u5143\u4e8b\u4ef6 \uff0c\u5305\u62ec OneBot \u751f\u547d\u5468\u671f\u3001\u5fc3\u8df3\u7b49\uff0c\u88ab @CQMetaEvent \u6ce8\u89e3\u4e8b\u4ef6\u5904\u7406\u3002 \u6ce8\u89e3\u4e8b\u4ef6\u53c2\u7167\u8868 \u6ce8\u89e3\u540d\u79f0 \u7c7b\u6240\u5728\u547d\u540d\u5168\u79f0 \u4f5c\u7528 @CQBefore \\ZM\\Annotation\\CQBefore OneBot \u5404\u7c7b\u4e8b\u4ef6\u524d\u89e6\u53d1\u7684\uff0c\u53ef\u5f53\u4f5c\u4e8b\u4ef6\u8fc7\u6ee4\u5668\u4f7f\u7528 @CQAfter \\ZM\\Annotation\\CQAfter OneBot \u5404\u7c7b\u4e8b\u4ef6\u540e\u89e6\u53d1\u7684 @CQMessage \\ZM\\Annotation\\CQMessage OneBot \u4e2d\u6d88\u606f\u7c7b\u4e8b\u4ef6\u7684\u89e6\u53d1\uff08\u673a\u5668\u4eba\u6d88\u606f\uff09\u4e8b\u4ef6 @CQCommand \\ZM\\Annotation\\CQCommand OneBot \u4e2d\u6d88\u606f\u7c7b\u4e8b\u4ef6\u7684\u89e6\u53d1\uff08\u673a\u5668\u4eba\u6d88\u606f\uff09\u4e8b\u4ef6\uff0c\u4f46\u662f\u88ab\u5c01\u88c5\u4e3a\u6307\u4ee4\u578b\u7684\uff0c\u65e0\u9700\u81ea\u5df1\u5207\u5272\u547d\u4ee4\u5f0f @CQNotice \\ZM\\Annotation\\CQNotice OneBot \u4e2d\u901a\u77e5\u7c7b\u4e8b\u4ef6\u7684\u89e6\u53d1\uff08\u673a\u5668\u4eba\u6d88\u606f\uff09\u4e8b\u4ef6 @CQRequest \\ZM\\Annotation\\CQRequest OneBot \u4e2d\u8bf7\u6c42\u7c7b\u4e8b\u4ef6\u7684\u89e6\u53d1\uff08\u673a\u5668\u4eba\u6d88\u606f\uff09\u4e8b\u4ef6\uff0c\u4e00\u822c\u5e26\u6709\u8bf7\u6c42\u4fe1\u606f\uff0c\u53ef\u8054\u52a8\u76f8\u5173\u54cd\u5e94\u7684 API \u5b8c\u6210\u529f\u80fd\u7f16\u5199 @CQMetaEvent \\ZM\\Annotation\\CQMetaEvent OneBot \u4e2d\u6d89\u53ca OneBot \u5b9e\u73b0\u672c\u8eab\u7684\u4e00\u4e9b\u548c\u673a\u5668\u4eba\u4e8b\u4ef6\u65e0\u5173\u7684\u5143\u4e8b\u4ef6\uff0c\u6bd4\u5982 WS \u8fde\u63a5\u7684\u5fc3\u8df3\u5305 CQMessage() QQ \u6536\u5230\u6d88\u606f\u540e\u89e6\u53d1\u7684\u4e8b\u4ef6\u5bf9\u5e94\u6ce8\u89e3\u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @CQMessage \u89e6\u53d1\u524d\u63d0 \u5f53 post_type \u4e3a message \u65f6\u89e6\u53d1 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\CQ\\CQMessage \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u5f53\u65b9\u6cd5\u8fd4\u56de\u5b57\u7b26\u4e32\u65f6\uff0c\u6548\u679c\u7b49\u540c\u4e8e\u6267\u884c ctx()->reply(\"xxx\") \u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 message_type string \uff0c\u652f\u6301\u586b\u5165 private \uff0c group \u9650\u5b9a\u6d88\u606f\u4e8b\u4ef6\u7684\u6765\u6e90\u7c7b\u578b\uff0c\u5982\u79c1\u804a\u6216\u7fa4\u6d88\u606f \u7a7a user_id int64 \u6216 string \u9650\u5b9a\u6d88\u606f\u53d1\u9001\u7528\u6237 ID\uff08QQ \u53f7\uff09 \u7a7a group_id int64 \u6216 string \u9650\u5b9a\u6d88\u606f\u53d1\u9001\u6765\u6e90\u7fa4 ID\uff08QQ \u7fa4\u53f7\uff09 \u7a7a message string \u9650\u5b9a\u6d88\u606f\u5185\u5bb9\u6587\u672c \u7a7a level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20 \u7528\u6cd5 \u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\u7684\u6ce8\u91ca\u7528\u9014\u5c31\u662f\uff1a \u5728\u7528\u6237 QQ \u4e3a 123456 \u7684\u7528\u6237\u79c1\u804a\u7ed9\u673a\u5668\u4eba\u53d1\u6d88\u606f\u540e\u673a\u5668\u4eba\u56de\u590d\u5185\u5bb9\u3002 \u7528\u6237\u53d1\u9001\u6587\u5b57\u4e3a hello \u65f6\u8fd4\u56de \u4f60\u597d\u554a\uff0cxxx \u7684\u6d88\u606f\u3002 \u4ee3\u7801 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 <?php namespace Module\\Example ; use ZM\\Annotation\\CQ\\CQMessage ; class Hello { /** * @CQMessage(message_type=\"private\",user_id=123456) */ public function test () { return \"\u4f60\u548c\u673a\u5668\u4eba\u79c1\u804a\u53d1\u9001\u4e86\u8fd9\u4e9b\u6587\u672c\uff1a\" . ctx () -> getMessage (); } /** * @CQMessage(message=\"hello\") */ public function hello () { return \"\u4f60\u597d\u554a\uff0c\" . ctx () -> getUserId (); } } \u6548\u679c ) \u5047\u8bbe\u6211\u662f\u79c1\u804a\u673a\u5668\u4eba ( \u4f60\u548c\u673a\u5668\u4eba\u79c1\u804a\u53d1\u9001\u4e86\u8fd9\u4e9b\u6587\u672c\uff1a\u5047\u8bbe\u6211\u662f\u79c1\u804a\u673a\u5668\u4eba ^ \u5047\u8bbe\u6211\u73b0\u5728\u5207\u5230\u7fa4\u91cc\uff0c\u5728\u7fa4\u91cc\u53d1hello ) hello ( \u4f60\u597d\u554a\uff0c123456 CQCommand() \u6b64\u6ce8\u89e3\u662f\u5bf9 @CQMessage \u7c7b\u522b\u7684\u518d\u5c01\u88c5\uff0c\u662f\u547d\u4ee4\u89e3\u6790\u683c\u5f0f\u5904\u7406\u6d88\u606f\u7684\u5229\u5668\u3002\u4f8b\u5982\uff0c\u4f60\u60f3\u5199\u4e00\u4e2a\u75ab\u60c5\u4e0a\u62a5\uff0c\u6307\u4ee4\u662f \u75ab\u60c5 \u57ce\u5e02\u540d\u79f0 \uff0c\u90a3\u4e48\u6b64\u65b9\u5f0f\u6765\u89e3\u6790\u7528\u6237\u6d88\u606f\u4f1a\u66f4\u52a0\u65b9\u4fbf\u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @CQCommand \u89e6\u53d1\u524d\u63d0 \u5f53\u6839\u636e\u53c2\u6570\u89c4\u5219\u5339\u914d\u5230\u7528\u6237\u547d\u4ee4\u5f0f\u6d88\u606f\u65f6\u89e6\u53d1 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\CQ\\CQCommand \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u5f53\u65b9\u6cd5\u8fd4\u56de\u5b57\u7b26\u4e32\u65f6\uff0c\u6548\u679c\u7b49\u540c\u4e8e\u6267\u884c ctx()->reply(\"xxx\") \u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 match string \u5339\u914d\u7b2c\u4e00\u4e2a\u8bcd\u7684\u547d\u4ee4\u5f0f\u6d88\u606f\uff0c\u5982 \u5929\u6c14 \u5317\u4eac \u4e2d\u7684 \u5929\u6c14 \u7a7a pattern string \u6839\u636e * \u53f7\u901a\u914d\u7b26\u8fdb\u884c\u6a21\u5f0f\u5339\u914d\u7528\u6237\u6d88\u606f\uff0c\u5982 \u67e5\u8be2*\u5929\u6c14 \u7a7a regex string \uff0c\u9650\u5b9a\u6b63\u5219\u8868\u8fbe\u5f0f \u5339\u914d\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u5230\u7684\u7528\u6237\u6d88\u606f \u7a7a start_with string \u5339\u914d\u6d88\u606f\u5f00\u5934\u76f8\u5339\u914d\u7684\u6d88\u606f\uff0c\u5982 \u6211\u53eb\u70b8\u6bdb \uff0c\u8fd9\u91cc\u5199 \u6211\u53eb \u7a7a end_with string \u5339\u914d\u6d88\u606f\u7ed3\u5c3e\u76f8\u5339\u914d\u7684\u6d88\u606f\uff0c\u4ee5 start_with \u7c7b\u63a8 \u7a7a keyword string \u5339\u914d\u6d88\u606f\u4e2d\u6709\u76f8\u5173\u5173\u952e\u8bcd\u7684\u6d88\u606f \u7a7a alias array[string] match \u5339\u914d\u5230\u547d\u4ee4\u7684\u522b\u540d\uff0c\u6570\u7ec4\u5f62\u5f0f {} message_type string \uff0c\u652f\u6301\u586b\u5165 private \uff0c group \u9650\u5b9a\u6d88\u606f\u4e8b\u4ef6\u7684\u6765\u6e90\u7c7b\u578b\uff0c\u540c @CQMessage \u7a7a user_id int64 \u6216 string \u9650\u5b9a\u6d88\u606f\u53d1\u9001\u7528\u6237 ID\uff0c\u540c @CQMessage \u7a7a group_id int64 \u6216 string \u9650\u5b9a\u6d88\u606f\u53d1\u9001\u6765\u6e90\u7fa4 ID\uff0c\u540c @CQMessage \u7a7a level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20 \u6ce8\u610f \u5728 @CQCommand \u6ce8\u89e3\u4e8b\u4ef6\u4e2d\uff0c\u4ece match \u5230 keyword \u516d\u4e2a\u53c2\u6570\u4e2d\uff0c\u5fc5\u987b\u4e14\u53ea\u80fd\u5b9a\u4e49\u4e00\u4e2a\uff0c alias \u76ee\u524d\u53ea\u80fd\u548c match \u53c2\u6570\u540c\u65f6\u4f7f\u7528\uff1b \u6846\u67b6\u5185\u90e8\u5bf9\u4e8e\u540c\u4e00\u6761\u6d88\u606f\u4e8b\u4ef6\uff0c\u4f18\u5148\u5904\u7406 @CQCommand \u6ce8\u89e3\u4e8b\u4ef6\uff0c\u5982\u679c\u672a\u5339\u914d\u5230\u4efb\u4f55\u6ce8\u89e3\u4e8b\u4ef6\uff0c\u5219\u624d\u4f1a\u7ee7\u7eed\u6267\u884c @CQMessage \u6ce8\u89e3\u4e8b\u4ef6\u3002 \u53c2\u6570 match \u5339\u914d\u6a21\u5f0f\u662f\uff1a\u9047\u5230\u7a7a\u683c\u3001\u6362\u884c\u5c31\u4f1a\u5207\u5206\uff0c\u6bd4\u5982 \u70b9\u6b4c xxx yyy \u4f1a\u88ab\u5206\u5272\u4e3a [\u70b9\u6b4c,xxx,yyy] \uff0c\u7136\u540e\u62bd\u53d6\u7b2c\u4e00\u4e2a\u8bcd\u505a\u4e3a\u547d\u4ee4\u53bb\u5339\u914d\uff0c\u5269\u4e0b\u7684\u4e3a\u53c2\u6570\u3002 \u53c2\u6570 pattern \u5339\u914d\u6a21\u5f0f\u662f\uff1a* \u53f7\u4f4d\u7f6e\u53d8\u6210\u53c2\u6570\uff0c\u6bd4\u5982 \u4ece*\u5230*\u7684\u968f\u673a\u6570 \uff0c\u6211\u4eec\u8f93\u5165 \u4ece1\u52309\u7684\u968f\u673a\u6570 \uff0c\u6210\u529f\u5339\u914d\uff0c\u53c2\u6570\u5217\u8868\uff1a [1,9] \u3002 \u53c2\u6570 regex \u5339\u914d\u6a21\u5f0f\u4e3a PHP \u6807\u51c6\u7684 pcre \u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u6bd4\u5982 ([01][0-9][2][0-3]):[0-5][0-9] \u7528\u6765\u5339\u914d 22:45 \u3002 \u53c2\u6570 start_with \uff0c end_with \u548c keyword \u90fd\u662f\u6839\u636e\u6d88\u606f\u5185\u5bb9\u5f00\u5934\u3001\u7ed3\u5c3e\u6216\u8005\u5185\u5bb9\u5305\u542b\u662f\u5426\u5339\u914d\u6765\u5339\u914d\uff0c\u8fd9\u91cc\u5c31\u4e0d\u591a\u8bf4\u4e86\uff0c\u4f60\u61c2\u7684\u3002 \u53c2\u6570 alias \u7528\u7684\u65f6\u5019\u4e00\u822c\u662f\u8fd9\u6837\uff1a @CQCommand(match=\"\u4f60\u597d\",alias={\"\u4f60\u597d\u554a\",\"\u4f60\u662f\u8c01\"}) \uff0c\u7528\u4ee5\u6269\u5145\u540c\u4e49\u8bcd\u4e0b\u547d\u4ee4\u7684\u9002\u914d\u5e7f\u5ea6\u3002 \u7528\u6cd5 \u6211\u4eec\u4ee5\u53c2\u6570 match \u5199\u4e00\u4e2a\u7b80\u5355\u7684 demo\uff1a \u4ee3\u7801 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 <?php namespace Module\\Example ; use ZM\\Annotation\\CQ\\CQCommand ; class Hello { /** * @CQCommand(match=\"\u75ab\u60c5\",alias={\"COVID\"}) */ public function virus (){ $city = ctx () -> getNextArg ( \"\u8bf7\u8f93\u5165\u57ce\u5e02\u540d\u79f0\" ); return \"\u57ce\u5e02 \" . $city . \" \u7684\u75ab\u60c5\u72b6\u51b5\u5982\u4e0b\uff1a\" . \"{\u8fd9\u91cc\u5047\u88c5\u662f\u75ab\u60c5\u63a5\u53e3\u8fd4\u56de\u7684\u6570\u636e}\" ; } /** * \u5982\u679c\u9009\u62e9\u4f7f\u7528 match \u53c2\u6570\u7684\u8bdd\uff0c\u53ef\u4ee5\u7701\u7565 `match=` * @CQCommand(\"\u63b7\u786c\u5e01\") */ public function randChoice () { return \"\u4f60\u770b\u5230\u7684\u662f\uff1a\" . ( mt_rand ( 0 , 1 ) ? \"\u6b63\u9762\" : \"\u53cd\u9762\" ); } /** * @CQCommand(pattern=\"*\u628a*\u7ffb\u8bd1\u6210*\") */ public function translate () { ctx () -> getNextArg (); // \u4e3a\u4ec0\u4e48\u9700\u8981\u5355\u72ec\u8c03\u7528\u4e00\u6b21\u5462\uff1f\u770b\u4e0b\u9762\u4f8b\u5b50\u5c31\u77e5\u9053\u5566 $text = ctx () -> getNextArg (); // \u83b7\u53d6\u7b2c\u4e8c\u4e2a\u661f\u53f7\u5339\u914d\u7684\u5185\u5bb9 $target = ctx () -> getNextArg (); // \u83b7\u53d6\u7b2c\u4e09\u4e2a\u661f\u53f7\u5339\u914d\u7684\u5185\u5bb9 // \u8fd9\u91cc FakeTranslateAPI \u662f\u5047\u8bbe\u6211\u4eec\u5bf9\u63a5\u4e86\u4e00\u4e2a\u7ffb\u8bd1\u7684 API\uff0c\u5f00\u53d1\u65f6\u8bf7\u66ff\u6362\u4e3a\u81ea\u5df1\u7684\u63a5\u53e3\u3002 return \"\u7ffb\u8bd1\u7ed3\u679c\uff1a\" . FakeTranslateAPI :: translate ( $text , $target ); } } \u6548\u679c ) \u75ab\u60c5 \u5317\u4eac ( \u57ce\u5e02 \u5317\u4eac \u7684\u75ab\u60c5\u72b6\u51b5\u5982\u4e0b\uff1ablablablabla ) COVID \u9999\u6e2f ( \u57ce\u5e02 \u9999\u6e2f \u7684\u75ab\u60c5\u72b6\u51b5\u5982\u4e0b\uff1ablablablabla ) \u63b7\u786c\u5e01 ( \u4f60\u770b\u5230\u7684\u662f\uff1a\u6b63\u9762 ) \u6211\u60f3\u628a\u6211\u7231\u4f60\u7ffb\u8bd1\u6210\u82f1\u8bed ( \u7ffb\u8bd1\u7ed3\u679c\uff1aI love you! CQNotice() \u901a\u77e5\u4e8b\u4ef6\u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @CQNotice \u89e6\u53d1\u524d\u63d0 \u5f53 post_type \u4e3a notice \u65f6\u89e6\u53d1\uff08\u901a\u77e5\u7c7b\u4e8b\u4ef6\u4e0a\u62a5\u65f6\uff09 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\CQ\\CQNotice \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0\u4f5c\u7528 \u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 notice_type string \uff0c\u652f\u6301\u586b\u5165 onebot \u6807\u51c6\u7684\u5185\u5bb9 \u9650\u5b9a\u901a\u77e5\u4e8b\u4ef6\u7684\u7c7b\u578b\uff0c\u89c1 OneBot - \u901a\u77e5\u4e8b\u4ef6 \u7a7a user_id int64 \u6216 string \u9650\u5b9a\u901a\u77e5\u4e8b\u4ef6\u7528\u6237 ID\uff08QQ \u53f7\uff09\uff0c\u540c\u4e0a\u89c1 OneBot - \u901a\u77e5\u4e8b\u4ef6 \u7a7a group_id int64 \u6216 string \u9650\u5b9a\u901a\u77e5\u4e8b\u4ef6\u7fa4 ID\uff08QQ \u7fa4\u53f7\uff09\uff0c\u540c\u4e0a\u89c1 OneBot - \u901a\u77e5\u4e8b\u4ef6 \u7a7a operator_id int64 \u6216 string \u9650\u5b9a\u64cd\u4f5c\u8005 QQ \u53f7\uff0c\u540c\u4e0a\u89c1 OneBot - \u901a\u77e5\u4e8b\u4ef6 \u7a7a level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20 \u7528\u6cd5 TODO\uff1a\u5148\u653e\u7740\uff0c\u6709\u65f6\u95f4\u518d\u66f4\u3002 CQRequest() \u8bf7\u6c42\u4e8b\u4ef6\u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @CQRequest \u89e6\u53d1\u524d\u63d0 \u5f53 post_type \u4e3a request \u65f6\u89e6\u53d1\uff08\u901a\u77e5\u7c7b\u4e8b\u4ef6\u4e0a\u62a5\u65f6\uff09 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\CQ\\CQRequest \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0\u4f5c\u7528 \u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 request_type string \uff0c\u652f\u6301\u586b\u5165 onebot \u6807\u51c6\u7684\u5185\u5bb9 \u9650\u5b9a\u8bf7\u6c42\u4e8b\u4ef6\u7684\u7c7b\u578b\uff0c\u89c1 OneBot - \u8bf7\u6c42\u4e8b\u4ef6 \u7a7a user_id int64 \u6216 string \u9650\u5b9a\u8bf7\u6c42\u4e8b\u4ef6\u5f53\u4e8b\u4eba\u7528\u6237 ID\uff08QQ \u53f7\uff09\uff0c\u89c1 OneBot - \u8bf7\u6c42\u4e8b\u4ef6 \u7a7a sub_type string \u9650\u5b9a\u8bf7\u6c42\u4e8b\u4ef6\u6765\u6e90\u7fa4 ID\uff08QQ \u7fa4\u53f7\uff09\uff0c\u89c1 OneBot - \u8bf7\u6c42\u4e8b\u4ef6 \u7a7a comment string \u9650\u5b9a\u9a8c\u8bc1\u6d88\u606f\u5185\u5bb9\uff0c\u89c1 OneBot - \u8bf7\u6c42\u4e8b\u4ef6 \u7a7a level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20 \u7528\u6cd5 TODO\uff1a\u5148\u653e\u7740\uff0c\u6709\u65f6\u95f4\u518d\u66f4\u3002 CQMetaEvent() \u5143\u4e8b\u4ef6\uff0c\u5143\u4e8b\u4ef6\u4e0d\u5c5e\u4e8e\u7528\u6237\u4ea4\u4e92\u7684\u4e00\u90e8\u5206\uff0c\u6d88\u606f\u3001\u901a\u77e5\u3001\u8bf7\u6c42\u4e09\u5927\u7c7b\u4e8b\u4ef6\u662f\u4e0e\u804a\u5929\u8f6f\u4ef6\u76f4\u63a5\u76f8\u5173\u7684\u3001\u673a\u5668\u4eba\u771f\u5b9e\u63a5\u6536\u5230\u7684\u4e8b\u4ef6\uff0c\u9664\u4e86\u8fd9\u4e9b\uff0cOneBot \u81ea\u5df1\u8fd8\u4f1a\u4ea7\u751f\u4e00\u7c7b\u4e8b\u4ef6\uff0c\u8fd9\u91cc\u79f0\u4e4b\u4e3a\u300c\u5143\u4e8b\u4ef6\u300d\uff0c\u4f8b\u5982\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u3001\u5fc3\u8df3\u4e8b\u4ef6\u7b49\uff0c\u8fd9\u7c7b\u4e8b\u4ef6\u4e0e\u517c\u5bb9 OneBot \u7684\u5ba2\u6237\u7aef\u548c\u70b8\u6bdb\u6846\u67b6\u672c\u8eab\u7684\u8fd0\u884c\u72b6\u6001\u6709\u5173\uff0c\u800c\u4e0e\u804a\u5929\u8f6f\u4ef6\u65e0\u5173\u3002\u5143\u4e8b\u4ef6\u7684\u4e0a\u62a5\u65b9\u5f0f\u548c\u666e\u901a\u4e8b\u4ef6\u5b8c\u5168\u4e00\u6837\u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @CQMetaEvent \u89e6\u53d1\u524d\u63d0 \u5f53 post_type \u4e3a meta_event \u65f6\u89e6\u53d1\uff08\u5143\u4e8b\u4ef6\u4e0a\u62a5\u65f6\uff09 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\CQ\\CQMetaEvent \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0\u4f5c\u7528 \u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 meta_event_type string \uff0c \u5fc5\u9700 \u9650\u5b9a\u5143\u4e8b\u4ef6\u7684\u7c7b\u578b\uff0c\u89c1 OneBot - \u5143\u4e8b\u4ef6 level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20 \u7528\u6cd5 TODO\uff1a\u5148\u653e\u7740\uff0c\u6709\u65f6\u95f4\u518d\u66f4\u3002 CQBefore() \u6240\u6709\u673a\u5668\u4eba\u4e8b\u4ef6\u7684\u524d\u7f6e\u6ce8\u89e3\u4e8b\u4ef6\uff0c\u4e00\u822c\u7528\u4f5c\u6d88\u606f\u8fc7\u6ee4\u3001\u5168\u5c40\u65e5\u5fd7\u3001\u5168\u5c40\u66ff\u6362\u7b49\u3002 \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @CQBefore \u89e6\u53d1\u524d\u63d0 \u5f53 post_type \u7b49\u4e8e\u53c2\u6570 cq_event \u65f6\u89e6\u53d1 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\CQ\\CQBefore \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u4ec5\u53ef\u8fd4\u56de bool \uff0c\u5982\u679c\u4e3a false \uff0c\u5219\u963b\u65ad cq_event \u7c7b\u7684\u6240\u6709\u4e8b\u4ef6\u9632\u6b62\u88ab\u6267\u884c \u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 cq_event string \uff0c \u5fc5\u9700 \uff0c\u652f\u6301 message \uff0c notice \uff0c request \uff0c meta_event \u9650\u5b9a\u673a\u5668\u4eba\u65f6\u95f4\u7684\u7c7b\u578b level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20 \u7528\u6cd5 \u4ee3\u7801 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 <?php namespace Module\\Example ; use ZM\\Annotation\\CQ\\CQBefore ; use ZM\\Annotation\\CQ\\CQMessage ; class Test { /** * @CQBefore(\"message\") */ public function filter (){ // \u53ef\u7528\u4e8e\u654f\u611f\u8bcd\uff0c\u5982\u653f\u6cbb\u76f8\u5173\u7684\u8bcd\u8bed\u4e0d\u54cd\u5e94\u5176\u4ed6\u6a21\u5757 if ( mb_strpos ( ctx () -> getMessage (), \"\u8c37\u6b4c\" ) !== false ) return false ; else return true ; } /** * @CQCommand(\"\u767e\u79d1\") */ public function wiki () { $content = ctx () -> getNextArg ( \"\u8bf7\u8bf4\u4f60\u8981\u67e5\u767e\u79d1\u7684\u5185\u5bb9\" ); // \u8fd9\u91cc\u5047\u8bbe\u4f60\u5bf9\u63a5\u4e86\u4e00\u4e2a\u67e5\u767e\u79d1\u7684\u63a5\u53e3 return \"\u5df2\u641c\u5230\u5339\u914d $content \u7684\u5982\u4e0b\u7ed3\u679c\uff1a\" . FakeAPI :: searchWiki ( $content ); } } \u6548\u679c ) \u767e\u79d1 \u5317\u4eac ( \u5df2\u641c\u5230\u5339\u914d \u5317\u4eac \u7684\u5982\u4e0b\u7ed3\u679c\uff1ablablabla ) \u767e\u79d1 \u8c37\u6b4c\u88ab\u5c01 ^ \u673a\u5668\u4eba\u6ca1\u6709\u4efb\u4f55\u56de\u590d \u6ce8\u610f \u5728\u8bbe\u7f6e\u4e86 level \u53c2\u6570\u540e\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86\u591a\u4e2a @CQBefore \u76d1\u542c\u4e8b\u4ef6\u51fd\u6570\uff0c\u66f4\u9ad8 level \u7684\u4e8b\u4ef6\u51fd\u6570\u8fd4\u56de\u4e86 false \uff0c\u5219\u4f4e level \u7684\u7ed1\u5b9a\u51fd\u6570\u4e0d\u4f1a\u6267\u884c\uff0c\u6240\u6709 @CQMessage \u7ed1\u5b9a\u7684\u4e8b\u4ef6\u4e5f\u4e0d\u4f1a\u6267\u884c\u3002 \u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 @CQBefore \u505a\u4e00\u4e9b\u6d88\u606f\u7684\u8f6c\u53d1\u548c\u8fc7\u6ee4\u3002\u6bd4\u5982\u4f60\u60f3\u53bb\u9664\u7528\u6237\u53d1\u6765\u7684\u6587\u5b57\u4e2d\u7684 emoji\u3001\u56fe\u7247\u7b49 CQ \u7801\uff0c\u53ea\u4fdd\u7559\u6587\u672c\u3002 \u4f7f\u7528 ctx()->waitMessage() \u65f6\u7b49\u5f85\u7528\u6237\u8f93\u5165\u4e0b\u4e00\u6761\u6d88\u606f\u529f\u80fd\u548c CQBefore \u914d\u5408\u8fc7\u6ee4\u6d88\u606f\u65f6\u9700\u6ce8\u610f\uff0c\u89c1 FAQ - CQBefore \u8fc7\u6ee4\u4e0d\u4e86 waitMessage CQAfter() \u540c\u4e0a\u3002\u53ea\u662f\u5728\u4ee5\u4e0a\u6240\u6709\u4e8b\u4ef6\u90fd\u8c03\u7528\u540e\u624d\u4f1a\u8c03\u7528\u7684\u3002 CQAPIResponse() TODO\uff1a\u8fd8\u6ca1\u5199\u5b8c\uff0c\u5148\u653e\u7740\uff0c\u6709\u65f6\u95f4\u518d\u66f4\u3002","title":"\u673a\u5668\u4eba\u6ce8\u89e3\u4e8b\u4ef6"},{"location":"event/robot-annotations/#_1","text":"QQ \u673a\u5668\u4eba\u4e8b\u4ef6\u662f\u6307 CQHTTP \u63d2\u4ef6\u53d1\u6765\u7684 Event \u4e8b\u4ef6\uff0c\u88ab\u6846\u67b6\u5904\u7406\u540e\u89e6\u53d1\u5230\u5355\u4e2a\u7c7b\u4e2d\u65b9\u6cd5\u7684\u4e8b\u4ef6\u3002 \u4e3a\u4e86\u4fbf\u4e8e\u5f00\u53d1\uff0c\u8fd9\u91cc\u7684\u6ce8\u89e3\u7c7b\u5bf9\u5e94 CQHTTP \u63d2\u4ef6\u8fd4\u56de\u7684 post_type \u7c7b\u578b\uff0c\u5bf9\u53f7\u5165\u5ea7\u5373\u53ef\u3002 \u63d0\u793a \u5728\u4f7f\u7528\u6ce8\u89e3\u7ed1\u5b9a\u4e8b\u4ef6\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u65e0 \u5fc5\u9700 \u53c2\u6570\uff0c\u53ef\u4e00\u4e2a\u53c2\u6570\u4e5f\u4e0d\u5199\uff0c\u6548\u679c\u5c31\u662f\u6b64\u4e8b\u4ef6\u4efb\u4f55\u60c5\u51b5\u4e0b\u90fd\u4f1a\u8c03\u7528\u6b64\u65b9\u6cd5\u3002\u4f8b\u5982\uff1a @CQMessage() \u4e8b\u4ef6\u662f\u7528\u6237\u9700\u8981\u4ece OneBot \u88ab\u52a8\u63a5\u6536\u7684\u6570\u636e\uff0c\u6709\u4ee5\u4e0b\u51e0\u4e2a\u5927\u7c7b\uff1a \u6d88\u606f\u4e8b\u4ef6 \uff0c\u5305\u62ec\u79c1\u804a\u6d88\u606f\u3001\u7fa4\u6d88\u606f\u7b49\uff0c\u88ab @CQCommand \uff0c @CQMessage \u6ce8\u89e3\u5904\u7406\u3002 \u901a\u77e5\u4e8b\u4ef6 \uff0c\u5305\u62ec\u7fa4\u6210\u5458\u53d8\u52a8\u3001\u597d\u53cb\u53d8\u52a8\u7b49\uff0c\u88ab @CQNotice \u6ce8\u89e3\u4e8b\u4ef6\u5904\u7406\u3002 \u8bf7\u6c42\u4e8b\u4ef6 \uff0c\u5305\u62ec\u52a0\u7fa4\u8bf7\u6c42\u3001\u52a0\u597d\u53cb\u8bf7\u6c42\u7b49\uff0c\u88ab @CQRequest \u6ce8\u89e3\u4e8b\u4ef6\u5904\u7406\u3002 \u5143\u4e8b\u4ef6 \uff0c\u5305\u62ec OneBot \u751f\u547d\u5468\u671f\u3001\u5fc3\u8df3\u7b49\uff0c\u88ab @CQMetaEvent \u6ce8\u89e3\u4e8b\u4ef6\u5904\u7406\u3002","title":"\u673a\u5668\u4eba\u6ce8\u89e3\u4e8b\u4ef6"},{"location":"event/robot-annotations/#_2","text":"\u6ce8\u89e3\u540d\u79f0 \u7c7b\u6240\u5728\u547d\u540d\u5168\u79f0 \u4f5c\u7528 @CQBefore \\ZM\\Annotation\\CQBefore OneBot \u5404\u7c7b\u4e8b\u4ef6\u524d\u89e6\u53d1\u7684\uff0c\u53ef\u5f53\u4f5c\u4e8b\u4ef6\u8fc7\u6ee4\u5668\u4f7f\u7528 @CQAfter \\ZM\\Annotation\\CQAfter OneBot \u5404\u7c7b\u4e8b\u4ef6\u540e\u89e6\u53d1\u7684 @CQMessage \\ZM\\Annotation\\CQMessage OneBot \u4e2d\u6d88\u606f\u7c7b\u4e8b\u4ef6\u7684\u89e6\u53d1\uff08\u673a\u5668\u4eba\u6d88\u606f\uff09\u4e8b\u4ef6 @CQCommand \\ZM\\Annotation\\CQCommand OneBot \u4e2d\u6d88\u606f\u7c7b\u4e8b\u4ef6\u7684\u89e6\u53d1\uff08\u673a\u5668\u4eba\u6d88\u606f\uff09\u4e8b\u4ef6\uff0c\u4f46\u662f\u88ab\u5c01\u88c5\u4e3a\u6307\u4ee4\u578b\u7684\uff0c\u65e0\u9700\u81ea\u5df1\u5207\u5272\u547d\u4ee4\u5f0f @CQNotice \\ZM\\Annotation\\CQNotice OneBot \u4e2d\u901a\u77e5\u7c7b\u4e8b\u4ef6\u7684\u89e6\u53d1\uff08\u673a\u5668\u4eba\u6d88\u606f\uff09\u4e8b\u4ef6 @CQRequest \\ZM\\Annotation\\CQRequest OneBot \u4e2d\u8bf7\u6c42\u7c7b\u4e8b\u4ef6\u7684\u89e6\u53d1\uff08\u673a\u5668\u4eba\u6d88\u606f\uff09\u4e8b\u4ef6\uff0c\u4e00\u822c\u5e26\u6709\u8bf7\u6c42\u4fe1\u606f\uff0c\u53ef\u8054\u52a8\u76f8\u5173\u54cd\u5e94\u7684 API \u5b8c\u6210\u529f\u80fd\u7f16\u5199 @CQMetaEvent \\ZM\\Annotation\\CQMetaEvent OneBot \u4e2d\u6d89\u53ca OneBot \u5b9e\u73b0\u672c\u8eab\u7684\u4e00\u4e9b\u548c\u673a\u5668\u4eba\u4e8b\u4ef6\u65e0\u5173\u7684\u5143\u4e8b\u4ef6\uff0c\u6bd4\u5982 WS \u8fde\u63a5\u7684\u5fc3\u8df3\u5305","title":"\u6ce8\u89e3\u4e8b\u4ef6\u53c2\u7167\u8868"},{"location":"event/robot-annotations/#cqmessage","text":"QQ \u6536\u5230\u6d88\u606f\u540e\u89e6\u53d1\u7684\u4e8b\u4ef6\u5bf9\u5e94\u6ce8\u89e3\u3002","title":"CQMessage()"},{"location":"event/robot-annotations/#_3","text":"\u7c7b\u578b \u503c \u540d\u79f0 @CQMessage \u89e6\u53d1\u524d\u63d0 \u5f53 post_type \u4e3a message \u65f6\u89e6\u53d1 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\CQ\\CQMessage \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u5f53\u65b9\u6cd5\u8fd4\u56de\u5b57\u7b26\u4e32\u65f6\uff0c\u6548\u679c\u7b49\u540c\u4e8e\u6267\u884c ctx()->reply(\"xxx\")","title":"\u5c5e\u6027"},{"location":"event/robot-annotations/#_4","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 message_type string \uff0c\u652f\u6301\u586b\u5165 private \uff0c group \u9650\u5b9a\u6d88\u606f\u4e8b\u4ef6\u7684\u6765\u6e90\u7c7b\u578b\uff0c\u5982\u79c1\u804a\u6216\u7fa4\u6d88\u606f \u7a7a user_id int64 \u6216 string \u9650\u5b9a\u6d88\u606f\u53d1\u9001\u7528\u6237 ID\uff08QQ \u53f7\uff09 \u7a7a group_id int64 \u6216 string \u9650\u5b9a\u6d88\u606f\u53d1\u9001\u6765\u6e90\u7fa4 ID\uff08QQ \u7fa4\u53f7\uff09 \u7a7a message string \u9650\u5b9a\u6d88\u606f\u5185\u5bb9\u6587\u672c \u7a7a level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20","title":"\u53c2\u6570"},{"location":"event/robot-annotations/#_5","text":"\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\u7684\u6ce8\u91ca\u7528\u9014\u5c31\u662f\uff1a \u5728\u7528\u6237 QQ \u4e3a 123456 \u7684\u7528\u6237\u79c1\u804a\u7ed9\u673a\u5668\u4eba\u53d1\u6d88\u606f\u540e\u673a\u5668\u4eba\u56de\u590d\u5185\u5bb9\u3002 \u7528\u6237\u53d1\u9001\u6587\u5b57\u4e3a hello \u65f6\u8fd4\u56de \u4f60\u597d\u554a\uff0cxxx \u7684\u6d88\u606f\u3002 \u4ee3\u7801 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 <?php namespace Module\\Example ; use ZM\\Annotation\\CQ\\CQMessage ; class Hello { /** * @CQMessage(message_type=\"private\",user_id=123456) */ public function test () { return \"\u4f60\u548c\u673a\u5668\u4eba\u79c1\u804a\u53d1\u9001\u4e86\u8fd9\u4e9b\u6587\u672c\uff1a\" . ctx () -> getMessage (); } /** * @CQMessage(message=\"hello\") */ public function hello () { return \"\u4f60\u597d\u554a\uff0c\" . ctx () -> getUserId (); } } \u6548\u679c ) \u5047\u8bbe\u6211\u662f\u79c1\u804a\u673a\u5668\u4eba ( \u4f60\u548c\u673a\u5668\u4eba\u79c1\u804a\u53d1\u9001\u4e86\u8fd9\u4e9b\u6587\u672c\uff1a\u5047\u8bbe\u6211\u662f\u79c1\u804a\u673a\u5668\u4eba ^ \u5047\u8bbe\u6211\u73b0\u5728\u5207\u5230\u7fa4\u91cc\uff0c\u5728\u7fa4\u91cc\u53d1hello ) hello ( \u4f60\u597d\u554a\uff0c123456","title":"\u7528\u6cd5"},{"location":"event/robot-annotations/#cqcommand","text":"\u6b64\u6ce8\u89e3\u662f\u5bf9 @CQMessage \u7c7b\u522b\u7684\u518d\u5c01\u88c5\uff0c\u662f\u547d\u4ee4\u89e3\u6790\u683c\u5f0f\u5904\u7406\u6d88\u606f\u7684\u5229\u5668\u3002\u4f8b\u5982\uff0c\u4f60\u60f3\u5199\u4e00\u4e2a\u75ab\u60c5\u4e0a\u62a5\uff0c\u6307\u4ee4\u662f \u75ab\u60c5 \u57ce\u5e02\u540d\u79f0 \uff0c\u90a3\u4e48\u6b64\u65b9\u5f0f\u6765\u89e3\u6790\u7528\u6237\u6d88\u606f\u4f1a\u66f4\u52a0\u65b9\u4fbf\u3002","title":"CQCommand()"},{"location":"event/robot-annotations/#_6","text":"\u7c7b\u578b \u503c \u540d\u79f0 @CQCommand \u89e6\u53d1\u524d\u63d0 \u5f53\u6839\u636e\u53c2\u6570\u89c4\u5219\u5339\u914d\u5230\u7528\u6237\u547d\u4ee4\u5f0f\u6d88\u606f\u65f6\u89e6\u53d1 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\CQ\\CQCommand \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u5f53\u65b9\u6cd5\u8fd4\u56de\u5b57\u7b26\u4e32\u65f6\uff0c\u6548\u679c\u7b49\u540c\u4e8e\u6267\u884c ctx()->reply(\"xxx\")","title":"\u5c5e\u6027"},{"location":"event/robot-annotations/#_7","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 match string \u5339\u914d\u7b2c\u4e00\u4e2a\u8bcd\u7684\u547d\u4ee4\u5f0f\u6d88\u606f\uff0c\u5982 \u5929\u6c14 \u5317\u4eac \u4e2d\u7684 \u5929\u6c14 \u7a7a pattern string \u6839\u636e * \u53f7\u901a\u914d\u7b26\u8fdb\u884c\u6a21\u5f0f\u5339\u914d\u7528\u6237\u6d88\u606f\uff0c\u5982 \u67e5\u8be2*\u5929\u6c14 \u7a7a regex string \uff0c\u9650\u5b9a\u6b63\u5219\u8868\u8fbe\u5f0f \u5339\u914d\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\u5230\u7684\u7528\u6237\u6d88\u606f \u7a7a start_with string \u5339\u914d\u6d88\u606f\u5f00\u5934\u76f8\u5339\u914d\u7684\u6d88\u606f\uff0c\u5982 \u6211\u53eb\u70b8\u6bdb \uff0c\u8fd9\u91cc\u5199 \u6211\u53eb \u7a7a end_with string \u5339\u914d\u6d88\u606f\u7ed3\u5c3e\u76f8\u5339\u914d\u7684\u6d88\u606f\uff0c\u4ee5 start_with \u7c7b\u63a8 \u7a7a keyword string \u5339\u914d\u6d88\u606f\u4e2d\u6709\u76f8\u5173\u5173\u952e\u8bcd\u7684\u6d88\u606f \u7a7a alias array[string] match \u5339\u914d\u5230\u547d\u4ee4\u7684\u522b\u540d\uff0c\u6570\u7ec4\u5f62\u5f0f {} message_type string \uff0c\u652f\u6301\u586b\u5165 private \uff0c group \u9650\u5b9a\u6d88\u606f\u4e8b\u4ef6\u7684\u6765\u6e90\u7c7b\u578b\uff0c\u540c @CQMessage \u7a7a user_id int64 \u6216 string \u9650\u5b9a\u6d88\u606f\u53d1\u9001\u7528\u6237 ID\uff0c\u540c @CQMessage \u7a7a group_id int64 \u6216 string \u9650\u5b9a\u6d88\u606f\u53d1\u9001\u6765\u6e90\u7fa4 ID\uff0c\u540c @CQMessage \u7a7a level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20 \u6ce8\u610f \u5728 @CQCommand \u6ce8\u89e3\u4e8b\u4ef6\u4e2d\uff0c\u4ece match \u5230 keyword \u516d\u4e2a\u53c2\u6570\u4e2d\uff0c\u5fc5\u987b\u4e14\u53ea\u80fd\u5b9a\u4e49\u4e00\u4e2a\uff0c alias \u76ee\u524d\u53ea\u80fd\u548c match \u53c2\u6570\u540c\u65f6\u4f7f\u7528\uff1b \u6846\u67b6\u5185\u90e8\u5bf9\u4e8e\u540c\u4e00\u6761\u6d88\u606f\u4e8b\u4ef6\uff0c\u4f18\u5148\u5904\u7406 @CQCommand \u6ce8\u89e3\u4e8b\u4ef6\uff0c\u5982\u679c\u672a\u5339\u914d\u5230\u4efb\u4f55\u6ce8\u89e3\u4e8b\u4ef6\uff0c\u5219\u624d\u4f1a\u7ee7\u7eed\u6267\u884c @CQMessage \u6ce8\u89e3\u4e8b\u4ef6\u3002 \u53c2\u6570 match \u5339\u914d\u6a21\u5f0f\u662f\uff1a\u9047\u5230\u7a7a\u683c\u3001\u6362\u884c\u5c31\u4f1a\u5207\u5206\uff0c\u6bd4\u5982 \u70b9\u6b4c xxx yyy \u4f1a\u88ab\u5206\u5272\u4e3a [\u70b9\u6b4c,xxx,yyy] \uff0c\u7136\u540e\u62bd\u53d6\u7b2c\u4e00\u4e2a\u8bcd\u505a\u4e3a\u547d\u4ee4\u53bb\u5339\u914d\uff0c\u5269\u4e0b\u7684\u4e3a\u53c2\u6570\u3002 \u53c2\u6570 pattern \u5339\u914d\u6a21\u5f0f\u662f\uff1a* \u53f7\u4f4d\u7f6e\u53d8\u6210\u53c2\u6570\uff0c\u6bd4\u5982 \u4ece*\u5230*\u7684\u968f\u673a\u6570 \uff0c\u6211\u4eec\u8f93\u5165 \u4ece1\u52309\u7684\u968f\u673a\u6570 \uff0c\u6210\u529f\u5339\u914d\uff0c\u53c2\u6570\u5217\u8868\uff1a [1,9] \u3002 \u53c2\u6570 regex \u5339\u914d\u6a21\u5f0f\u4e3a PHP \u6807\u51c6\u7684 pcre \u6b63\u5219\u8868\u8fbe\u5f0f\uff0c\u6bd4\u5982 ([01][0-9][2][0-3]):[0-5][0-9] \u7528\u6765\u5339\u914d 22:45 \u3002 \u53c2\u6570 start_with \uff0c end_with \u548c keyword \u90fd\u662f\u6839\u636e\u6d88\u606f\u5185\u5bb9\u5f00\u5934\u3001\u7ed3\u5c3e\u6216\u8005\u5185\u5bb9\u5305\u542b\u662f\u5426\u5339\u914d\u6765\u5339\u914d\uff0c\u8fd9\u91cc\u5c31\u4e0d\u591a\u8bf4\u4e86\uff0c\u4f60\u61c2\u7684\u3002 \u53c2\u6570 alias \u7528\u7684\u65f6\u5019\u4e00\u822c\u662f\u8fd9\u6837\uff1a @CQCommand(match=\"\u4f60\u597d\",alias={\"\u4f60\u597d\u554a\",\"\u4f60\u662f\u8c01\"}) \uff0c\u7528\u4ee5\u6269\u5145\u540c\u4e49\u8bcd\u4e0b\u547d\u4ee4\u7684\u9002\u914d\u5e7f\u5ea6\u3002","title":"\u53c2\u6570"},{"location":"event/robot-annotations/#_8","text":"\u6211\u4eec\u4ee5\u53c2\u6570 match \u5199\u4e00\u4e2a\u7b80\u5355\u7684 demo\uff1a \u4ee3\u7801 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 <?php namespace Module\\Example ; use ZM\\Annotation\\CQ\\CQCommand ; class Hello { /** * @CQCommand(match=\"\u75ab\u60c5\",alias={\"COVID\"}) */ public function virus (){ $city = ctx () -> getNextArg ( \"\u8bf7\u8f93\u5165\u57ce\u5e02\u540d\u79f0\" ); return \"\u57ce\u5e02 \" . $city . \" \u7684\u75ab\u60c5\u72b6\u51b5\u5982\u4e0b\uff1a\" . \"{\u8fd9\u91cc\u5047\u88c5\u662f\u75ab\u60c5\u63a5\u53e3\u8fd4\u56de\u7684\u6570\u636e}\" ; } /** * \u5982\u679c\u9009\u62e9\u4f7f\u7528 match \u53c2\u6570\u7684\u8bdd\uff0c\u53ef\u4ee5\u7701\u7565 `match=` * @CQCommand(\"\u63b7\u786c\u5e01\") */ public function randChoice () { return \"\u4f60\u770b\u5230\u7684\u662f\uff1a\" . ( mt_rand ( 0 , 1 ) ? \"\u6b63\u9762\" : \"\u53cd\u9762\" ); } /** * @CQCommand(pattern=\"*\u628a*\u7ffb\u8bd1\u6210*\") */ public function translate () { ctx () -> getNextArg (); // \u4e3a\u4ec0\u4e48\u9700\u8981\u5355\u72ec\u8c03\u7528\u4e00\u6b21\u5462\uff1f\u770b\u4e0b\u9762\u4f8b\u5b50\u5c31\u77e5\u9053\u5566 $text = ctx () -> getNextArg (); // \u83b7\u53d6\u7b2c\u4e8c\u4e2a\u661f\u53f7\u5339\u914d\u7684\u5185\u5bb9 $target = ctx () -> getNextArg (); // \u83b7\u53d6\u7b2c\u4e09\u4e2a\u661f\u53f7\u5339\u914d\u7684\u5185\u5bb9 // \u8fd9\u91cc FakeTranslateAPI \u662f\u5047\u8bbe\u6211\u4eec\u5bf9\u63a5\u4e86\u4e00\u4e2a\u7ffb\u8bd1\u7684 API\uff0c\u5f00\u53d1\u65f6\u8bf7\u66ff\u6362\u4e3a\u81ea\u5df1\u7684\u63a5\u53e3\u3002 return \"\u7ffb\u8bd1\u7ed3\u679c\uff1a\" . FakeTranslateAPI :: translate ( $text , $target ); } } \u6548\u679c ) \u75ab\u60c5 \u5317\u4eac ( \u57ce\u5e02 \u5317\u4eac \u7684\u75ab\u60c5\u72b6\u51b5\u5982\u4e0b\uff1ablablablabla ) COVID \u9999\u6e2f ( \u57ce\u5e02 \u9999\u6e2f \u7684\u75ab\u60c5\u72b6\u51b5\u5982\u4e0b\uff1ablablablabla ) \u63b7\u786c\u5e01 ( \u4f60\u770b\u5230\u7684\u662f\uff1a\u6b63\u9762 ) \u6211\u60f3\u628a\u6211\u7231\u4f60\u7ffb\u8bd1\u6210\u82f1\u8bed ( \u7ffb\u8bd1\u7ed3\u679c\uff1aI love you!","title":"\u7528\u6cd5"},{"location":"event/robot-annotations/#cqnotice","text":"\u901a\u77e5\u4e8b\u4ef6\u3002","title":"CQNotice()"},{"location":"event/robot-annotations/#_9","text":"\u7c7b\u578b \u503c \u540d\u79f0 @CQNotice \u89e6\u53d1\u524d\u63d0 \u5f53 post_type \u4e3a notice \u65f6\u89e6\u53d1\uff08\u901a\u77e5\u7c7b\u4e8b\u4ef6\u4e0a\u62a5\u65f6\uff09 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\CQ\\CQNotice \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0\u4f5c\u7528","title":"\u5c5e\u6027"},{"location":"event/robot-annotations/#_10","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 notice_type string \uff0c\u652f\u6301\u586b\u5165 onebot \u6807\u51c6\u7684\u5185\u5bb9 \u9650\u5b9a\u901a\u77e5\u4e8b\u4ef6\u7684\u7c7b\u578b\uff0c\u89c1 OneBot - \u901a\u77e5\u4e8b\u4ef6 \u7a7a user_id int64 \u6216 string \u9650\u5b9a\u901a\u77e5\u4e8b\u4ef6\u7528\u6237 ID\uff08QQ \u53f7\uff09\uff0c\u540c\u4e0a\u89c1 OneBot - \u901a\u77e5\u4e8b\u4ef6 \u7a7a group_id int64 \u6216 string \u9650\u5b9a\u901a\u77e5\u4e8b\u4ef6\u7fa4 ID\uff08QQ \u7fa4\u53f7\uff09\uff0c\u540c\u4e0a\u89c1 OneBot - \u901a\u77e5\u4e8b\u4ef6 \u7a7a operator_id int64 \u6216 string \u9650\u5b9a\u64cd\u4f5c\u8005 QQ \u53f7\uff0c\u540c\u4e0a\u89c1 OneBot - \u901a\u77e5\u4e8b\u4ef6 \u7a7a level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20","title":"\u53c2\u6570"},{"location":"event/robot-annotations/#_11","text":"TODO\uff1a\u5148\u653e\u7740\uff0c\u6709\u65f6\u95f4\u518d\u66f4\u3002","title":"\u7528\u6cd5"},{"location":"event/robot-annotations/#cqrequest","text":"\u8bf7\u6c42\u4e8b\u4ef6\u3002","title":"CQRequest()"},{"location":"event/robot-annotations/#_12","text":"\u7c7b\u578b \u503c \u540d\u79f0 @CQRequest \u89e6\u53d1\u524d\u63d0 \u5f53 post_type \u4e3a request \u65f6\u89e6\u53d1\uff08\u901a\u77e5\u7c7b\u4e8b\u4ef6\u4e0a\u62a5\u65f6\uff09 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\CQ\\CQRequest \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0\u4f5c\u7528","title":"\u5c5e\u6027"},{"location":"event/robot-annotations/#_13","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 request_type string \uff0c\u652f\u6301\u586b\u5165 onebot \u6807\u51c6\u7684\u5185\u5bb9 \u9650\u5b9a\u8bf7\u6c42\u4e8b\u4ef6\u7684\u7c7b\u578b\uff0c\u89c1 OneBot - \u8bf7\u6c42\u4e8b\u4ef6 \u7a7a user_id int64 \u6216 string \u9650\u5b9a\u8bf7\u6c42\u4e8b\u4ef6\u5f53\u4e8b\u4eba\u7528\u6237 ID\uff08QQ \u53f7\uff09\uff0c\u89c1 OneBot - \u8bf7\u6c42\u4e8b\u4ef6 \u7a7a sub_type string \u9650\u5b9a\u8bf7\u6c42\u4e8b\u4ef6\u6765\u6e90\u7fa4 ID\uff08QQ \u7fa4\u53f7\uff09\uff0c\u89c1 OneBot - \u8bf7\u6c42\u4e8b\u4ef6 \u7a7a comment string \u9650\u5b9a\u9a8c\u8bc1\u6d88\u606f\u5185\u5bb9\uff0c\u89c1 OneBot - \u8bf7\u6c42\u4e8b\u4ef6 \u7a7a level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20","title":"\u53c2\u6570"},{"location":"event/robot-annotations/#_14","text":"TODO\uff1a\u5148\u653e\u7740\uff0c\u6709\u65f6\u95f4\u518d\u66f4\u3002","title":"\u7528\u6cd5"},{"location":"event/robot-annotations/#cqmetaevent","text":"\u5143\u4e8b\u4ef6\uff0c\u5143\u4e8b\u4ef6\u4e0d\u5c5e\u4e8e\u7528\u6237\u4ea4\u4e92\u7684\u4e00\u90e8\u5206\uff0c\u6d88\u606f\u3001\u901a\u77e5\u3001\u8bf7\u6c42\u4e09\u5927\u7c7b\u4e8b\u4ef6\u662f\u4e0e\u804a\u5929\u8f6f\u4ef6\u76f4\u63a5\u76f8\u5173\u7684\u3001\u673a\u5668\u4eba\u771f\u5b9e\u63a5\u6536\u5230\u7684\u4e8b\u4ef6\uff0c\u9664\u4e86\u8fd9\u4e9b\uff0cOneBot \u81ea\u5df1\u8fd8\u4f1a\u4ea7\u751f\u4e00\u7c7b\u4e8b\u4ef6\uff0c\u8fd9\u91cc\u79f0\u4e4b\u4e3a\u300c\u5143\u4e8b\u4ef6\u300d\uff0c\u4f8b\u5982\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u3001\u5fc3\u8df3\u4e8b\u4ef6\u7b49\uff0c\u8fd9\u7c7b\u4e8b\u4ef6\u4e0e\u517c\u5bb9 OneBot \u7684\u5ba2\u6237\u7aef\u548c\u70b8\u6bdb\u6846\u67b6\u672c\u8eab\u7684\u8fd0\u884c\u72b6\u6001\u6709\u5173\uff0c\u800c\u4e0e\u804a\u5929\u8f6f\u4ef6\u65e0\u5173\u3002\u5143\u4e8b\u4ef6\u7684\u4e0a\u62a5\u65b9\u5f0f\u548c\u666e\u901a\u4e8b\u4ef6\u5b8c\u5168\u4e00\u6837\u3002","title":"CQMetaEvent()"},{"location":"event/robot-annotations/#_15","text":"\u7c7b\u578b \u503c \u540d\u79f0 @CQMetaEvent \u89e6\u53d1\u524d\u63d0 \u5f53 post_type \u4e3a meta_event \u65f6\u89e6\u53d1\uff08\u5143\u4e8b\u4ef6\u4e0a\u62a5\u65f6\uff09 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\CQ\\CQMetaEvent \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u65e0\u4f5c\u7528","title":"\u5c5e\u6027"},{"location":"event/robot-annotations/#_16","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 meta_event_type string \uff0c \u5fc5\u9700 \u9650\u5b9a\u5143\u4e8b\u4ef6\u7684\u7c7b\u578b\uff0c\u89c1 OneBot - \u5143\u4e8b\u4ef6 level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20","title":"\u53c2\u6570"},{"location":"event/robot-annotations/#_17","text":"TODO\uff1a\u5148\u653e\u7740\uff0c\u6709\u65f6\u95f4\u518d\u66f4\u3002","title":"\u7528\u6cd5"},{"location":"event/robot-annotations/#cqbefore","text":"\u6240\u6709\u673a\u5668\u4eba\u4e8b\u4ef6\u7684\u524d\u7f6e\u6ce8\u89e3\u4e8b\u4ef6\uff0c\u4e00\u822c\u7528\u4f5c\u6d88\u606f\u8fc7\u6ee4\u3001\u5168\u5c40\u65e5\u5fd7\u3001\u5168\u5c40\u66ff\u6362\u7b49\u3002","title":"CQBefore()"},{"location":"event/robot-annotations/#_18","text":"\u7c7b\u578b \u503c \u540d\u79f0 @CQBefore \u89e6\u53d1\u524d\u63d0 \u5f53 post_type \u7b49\u4e8e\u53c2\u6570 cq_event \u65f6\u89e6\u53d1 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\CQ\\CQBefore \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u4ec5\u53ef\u8fd4\u56de bool \uff0c\u5982\u679c\u4e3a false \uff0c\u5219\u963b\u65ad cq_event \u7c7b\u7684\u6240\u6709\u4e8b\u4ef6\u9632\u6b62\u88ab\u6267\u884c","title":"\u5c5e\u6027"},{"location":"event/robot-annotations/#_19","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 cq_event string \uff0c \u5fc5\u9700 \uff0c\u652f\u6301 message \uff0c notice \uff0c request \uff0c meta_event \u9650\u5b9a\u673a\u5668\u4eba\u65f6\u95f4\u7684\u7c7b\u578b level int \u4e8b\u4ef6\u4f18\u5148\u7ea7\uff08\u8d8a\u5927\u8d8a\u9760\u524d\uff09 20","title":"\u53c2\u6570"},{"location":"event/robot-annotations/#_20","text":"\u4ee3\u7801 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 <?php namespace Module\\Example ; use ZM\\Annotation\\CQ\\CQBefore ; use ZM\\Annotation\\CQ\\CQMessage ; class Test { /** * @CQBefore(\"message\") */ public function filter (){ // \u53ef\u7528\u4e8e\u654f\u611f\u8bcd\uff0c\u5982\u653f\u6cbb\u76f8\u5173\u7684\u8bcd\u8bed\u4e0d\u54cd\u5e94\u5176\u4ed6\u6a21\u5757 if ( mb_strpos ( ctx () -> getMessage (), \"\u8c37\u6b4c\" ) !== false ) return false ; else return true ; } /** * @CQCommand(\"\u767e\u79d1\") */ public function wiki () { $content = ctx () -> getNextArg ( \"\u8bf7\u8bf4\u4f60\u8981\u67e5\u767e\u79d1\u7684\u5185\u5bb9\" ); // \u8fd9\u91cc\u5047\u8bbe\u4f60\u5bf9\u63a5\u4e86\u4e00\u4e2a\u67e5\u767e\u79d1\u7684\u63a5\u53e3 return \"\u5df2\u641c\u5230\u5339\u914d $content \u7684\u5982\u4e0b\u7ed3\u679c\uff1a\" . FakeAPI :: searchWiki ( $content ); } } \u6548\u679c ) \u767e\u79d1 \u5317\u4eac ( \u5df2\u641c\u5230\u5339\u914d \u5317\u4eac \u7684\u5982\u4e0b\u7ed3\u679c\uff1ablablabla ) \u767e\u79d1 \u8c37\u6b4c\u88ab\u5c01 ^ \u673a\u5668\u4eba\u6ca1\u6709\u4efb\u4f55\u56de\u590d \u6ce8\u610f \u5728\u8bbe\u7f6e\u4e86 level \u53c2\u6570\u540e\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86\u591a\u4e2a @CQBefore \u76d1\u542c\u4e8b\u4ef6\u51fd\u6570\uff0c\u66f4\u9ad8 level \u7684\u4e8b\u4ef6\u51fd\u6570\u8fd4\u56de\u4e86 false \uff0c\u5219\u4f4e level \u7684\u7ed1\u5b9a\u51fd\u6570\u4e0d\u4f1a\u6267\u884c\uff0c\u6240\u6709 @CQMessage \u7ed1\u5b9a\u7684\u4e8b\u4ef6\u4e5f\u4e0d\u4f1a\u6267\u884c\u3002 \u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 @CQBefore \u505a\u4e00\u4e9b\u6d88\u606f\u7684\u8f6c\u53d1\u548c\u8fc7\u6ee4\u3002\u6bd4\u5982\u4f60\u60f3\u53bb\u9664\u7528\u6237\u53d1\u6765\u7684\u6587\u5b57\u4e2d\u7684 emoji\u3001\u56fe\u7247\u7b49 CQ \u7801\uff0c\u53ea\u4fdd\u7559\u6587\u672c\u3002 \u4f7f\u7528 ctx()->waitMessage() \u65f6\u7b49\u5f85\u7528\u6237\u8f93\u5165\u4e0b\u4e00\u6761\u6d88\u606f\u529f\u80fd\u548c CQBefore \u914d\u5408\u8fc7\u6ee4\u6d88\u606f\u65f6\u9700\u6ce8\u610f\uff0c\u89c1 FAQ - CQBefore \u8fc7\u6ee4\u4e0d\u4e86 waitMessage","title":"\u7528\u6cd5"},{"location":"event/robot-annotations/#cqafter","text":"\u540c\u4e0a\u3002\u53ea\u662f\u5728\u4ee5\u4e0a\u6240\u6709\u4e8b\u4ef6\u90fd\u8c03\u7528\u540e\u624d\u4f1a\u8c03\u7528\u7684\u3002","title":"CQAfter()"},{"location":"event/robot-annotations/#cqapiresponse","text":"TODO\uff1a\u8fd8\u6ca1\u5199\u5b8c\uff0c\u5148\u653e\u7740\uff0c\u6709\u65f6\u95f4\u518d\u66f4\u3002","title":"CQAPIResponse()"},{"location":"event/route-annotations/","text":"\u8def\u7531\u6ce8\u89e3\u4e8b\u4ef6 \u70b8\u6bdb\u6846\u67b6\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7b80\u6613\u4f46\u662f\u9ad8\u6548\u6613\u7528\u7684 HTTP \u8def\u7531\u6ce8\u89e3\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u8def\u7531\u529f\u80fd\u6765\u5f00\u53d1\u4efb\u4f55 Web \u5e94\u7528\u5fae\u670d\u52a1\u3001API \u63a5\u53e3\u3001\u4e2d\u95f4\u4ef6\u7b49\u3002 \u5f00\u53d1\u63d0\u793a \u672c\u7ae0\u8282\u6d89\u53ca\u7684\u8def\u7531\u548c\u63a7\u5236\u5668\u6982\u5ff5\u53ef\u80fd\u548c\u5176\u4ed6\u4f20\u7edf\u6846\u67b6\u6709\u4e00\u4e9b\u51fa\u5165\uff0c\u800c\u4e14\u70b8\u6bdb\u6846\u67b6\u975e\u7edd\u5bf9\u6839\u636e PSR \u6807\u51c6\u8fdb\u884c\u5f00\u53d1\uff0c\u76ee\u7684\u662f\u4f7f\u7528\u4e0a\u4e00\u4e9b\u5e38\u89c1\u7684\u4e1c\u897f\u5c3d\u53ef\u80fd\u5730\u7075\u6d3b\u548c\u4e0d\u5570\u55e6\u3002 \u63a7\u5236\u5668\u548c\u8def\u7531 Controller \u548c Route \u4e3a\u8def\u7531\u6ce8\u89e3\u4e8b\u4ef6\u7684\u6838\u5fc3\u6ce8\u89e3\u4e8b\u4ef6\uff0c\u5176\u4e2d Controller \u7684\u6ce8\u89e3\u4e8b\u4ef6\u4e3a @Controller \uff0cRoute \u7684\u6ce8\u89e3\u4e8b\u4ef6\u4e3a @RequestMapping \u3002 Controller() \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @Controller \u89e6\u53d1\u524d\u63d0 \u5f53\u8def\u7531 url \u5339\u914d\u5230\u65f6\u8fdb\u5165\u89e6\u53d1 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Http\\Controller \u9002\u7528\u4f4d\u7f6e \u7c7b \u8fd4\u56de\u503c\u5904\u7406 \u5bf9\u7c7b\u6ce8\u89e3\u4fee\u9970\uff0c\u65e0\u8fd4\u56de\u503c \u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 prefix string \uff0c\u5fc5\u9700 \u63a7\u5236\u5668\u7684 url \u7a7a RequestMapping() \u5c5e\u6027 \u7c7b\u578b \u503c \u540d\u79f0 @RequestMapping \u89e6\u53d1\u524d\u63d0 \u5f53\u8def\u7531 url \u5339\u914d\u5230\u65f6\u8fdb\u5165\u89e6\u53d1 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Http\\RequestMapping \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u8fd4\u56de\u7c7b\u578b\u662f string \u65f6\uff0c\u81ea\u52a8\u8c03\u7528 HTTP \u54cd\u5e94\u5e76\u8fd4\u56de 200 \u72b6\u6001\u7801 \u53c2\u6570 \u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 route string \uff0c\u5fc5\u9700 \u63a7\u5236\u5668\u7684 url \u7a7a name string \u8def\u7531\u7684\u540d\u79f0 \u7a7a request_method array \uff0c\u9650\u5b9a RequestMethod::GET \u7b49\u5e38\u91cf \u9650\u5236\u6fc0\u6d3b\u8def\u7531\u7684 HTTP \u65b9\u6cd5 [RequestMethod::GET,RequestMethod::POST] params array \uff0c\u5f53\u8def\u7531\u4e2d\u542b\u6709\u5982 {id} \u7c7b\u4f3c\u7684\u52a8\u6001\u8def\u7531\u65f6\uff0c\u4f1a\u52a8\u6001\u6539\u53d8 \u52a8\u6001\u53c2\u6570\u7684\u8def\u7531\u53c2\u6570\u503c\u7684\u7ed1\u5b9a [] \u51fd\u6570\u8c03\u7528\u53c2\u6570 $param \uff1a\u5982\u679c\u8def\u7531\u4e2d\u5b58\u5728\u53d8\u91cf\uff08\u52a8\u6001\u8def\u7531\uff09\uff0c\u5219\u4f1a\u628a\u52a8\u6001\u8def\u7531\u6240\u5339\u914d\u7684\u53c2\u6570\u653e\u5165 $param \u6570\u7ec4\u4e2d\u3002 1 2 3 4 5 6 /** * @RequestMapping(route=\"/test/{ass}\") */ public function testName($param) { return \"Your name is \".($param[\"ass\"] ?? \"unknown\"); } \u8def\u7531\u793a\u4f8b \u4ee3\u7801 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <?php namespace Module\\Example ; use ZM\\Annotation\\Http\\Controller ; use ZM\\Annotation\\Http\\RequestMapping ; /** * @Controller(\"/api\") */ class Hello { /** * @RequestMapping(\"/index\") */ public function index (){ ctx () -> getResponse () -> end ( \"This is API index page\" ); // \u4f7f\u7528\u4e0a\u4e0b\u6587\u83b7\u53d6\u54cd\u5e94\u5bf9\u8c61 } /** * @RequestMapping(\"/ping\") */ public function ping (){ return \"pong\" ; // \u76f4\u63a5\u8fd4\u56de\u5b57\u7b26\u4e32 } } \u6548\u679c \u6548\u679c\u63cf\u8ff0 \u5f53\u8bbf\u95ee\u6d4f\u89c8\u5668\u7684 http://localhost:20001/api/index \u65f6\uff0c\u6d4f\u89c8\u5668\u4f1a\u8fd4\u56de This is API index page \uff0c\u5f53\u8bbf\u95ee /api/ping \u7684 url \u65f6\uff0c\u6d4f\u89c8\u5668\u4f1a\u8fd4\u56de pong \u3002 1 2 3 / -> \u65e0\u4efb\u4f55\u8def\u7531 /api/index -> Hello->index /api/ping -> Hello->ping \u63d0\u793a \u5f53 @Controller \u4e3a / \u7684\u65f6\u5019\uff0c\u6548\u679c\u548c\u4e0d\u5199\u662f\u4e00\u6837\u7684\uff0c @RequestMapping \u4e3a / \u6216 /index/inside \u7b49\u591a\u7ea7\u8def\u7531\u4e5f\u662f\u53ef\u4ee5\u7684\u3002 \u7ed1\u5b9a\u53c2\u6570 \u5728 @RequestMapping \u4e2d\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u5199\u9759\u6001\u7684\u8def\u7531\u5730\u5740\uff0c\u4e5f\u53ef\u4ee5\u5199\u7ed1\u5b9a\u7684\u53c2\u6570\u3002\u4f8b\u5982\uff1a @RequestMapping(route=\"/index/{name}\") \uff0c\u5219\u8bbf\u95ee /index/xxx \u7684\u65f6\u5019\uff0c\u4f60\u5728\u51fd\u6570\u65b9\u6cd5\u5185\u53ef\u4ee5\u8fd9\u6837\u83b7\u53d6\u6b64\u53c2\u6570\uff1a 1 2 3 4 5 6 /** * @RequestMapping(\"/index/{name}\") */ public function index($arg) { return \"Your param 'name' is \".$arg[\"name\"]; } \u83b7\u53d6\u8bf7\u6c42\u53c2\u6570 GET / POST \u70b8\u6bdb\u6846\u67b6\u652f\u6301\u83b7\u53d6\u5916\u90e8 HTTP \u8bf7\u6c42\u8fdb\u6765\u7684 GET \u548c POST \u8bf7\u6c42\uff0c\u901a\u8fc7\u83b7\u53d6 HTTP \u8bf7\u6c42\u5bf9\u8c61 Request \u5373\u53ef\u3002\u5bf9\u8c61\u5177\u4f53\u5c5e\u6027\u548c\u65b9\u6cd5\u70b9\u8fd9\u4e2a\u94fe\u63a5\u8fdb\u53bb\u5c31\u884c\u3002 \u793a\u4f8b \u83b7\u53d6 GET 1 2 3 4 5 6 7 8 /** * @RequestMapping(\"/testUrl\") */ public function testUrl() { $get = ctx()->getRequest()->get; if(isset($get[\"name\"])) return \"hello, \".$get[\"name\"]; else return \"Unknown name!!\"; } \u83b7\u53d6 POST\uff08x-www-form-urlencoded\uff09 1 2 3 4 5 6 7 8 /** * @RequestMapping(\"/testUrl\") */ public function testUrl() { $post = ctx()->getRequest()->post; if(isset($post[\"name\"])) return \"hello, \".$post[\"name\"]; else return \"Unknown name!!\"; } \u83b7\u53d6 JSON POST 1 2 3 4 5 6 7 8 9 10 /** * @RequestMapping(\"/testUrl\") */ public function testUrl() { $post = ctx()->getRequest()->rawContent(); $json = json_decode($post, true); if ($json === null) return \"Invalid json data!\"; if(isset($json[\"name\"])) return \"hello, \".$json[\"name\"]; else return \"Unknown name!!\"; } \u8bbe\u7f6e\u8def\u7531\u8bf7\u6c42\u65b9\u5f0f \u5982\u679c\u60f3\u8981\u8bbe\u7f6e\u5141\u8bb8\u8bf7\u6c42\u63a7\u5236\u5668\u7684 HTTP \u8bf7\u6c42\u65b9\u5f0f\uff0c\u53ef\u4ee5\u4f7f\u7528\u65b9\u6cd5\u5728\u63a7\u5236\u5668\u4e2d\u7684 @RequestMapping \u6ce8\u89e3\u914d\u7f6e method \u53c2\u6570\uff0c\u53ef\u4ee5\u662f GET \uff0c POST \uff0c PUT , PATCH \uff0c DELETE \uff0c OPTIONS \uff0c HEAD \u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u3002 \u9650\u5b9a HTTP \u65b9\u6cd5\uff1a @RequestMapping(method=\"GET\") \uff0c @RequestMapping(method={\"GET\",\"POST\"}) \u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668 \u6846\u67b6\u652f\u6301\u4e86\u9759\u6001\u6587\u4ef6\u7684\u8bbf\u95ee\u3002\u5982\u9700\u4f7f\u7528\uff0c\u5219\u9700\u8981\u5148\u5230\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u76f8\u5e94\u7684 static_file_server \u53c2\u6570\u4e2d status \u4e3a true \u3002 \u6846\u67b6\u5206\u4e3a\u4e24\u79cd\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\uff0c\u4e00\u79cd\u662f\u5168\u5c40\u7684\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\uff0c\u6bd4\u5982\u6846\u67b6\u90e8\u7f72\u5728 http://127.0.0.1:20001/ \u4e0a\u901a\u8fc7 HTTP \u8bbf\u95ee\uff0c\u5982\u679c\u6ca1\u6709\u8bbf\u95ee\u5230 @RequestMapping \u6ce8\u89e3\u4e8b\u4ef6\u6ce8\u518c\u7684\u8def\u7531\u5730\u5740\uff0c\u5219\u4f1a\u901a\u8fc7 url \u81ea\u52a8\u67e5\u627e\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\u8bbe\u7f6e\u7684\u6839\u8def\u5f84\u4e0b\u9762\u7684\u6587\u4ef6\uff0c\u5982\u679c\u90fd\u4e0d\u5b58\u5728\u5219\u4f1a\u8fd4\u56de 404\u3002 \u914d\u7f6e\u5168\u5c40\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668 \u6211\u4eec\u5047\u8bbe\u5728\u4f60\u5199\u7684\u6846\u67b6\u5e94\u7528\u7684\u6839\u76ee\u5f55\u4e0b\uff0c\u6709\u5982\u4e0b\u6587\u4ef6\u548c\u5185\u5bb9\uff1a 1 2 3 4 5 6 7 8 9 resources/html/hello.html (\u4e0b\u9762\u662f\u5185\u5bb9) <html> <head> <meta charset=\"utf-8\"> </head> <body> \u6846\u67b6\u6587\u6863\u5185\u5bb9\u592a\u591a\u4e86\uff0c\u5199\u4e0d\u5b8c\uff01\uff01\uff01 </body> </html> \u7136\u540e\u5728 global.php \u914d\u7f6e\u6587\u4ef6\u4e2d\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\u53c2\u6570\u4e3a\uff1a 1 2 3 4 5 6 7 8 /** \u9759\u6001\u6587\u4ef6\u8bbf\u95ee */ $config['static_file_server'] = [ 'status' => true, 'document_root' => realpath(__DIR__ . \"/../\") . '/resources/html', 'document_index' => [ 'index.html' ] ]; \u6700\u7ec8\uff0c\u6211\u4eec\u901a\u8fc7 vendor/bin/start server \u7b49\u65b9\u5f0f\uff0c\u542f\u52a8\u6846\u67b6\u540e\uff0c\u6d4f\u89c8\u5668\u8bbf\u95ee http://127.0.0.1:20001/hello.html \u5373\u53ef\u83b7\u53d6\u5185\u5bb9\u3002 \u914d\u7f6e\u5c40\u90e8\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668 \u6240\u6d89\u53ca\u7684\u7c7b\u7684\u547d\u540d\u7a7a\u95f4\uff1a use ZM\\Http\\StaticFileHandler; \u5c40\u90e8\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\u4e00\u822c\u7528\u4e8e\uff0c\u6bd4\u5982\u673a\u5668\u4eba\u8981\u53d1\u9001\u56fe\u7247\uff0c\u6216\u8005\u7ed9\u5176\u4ed6 HTTP \u670d\u52a1\u63d0\u4f9b\u6587\u4ef6\u4e0b\u8f7d\u7684\u63a5\u53e3\u65f6\u53ef\u7528\u3002\u6211\u4eec\u5047\u8bbe\u5199\u4e86\u4e00\u4e2a\u56fe\u7247\u6536\u96c6\u7684\u4e00\u4e2a\u9759\u6001\u6587\u4ef6\u5939\u533a\u57df\uff0c\u5c06\u5176\u4e2d\u4e00\u4e2a\u5b50\u8def\u7531\u5f53\u4f5c\u56fe\u7247\u9759\u6001\u76ee\u5f55\uff1a 1 2 3 4 5 6 7 8 9 /** * @RequestMapping(\"/images/{filename}\") * @param $param * @return StaticFileHandler */ public function staticImage($param) { Console::info(\"[\u4e0b\u8f7d\u56fe\u7247] \" . $param[\"filename\"]); return new StaticFileHandler($param[\"filename\"], \"/path/to/your/image_dir/\"); } \u8fd9\u6837\u5f53\u7528\u6237\u8bbf\u95ee http://\u6846\u67b6\u5730\u5740/images/aaa.jpg \u5c31\u53ef\u4ee5\u5feb\u901f\u5730\u8c03\u7528\u6b64\u8def\u7531\u4e0b\u7684\u5c40\u90e8\u6587\u4ef6\u670d\u52a1\u5668\u529f\u80fd\u4e86\u3002","title":"HTTP \u8def\u7531\u6ce8\u89e3\u4e8b\u4ef6"},{"location":"event/route-annotations/#_1","text":"\u70b8\u6bdb\u6846\u67b6\u63d0\u4f9b\u4e86\u4e00\u4e2a\u7b80\u6613\u4f46\u662f\u9ad8\u6548\u6613\u7528\u7684 HTTP \u8def\u7531\u6ce8\u89e3\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u8def\u7531\u529f\u80fd\u6765\u5f00\u53d1\u4efb\u4f55 Web \u5e94\u7528\u5fae\u670d\u52a1\u3001API \u63a5\u53e3\u3001\u4e2d\u95f4\u4ef6\u7b49\u3002 \u5f00\u53d1\u63d0\u793a \u672c\u7ae0\u8282\u6d89\u53ca\u7684\u8def\u7531\u548c\u63a7\u5236\u5668\u6982\u5ff5\u53ef\u80fd\u548c\u5176\u4ed6\u4f20\u7edf\u6846\u67b6\u6709\u4e00\u4e9b\u51fa\u5165\uff0c\u800c\u4e14\u70b8\u6bdb\u6846\u67b6\u975e\u7edd\u5bf9\u6839\u636e PSR \u6807\u51c6\u8fdb\u884c\u5f00\u53d1\uff0c\u76ee\u7684\u662f\u4f7f\u7528\u4e0a\u4e00\u4e9b\u5e38\u89c1\u7684\u4e1c\u897f\u5c3d\u53ef\u80fd\u5730\u7075\u6d3b\u548c\u4e0d\u5570\u55e6\u3002","title":"\u8def\u7531\u6ce8\u89e3\u4e8b\u4ef6"},{"location":"event/route-annotations/#_2","text":"Controller \u548c Route \u4e3a\u8def\u7531\u6ce8\u89e3\u4e8b\u4ef6\u7684\u6838\u5fc3\u6ce8\u89e3\u4e8b\u4ef6\uff0c\u5176\u4e2d Controller \u7684\u6ce8\u89e3\u4e8b\u4ef6\u4e3a @Controller \uff0cRoute \u7684\u6ce8\u89e3\u4e8b\u4ef6\u4e3a @RequestMapping \u3002","title":"\u63a7\u5236\u5668\u548c\u8def\u7531"},{"location":"event/route-annotations/#controller","text":"","title":"Controller()"},{"location":"event/route-annotations/#_3","text":"\u7c7b\u578b \u503c \u540d\u79f0 @Controller \u89e6\u53d1\u524d\u63d0 \u5f53\u8def\u7531 url \u5339\u914d\u5230\u65f6\u8fdb\u5165\u89e6\u53d1 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Http\\Controller \u9002\u7528\u4f4d\u7f6e \u7c7b \u8fd4\u56de\u503c\u5904\u7406 \u5bf9\u7c7b\u6ce8\u89e3\u4fee\u9970\uff0c\u65e0\u8fd4\u56de\u503c","title":"\u5c5e\u6027"},{"location":"event/route-annotations/#_4","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 prefix string \uff0c\u5fc5\u9700 \u63a7\u5236\u5668\u7684 url \u7a7a","title":"\u53c2\u6570"},{"location":"event/route-annotations/#requestmapping","text":"","title":"RequestMapping()"},{"location":"event/route-annotations/#_5","text":"\u7c7b\u578b \u503c \u540d\u79f0 @RequestMapping \u89e6\u53d1\u524d\u63d0 \u5f53\u8def\u7531 url \u5339\u914d\u5230\u65f6\u8fdb\u5165\u89e6\u53d1 \u547d\u540d\u7a7a\u95f4 ZM\\Annotation\\Http\\RequestMapping \u9002\u7528\u4f4d\u7f6e \u65b9\u6cd5 \u8fd4\u56de\u503c\u5904\u7406 \u8fd4\u56de\u7c7b\u578b\u662f string \u65f6\uff0c\u81ea\u52a8\u8c03\u7528 HTTP \u54cd\u5e94\u5e76\u8fd4\u56de 200 \u72b6\u6001\u7801","title":"\u5c5e\u6027"},{"location":"event/route-annotations/#_6","text":"\u53c2\u6570\u540d\u79f0 \u53c2\u6570\u8303\u56f4 \u7528\u9014 \u9ed8\u8ba4 route string \uff0c\u5fc5\u9700 \u63a7\u5236\u5668\u7684 url \u7a7a name string \u8def\u7531\u7684\u540d\u79f0 \u7a7a request_method array \uff0c\u9650\u5b9a RequestMethod::GET \u7b49\u5e38\u91cf \u9650\u5236\u6fc0\u6d3b\u8def\u7531\u7684 HTTP \u65b9\u6cd5 [RequestMethod::GET,RequestMethod::POST] params array \uff0c\u5f53\u8def\u7531\u4e2d\u542b\u6709\u5982 {id} \u7c7b\u4f3c\u7684\u52a8\u6001\u8def\u7531\u65f6\uff0c\u4f1a\u52a8\u6001\u6539\u53d8 \u52a8\u6001\u53c2\u6570\u7684\u8def\u7531\u53c2\u6570\u503c\u7684\u7ed1\u5b9a []","title":"\u53c2\u6570"},{"location":"event/route-annotations/#_7","text":"$param \uff1a\u5982\u679c\u8def\u7531\u4e2d\u5b58\u5728\u53d8\u91cf\uff08\u52a8\u6001\u8def\u7531\uff09\uff0c\u5219\u4f1a\u628a\u52a8\u6001\u8def\u7531\u6240\u5339\u914d\u7684\u53c2\u6570\u653e\u5165 $param \u6570\u7ec4\u4e2d\u3002 1 2 3 4 5 6 /** * @RequestMapping(route=\"/test/{ass}\") */ public function testName($param) { return \"Your name is \".($param[\"ass\"] ?? \"unknown\"); }","title":"\u51fd\u6570\u8c03\u7528\u53c2\u6570"},{"location":"event/route-annotations/#_8","text":"\u4ee3\u7801 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 <?php namespace Module\\Example ; use ZM\\Annotation\\Http\\Controller ; use ZM\\Annotation\\Http\\RequestMapping ; /** * @Controller(\"/api\") */ class Hello { /** * @RequestMapping(\"/index\") */ public function index (){ ctx () -> getResponse () -> end ( \"This is API index page\" ); // \u4f7f\u7528\u4e0a\u4e0b\u6587\u83b7\u53d6\u54cd\u5e94\u5bf9\u8c61 } /** * @RequestMapping(\"/ping\") */ public function ping (){ return \"pong\" ; // \u76f4\u63a5\u8fd4\u56de\u5b57\u7b26\u4e32 } } \u6548\u679c \u6548\u679c\u63cf\u8ff0 \u5f53\u8bbf\u95ee\u6d4f\u89c8\u5668\u7684 http://localhost:20001/api/index \u65f6\uff0c\u6d4f\u89c8\u5668\u4f1a\u8fd4\u56de This is API index page \uff0c\u5f53\u8bbf\u95ee /api/ping \u7684 url \u65f6\uff0c\u6d4f\u89c8\u5668\u4f1a\u8fd4\u56de pong \u3002 1 2 3 / -> \u65e0\u4efb\u4f55\u8def\u7531 /api/index -> Hello->index /api/ping -> Hello->ping \u63d0\u793a \u5f53 @Controller \u4e3a / \u7684\u65f6\u5019\uff0c\u6548\u679c\u548c\u4e0d\u5199\u662f\u4e00\u6837\u7684\uff0c @RequestMapping \u4e3a / \u6216 /index/inside \u7b49\u591a\u7ea7\u8def\u7531\u4e5f\u662f\u53ef\u4ee5\u7684\u3002","title":"\u8def\u7531\u793a\u4f8b"},{"location":"event/route-annotations/#_9","text":"\u5728 @RequestMapping \u4e2d\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u5199\u9759\u6001\u7684\u8def\u7531\u5730\u5740\uff0c\u4e5f\u53ef\u4ee5\u5199\u7ed1\u5b9a\u7684\u53c2\u6570\u3002\u4f8b\u5982\uff1a @RequestMapping(route=\"/index/{name}\") \uff0c\u5219\u8bbf\u95ee /index/xxx \u7684\u65f6\u5019\uff0c\u4f60\u5728\u51fd\u6570\u65b9\u6cd5\u5185\u53ef\u4ee5\u8fd9\u6837\u83b7\u53d6\u6b64\u53c2\u6570\uff1a 1 2 3 4 5 6 /** * @RequestMapping(\"/index/{name}\") */ public function index($arg) { return \"Your param 'name' is \".$arg[\"name\"]; }","title":"\u7ed1\u5b9a\u53c2\u6570"},{"location":"event/route-annotations/#get-post","text":"\u70b8\u6bdb\u6846\u67b6\u652f\u6301\u83b7\u53d6\u5916\u90e8 HTTP \u8bf7\u6c42\u8fdb\u6765\u7684 GET \u548c POST \u8bf7\u6c42\uff0c\u901a\u8fc7\u83b7\u53d6 HTTP \u8bf7\u6c42\u5bf9\u8c61 Request \u5373\u53ef\u3002\u5bf9\u8c61\u5177\u4f53\u5c5e\u6027\u548c\u65b9\u6cd5\u70b9\u8fd9\u4e2a\u94fe\u63a5\u8fdb\u53bb\u5c31\u884c\u3002","title":"\u83b7\u53d6\u8bf7\u6c42\u53c2\u6570 GET / POST"},{"location":"event/route-annotations/#_10","text":"\u83b7\u53d6 GET 1 2 3 4 5 6 7 8 /** * @RequestMapping(\"/testUrl\") */ public function testUrl() { $get = ctx()->getRequest()->get; if(isset($get[\"name\"])) return \"hello, \".$get[\"name\"]; else return \"Unknown name!!\"; } \u83b7\u53d6 POST\uff08x-www-form-urlencoded\uff09 1 2 3 4 5 6 7 8 /** * @RequestMapping(\"/testUrl\") */ public function testUrl() { $post = ctx()->getRequest()->post; if(isset($post[\"name\"])) return \"hello, \".$post[\"name\"]; else return \"Unknown name!!\"; } \u83b7\u53d6 JSON POST 1 2 3 4 5 6 7 8 9 10 /** * @RequestMapping(\"/testUrl\") */ public function testUrl() { $post = ctx()->getRequest()->rawContent(); $json = json_decode($post, true); if ($json === null) return \"Invalid json data!\"; if(isset($json[\"name\"])) return \"hello, \".$json[\"name\"]; else return \"Unknown name!!\"; }","title":"\u793a\u4f8b"},{"location":"event/route-annotations/#_11","text":"\u5982\u679c\u60f3\u8981\u8bbe\u7f6e\u5141\u8bb8\u8bf7\u6c42\u63a7\u5236\u5668\u7684 HTTP \u8bf7\u6c42\u65b9\u5f0f\uff0c\u53ef\u4ee5\u4f7f\u7528\u65b9\u6cd5\u5728\u63a7\u5236\u5668\u4e2d\u7684 @RequestMapping \u6ce8\u89e3\u914d\u7f6e method \u53c2\u6570\uff0c\u53ef\u4ee5\u662f GET \uff0c POST \uff0c PUT , PATCH \uff0c DELETE \uff0c OPTIONS \uff0c HEAD \u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u3002 \u9650\u5b9a HTTP \u65b9\u6cd5\uff1a @RequestMapping(method=\"GET\") \uff0c @RequestMapping(method={\"GET\",\"POST\"})","title":"\u8bbe\u7f6e\u8def\u7531\u8bf7\u6c42\u65b9\u5f0f"},{"location":"event/route-annotations/#_12","text":"\u6846\u67b6\u652f\u6301\u4e86\u9759\u6001\u6587\u4ef6\u7684\u8bbf\u95ee\u3002\u5982\u9700\u4f7f\u7528\uff0c\u5219\u9700\u8981\u5148\u5230\u914d\u7f6e\u6587\u4ef6\u4e2d\u914d\u7f6e\u76f8\u5e94\u7684 static_file_server \u53c2\u6570\u4e2d status \u4e3a true \u3002 \u6846\u67b6\u5206\u4e3a\u4e24\u79cd\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\uff0c\u4e00\u79cd\u662f\u5168\u5c40\u7684\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\uff0c\u6bd4\u5982\u6846\u67b6\u90e8\u7f72\u5728 http://127.0.0.1:20001/ \u4e0a\u901a\u8fc7 HTTP \u8bbf\u95ee\uff0c\u5982\u679c\u6ca1\u6709\u8bbf\u95ee\u5230 @RequestMapping \u6ce8\u89e3\u4e8b\u4ef6\u6ce8\u518c\u7684\u8def\u7531\u5730\u5740\uff0c\u5219\u4f1a\u901a\u8fc7 url \u81ea\u52a8\u67e5\u627e\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\u8bbe\u7f6e\u7684\u6839\u8def\u5f84\u4e0b\u9762\u7684\u6587\u4ef6\uff0c\u5982\u679c\u90fd\u4e0d\u5b58\u5728\u5219\u4f1a\u8fd4\u56de 404\u3002","title":"\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668"},{"location":"event/route-annotations/#_13","text":"\u6211\u4eec\u5047\u8bbe\u5728\u4f60\u5199\u7684\u6846\u67b6\u5e94\u7528\u7684\u6839\u76ee\u5f55\u4e0b\uff0c\u6709\u5982\u4e0b\u6587\u4ef6\u548c\u5185\u5bb9\uff1a 1 2 3 4 5 6 7 8 9 resources/html/hello.html (\u4e0b\u9762\u662f\u5185\u5bb9) <html> <head> <meta charset=\"utf-8\"> </head> <body> \u6846\u67b6\u6587\u6863\u5185\u5bb9\u592a\u591a\u4e86\uff0c\u5199\u4e0d\u5b8c\uff01\uff01\uff01 </body> </html> \u7136\u540e\u5728 global.php \u914d\u7f6e\u6587\u4ef6\u4e2d\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\u53c2\u6570\u4e3a\uff1a 1 2 3 4 5 6 7 8 /** \u9759\u6001\u6587\u4ef6\u8bbf\u95ee */ $config['static_file_server'] = [ 'status' => true, 'document_root' => realpath(__DIR__ . \"/../\") . '/resources/html', 'document_index' => [ 'index.html' ] ]; \u6700\u7ec8\uff0c\u6211\u4eec\u901a\u8fc7 vendor/bin/start server \u7b49\u65b9\u5f0f\uff0c\u542f\u52a8\u6846\u67b6\u540e\uff0c\u6d4f\u89c8\u5668\u8bbf\u95ee http://127.0.0.1:20001/hello.html \u5373\u53ef\u83b7\u53d6\u5185\u5bb9\u3002","title":"\u914d\u7f6e\u5168\u5c40\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668"},{"location":"event/route-annotations/#_14","text":"\u6240\u6d89\u53ca\u7684\u7c7b\u7684\u547d\u540d\u7a7a\u95f4\uff1a use ZM\\Http\\StaticFileHandler; \u5c40\u90e8\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\u4e00\u822c\u7528\u4e8e\uff0c\u6bd4\u5982\u673a\u5668\u4eba\u8981\u53d1\u9001\u56fe\u7247\uff0c\u6216\u8005\u7ed9\u5176\u4ed6 HTTP \u670d\u52a1\u63d0\u4f9b\u6587\u4ef6\u4e0b\u8f7d\u7684\u63a5\u53e3\u65f6\u53ef\u7528\u3002\u6211\u4eec\u5047\u8bbe\u5199\u4e86\u4e00\u4e2a\u56fe\u7247\u6536\u96c6\u7684\u4e00\u4e2a\u9759\u6001\u6587\u4ef6\u5939\u533a\u57df\uff0c\u5c06\u5176\u4e2d\u4e00\u4e2a\u5b50\u8def\u7531\u5f53\u4f5c\u56fe\u7247\u9759\u6001\u76ee\u5f55\uff1a 1 2 3 4 5 6 7 8 9 /** * @RequestMapping(\"/images/{filename}\") * @param $param * @return StaticFileHandler */ public function staticImage($param) { Console::info(\"[\u4e0b\u8f7d\u56fe\u7247] \" . $param[\"filename\"]); return new StaticFileHandler($param[\"filename\"], \"/path/to/your/image_dir/\"); } \u8fd9\u6837\u5f53\u7528\u6237\u8bbf\u95ee http://\u6846\u67b6\u5730\u5740/images/aaa.jpg \u5c31\u53ef\u4ee5\u5feb\u901f\u5730\u8c03\u7528\u6b64\u8def\u7531\u4e0b\u7684\u5c40\u90e8\u6587\u4ef6\u670d\u52a1\u5668\u529f\u80fd\u4e86\u3002","title":"\u914d\u7f6e\u5c40\u90e8\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668"},{"location":"faq/FAQ/","text":"FAQ \u8fd9\u91cc\u4f1a\u5199\u4e00\u4e9b\u5e38\u89c1\u7684\u7591\u96be\u89e3\u7b54\uff0c\u70b9\u51fb\u5de6\u4fa7\u95ee\u9898\u540d\u79f0\u6253\u5f00\u5bf9\u5e94\u89e3\u51b3\u65b9\u6cd5\u3002 \u5982\u679c\u6846\u67b6\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u5e26\u6709\u9519\u8bef\u7801\uff08\u5982 E00034 \u7684\u5f62\u5f0f\uff09\uff0c\u53ef\u4ee5\u5230 \u9519\u8bef\u7801 \u67e5\u770b\u3002 \u6846\u67b6\u7684\u5e38\u89c1\u95ee\u9898\u89c1 \u5e38\u89c1\u95ee\u9898\u6c47\u603b \u3002","title":"FAQ"},{"location":"faq/FAQ/#faq","text":"\u8fd9\u91cc\u4f1a\u5199\u4e00\u4e9b\u5e38\u89c1\u7684\u7591\u96be\u89e3\u7b54\uff0c\u70b9\u51fb\u5de6\u4fa7\u95ee\u9898\u540d\u79f0\u6253\u5f00\u5bf9\u5e94\u89e3\u51b3\u65b9\u6cd5\u3002 \u5982\u679c\u6846\u67b6\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u5e26\u6709\u9519\u8bef\u7801\uff08\u5982 E00034 \u7684\u5f62\u5f0f\uff09\uff0c\u53ef\u4ee5\u5230 \u9519\u8bef\u7801 \u67e5\u770b\u3002 \u6846\u67b6\u7684\u5e38\u89c1\u95ee\u9898\u89c1 \u5e38\u89c1\u95ee\u9898\u6c47\u603b \u3002","title":"FAQ"},{"location":"faq/address-already-in-use/","text":"\u542f\u52a8\u65f6\u62a5\u9519 Address already in use \u68c0\u67e5\u662f\u5426\u5f00\u542f\u4e86\u4e24\u6b21\u6846\u67b6\uff0c\u6bcf\u4e2a\u7aef\u53e3\u53ea\u80fd\u5f00\u542f\u4e00\u4e2a\u6846\u67b6\u3002 \u5982\u679c\u662f\u4e4b\u524d\u5df2\u7ecf\u5728 20001 \u7aef\u53e3\u6216\u8005\u4f60\u8bbe\u7f6e\u4e86\u522b\u7684\u5e94\u7528\u540c\u6837\u5360\u7528\u6b64\u7aef\u53e3\uff0c\u66f4\u6362\u914d\u7f6e\u6587\u4ef6 global.php \u4e2d\u7684 port \u5373\u53ef\u3002 \u5982\u679c\u662f\u4e4b\u524d\u6846\u67b6\u6210\u529f\u542f\u52a8\uff0c\u4f46\u662f\u4f7f\u7528 Ctrl+C \u505c\u6b62\u540e\u518d\u6b21\u542f\u52a8\u5bfc\u81f4\u7684\u62a5\u9519\uff0c\u8bf7\u6839\u636e\u4e0b\u9762\u7684\u6b65\u9aa4\u6765\u68c0\u67e5\u662f\u5426\u5b58\u5728\u50f5\u5c38\u8fdb\u7a0b\u3002 \u5982\u679c\u7cfb\u7edf\u5185\u88c5\u6709 htop \uff0c\u53ef\u4ee5\u76f4\u63a5\u5728 htop \u4e2d\u5f00\u542f Tree \u6a21\u5f0f\u5e76\u4f7f\u7528 filter \u8fc7\u6ee4 php\uff0c\u68c0\u67e5\u6b8b\u7559\u7684\u6846\u67b6\u8fdb\u7a0b\u3002 \u5982\u679c\u7cfb\u7edf\u6ca1\u6709 htop \uff0c\u4f7f\u7528 ps aux | grep vendor/bin/start | grep -v grep \u5982\u679c\u5b58\u5728\u8fdb\u7a0b\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5c1d\u8bd5\u6740\u6389\uff1a 1 2 3 4 5 6 7 8 # \u5982\u679c\u786e\u5b9a\u6846\u67b6\u7684\u6570\u636e\u90fd\u5df2\u4fdd\u5b58\u4e14\u6ca1\u6709\u9700\u8981\u4fdd\u5b58\u7684\u7f13\u5b58\u6570\u636e\uff0c\u76f4\u63a5\u6740\u6389 SIGKILL \u5373\u53ef\uff0c\u8f93\u5165\u4e0b\u9762\u8fd9\u6761 ps aux | grep vendor/bin/start | grep -v grep | awk '{print $2}' | xargs kill -9 # \u5982\u679c\u4e0d\u786e\u5b9a\u6846\u67b6\u662f\u4e0d\u662f\u8fd8\u7ee7\u7eed\u8fd0\u884c\uff0c\u60f3\u5c1d\u8bd5\u6b63\u5e38\u5173\u95ed\uff08\u8d70\u4e00\u904d\u50a8\u5b58\u4fdd\u5b58\u6570\u636e\u7684\u4e8b\u4ef6\uff09\uff0c\u4f7f\u7528\u4e0b\u9762\u8fd9\u6761 # \u9996\u5148\u4f7f\u7528 'ps aux | grep vendor/bin/start | grep -v grep' \u627e\u5230\u8fdb\u7a0b\u4e2d\u7b2c\u4e8c\u5217\u6700\u5c0f\u7684pid # \u7136\u540e\u4f7f\u7528\u4e0b\u9762\u7684\u8fd9\u6761\u547d\u4ee4\uff0c\u5047\u8bbe\u6700\u5c0f\u7684pid\u662f23643 kill -INT 23643 # \u5982\u679c\u4f7f\u7528 ps aux \u770b\u4e0d\u5230\u6846\u67b6\u76f8\u5173\u8fdb\u7a0b\uff0c\u8bc1\u660e\u5173\u95ed\u6210\u529f\uff0c\u5426\u5219\u9700\u8981\u4f7f\u7528\u7b2c\u4e00\u6761\u5f3a\u884c\u6740\u6b7b","title":"\u542f\u52a8\u65f6\u62a5\u9519 Address already in use"},{"location":"faq/address-already-in-use/#address-already-in-use","text":"\u68c0\u67e5\u662f\u5426\u5f00\u542f\u4e86\u4e24\u6b21\u6846\u67b6\uff0c\u6bcf\u4e2a\u7aef\u53e3\u53ea\u80fd\u5f00\u542f\u4e00\u4e2a\u6846\u67b6\u3002 \u5982\u679c\u662f\u4e4b\u524d\u5df2\u7ecf\u5728 20001 \u7aef\u53e3\u6216\u8005\u4f60\u8bbe\u7f6e\u4e86\u522b\u7684\u5e94\u7528\u540c\u6837\u5360\u7528\u6b64\u7aef\u53e3\uff0c\u66f4\u6362\u914d\u7f6e\u6587\u4ef6 global.php \u4e2d\u7684 port \u5373\u53ef\u3002 \u5982\u679c\u662f\u4e4b\u524d\u6846\u67b6\u6210\u529f\u542f\u52a8\uff0c\u4f46\u662f\u4f7f\u7528 Ctrl+C \u505c\u6b62\u540e\u518d\u6b21\u542f\u52a8\u5bfc\u81f4\u7684\u62a5\u9519\uff0c\u8bf7\u6839\u636e\u4e0b\u9762\u7684\u6b65\u9aa4\u6765\u68c0\u67e5\u662f\u5426\u5b58\u5728\u50f5\u5c38\u8fdb\u7a0b\u3002 \u5982\u679c\u7cfb\u7edf\u5185\u88c5\u6709 htop \uff0c\u53ef\u4ee5\u76f4\u63a5\u5728 htop \u4e2d\u5f00\u542f Tree \u6a21\u5f0f\u5e76\u4f7f\u7528 filter \u8fc7\u6ee4 php\uff0c\u68c0\u67e5\u6b8b\u7559\u7684\u6846\u67b6\u8fdb\u7a0b\u3002 \u5982\u679c\u7cfb\u7edf\u6ca1\u6709 htop \uff0c\u4f7f\u7528 ps aux | grep vendor/bin/start | grep -v grep \u5982\u679c\u5b58\u5728\u8fdb\u7a0b\uff0c\u8bf7\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5c1d\u8bd5\u6740\u6389\uff1a 1 2 3 4 5 6 7 8 # \u5982\u679c\u786e\u5b9a\u6846\u67b6\u7684\u6570\u636e\u90fd\u5df2\u4fdd\u5b58\u4e14\u6ca1\u6709\u9700\u8981\u4fdd\u5b58\u7684\u7f13\u5b58\u6570\u636e\uff0c\u76f4\u63a5\u6740\u6389 SIGKILL \u5373\u53ef\uff0c\u8f93\u5165\u4e0b\u9762\u8fd9\u6761 ps aux | grep vendor/bin/start | grep -v grep | awk '{print $2}' | xargs kill -9 # \u5982\u679c\u4e0d\u786e\u5b9a\u6846\u67b6\u662f\u4e0d\u662f\u8fd8\u7ee7\u7eed\u8fd0\u884c\uff0c\u60f3\u5c1d\u8bd5\u6b63\u5e38\u5173\u95ed\uff08\u8d70\u4e00\u904d\u50a8\u5b58\u4fdd\u5b58\u6570\u636e\u7684\u4e8b\u4ef6\uff09\uff0c\u4f7f\u7528\u4e0b\u9762\u8fd9\u6761 # \u9996\u5148\u4f7f\u7528 'ps aux | grep vendor/bin/start | grep -v grep' \u627e\u5230\u8fdb\u7a0b\u4e2d\u7b2c\u4e8c\u5217\u6700\u5c0f\u7684pid # \u7136\u540e\u4f7f\u7528\u4e0b\u9762\u7684\u8fd9\u6761\u547d\u4ee4\uff0c\u5047\u8bbe\u6700\u5c0f\u7684pid\u662f23643 kill -INT 23643 # \u5982\u679c\u4f7f\u7528 ps aux \u770b\u4e0d\u5230\u6846\u67b6\u76f8\u5173\u8fdb\u7a0b\uff0c\u8bc1\u660e\u5173\u95ed\u6210\u529f\uff0c\u5426\u5219\u9700\u8981\u4f7f\u7528\u7b2c\u4e00\u6761\u5f3a\u884c\u6740\u6b7b","title":"\u542f\u52a8\u65f6\u62a5\u9519 Address already in use"},{"location":"faq/display-deadlock/","text":"\u51fa\u73b0 deadlock \u5b57\u6837 \u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u8bef\u64cd\u4f5c\u6846\u67b6\u53ef\u80fd\u4f1a\u62a5\u5982\u4e0b\u56fe\u7684\u9519\u8bef\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 =================================================================== [FATAL ERROR]: all coroutines (count: 1) are asleep - deadlock! =================================================================== [Coroutine-1] -------------------------------------------------------------------- #0 Swoole\\Coroutine\\System::sleep() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/global_functions.php:232] #1 zm_sleep() called at [/Users/jerry/project/git-project/zhamao-framework/src/Module/Example/Hello.php:38] #2 Module\\Example\\Hello->onStart() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/Event/EventDispatcher.php:205] #3 ZM\\Event\\EventDispatcher->dispatchEvent() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/Event/EventDispatcher.php:89] #4 ZM\\Event\\EventDispatcher->dispatchEvents() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/Event/SwooleEvent/OnWorkerStart.php:130] #5 ZM\\Event\\SwooleEvent\\OnWorkerStart->onCall() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/Framework.php:336] \u8fd9\u79cd\u9519\u8bef\u7684\u51fa\u73b0\u539f\u56e0\u4e00\u822c\u662f\u56e0\u4e3a\u534f\u7a0b\u672a\u7ed3\u675f\u800c Worker \u8fdb\u7a0b\u63d0\u524d\u9000\u51fa\u5bfc\u81f4\u7684\uff0c\u8fd9\u4e2a\u9519\u8bef\u4e5f\u53ef\u624b\u52a8\u9020\u6210\uff08\u5728\u4efb\u610f Worker \u8fdb\u7a0b\u5185\u7684\u4f4d\u7f6e\u4f7f\u7528 zm_yield() \u4e14\u4e0d\u4f7f\u7528 zm_resume() \u6062\u590d\uff0c\u671f\u95f4\u4f7f\u7528 reload \u6216 stop \u91cd\u542f\u6216\u505c\u6b62\u6846\u67b6\u5c31\u4f1a\u62a5\u9519\uff09\u3002 \u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\u662f\u6570\u636e\u5e93\u3001\u6587\u4ef6\u8bfb\u53d6\u6216\u4e0b\u8f7d\u4e0a\u4f20\u8fd8\u6ca1\u6709\u4f20\u9001\u7ed3\u675f\uff0c\u65f6\u95f4\u5df2\u7ecf\u8d85\u65f6\uff0c\u5728\u5173\u95ed\u6216\u91cd\u542f\u6846\u67b6\u65f6\u4e0d\u5f97\u4e0d\u5f3a\u884c\u5207\u65ad\u534f\u7a0b\u7684\u8fd0\u884c\u3002\u8fd9\u79cd\u60c5\u51b5\u5efa\u8bae\u6839\u636e\u4e0b\u65b9\u7684\u6253\u5370\u8f93\u51fa\u6808\u8fdb\u884c\u63d2\u9519\uff0c\u5efa\u8bae\u5c06\u534f\u7a0b\u8fd0\u884c\u65f6\u95f4\u957f\u7684\u8fc7\u7a0b\u7f29\u77ed\u6216\u8c03\u957f swoole \u914d\u7f6e\u9879\u4e0b\u9762\u7684 max_wait_time \u65f6\u95f4\uff08\u79d2\uff09\uff0c2.4.3 \u7248\u672c\u8d77\u6b64\u53c2\u6570\u9ed8\u8ba4\u4e3a 5 \u79d2\u3002","title":"\u51fa\u73b0 deadlock \u5b57\u6837"},{"location":"faq/display-deadlock/#deadlock","text":"\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u8bef\u64cd\u4f5c\u6846\u67b6\u53ef\u80fd\u4f1a\u62a5\u5982\u4e0b\u56fe\u7684\u9519\u8bef\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 =================================================================== [FATAL ERROR]: all coroutines (count: 1) are asleep - deadlock! =================================================================== [Coroutine-1] -------------------------------------------------------------------- #0 Swoole\\Coroutine\\System::sleep() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/global_functions.php:232] #1 zm_sleep() called at [/Users/jerry/project/git-project/zhamao-framework/src/Module/Example/Hello.php:38] #2 Module\\Example\\Hello->onStart() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/Event/EventDispatcher.php:205] #3 ZM\\Event\\EventDispatcher->dispatchEvent() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/Event/EventDispatcher.php:89] #4 ZM\\Event\\EventDispatcher->dispatchEvents() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/Event/SwooleEvent/OnWorkerStart.php:130] #5 ZM\\Event\\SwooleEvent\\OnWorkerStart->onCall() called at [/Users/jerry/project/git-project/zhamao-framework/src/ZM/Framework.php:336] \u8fd9\u79cd\u9519\u8bef\u7684\u51fa\u73b0\u539f\u56e0\u4e00\u822c\u662f\u56e0\u4e3a\u534f\u7a0b\u672a\u7ed3\u675f\u800c Worker \u8fdb\u7a0b\u63d0\u524d\u9000\u51fa\u5bfc\u81f4\u7684\uff0c\u8fd9\u4e2a\u9519\u8bef\u4e5f\u53ef\u624b\u52a8\u9020\u6210\uff08\u5728\u4efb\u610f Worker \u8fdb\u7a0b\u5185\u7684\u4f4d\u7f6e\u4f7f\u7528 zm_yield() \u4e14\u4e0d\u4f7f\u7528 zm_resume() \u6062\u590d\uff0c\u671f\u95f4\u4f7f\u7528 reload \u6216 stop \u91cd\u542f\u6216\u505c\u6b62\u6846\u67b6\u5c31\u4f1a\u62a5\u9519\uff09\u3002 \u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\u662f\u6570\u636e\u5e93\u3001\u6587\u4ef6\u8bfb\u53d6\u6216\u4e0b\u8f7d\u4e0a\u4f20\u8fd8\u6ca1\u6709\u4f20\u9001\u7ed3\u675f\uff0c\u65f6\u95f4\u5df2\u7ecf\u8d85\u65f6\uff0c\u5728\u5173\u95ed\u6216\u91cd\u542f\u6846\u67b6\u65f6\u4e0d\u5f97\u4e0d\u5f3a\u884c\u5207\u65ad\u534f\u7a0b\u7684\u8fd0\u884c\u3002\u8fd9\u79cd\u60c5\u51b5\u5efa\u8bae\u6839\u636e\u4e0b\u65b9\u7684\u6253\u5370\u8f93\u51fa\u6808\u8fdb\u884c\u63d2\u9519\uff0c\u5efa\u8bae\u5c06\u534f\u7a0b\u8fd0\u884c\u65f6\u95f4\u957f\u7684\u8fc7\u7a0b\u7f29\u77ed\u6216\u8c03\u957f swoole \u914d\u7f6e\u9879\u4e0b\u9762\u7684 max_wait_time \u65f6\u95f4\uff08\u79d2\uff09\uff0c2.4.3 \u7248\u672c\u8d77\u6b64\u53c2\u6570\u9ed8\u8ba4\u4e3a 5 \u79d2\u3002","title":"\u51fa\u73b0 deadlock \u5b57\u6837"},{"location":"faq/light-cache-wrong/","text":"\u4f7f\u7528 LightCache \u5173\u95ed\u65f6\u65e0\u6cd5\u6b63\u5e38\u4fdd\u5b58\u6301\u4e45\u5316 LightCache \u56e0\u4e3a\u662f\u8de8\u5185\u5b58\u4f7f\u7528\u7684\uff0c\u6240\u4ee5\u6bcf\u6b21\u91cd\u542f\u548c\u5173\u95ed\u6846\u67b6\u65f6\uff0c\u90fd\u53ea\u4f1a\u8ba9\u5176\u4e2d\u4e00\u4e2a\u8fdb\u7a0b\u53bb\u4fdd\u5b58\u3002\u56e0\u4e3a\u5728 2.4.2 \u7248\u672c\u5f00\u59cb\uff0c\u6301\u4e45\u5316\u7684\u903b\u8f91\u53d1\u751f\u4e86\u66f4\u6539\uff0c\u4e0d\u518d\u652f\u6301 expire = -2 \u8fdb\u884c\u8bbe\u7f6e\u6301\u4e45\u5316\uff08\u56e0\u4e3a\u90a3\u6837\u4f1a\u5f88\u5bb9\u6613\u8ba9\u5f00\u53d1\u8005\u5199\u9519\uff09\uff0c\u4ec5\u652f\u6301\u4f7f\u7528 LightCache::addPersistence($key) \u8fd9\u6837\u7684\u65b9\u5f0f\u8fdb\u884c\u8bbe\u7f6e\u6301\u4e45\u5316\uff0c\u6240\u4ee5\u5728 2.4.2 \u7248\u672c\u4ee5\u540e\uff0c\u8bf7\u4f7f\u7528\u6b64\u65b9\u6cd5\u8fdb\u884c\u6301\u4e45\u5316\u8bbe\u7f6e\uff0c\u4fdd\u8bc1\u6570\u636e\u4e0d\u4e22\u5931\u3002 \u6b64\u5916\uff0c2.4.2 \u7248\u672c\u8d77\uff0c\u4e0d\u518d\u652f\u6301\u7528\u6237\u624b\u52a8\u8c03\u7528 savePersistence() \u65b9\u6cd5\uff0c\u666e\u901a\u7528\u6237\u4e0d\u53ef\u624b\u52a8\u8c03\u7528\u6b64\u65b9\u6cd5\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u6570\u636e\u51fa\u9519\u3002","title":"\u4f7f\u7528 LightCache \u5173\u95ed\u65f6\u65e0\u6cd5\u6b63\u5e38\u4fdd\u5b58\u6301\u4e45\u5316"},{"location":"faq/light-cache-wrong/#lightcache","text":"LightCache \u56e0\u4e3a\u662f\u8de8\u5185\u5b58\u4f7f\u7528\u7684\uff0c\u6240\u4ee5\u6bcf\u6b21\u91cd\u542f\u548c\u5173\u95ed\u6846\u67b6\u65f6\uff0c\u90fd\u53ea\u4f1a\u8ba9\u5176\u4e2d\u4e00\u4e2a\u8fdb\u7a0b\u53bb\u4fdd\u5b58\u3002\u56e0\u4e3a\u5728 2.4.2 \u7248\u672c\u5f00\u59cb\uff0c\u6301\u4e45\u5316\u7684\u903b\u8f91\u53d1\u751f\u4e86\u66f4\u6539\uff0c\u4e0d\u518d\u652f\u6301 expire = -2 \u8fdb\u884c\u8bbe\u7f6e\u6301\u4e45\u5316\uff08\u56e0\u4e3a\u90a3\u6837\u4f1a\u5f88\u5bb9\u6613\u8ba9\u5f00\u53d1\u8005\u5199\u9519\uff09\uff0c\u4ec5\u652f\u6301\u4f7f\u7528 LightCache::addPersistence($key) \u8fd9\u6837\u7684\u65b9\u5f0f\u8fdb\u884c\u8bbe\u7f6e\u6301\u4e45\u5316\uff0c\u6240\u4ee5\u5728 2.4.2 \u7248\u672c\u4ee5\u540e\uff0c\u8bf7\u4f7f\u7528\u6b64\u65b9\u6cd5\u8fdb\u884c\u6301\u4e45\u5316\u8bbe\u7f6e\uff0c\u4fdd\u8bc1\u6570\u636e\u4e0d\u4e22\u5931\u3002 \u6b64\u5916\uff0c2.4.2 \u7248\u672c\u8d77\uff0c\u4e0d\u518d\u652f\u6301\u7528\u6237\u624b\u52a8\u8c03\u7528 savePersistence() \u65b9\u6cd5\uff0c\u666e\u901a\u7528\u6237\u4e0d\u53ef\u624b\u52a8\u8c03\u7528\u6b64\u65b9\u6cd5\uff0c\u5426\u5219\u4f1a\u5bfc\u81f4\u6570\u636e\u51fa\u9519\u3002","title":"\u4f7f\u7528 LightCache \u5173\u95ed\u65f6\u65e0\u6cd5\u6b63\u5e38\u4fdd\u5b58\u6301\u4e45\u5316"},{"location":"faq/usual-question/","text":"\u6846\u67b6\u5e38\u89c1\u95ee\u9898\uff08\u6301\u7eed\u66f4\u65b0\uff09 \u5982\u4f55\u6b63\u786e\u5730\u5f3a\u5236\u9000\u51fa\u70b8\u6bdb\u6846\u67b6\uff1f \u9996\u5148\u8981\u77e5\u9053\u4e00\u4e2a\u6982\u5ff5\uff0c\u70b8\u6bdb\u6846\u67b6\u548c\u4f20\u7edf\u7684 PHP \u4ee5\u53ca\u5176\u4ed6\u5982 Python \u7b49\u8bed\u8a00\u7684\u8f7b\u91cf\u6846\u67b6\u90fd\u4e0d\u540c\uff0c\u6846\u67b6\u542f\u52a8\u540e\u4f1a\u4f9d\u6b21\u542f\u52a8 Master\u3001Manager\u3001Worker \u7b49\u591a\u4e2a\u8fdb\u7a0b\uff0c\u800c\u7528\u6237\u542f\u52a8\u65f6\u5165\u53e3\u7684 PHP \u8fdb\u7a0b\u5c31\u662f Master \u8fdb\u7a0b\uff0c\u5728\u4e00\u4e9b\u5bf9\u6846\u67b6\u7684\u6b63\u5e38\u4e2d\u6b62\u3001\u70ed\u91cd\u542f\u4e0a\uff0c\u6211\u4eec\u7ed9 Master \u8fdb\u7a0b\u53d1\u9001\u76f8\u5e94\u7684 Linux \u4fe1\u53f7\uff08\u5982 SIGTERM\uff09\u5373\u53ef\u5bf9\u6574\u4e2a\u6846\u67b6\u7684\u591a\u4e2a\u8fdb\u7a0b\u751f\u6548\uff0c\u65e0\u9700\u7ed9\u6bcf\u4e2a\u8fdb\u7a0b\u53d1\u9001\u3002 \u4f46\u662f\u5982\u679c\u56e0\u4e3a\u7528\u6237\u7684\u8bef\u64cd\u4f5c\uff0c\u5bfc\u81f4\u70b8\u6bdb\u6846\u67b6\u5176\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u8fdb\u7a0b\u963b\u585e\uff0c\u6216\u8005\u6bd4\u5982\u5c06\u6846\u67b6\u6302\u5728 screen \u7b49\u5b88\u62a4\u4f46\u662f\u5b88\u62a4\u670d\u52a1\u8fdb\u7a0b\u88ab\u6740\u6389\uff0c\u603b\u4e4b\u5c31\u662f\u65e0\u6cd5\u4f7f\u7528 Ctrl+C \u7684\u65b9\u5f0f\u6b63\u5e38\u5173\u95ed\u6846\u67b6\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u6b63\u786e\u5730\u6740\u6389\u6240\u6709\u6846\u67b6\u8fdb\u7a0b\uff08\u8fd9\u56fa\u7136\u53ef\u80fd\u4f1a\u9020\u6210\u5185\u5b58\u7684\u7f13\u5b58\u6570\u636e\u4e22\u5931\uff09\u3002 \u6ce8\u610f \u4e0b\u65b9\u6d89\u53ca ps \u547d\u4ee4\u540e\u4f7f\u7528 grep \u8fc7\u6ee4\u7684\u6846\u67b6\u8fdb\u7a0b\u65b9\u5f0f\uff0c\u5982\u679c\u4f60\u7684\u670d\u52a1\u5668\u540c\u65f6\u6709\u5176\u4ed6\u4f7f\u7528 PHP \u542f\u52a8\u7684\u670d\u52a1\uff0c\u547d\u4ee4\u884c\u521a\u597d\u6709 server \u5b57\u6837\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8bef\u6740\uff0c\u5982\u679c\u6709\u5f71\u54cd\u7684\u8bdd\uff0c\u5efa\u8bae\u5c06 grep server \u6362\u6210\u4f60\u542f\u52a8\u65f6\u547d\u4ee4\u884c\u7684\u7279\u6b8a\u53c2\u6570\u6216\u624b\u52a8\u6392\u9664\uff01 \u4e00\u3001 \u9996\u5148\uff0c\u4f7f\u7528 ps \u3001 htop \u3001 netstat -nlp \u7b49\u547d\u4ee4\u786e\u5b9a\u6846\u67b6\u7684\u5165\u53e3\u8fdb\u7a0b\uff08\u4e5f\u5c31\u662f Master \u8fdb\u7a0b\u7684 pid\uff09\u3002 \u786e\u8ba4\u65b9\u5f0f\u793a\u4f8b\u5982\u4e0b\uff1a \u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f >=2.4 \u7248\u672c\u7684\u6846\u67b6\uff0c\u5728\u6846\u67b6\u542f\u52a8\u65f6\u5c31\u4f1a\u5728\u6700\u5148\u5f00\u59cb\u7684 motd \u4e0a\u65b9\u663e\u793a master_pid \uff0c\u5982\u679c\u4f60\u8fd8\u80fd\u627e\u5230\u6b64\u5904\u7684\u663e\u793a\uff0c\u90a3\u4e48\u606d\u559c\u4f60\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u4e0b\u9762\u7684\u7b2c\u4e8c\u6b65\u3002 \u5982\u679c\u4f60\u4e0d\u80fd\u6b63\u5e38\u901a\u8fc7\u6846\u67b6\u7684\u65b9\u5f0f\u627e\u5230 pid\uff0c\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4 ps aux | grep php | grep server \u7684\u65b9\u5f0f\u627e\u5230\u6846\u67b6\u6240\u6709\u7684\u8fdb\u7a0b\u3002\u5176\u4e2d\u5217\u51fa\u7684\u76f8\u5173\u6846\u67b6\u7684\u8fdb\u7a0b\uff0c\u53ef\u4ee5\u5bfb\u627e pid \u6700\u5c0f\u7684\u8fdb\u7a0b\uff0c\u5373\u4e3a Master \u8fdb\u7a0b\u3002\u5173\u4e8e\u5982\u4f55\u533a\u5206\u8fdb\u7a0b\u5bf9\u5e94\u5173\u7cfb\uff0c\u89c1\u672c\u9875 \u4f7f\u7528 Linux \u5de5\u5177\u8fa8\u522b\u6846\u67b6\u8fdb\u7a0b \u3002 \u5982\u679c\u4f60\u5bf9 ps \u4e0d\u719f\u6089\uff0c\u53ef\u4ee5\u4f7f\u7528 htop \u5de5\u5177\uff0c\u4f7f\u7528 F5 Tree \u65b9\u5f0f\u663e\u793a\uff0c\u5e76\u4e14\u4f7f\u7528 F4 \u7684 Filter\uff0c\u8fc7\u6ee4 php \u6216 bin/start \u7b49\u5b57\u6837\uff0c\u627e\u5230\u8fdb\u7a0b\u6811\u3002 \u4e8c\u3001 \u7136\u540e\uff0c\u786e\u5b9a\u6846\u67b6\u662f\u5426\u6b63\u5e38\u8fd0\u884c\u4e14\u6b63\u5e38\u6d41\u7a0b\u5173\u95ed\u3002 \u5982\u679c\u6846\u67b6\u80fd\u6b63\u5e38\u8fd0\u884c\uff0c\u6bd4\u5982\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\u6d4f\u89c8\u5668\u7684 http://\u5730\u5740:\u7aef\u53e3/httpTimer \u7b49 HTTP \u8def\u7531\uff0c\u53ef\u4ee5\u4f7f\u7528 SIGINT \u6216 SIGTERM \u4fe1\u53f7\u6b63\u5e38\u5173\u95ed\u6846\u67b6\u3002\u6211\u4eec\u5047\u8bbe Master \u8fdb\u7a0b\u7684 pid \u4e3a 31234\uff1a kill -TERM 31234 \u6216 kill -INT 31234 \uff0c\u5982\u679c\u7a0d\u540e\u4f7f\u7528 ps aux | grep php | grep server \u547d\u4ee4\u53d1\u73b0\u6ca1\u6709\u8fdb\u7a0b\u5b58\u5728\uff08\u6392\u9664\u6389 grep \u81ea\u8eab\u7684\u8fdb\u7a0b\uff09\uff0c\u8bf4\u660e\u53ef\u4ee5\u6b63\u5e38\u5173\u95ed\uff0c\u6b64\u5173\u95ed\u65b9\u6cd5\u4e3a\u6b63\u5e38\u505c\u6b62\u6d41\u7a0b\uff0c\u5373\u4fdd\u5b58\u4e86 LightCache \u7b49\u5185\u5b58\u7f13\u5b58\u6301\u4e45\u5316\u7684\u6570\u636e\u3002 \u5982\u679c\u4ee5\u4e0a\u65b9\u5f0f\u6ca1\u6709\u4efb\u4f55\u6548\u679c\uff0c\u7ee7\u7eed\u770b\u7b2c\u4e09\u6b65\u3002 \u4e09\u3001 \u4e0d\u80fd\u6b63\u5e38\u6d41\u7a0b\u5173\u95ed\uff0c\u9700\u8981\u624b\u52a8\u6740\u6389\u6240\u6709\u8fdb\u7a0b\u3002 \u9996\u5148\u4f7f\u7528 ps aux | grep php | grep server | grep -v grep | awk '{print $2}' \u5217\u51fa\u6846\u67b6\u6240\u6709\u8fdb\u7a0b\u7684 pid\uff0c\u786e\u8ba4\u65e0\u8bef\u540e\uff0c\u5728\u6b64\u6761\u547d\u4ee4\u540e\u63a5 | xargs kill -9 \u5373\u53ef\uff1a 1 2 # \u5217\u51fa\u8fdb\u7a0b\uff0c\u53ea\u663e\u793a\u5305\u542bphp\uff0c\u53ea\u663e\u793a\u5305\u542bserver\uff0c\u6392\u9664grep\u672c\u8eab\u8fdb\u7a0b\uff0c\u663e\u793a\u7b2c\u4e8c\u5217\u7684pid\uff0c\u4f7f\u7528xargs\u5faa\u73afkill\u8fd9\u91cc\u9762\u7684\u8fdb\u7a0b ps aux | grep php | grep server | grep -v grep | awk '{print $2}' | xargs kill -9 \u5982\u4f55\u4f7f\u7528 Linux \u5de5\u5177\u67e5\u770b\u6846\u67b6\u8fdb\u7a0b\u72b6\u6001\uff1f \u6846\u67b6\u6709\u591a\u4e2a\u8fdb\u7a0b\uff0c\u6709\u65f6\u5019\u6211\u4eec\u9700\u8981\u901a\u8fc7\u76d1\u89c6\u8fdb\u7a0b\u72b6\u6001\u6765\u786e\u5b9a\u6846\u67b6\u662f\u5426\u6b63\u5e38\u8fd0\u884c\u6216\u67e5\u770b\u6846\u67b6\u7684\u8d44\u6e90\u5360\u7528\u7387\u3002\u9996\u5148\u4e00\u4e2a\u5927\u6982\u5ff5\uff0c\u8001\u751f\u5e38\u8c08\uff0c\u70b8\u6bdb\u6846\u67b6\u7531 Master\u3001Manager\u3001Worker\uff08\u3001TaskWorker\uff09\u8fdb\u7a0b\u7ec4\u6210\u7684\u3002 \u5982\u679c\u4f7f\u7528 htop \u5de5\u5177\uff0c\u5c31\u6bd4\u8f83\u7b80\u5355\uff0c\u6bd4\u5982\u6211\u542f\u52a8\u4e86\u4e00\u4e2a\u5e94\u7528\uff0c\u4f7f\u7528\u70b8\u6bdb\u6846\u67b6\u7f16\u5199\u7684\u5783\u573e\u5206\u7c7b\u5c0f\u7a0b\u5e8f API \u670d\u52a1\u5668\uff0c\u5728 htop \u547d\u4ee4\u540e\u627e\u5230\u5982\u56fe\u8fd9\u90e8\u5206\uff08\u4e0b\u9762\u7684\u6811\u72b6\u56fe\u662f\u6309 F5 \u540e\u5207\u6362\u4e3a\u6811\u72b6\u663e\u793a\uff0c\u907f\u514d\u8fdb\u7a0b\u5237\u592a\u5feb\u53ef\u4ee5\u8f93\u5165 Shift+z \uff09\uff1a \u5176\u4e2d\uff0c -zsh \u4e0b\u6709\u552f\u4e00\u4e00\u4e2a php \u8fdb\u7a0b\uff0c\u5728\u56fe\u4e2d\u5bf9\u5e94\u7684\u7b2c\u4e00\u5217 pid \u4e3a 16258 \uff0c\u4ee3\u8868 Master \u8fdb\u7a0b\u3002 Master \u8fdb\u7a0b\u4e0b\u7684\u552f\u4e00\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff08\u767d\u8272\u7684\u662f\u8fdb\u7a0b\uff0c\u7eff\u8272\u662f\u7ebf\u7a0b\uff09\uff0c\u5728\u56fe\u4e2d\u5bf9\u5e94\u7684 pid \u4e3a 16263 \uff0c\u4ee3\u8868 Manager \u8fdb\u7a0b\uff0c\u7528\u4f5c\u7ba1\u7406 Worker \u8fdb\u7a0b\u3002 Manager \u8fdb\u7a0b\u4e0b\u7684\u5b50\u8fdb\u7a0b\uff0c\u8fde\u53f7\u90e8\u5206\u4e3a\u5bf9\u5e94\u7684 Worker \u8fdb\u7a0b\uff0c\u6bd4\u5982\u56fe\u4e2d\u7684 16266 \uff0c 16267 \uff0c 16268 \uff0c 16269 \u5206\u522b\u4ee3\u8868 Worker #0 \uff0c Worker #1 \uff0c Worker #2 \uff0c Worker #3 \u56db\u4e2a Worker \u8fdb\u7a0b\u3002 \u5982\u679c\u4f60\u8fd8\u8bbe\u7f6e\u4e86 TaskWorker \u8fdb\u7a0b\uff0cTaskWorker \u8fdb\u7a0b\u7684 pid \u4f1a\u548c Worker \u8fdb\u7a0b\u4e00\u6837\u662f\u8fde\u7eed\u7684\uff0c\u4e00\u822c\u4f1a\u63a5\u5728 Worker \u8fdb\u7a0b\u540e\u9762\u3002 htop \u4f7f\u7528\u65b9\u5411\u952e\u9009\u62e9\u8fdb\u7a0b\uff0c\u9009\u62e9\u5230\u5bf9\u5e94\u8fdb\u7a0b\u540e\u53ef\u4ee5\u4f7f\u7528 F9 \u6765\u9009\u62e9 kill \u6307\u4ee4\uff0c\u6bd4\u5982\u8ba9\u6846\u67b6\u70ed\u91cd\u542f\uff0c\u53ef\u4ee5\u5c06\u5149\u6807\u79fb\u5230 Master \u8fdb\u7a0b\u4e0a\uff0c\u4f7f\u7528 SIGUSR1 \uff1a","title":"\u6846\u67b6\u5e38\u89c1\u95ee\u9898\uff08\u6301\u7eed\u66f4\u65b0\uff09"},{"location":"faq/usual-question/#_1","text":"","title":"\u6846\u67b6\u5e38\u89c1\u95ee\u9898\uff08\u6301\u7eed\u66f4\u65b0\uff09"},{"location":"faq/usual-question/#_2","text":"\u9996\u5148\u8981\u77e5\u9053\u4e00\u4e2a\u6982\u5ff5\uff0c\u70b8\u6bdb\u6846\u67b6\u548c\u4f20\u7edf\u7684 PHP \u4ee5\u53ca\u5176\u4ed6\u5982 Python \u7b49\u8bed\u8a00\u7684\u8f7b\u91cf\u6846\u67b6\u90fd\u4e0d\u540c\uff0c\u6846\u67b6\u542f\u52a8\u540e\u4f1a\u4f9d\u6b21\u542f\u52a8 Master\u3001Manager\u3001Worker \u7b49\u591a\u4e2a\u8fdb\u7a0b\uff0c\u800c\u7528\u6237\u542f\u52a8\u65f6\u5165\u53e3\u7684 PHP \u8fdb\u7a0b\u5c31\u662f Master \u8fdb\u7a0b\uff0c\u5728\u4e00\u4e9b\u5bf9\u6846\u67b6\u7684\u6b63\u5e38\u4e2d\u6b62\u3001\u70ed\u91cd\u542f\u4e0a\uff0c\u6211\u4eec\u7ed9 Master \u8fdb\u7a0b\u53d1\u9001\u76f8\u5e94\u7684 Linux \u4fe1\u53f7\uff08\u5982 SIGTERM\uff09\u5373\u53ef\u5bf9\u6574\u4e2a\u6846\u67b6\u7684\u591a\u4e2a\u8fdb\u7a0b\u751f\u6548\uff0c\u65e0\u9700\u7ed9\u6bcf\u4e2a\u8fdb\u7a0b\u53d1\u9001\u3002 \u4f46\u662f\u5982\u679c\u56e0\u4e3a\u7528\u6237\u7684\u8bef\u64cd\u4f5c\uff0c\u5bfc\u81f4\u70b8\u6bdb\u6846\u67b6\u5176\u4e2d\u7684\u4e00\u4e2a\u6216\u591a\u4e2a\u8fdb\u7a0b\u963b\u585e\uff0c\u6216\u8005\u6bd4\u5982\u5c06\u6846\u67b6\u6302\u5728 screen \u7b49\u5b88\u62a4\u4f46\u662f\u5b88\u62a4\u670d\u52a1\u8fdb\u7a0b\u88ab\u6740\u6389\uff0c\u603b\u4e4b\u5c31\u662f\u65e0\u6cd5\u4f7f\u7528 Ctrl+C \u7684\u65b9\u5f0f\u6b63\u5e38\u5173\u95ed\u6846\u67b6\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u6b63\u786e\u5730\u6740\u6389\u6240\u6709\u6846\u67b6\u8fdb\u7a0b\uff08\u8fd9\u56fa\u7136\u53ef\u80fd\u4f1a\u9020\u6210\u5185\u5b58\u7684\u7f13\u5b58\u6570\u636e\u4e22\u5931\uff09\u3002 \u6ce8\u610f \u4e0b\u65b9\u6d89\u53ca ps \u547d\u4ee4\u540e\u4f7f\u7528 grep \u8fc7\u6ee4\u7684\u6846\u67b6\u8fdb\u7a0b\u65b9\u5f0f\uff0c\u5982\u679c\u4f60\u7684\u670d\u52a1\u5668\u540c\u65f6\u6709\u5176\u4ed6\u4f7f\u7528 PHP \u542f\u52a8\u7684\u670d\u52a1\uff0c\u547d\u4ee4\u884c\u521a\u597d\u6709 server \u5b57\u6837\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u8bef\u6740\uff0c\u5982\u679c\u6709\u5f71\u54cd\u7684\u8bdd\uff0c\u5efa\u8bae\u5c06 grep server \u6362\u6210\u4f60\u542f\u52a8\u65f6\u547d\u4ee4\u884c\u7684\u7279\u6b8a\u53c2\u6570\u6216\u624b\u52a8\u6392\u9664\uff01 \u4e00\u3001 \u9996\u5148\uff0c\u4f7f\u7528 ps \u3001 htop \u3001 netstat -nlp \u7b49\u547d\u4ee4\u786e\u5b9a\u6846\u67b6\u7684\u5165\u53e3\u8fdb\u7a0b\uff08\u4e5f\u5c31\u662f Master \u8fdb\u7a0b\u7684 pid\uff09\u3002 \u786e\u8ba4\u65b9\u5f0f\u793a\u4f8b\u5982\u4e0b\uff1a \u5982\u679c\u4f60\u4f7f\u7528\u7684\u662f >=2.4 \u7248\u672c\u7684\u6846\u67b6\uff0c\u5728\u6846\u67b6\u542f\u52a8\u65f6\u5c31\u4f1a\u5728\u6700\u5148\u5f00\u59cb\u7684 motd \u4e0a\u65b9\u663e\u793a master_pid \uff0c\u5982\u679c\u4f60\u8fd8\u80fd\u627e\u5230\u6b64\u5904\u7684\u663e\u793a\uff0c\u90a3\u4e48\u606d\u559c\u4f60\uff0c\u53ef\u4ee5\u76f4\u63a5\u8fdb\u884c\u4e0b\u9762\u7684\u7b2c\u4e8c\u6b65\u3002 \u5982\u679c\u4f60\u4e0d\u80fd\u6b63\u5e38\u901a\u8fc7\u6846\u67b6\u7684\u65b9\u5f0f\u627e\u5230 pid\uff0c\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4 ps aux | grep php | grep server \u7684\u65b9\u5f0f\u627e\u5230\u6846\u67b6\u6240\u6709\u7684\u8fdb\u7a0b\u3002\u5176\u4e2d\u5217\u51fa\u7684\u76f8\u5173\u6846\u67b6\u7684\u8fdb\u7a0b\uff0c\u53ef\u4ee5\u5bfb\u627e pid \u6700\u5c0f\u7684\u8fdb\u7a0b\uff0c\u5373\u4e3a Master \u8fdb\u7a0b\u3002\u5173\u4e8e\u5982\u4f55\u533a\u5206\u8fdb\u7a0b\u5bf9\u5e94\u5173\u7cfb\uff0c\u89c1\u672c\u9875 \u4f7f\u7528 Linux \u5de5\u5177\u8fa8\u522b\u6846\u67b6\u8fdb\u7a0b \u3002 \u5982\u679c\u4f60\u5bf9 ps \u4e0d\u719f\u6089\uff0c\u53ef\u4ee5\u4f7f\u7528 htop \u5de5\u5177\uff0c\u4f7f\u7528 F5 Tree \u65b9\u5f0f\u663e\u793a\uff0c\u5e76\u4e14\u4f7f\u7528 F4 \u7684 Filter\uff0c\u8fc7\u6ee4 php \u6216 bin/start \u7b49\u5b57\u6837\uff0c\u627e\u5230\u8fdb\u7a0b\u6811\u3002 \u4e8c\u3001 \u7136\u540e\uff0c\u786e\u5b9a\u6846\u67b6\u662f\u5426\u6b63\u5e38\u8fd0\u884c\u4e14\u6b63\u5e38\u6d41\u7a0b\u5173\u95ed\u3002 \u5982\u679c\u6846\u67b6\u80fd\u6b63\u5e38\u8fd0\u884c\uff0c\u6bd4\u5982\u53ef\u4ee5\u901a\u8fc7\u8bbf\u95ee\u6d4f\u89c8\u5668\u7684 http://\u5730\u5740:\u7aef\u53e3/httpTimer \u7b49 HTTP \u8def\u7531\uff0c\u53ef\u4ee5\u4f7f\u7528 SIGINT \u6216 SIGTERM \u4fe1\u53f7\u6b63\u5e38\u5173\u95ed\u6846\u67b6\u3002\u6211\u4eec\u5047\u8bbe Master \u8fdb\u7a0b\u7684 pid \u4e3a 31234\uff1a kill -TERM 31234 \u6216 kill -INT 31234 \uff0c\u5982\u679c\u7a0d\u540e\u4f7f\u7528 ps aux | grep php | grep server \u547d\u4ee4\u53d1\u73b0\u6ca1\u6709\u8fdb\u7a0b\u5b58\u5728\uff08\u6392\u9664\u6389 grep \u81ea\u8eab\u7684\u8fdb\u7a0b\uff09\uff0c\u8bf4\u660e\u53ef\u4ee5\u6b63\u5e38\u5173\u95ed\uff0c\u6b64\u5173\u95ed\u65b9\u6cd5\u4e3a\u6b63\u5e38\u505c\u6b62\u6d41\u7a0b\uff0c\u5373\u4fdd\u5b58\u4e86 LightCache \u7b49\u5185\u5b58\u7f13\u5b58\u6301\u4e45\u5316\u7684\u6570\u636e\u3002 \u5982\u679c\u4ee5\u4e0a\u65b9\u5f0f\u6ca1\u6709\u4efb\u4f55\u6548\u679c\uff0c\u7ee7\u7eed\u770b\u7b2c\u4e09\u6b65\u3002 \u4e09\u3001 \u4e0d\u80fd\u6b63\u5e38\u6d41\u7a0b\u5173\u95ed\uff0c\u9700\u8981\u624b\u52a8\u6740\u6389\u6240\u6709\u8fdb\u7a0b\u3002 \u9996\u5148\u4f7f\u7528 ps aux | grep php | grep server | grep -v grep | awk '{print $2}' \u5217\u51fa\u6846\u67b6\u6240\u6709\u8fdb\u7a0b\u7684 pid\uff0c\u786e\u8ba4\u65e0\u8bef\u540e\uff0c\u5728\u6b64\u6761\u547d\u4ee4\u540e\u63a5 | xargs kill -9 \u5373\u53ef\uff1a 1 2 # \u5217\u51fa\u8fdb\u7a0b\uff0c\u53ea\u663e\u793a\u5305\u542bphp\uff0c\u53ea\u663e\u793a\u5305\u542bserver\uff0c\u6392\u9664grep\u672c\u8eab\u8fdb\u7a0b\uff0c\u663e\u793a\u7b2c\u4e8c\u5217\u7684pid\uff0c\u4f7f\u7528xargs\u5faa\u73afkill\u8fd9\u91cc\u9762\u7684\u8fdb\u7a0b ps aux | grep php | grep server | grep -v grep | awk '{print $2}' | xargs kill -9","title":"\u5982\u4f55\u6b63\u786e\u5730\u5f3a\u5236\u9000\u51fa\u70b8\u6bdb\u6846\u67b6\uff1f"},{"location":"faq/usual-question/#linux","text":"\u6846\u67b6\u6709\u591a\u4e2a\u8fdb\u7a0b\uff0c\u6709\u65f6\u5019\u6211\u4eec\u9700\u8981\u901a\u8fc7\u76d1\u89c6\u8fdb\u7a0b\u72b6\u6001\u6765\u786e\u5b9a\u6846\u67b6\u662f\u5426\u6b63\u5e38\u8fd0\u884c\u6216\u67e5\u770b\u6846\u67b6\u7684\u8d44\u6e90\u5360\u7528\u7387\u3002\u9996\u5148\u4e00\u4e2a\u5927\u6982\u5ff5\uff0c\u8001\u751f\u5e38\u8c08\uff0c\u70b8\u6bdb\u6846\u67b6\u7531 Master\u3001Manager\u3001Worker\uff08\u3001TaskWorker\uff09\u8fdb\u7a0b\u7ec4\u6210\u7684\u3002 \u5982\u679c\u4f7f\u7528 htop \u5de5\u5177\uff0c\u5c31\u6bd4\u8f83\u7b80\u5355\uff0c\u6bd4\u5982\u6211\u542f\u52a8\u4e86\u4e00\u4e2a\u5e94\u7528\uff0c\u4f7f\u7528\u70b8\u6bdb\u6846\u67b6\u7f16\u5199\u7684\u5783\u573e\u5206\u7c7b\u5c0f\u7a0b\u5e8f API \u670d\u52a1\u5668\uff0c\u5728 htop \u547d\u4ee4\u540e\u627e\u5230\u5982\u56fe\u8fd9\u90e8\u5206\uff08\u4e0b\u9762\u7684\u6811\u72b6\u56fe\u662f\u6309 F5 \u540e\u5207\u6362\u4e3a\u6811\u72b6\u663e\u793a\uff0c\u907f\u514d\u8fdb\u7a0b\u5237\u592a\u5feb\u53ef\u4ee5\u8f93\u5165 Shift+z \uff09\uff1a \u5176\u4e2d\uff0c -zsh \u4e0b\u6709\u552f\u4e00\u4e00\u4e2a php \u8fdb\u7a0b\uff0c\u5728\u56fe\u4e2d\u5bf9\u5e94\u7684\u7b2c\u4e00\u5217 pid \u4e3a 16258 \uff0c\u4ee3\u8868 Master \u8fdb\u7a0b\u3002 Master \u8fdb\u7a0b\u4e0b\u7684\u552f\u4e00\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff08\u767d\u8272\u7684\u662f\u8fdb\u7a0b\uff0c\u7eff\u8272\u662f\u7ebf\u7a0b\uff09\uff0c\u5728\u56fe\u4e2d\u5bf9\u5e94\u7684 pid \u4e3a 16263 \uff0c\u4ee3\u8868 Manager \u8fdb\u7a0b\uff0c\u7528\u4f5c\u7ba1\u7406 Worker \u8fdb\u7a0b\u3002 Manager \u8fdb\u7a0b\u4e0b\u7684\u5b50\u8fdb\u7a0b\uff0c\u8fde\u53f7\u90e8\u5206\u4e3a\u5bf9\u5e94\u7684 Worker \u8fdb\u7a0b\uff0c\u6bd4\u5982\u56fe\u4e2d\u7684 16266 \uff0c 16267 \uff0c 16268 \uff0c 16269 \u5206\u522b\u4ee3\u8868 Worker #0 \uff0c Worker #1 \uff0c Worker #2 \uff0c Worker #3 \u56db\u4e2a Worker \u8fdb\u7a0b\u3002 \u5982\u679c\u4f60\u8fd8\u8bbe\u7f6e\u4e86 TaskWorker \u8fdb\u7a0b\uff0cTaskWorker \u8fdb\u7a0b\u7684 pid \u4f1a\u548c Worker \u8fdb\u7a0b\u4e00\u6837\u662f\u8fde\u7eed\u7684\uff0c\u4e00\u822c\u4f1a\u63a5\u5728 Worker \u8fdb\u7a0b\u540e\u9762\u3002 htop \u4f7f\u7528\u65b9\u5411\u952e\u9009\u62e9\u8fdb\u7a0b\uff0c\u9009\u62e9\u5230\u5bf9\u5e94\u8fdb\u7a0b\u540e\u53ef\u4ee5\u4f7f\u7528 F9 \u6765\u9009\u62e9 kill \u6307\u4ee4\uff0c\u6bd4\u5982\u8ba9\u6846\u67b6\u70ed\u91cd\u542f\uff0c\u53ef\u4ee5\u5c06\u5149\u6807\u79fb\u5230 Master \u8fdb\u7a0b\u4e0a\uff0c\u4f7f\u7528 SIGUSR1 \uff1a","title":"\u5982\u4f55\u4f7f\u7528 Linux \u5de5\u5177\u67e5\u770b\u6846\u67b6\u8fdb\u7a0b\u72b6\u6001\uff1f"},{"location":"faq/wait-message-cqbefore/","text":"CQBefore \u8fc7\u6ee4\u4e0d\u4e86 waitMessage \u56e0\u4e3a waitMessage() \u529f\u80fd\u662f\u8981\u7b49\u5f85\u63a5\u6536\u4e0b\u4e00\u4e2a\u6d88\u606f\u4e8b\u4ef6\u7684\uff0c\u800c\u6d88\u606f\u4e8b\u4ef6\u53c8\u4f1a\u88ab CQBefore \u8d70\u4e00\u904d\u3002\u4f46\u662f\u8fd9\u91cc\u5c31\u4f1a\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u90a3 waitMessage() \u7684\u6d88\u606f\u4f1a\u4e0d\u4f1a\u8d70 CQBefore \u5462\uff1f\uff08\u663e\u7136\u4e0d\u4f1a\u554a\uff01\u8fd9\u4e2a\u95ee\u9898\u7684\u9898\u76ee\u5c31\u662f\u8fd9\u4e2a\uff01\uff09 \u6846\u67b6\u5728 2.4.2 \u7248\u672c\u4e4b\u524d\u662f\u65e0\u6cd5\u8fc7\u6ee4 waitMessage() \u7684\uff08\u4e4b\u524d\u5728 2.1 \u7248\u672c\u5de6\u53f3\u7684\u51e0\u4e2a\u7248\u672c\u662f\u53ef\u4ee5\u7684\uff0c\u4f46\u8fd9\u91cc\u4e0d\u8ba8\u8bba\u5386\u53f2\u7248\u672c\uff09\uff0c\u4ece 2.4.2 \u7248\u672c\u8d77\u652f\u6301\u8fc7\u6ee4 waitMessage \uff0c\u4f46\u662f\u9700\u8981\u8bbe\u7f6e\u4e00\u4e0b @CQBefore \u7684\u7ea7\u522b\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 /** * @CQBefore(\"message\",level=201) */ public function filter1() { return true; } /** * @CQBefore(\"message\") */ public function filter2() { return true; } \u5982\u679c level >= 200 \uff0c\u90a3\u4e48\u6b64\u6ce8\u89e3\u4e8b\u4ef6\u5219\u4f1a\u8fc7\u6ee4 waitMessage() \uff0c\u5982\u679c level < 200 \uff0c\u5219\u4e0d\u4f1a\u3002\uff08 @CQBefore \u7684\u9ed8\u8ba4 level \u4e3a 20\uff0c\u6240\u4ee5\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u4e0d\u4f1a\u8fc7\u6ee4 waitMessage \u7684\uff09","title":"CQBefore \u8fc7\u6ee4\u4e0d\u4e86 waitMessage"},{"location":"faq/wait-message-cqbefore/#cqbefore-waitmessage","text":"\u56e0\u4e3a waitMessage() \u529f\u80fd\u662f\u8981\u7b49\u5f85\u63a5\u6536\u4e0b\u4e00\u4e2a\u6d88\u606f\u4e8b\u4ef6\u7684\uff0c\u800c\u6d88\u606f\u4e8b\u4ef6\u53c8\u4f1a\u88ab CQBefore \u8d70\u4e00\u904d\u3002\u4f46\u662f\u8fd9\u91cc\u5c31\u4f1a\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u90a3 waitMessage() \u7684\u6d88\u606f\u4f1a\u4e0d\u4f1a\u8d70 CQBefore \u5462\uff1f\uff08\u663e\u7136\u4e0d\u4f1a\u554a\uff01\u8fd9\u4e2a\u95ee\u9898\u7684\u9898\u76ee\u5c31\u662f\u8fd9\u4e2a\uff01\uff09 \u6846\u67b6\u5728 2.4.2 \u7248\u672c\u4e4b\u524d\u662f\u65e0\u6cd5\u8fc7\u6ee4 waitMessage() \u7684\uff08\u4e4b\u524d\u5728 2.1 \u7248\u672c\u5de6\u53f3\u7684\u51e0\u4e2a\u7248\u672c\u662f\u53ef\u4ee5\u7684\uff0c\u4f46\u8fd9\u91cc\u4e0d\u8ba8\u8bba\u5386\u53f2\u7248\u672c\uff09\uff0c\u4ece 2.4.2 \u7248\u672c\u8d77\u652f\u6301\u8fc7\u6ee4 waitMessage \uff0c\u4f46\u662f\u9700\u8981\u8bbe\u7f6e\u4e00\u4e0b @CQBefore \u7684\u7ea7\u522b\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 /** * @CQBefore(\"message\",level=201) */ public function filter1() { return true; } /** * @CQBefore(\"message\") */ public function filter2() { return true; } \u5982\u679c level >= 200 \uff0c\u90a3\u4e48\u6b64\u6ce8\u89e3\u4e8b\u4ef6\u5219\u4f1a\u8fc7\u6ee4 waitMessage() \uff0c\u5982\u679c level < 200 \uff0c\u5219\u4e0d\u4f1a\u3002\uff08 @CQBefore \u7684\u9ed8\u8ba4 level \u4e3a 20\uff0c\u6240\u4ee5\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u4e0d\u4f1a\u8fc7\u6ee4 waitMessage \u7684\uff09","title":"CQBefore \u8fc7\u6ee4\u4e0d\u4e86 waitMessage"},{"location":"guide/basic-config/","text":"\u57fa\u672c\u914d\u7f6e \u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u70b8\u6bdb\u6846\u67b6\u7684\u914d\u7f6e\u6587\u4ef6\u8fd8\u6ca1\u6709\u4efb\u4f55\u53d8\u66f4\uff0c\u662f\u9ed8\u8ba4\u7684\u884c\u4e3a\u3002\u5728\u672c\u7ae0\u5185\u5bb9\u4e2d\uff0c\u5c06\u5217\u4e3e\u51fa\u70b8\u6bdb\u6846\u67b6\u7684\u914d\u7f6e\u6587\u4ef6\u7684\u89c4\u5219\u548c\u4f7f\u7528\u3002 \u8b66\u544a \u56e0\u4e3a\u70b8\u6bdb\u6846\u67b6\u7684\u5168\u5c40\u914d\u7f6e\u4e2d\u542b\u6709\u6570\u636e\u5e93\u540d\u79f0\u548c\u5bc6\u7801\u4ee5\u53ca access_token \u7b49\u654f\u611f\u5b57\u6bb5\uff0c\u5728\u4f7f\u7528\u7248\u672c\u63a7\u5236\u8f6f\u4ef6\u8fc7\u7a0b\u4e2d\u8bf7\u4e0d\u8981\u5c06\u654f\u611f\u4fe1\u606f\u5199\u5165\u914d\u7f6e\u6587\u4ef6\u5e76\u63d0\u4ea4\u81f3\u5f00\u6e90\u4ed3\u5e93\uff01 \u5168\u5c40\u914d\u7f6e\u6587\u4ef6 global.php \u6846\u67b6\u7684\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u5728 config/global.php \u6587\u4ef6\u4e2d\u3002\u4e0b\u9762\u662f\u914d\u7f6e\u6587\u4ef6\u7684\u5404\u4e2a\u9009\u9879\uff0c\u8bf7\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u81ea\u884c\u914d\u7f6e\u3002 \u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c host \u6846\u67b6\u76d1\u542c\u7684\u5730\u5740 0.0.0.0 port \u6846\u67b6\u76d1\u542c\u7684\u7aef\u53e3 20001 http_reverse_link \u6846\u67b6\u5f00\u5230\u516c\u7f51\u6216\u5916\u90e8\u7684 HTTP \u53cd\u4ee3\u94fe\u63a5 \u89c1\u914d\u7f6e\u6587\u4ef6 zm_data \u6846\u67b6\u7684\u914d\u7f6e\u6587\u4ef6\u3001\u65e5\u5fd7\u6587\u4ef6\u7b49\u6587\u4ef6\u76ee\u5f55 ./ \u4e0b\u7684 zm_data/ debug_mode \u6846\u67b6\u662f\u5426\u542f\u52a8 debug \u6a21\u5f0f false crash_dir \u5b58\u653e\u5d29\u6e83\u548c\u8fd0\u884c\u65e5\u5fd7\u7684\u76ee\u5f55 zm_data \u4e0b\u7684 crash/ config_dir \u5b58\u653e saveToJson() \u65b9\u6cd5\u4fdd\u5b58\u7684\u6570\u636e\u7684\u76ee\u5f55 zm_data \u4e0b\u7684 config/ swoole \u5bf9\u5e94 Swoole server \u4e2d set \u7684\u53c2\u6570\uff0c\u53c2\u8003Swoole\u6587\u6863 \u89c1\u5b50\u8868 swoole light_cache \u8f7b\u91cf\u5185\u7f6e key-value \u7f13\u5b58 \u89c1\u5b57\u8868 light_cache worker_cache \u8de8\u8fdb\u7a0b\u53d8\u91cf\u7ea7\u7f13\u5b58 \u89c1\u5b50\u8868 worker_cache sql_config MySQL \u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f \u89c1\u5b50\u8868 sql_config redis_config Redis \u8fde\u63a5\u4fe1\u606f \u89c1\u5b50\u8868 redis_config access_token OneBot \u5ba2\u6237\u7aef\u8fde\u63a5\u7ea6\u5b9a\u7684token\uff0c\u7559\u7a7a\u5219\u65e0\uff0c\u76f8\u5173\u8bbe\u7f6e\u89c1 \u7ec4\u4ef6 - Access Token \u9a8c\u8bc1 \u7a7a http_header HTTP \u8bf7\u6c42\u81ea\u5b9a\u4e49\u8fd4\u56de\u7684header \u89c1\u914d\u7f6e\u6587\u4ef6 http_default_code_page HTTP\u670d\u52a1\u5668\u5728\u6307\u5b9a\u72b6\u6001\u7801\u4e0b\u56de\u590d\u7684\u9ed8\u8ba4\u9875\u9762 \u89c1\u914d\u7f6e\u6587\u4ef6 init_atomics \u6846\u67b6\u542f\u52a8\u65f6\u521d\u59cb\u5316\u7684\u539f\u5b50\u8ba1\u6570\u5668\u5217\u8868 \u89c1\u914d\u7f6e\u6587\u4ef6 info_level \u7ec8\u7aef\u65e5\u5fd7\u663e\u793a\u7b49\u7ea7\uff080-4\uff09 2 context_class \u4e0a\u4e0b\u6587\u6240\u5b9a\u4e49\u7684\u7c7b\uff0c\u89c1\u5bf9\u5e94\u4e0a\u4e0b\u6587\u8bf4\u660e\u6587\u6863 \\ZM\\Context\\Context::class static_file_server \u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\u914d\u7f6e\u9879 \u89c1\u5b50\u8868 static_file_server server_event_handler_class \u6ce8\u518c Swoole Server \u4e8b\u4ef6\u6ce8\u89e3\u7684\u7c7b\u5217\u8868\uff0c\u5728 Swoole \u670d\u52a1\u5668\u542f\u52a8\u524d\u5c31\u88ab\u52a0\u8f7d \u7a7a onebot OneBot \u534f\u8bae\u76f8\u5173\u914d\u7f6e \u89c1\u5b50\u8868 onebot remote_terminal \u8fdc\u7a0b\u7ec8\u7aef\u76f8\u5173\u914d\u7f6e \u89c1\u5b50\u8868 remote_terminal \u5b50\u8868 swoole \u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c log_file Swoole \u7684\u65e5\u5fd7\u6587\u4ef6 crash_dir \u4e0b\u7684 swoole_error.log worker_num Worker \u5de5\u4f5c\u8fdb\u7a0b\u6570 \u8fd0\u884c\u6846\u67b6\u7684\u4e3b\u673a CPU \u6838\u5fc3\u6570 dispatch_mode \u6570\u636e\u5305\u5206\u53d1\u7b56\u7565\uff0c\u89c1 \u6587\u6863 2 max_coroutine \u6700\u5927\u534f\u7a0b\u5e76\u53d1\u6570 300000 max_wait_time \u9000\u51fa\u8fdb\u7a0b\u65f6\u7b49\u5f85\u534f\u7a0b\u6062\u590d\u7684\u6700\u957f\u65f6\u95f4\uff08\u79d2\uff09 5\uff082.4.3 \u7248\u672c\u540e\u9ed8\u8ba4\u503c\uff09 task_worker_num TaskWorker \u5de5\u4f5c\u8fdb\u7a0b\u6570 \u9ed8\u8ba4\u4e0d\u5f00\u542f\uff08\u6b64\u53c2\u6570\u88ab\u6ce8\u91ca\uff09 task_enable_coroutine TaskWorker \u5de5\u4f5c\u8fdb\u7a0b\u542f\u7528\u534f\u7a0b \u9ed8\u8ba4\u4e0d\u5f00\u542f\uff08\u6b64\u53c2\u6570\u88ab\u6ce8\u91ca\uff09\u6216 bool \u5b50\u8868 light_cache \u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c size \u6700\u591a\u53ef\u4ee5\u7f13\u5b58\u7684 k-v \u6761\u76ee\u6570\uff08\u5fc5\u987b\u662f 2 \u7684 n \u6b21\u65b9\uff09 512 max_strlen \u4f5c\u4e3a value \u5b57\u7b26\u4e32\u7684\u6700\u5927\u957f\u5ea6 32768 hash_conflict_proportion Hash\u51b2\u7a81\u7387\uff08\u8d8a\u5927\u8d8a\u597d\uff0c\u4f46\u662f\u9700\u8981\u7684\u5185\u5b58\u66f4\u591a\uff09 0.6 persistence_path \u6301\u4e45\u5316\u7684\u952e\u503c\u5bf9\u7684\u5b58\u50a8\u8def\u5f84 zm_data \u4e0b\u7684 _cache.json auto_save_interval \u6301\u4e45\u5316\u7684\u952e\u503c\u5bf9\u81ea\u52a8\u4fdd\u5b58\u65f6\u95f4\u95f4\u9694\uff08\u79d2\uff09 900 \u5b50\u8868 worker_cache \u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c worker \u8de8\u8fdb\u7a0b\u7f13\u5b58\u7684\u5b58\u50a8\u5de5\u4f5c\u8fdb\u7a0b id 0 \u5b50\u8868 sql_config \u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c sql_host \u6570\u636e\u5e93\u5730\u5740(\u7559\u7a7a\u5219\u4e0d\u4f7f\u7528\u6570\u636e\u5e93) \u7a7a sql_port \u6570\u636e\u5e93\u7aef\u53e3 3306 sql_username \u8fde\u63a5\u6570\u636e\u5e93\u7684\u7528\u6237\u540d sql_database \u8981\u8fde\u63a5\u7684\u6570\u636e\u5e93\u540d sql_password \u6570\u636e\u5e93\u8fde\u63a5\u5bc6\u7801 sql_options PDO \u6570\u636e\u5e93\u7684 options \u53c2\u6570 [PDO::ATTR_STRINGIFY_FETCHES => false,PDO::ATTR_EMULATE_PREPARES => false] sql_default_fetch_mode PDO \u7684 fetch \u6a21\u5f0f PDO::FETCH_ASSOC \u5b50\u8868 redis_config \u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c host Redis \u670d\u52a1\u5668\u5730\u5740\uff0c\u7559\u7a7a\u5219\u542f\u52a8\u65f6\u4e0d\u521b\u5efa\u8fde\u63a5\u6c60 \u7a7a port Redis \u670d\u52a1\u5668\u7aef\u53e3 6379 timeout Redis \u8d85\u65f6\u65f6\u95f4 1 db_index Redis \u8981\u8fde\u63a5\u7684\u6570\u636e\u5e93 index 0 auth \u8ba4\u8bc1\u5b57\u7b26\u4e32 \u7a7a \u5b50\u8868 static_file_server \u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c status \u662f\u5426\u5f00\u542f\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668 false document_root \u9759\u6001\u6587\u4ef6\u7684\u6839\u76ee\u5f55 {WORKING_DIR}/resources/html document_index \u9ed8\u8ba4\u7d22\u5f15\u7684\u6587\u4ef6\u540d\u5217\u8868 [\"index.html\"] \u5b50\u8868 onebot \u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c status \u662f\u5426\u5f00\u542f OneBot \u6807\u51c6\u673a\u5668\u4eba\u89e3\u6790\u529f\u80fd true single_bot_mode \u662f\u5426\u5f00\u542f\u5355\u673a\u5668\u4eba\u6a21\u5f0f false message_level \u673a\u5668\u4eba\u7684 WebSocket \u4e8b\u4ef6\u5728 Swoole \u539f\u751f\u4e8b\u4ef6 @OnMessageEvent \u4e2d\u7684\u7b49\u7ea7\uff08\u8d8a\u9ad8\u8bf4\u660e\u8d8a\u88ab\u4f18\u5148\u5904\u7406\uff09 99999 \u5b50\u8868 remote_terminal \u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c status \u662f\u5426\u5f00\u542f\u8fdc\u7a0b\u7ec8\u7aef\u529f\u80fd\uff0c\u89c1 \u7ec4\u4ef6 - \u8fdc\u7a0b\u7ec8\u7aef false host \u8fdc\u7a0b\u7ec8\u7aef\u76d1\u542c\u5730\u5740\uff0c\u4e3a\u5b89\u5168\u8d77\u89c1\uff0c\u9ed8\u8ba4\u503c\u53ea\u5141\u8bb8\u672c\u5730\u56de\u73af\u5730\u5740\uff08127.0.0.1\uff09 127.0.0.1 port \u8fdc\u7a0b\u7ec8\u7aef\u76d1\u542c\u7684 TCP \u7aef\u53e3 20002 token \u8fdc\u7a0b\u7ec8\u7aef\u8fde\u63a5\u7684\u4ee4\u724c\uff08\u5982\u679c\u4e3a\u7a7a\uff08\"\"\uff09\u5219\u4e0d\u9a8c\u8bc1\uff09 \"\" \u591a\u73af\u5883\u4e0b\u7684\u914d\u7f6e\u6587\u4ef6 \u70b8\u6bdb\u6846\u67b6\u7684\u914d\u7f6e\u6587\u4ef6\u6a21\u5757\u652f\u6301\u4e0d\u540c\u73af\u5883\u4e0b\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u4e3b\u8981\u7ed3\u6784\u4e3a global.{\u73af\u5883}.php \u3002\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u70b8\u6bdb\u6846\u67b6\u9ed8\u8ba4\u4ece\u6559\u7a0b\u5f15\u5bfc\u65b9\u5f0f\u6839\u636e\u6307\u4ee4 vendor/bin/start server \u542f\u52a8\u7684\u6846\u67b6\u662f\u4e0d\u5e26\u73af\u5883\u63a7\u5236\u7684\u3002\u8fd9\u7ae0\u5c06\u8bb2\u8ff0\u5982\u4f55\u6839\u636e\u4e0d\u540c\u7684\u73af\u5883\uff08development / staging / production\uff09\u6765\u7f16\u5199\u914d\u7f6e\u6587\u4ef6\u3002 \u4f7f\u7528\u73af\u5883\u53c2\u6570 \u5728\u542f\u52a8\u6846\u67b6\u65f6\uff0c\u989d\u5916\u589e\u52a0\u53c2\u6570 --env \u53ef\u4ee5\u6307\u5b9a\u5f53\u524d\u7684\u73af\u5883\uff0c\u4ece\u800c\u4f7f\u7528\u4e0d\u540c\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u73b0\u5728\u6846\u67b6\u652f\u6301\u4ee5\u4e0b\u51e0\u79cd\u73af\u5883\uff1a development \uff0c staging \uff0c production \u3002 1 vendor/bin/start server --env = development \u4e0d\u540c\u73af\u5883\u914d\u7f6e\u6587\u4ef6 \u7531\u4e8e\u6846\u67b6\u9ed8\u8ba4\u53ea\u5e26\u6709 global.php \u6587\u4ef6\uff0c\u6240\u4ee5\u5047\u8bbe\u4f60\u73b0\u5728\u9700\u8981\u533a\u5206\u5f00\u53d1\u73af\u5883\u548c\u751f\u4ea7\u73af\u5883\u7684\u914d\u7f6e\uff0c\u5c06 global.php \u6587\u4ef6\u590d\u5236\u5e76\u91cd\u547d\u540d\u4e3a global.development.php \u6216 global.production.php \u5373\u53ef\u3002 \u4f18\u5148\u7ea7 \u5982\u679c\u6307\u5b9a\u4e86 --env \u73af\u5883\u53c2\u6570\uff1a global.{\u5bf9\u5e94\u73af\u5883}.php > global.php \uff0c\u5982\u679c\u4e24\u4e2a\u914d\u7f6e\u6587\u4ef6\u90fd\u627e\u4e0d\u5230\u5219\u62a5\u9519\u3002 \u5982\u679c\u672a\u6307\u5b9a --env \u73af\u5883\u53c2\u6570\uff1a global.php > global.development.php > global.staging.php > global.production.php \u3002 \u5176\u4ed6\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6 \u70b8\u6bdb\u6846\u67b6\u7684\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u4e3a global.php \uff0c\u4e3a\u4e86\u8ba9\u4e0d\u540c\u7684\u5f00\u53d1\u8005\u66f4\u597d\u7684\u4e8c\u6b21\u5f00\u53d1\u6216\u8005\u96c6\u6210\u66f4\u591a\u529f\u80fd\uff0c\u70b8\u6bdb\u6846\u67b6\u7684\u914d\u7f6e\u6587\u4ef6\u6a21\u5757\u4e5f\u652f\u6301\u81ea\u5df1\u7f16\u5199\u7684\u5176\u4ed6 *.php \u6216 *.json \u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u4f8b\u5982\u70b8\u6bdb\u6846\u67b6\u9ed8\u8ba4\u9644\u5e26\u4e86 file_header.json \u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\uff08\u7528\u6765\u8fd4\u56de\u5404\u7c7b\u6587\u4ef6\u6269\u5c55\u540d\u5bf9\u5e94\u7684 Content-Type \u5934\u53c2\u6570\u7684\u8868\uff09\u3002 \u4f7f\u7528\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u6211\u4eec\u5148\u4ee5 .json \u683c\u5f0f\u4e3a\u4f8b\uff0c\u6211\u4eec\u521b\u5efa\u4e00\u4e2a example_a.json \u6587\u4ef6\u5728 config/ \u76ee\u5f55\uff08\u548c global.php \u4e00\u4e2a\u6587\u4ef6\u5939\u4e0b\uff09\uff0c\u5e76\u7f16\u5199\u81ea\u5df1\u7684\u4efb\u610f\u914d\u7f6e\u5185\u5bb9\uff1a 1 2 3 { \"key1\" : \"value1\" } \u5728\u6846\u67b6\u4e2d\uff0c\u542f\u52a8\u540e\u5c31\u4f1a\u9ed8\u8ba4\u52a0\u8f7d\uff0c\u4f7f\u7528\u53ea\u9700\u8981\u7528\u4ee5\u4e0b\u65b9\u5f0f\u5373\u53ef\uff1a 1 2 use ZM\\Config\\ZMConfig; # \u5148 use \u518d\u4f7f\u7528\uff01 $r = ZMConfig::get(\"example_a\", \"key1\"); # $r == \"value1\" \u5982\u679c\u9700\u8981\u7528\u5230\u53d8\u91cf\u6216\u5176\u4ed6\u52a8\u6001\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u4f7f\u7528 .php \u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u8fd9\u91cc\u8fd8\u662f\u4ee5 example_a.php \u6765\u4e3e\u4f8b\uff1a 1 2 3 4 <?php $config [ 'key1' ] = \"value1\" ; $config [ 'starttime' ] = time (); return $config ; \u4f7f\u7528\u65b9\u5f0f\u540c\u4e0a\uff1a 1 2 $r = ZMConfig::get(\"example_a\", \"key1\"); # $r == \"value1\" $time = ZMConfig::get(\"example_a\", \"starttime\"); # $time == \u670d\u52a1\u5668\u542f\u52a8\u65f6\u95f4 \u540c\u65f6\uff0c\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\u4e5f\u652f\u6301\u73af\u5883\u53d8\u91cf\uff0c\u4f8b\u5982\uff1a example_a.development.json \u6216 example_a.production.php \u5747\u53ef\u3002","title":"\u57fa\u672c\u914d\u7f6e"},{"location":"guide/basic-config/#_1","text":"\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u70b8\u6bdb\u6846\u67b6\u7684\u914d\u7f6e\u6587\u4ef6\u8fd8\u6ca1\u6709\u4efb\u4f55\u53d8\u66f4\uff0c\u662f\u9ed8\u8ba4\u7684\u884c\u4e3a\u3002\u5728\u672c\u7ae0\u5185\u5bb9\u4e2d\uff0c\u5c06\u5217\u4e3e\u51fa\u70b8\u6bdb\u6846\u67b6\u7684\u914d\u7f6e\u6587\u4ef6\u7684\u89c4\u5219\u548c\u4f7f\u7528\u3002 \u8b66\u544a \u56e0\u4e3a\u70b8\u6bdb\u6846\u67b6\u7684\u5168\u5c40\u914d\u7f6e\u4e2d\u542b\u6709\u6570\u636e\u5e93\u540d\u79f0\u548c\u5bc6\u7801\u4ee5\u53ca access_token \u7b49\u654f\u611f\u5b57\u6bb5\uff0c\u5728\u4f7f\u7528\u7248\u672c\u63a7\u5236\u8f6f\u4ef6\u8fc7\u7a0b\u4e2d\u8bf7\u4e0d\u8981\u5c06\u654f\u611f\u4fe1\u606f\u5199\u5165\u914d\u7f6e\u6587\u4ef6\u5e76\u63d0\u4ea4\u81f3\u5f00\u6e90\u4ed3\u5e93\uff01","title":"\u57fa\u672c\u914d\u7f6e"},{"location":"guide/basic-config/#globalphp","text":"\u6846\u67b6\u7684\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u5728 config/global.php \u6587\u4ef6\u4e2d\u3002\u4e0b\u9762\u662f\u914d\u7f6e\u6587\u4ef6\u7684\u5404\u4e2a\u9009\u9879\uff0c\u8bf7\u6839\u636e\u81ea\u5df1\u7684\u9700\u8981\u81ea\u884c\u914d\u7f6e\u3002 \u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c host \u6846\u67b6\u76d1\u542c\u7684\u5730\u5740 0.0.0.0 port \u6846\u67b6\u76d1\u542c\u7684\u7aef\u53e3 20001 http_reverse_link \u6846\u67b6\u5f00\u5230\u516c\u7f51\u6216\u5916\u90e8\u7684 HTTP \u53cd\u4ee3\u94fe\u63a5 \u89c1\u914d\u7f6e\u6587\u4ef6 zm_data \u6846\u67b6\u7684\u914d\u7f6e\u6587\u4ef6\u3001\u65e5\u5fd7\u6587\u4ef6\u7b49\u6587\u4ef6\u76ee\u5f55 ./ \u4e0b\u7684 zm_data/ debug_mode \u6846\u67b6\u662f\u5426\u542f\u52a8 debug \u6a21\u5f0f false crash_dir \u5b58\u653e\u5d29\u6e83\u548c\u8fd0\u884c\u65e5\u5fd7\u7684\u76ee\u5f55 zm_data \u4e0b\u7684 crash/ config_dir \u5b58\u653e saveToJson() \u65b9\u6cd5\u4fdd\u5b58\u7684\u6570\u636e\u7684\u76ee\u5f55 zm_data \u4e0b\u7684 config/ swoole \u5bf9\u5e94 Swoole server \u4e2d set \u7684\u53c2\u6570\uff0c\u53c2\u8003Swoole\u6587\u6863 \u89c1\u5b50\u8868 swoole light_cache \u8f7b\u91cf\u5185\u7f6e key-value \u7f13\u5b58 \u89c1\u5b57\u8868 light_cache worker_cache \u8de8\u8fdb\u7a0b\u53d8\u91cf\u7ea7\u7f13\u5b58 \u89c1\u5b50\u8868 worker_cache sql_config MySQL \u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f \u89c1\u5b50\u8868 sql_config redis_config Redis \u8fde\u63a5\u4fe1\u606f \u89c1\u5b50\u8868 redis_config access_token OneBot \u5ba2\u6237\u7aef\u8fde\u63a5\u7ea6\u5b9a\u7684token\uff0c\u7559\u7a7a\u5219\u65e0\uff0c\u76f8\u5173\u8bbe\u7f6e\u89c1 \u7ec4\u4ef6 - Access Token \u9a8c\u8bc1 \u7a7a http_header HTTP \u8bf7\u6c42\u81ea\u5b9a\u4e49\u8fd4\u56de\u7684header \u89c1\u914d\u7f6e\u6587\u4ef6 http_default_code_page HTTP\u670d\u52a1\u5668\u5728\u6307\u5b9a\u72b6\u6001\u7801\u4e0b\u56de\u590d\u7684\u9ed8\u8ba4\u9875\u9762 \u89c1\u914d\u7f6e\u6587\u4ef6 init_atomics \u6846\u67b6\u542f\u52a8\u65f6\u521d\u59cb\u5316\u7684\u539f\u5b50\u8ba1\u6570\u5668\u5217\u8868 \u89c1\u914d\u7f6e\u6587\u4ef6 info_level \u7ec8\u7aef\u65e5\u5fd7\u663e\u793a\u7b49\u7ea7\uff080-4\uff09 2 context_class \u4e0a\u4e0b\u6587\u6240\u5b9a\u4e49\u7684\u7c7b\uff0c\u89c1\u5bf9\u5e94\u4e0a\u4e0b\u6587\u8bf4\u660e\u6587\u6863 \\ZM\\Context\\Context::class static_file_server \u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668\u914d\u7f6e\u9879 \u89c1\u5b50\u8868 static_file_server server_event_handler_class \u6ce8\u518c Swoole Server \u4e8b\u4ef6\u6ce8\u89e3\u7684\u7c7b\u5217\u8868\uff0c\u5728 Swoole \u670d\u52a1\u5668\u542f\u52a8\u524d\u5c31\u88ab\u52a0\u8f7d \u7a7a onebot OneBot \u534f\u8bae\u76f8\u5173\u914d\u7f6e \u89c1\u5b50\u8868 onebot remote_terminal \u8fdc\u7a0b\u7ec8\u7aef\u76f8\u5173\u914d\u7f6e \u89c1\u5b50\u8868 remote_terminal","title":"\u5168\u5c40\u914d\u7f6e\u6587\u4ef6 global.php"},{"location":"guide/basic-config/#swoole","text":"\u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c log_file Swoole \u7684\u65e5\u5fd7\u6587\u4ef6 crash_dir \u4e0b\u7684 swoole_error.log worker_num Worker \u5de5\u4f5c\u8fdb\u7a0b\u6570 \u8fd0\u884c\u6846\u67b6\u7684\u4e3b\u673a CPU \u6838\u5fc3\u6570 dispatch_mode \u6570\u636e\u5305\u5206\u53d1\u7b56\u7565\uff0c\u89c1 \u6587\u6863 2 max_coroutine \u6700\u5927\u534f\u7a0b\u5e76\u53d1\u6570 300000 max_wait_time \u9000\u51fa\u8fdb\u7a0b\u65f6\u7b49\u5f85\u534f\u7a0b\u6062\u590d\u7684\u6700\u957f\u65f6\u95f4\uff08\u79d2\uff09 5\uff082.4.3 \u7248\u672c\u540e\u9ed8\u8ba4\u503c\uff09 task_worker_num TaskWorker \u5de5\u4f5c\u8fdb\u7a0b\u6570 \u9ed8\u8ba4\u4e0d\u5f00\u542f\uff08\u6b64\u53c2\u6570\u88ab\u6ce8\u91ca\uff09 task_enable_coroutine TaskWorker \u5de5\u4f5c\u8fdb\u7a0b\u542f\u7528\u534f\u7a0b \u9ed8\u8ba4\u4e0d\u5f00\u542f\uff08\u6b64\u53c2\u6570\u88ab\u6ce8\u91ca\uff09\u6216 bool","title":"\u5b50\u8868 swoole"},{"location":"guide/basic-config/#light_cache","text":"\u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c size \u6700\u591a\u53ef\u4ee5\u7f13\u5b58\u7684 k-v \u6761\u76ee\u6570\uff08\u5fc5\u987b\u662f 2 \u7684 n \u6b21\u65b9\uff09 512 max_strlen \u4f5c\u4e3a value \u5b57\u7b26\u4e32\u7684\u6700\u5927\u957f\u5ea6 32768 hash_conflict_proportion Hash\u51b2\u7a81\u7387\uff08\u8d8a\u5927\u8d8a\u597d\uff0c\u4f46\u662f\u9700\u8981\u7684\u5185\u5b58\u66f4\u591a\uff09 0.6 persistence_path \u6301\u4e45\u5316\u7684\u952e\u503c\u5bf9\u7684\u5b58\u50a8\u8def\u5f84 zm_data \u4e0b\u7684 _cache.json auto_save_interval \u6301\u4e45\u5316\u7684\u952e\u503c\u5bf9\u81ea\u52a8\u4fdd\u5b58\u65f6\u95f4\u95f4\u9694\uff08\u79d2\uff09 900","title":"\u5b50\u8868 light_cache"},{"location":"guide/basic-config/#worker_cache","text":"\u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c worker \u8de8\u8fdb\u7a0b\u7f13\u5b58\u7684\u5b58\u50a8\u5de5\u4f5c\u8fdb\u7a0b id 0","title":"\u5b50\u8868 worker_cache"},{"location":"guide/basic-config/#sql_config","text":"\u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c sql_host \u6570\u636e\u5e93\u5730\u5740(\u7559\u7a7a\u5219\u4e0d\u4f7f\u7528\u6570\u636e\u5e93) \u7a7a sql_port \u6570\u636e\u5e93\u7aef\u53e3 3306 sql_username \u8fde\u63a5\u6570\u636e\u5e93\u7684\u7528\u6237\u540d sql_database \u8981\u8fde\u63a5\u7684\u6570\u636e\u5e93\u540d sql_password \u6570\u636e\u5e93\u8fde\u63a5\u5bc6\u7801 sql_options PDO \u6570\u636e\u5e93\u7684 options \u53c2\u6570 [PDO::ATTR_STRINGIFY_FETCHES => false,PDO::ATTR_EMULATE_PREPARES => false] sql_default_fetch_mode PDO \u7684 fetch \u6a21\u5f0f PDO::FETCH_ASSOC","title":"\u5b50\u8868 sql_config"},{"location":"guide/basic-config/#redis_config","text":"\u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c host Redis \u670d\u52a1\u5668\u5730\u5740\uff0c\u7559\u7a7a\u5219\u542f\u52a8\u65f6\u4e0d\u521b\u5efa\u8fde\u63a5\u6c60 \u7a7a port Redis \u670d\u52a1\u5668\u7aef\u53e3 6379 timeout Redis \u8d85\u65f6\u65f6\u95f4 1 db_index Redis \u8981\u8fde\u63a5\u7684\u6570\u636e\u5e93 index 0 auth \u8ba4\u8bc1\u5b57\u7b26\u4e32 \u7a7a","title":"\u5b50\u8868 redis_config"},{"location":"guide/basic-config/#static_file_server","text":"\u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c status \u662f\u5426\u5f00\u542f\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668 false document_root \u9759\u6001\u6587\u4ef6\u7684\u6839\u76ee\u5f55 {WORKING_DIR}/resources/html document_index \u9ed8\u8ba4\u7d22\u5f15\u7684\u6587\u4ef6\u540d\u5217\u8868 [\"index.html\"]","title":"\u5b50\u8868 static_file_server"},{"location":"guide/basic-config/#onebot","text":"\u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c status \u662f\u5426\u5f00\u542f OneBot \u6807\u51c6\u673a\u5668\u4eba\u89e3\u6790\u529f\u80fd true single_bot_mode \u662f\u5426\u5f00\u542f\u5355\u673a\u5668\u4eba\u6a21\u5f0f false message_level \u673a\u5668\u4eba\u7684 WebSocket \u4e8b\u4ef6\u5728 Swoole \u539f\u751f\u4e8b\u4ef6 @OnMessageEvent \u4e2d\u7684\u7b49\u7ea7\uff08\u8d8a\u9ad8\u8bf4\u660e\u8d8a\u88ab\u4f18\u5148\u5904\u7406\uff09 99999","title":"\u5b50\u8868 onebot"},{"location":"guide/basic-config/#remote_terminal","text":"\u914d\u7f6e\u540d\u79f0 \u8bf4\u660e \u9ed8\u8ba4\u503c status \u662f\u5426\u5f00\u542f\u8fdc\u7a0b\u7ec8\u7aef\u529f\u80fd\uff0c\u89c1 \u7ec4\u4ef6 - \u8fdc\u7a0b\u7ec8\u7aef false host \u8fdc\u7a0b\u7ec8\u7aef\u76d1\u542c\u5730\u5740\uff0c\u4e3a\u5b89\u5168\u8d77\u89c1\uff0c\u9ed8\u8ba4\u503c\u53ea\u5141\u8bb8\u672c\u5730\u56de\u73af\u5730\u5740\uff08127.0.0.1\uff09 127.0.0.1 port \u8fdc\u7a0b\u7ec8\u7aef\u76d1\u542c\u7684 TCP \u7aef\u53e3 20002 token \u8fdc\u7a0b\u7ec8\u7aef\u8fde\u63a5\u7684\u4ee4\u724c\uff08\u5982\u679c\u4e3a\u7a7a\uff08\"\"\uff09\u5219\u4e0d\u9a8c\u8bc1\uff09 \"\"","title":"\u5b50\u8868 remote_terminal"},{"location":"guide/basic-config/#_2","text":"\u70b8\u6bdb\u6846\u67b6\u7684\u914d\u7f6e\u6587\u4ef6\u6a21\u5757\u652f\u6301\u4e0d\u540c\u73af\u5883\u4e0b\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u4e3b\u8981\u7ed3\u6784\u4e3a global.{\u73af\u5883}.php \u3002\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u70b8\u6bdb\u6846\u67b6\u9ed8\u8ba4\u4ece\u6559\u7a0b\u5f15\u5bfc\u65b9\u5f0f\u6839\u636e\u6307\u4ee4 vendor/bin/start server \u542f\u52a8\u7684\u6846\u67b6\u662f\u4e0d\u5e26\u73af\u5883\u63a7\u5236\u7684\u3002\u8fd9\u7ae0\u5c06\u8bb2\u8ff0\u5982\u4f55\u6839\u636e\u4e0d\u540c\u7684\u73af\u5883\uff08development / staging / production\uff09\u6765\u7f16\u5199\u914d\u7f6e\u6587\u4ef6\u3002","title":"\u591a\u73af\u5883\u4e0b\u7684\u914d\u7f6e\u6587\u4ef6"},{"location":"guide/basic-config/#_3","text":"\u5728\u542f\u52a8\u6846\u67b6\u65f6\uff0c\u989d\u5916\u589e\u52a0\u53c2\u6570 --env \u53ef\u4ee5\u6307\u5b9a\u5f53\u524d\u7684\u73af\u5883\uff0c\u4ece\u800c\u4f7f\u7528\u4e0d\u540c\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u73b0\u5728\u6846\u67b6\u652f\u6301\u4ee5\u4e0b\u51e0\u79cd\u73af\u5883\uff1a development \uff0c staging \uff0c production \u3002 1 vendor/bin/start server --env = development","title":"\u4f7f\u7528\u73af\u5883\u53c2\u6570"},{"location":"guide/basic-config/#_4","text":"\u7531\u4e8e\u6846\u67b6\u9ed8\u8ba4\u53ea\u5e26\u6709 global.php \u6587\u4ef6\uff0c\u6240\u4ee5\u5047\u8bbe\u4f60\u73b0\u5728\u9700\u8981\u533a\u5206\u5f00\u53d1\u73af\u5883\u548c\u751f\u4ea7\u73af\u5883\u7684\u914d\u7f6e\uff0c\u5c06 global.php \u6587\u4ef6\u590d\u5236\u5e76\u91cd\u547d\u540d\u4e3a global.development.php \u6216 global.production.php \u5373\u53ef\u3002","title":"\u4e0d\u540c\u73af\u5883\u914d\u7f6e\u6587\u4ef6"},{"location":"guide/basic-config/#_5","text":"\u5982\u679c\u6307\u5b9a\u4e86 --env \u73af\u5883\u53c2\u6570\uff1a global.{\u5bf9\u5e94\u73af\u5883}.php > global.php \uff0c\u5982\u679c\u4e24\u4e2a\u914d\u7f6e\u6587\u4ef6\u90fd\u627e\u4e0d\u5230\u5219\u62a5\u9519\u3002 \u5982\u679c\u672a\u6307\u5b9a --env \u73af\u5883\u53c2\u6570\uff1a global.php > global.development.php > global.staging.php > global.production.php \u3002","title":"\u4f18\u5148\u7ea7"},{"location":"guide/basic-config/#_6","text":"\u70b8\u6bdb\u6846\u67b6\u7684\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u4e3a global.php \uff0c\u4e3a\u4e86\u8ba9\u4e0d\u540c\u7684\u5f00\u53d1\u8005\u66f4\u597d\u7684\u4e8c\u6b21\u5f00\u53d1\u6216\u8005\u96c6\u6210\u66f4\u591a\u529f\u80fd\uff0c\u70b8\u6bdb\u6846\u67b6\u7684\u914d\u7f6e\u6587\u4ef6\u6a21\u5757\u4e5f\u652f\u6301\u81ea\u5df1\u7f16\u5199\u7684\u5176\u4ed6 *.php \u6216 *.json \u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u4f8b\u5982\u70b8\u6bdb\u6846\u67b6\u9ed8\u8ba4\u9644\u5e26\u4e86 file_header.json \u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\uff08\u7528\u6765\u8fd4\u56de\u5404\u7c7b\u6587\u4ef6\u6269\u5c55\u540d\u5bf9\u5e94\u7684 Content-Type \u5934\u53c2\u6570\u7684\u8868\uff09\u3002 \u4f7f\u7528\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u6211\u4eec\u5148\u4ee5 .json \u683c\u5f0f\u4e3a\u4f8b\uff0c\u6211\u4eec\u521b\u5efa\u4e00\u4e2a example_a.json \u6587\u4ef6\u5728 config/ \u76ee\u5f55\uff08\u548c global.php \u4e00\u4e2a\u6587\u4ef6\u5939\u4e0b\uff09\uff0c\u5e76\u7f16\u5199\u81ea\u5df1\u7684\u4efb\u610f\u914d\u7f6e\u5185\u5bb9\uff1a 1 2 3 { \"key1\" : \"value1\" } \u5728\u6846\u67b6\u4e2d\uff0c\u542f\u52a8\u540e\u5c31\u4f1a\u9ed8\u8ba4\u52a0\u8f7d\uff0c\u4f7f\u7528\u53ea\u9700\u8981\u7528\u4ee5\u4e0b\u65b9\u5f0f\u5373\u53ef\uff1a 1 2 use ZM\\Config\\ZMConfig; # \u5148 use \u518d\u4f7f\u7528\uff01 $r = ZMConfig::get(\"example_a\", \"key1\"); # $r == \"value1\" \u5982\u679c\u9700\u8981\u7528\u5230\u53d8\u91cf\u6216\u5176\u4ed6\u52a8\u6001\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u4f7f\u7528 .php \u683c\u5f0f\u7684\u914d\u7f6e\u6587\u4ef6\u3002\u8fd9\u91cc\u8fd8\u662f\u4ee5 example_a.php \u6765\u4e3e\u4f8b\uff1a 1 2 3 4 <?php $config [ 'key1' ] = \"value1\" ; $config [ 'starttime' ] = time (); return $config ; \u4f7f\u7528\u65b9\u5f0f\u540c\u4e0a\uff1a 1 2 $r = ZMConfig::get(\"example_a\", \"key1\"); # $r == \"value1\" $time = ZMConfig::get(\"example_a\", \"starttime\"); # $time == \u670d\u52a1\u5668\u542f\u52a8\u65f6\u95f4 \u540c\u65f6\uff0c\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6\u4e5f\u652f\u6301\u73af\u5883\u53d8\u91cf\uff0c\u4f8b\u5982\uff1a example_a.development.json \u6216 example_a.production.php \u5747\u53ef\u3002","title":"\u5176\u4ed6\u81ea\u5b9a\u4e49\u914d\u7f6e\u6587\u4ef6"},{"location":"guide/errcode/","text":"\u5f02\u5e38\u7801 \u542b\u4e49 \u89e3\u51b3\u65b9\u6848 E00001 \u70b8\u6bdb\u6846\u67b6\u672a\u68c0\u6d4b\u5230 PHP \u5b89\u88c5\u4e86 Swoole \u6269\u5c55 \u6839\u636e\u6587\u6863\u5b89\u88c5\u6269\u5c55\u53bb\uff01 E00002 Swoole \u6269\u5c55\u5b89\u88c5\u7684\u7248\u672c\u8fc7\u4f4e \u5347\u7ea7 Swoole \u7248\u672c\uff0c\u6700\u597d\u4e3a\u6700\u65b0\u7248\u3002 E00003 PHP \u7248\u672c\u8fc7\u4f4e \u5347\u7ea7 PHP \u7248\u672c\uff0c\u81f3\u5c11\u4e3a 7.2\u3002 E00004 Swoole \u7248\u672c\u4f4e\u4e8e 4.6.7 \u4e14\u672a\u5b89\u88c5 pcntl \u6269\u5c55 \u5b89\u88c5 pcntl \u6269\u5c55\u6216\u5347\u7ea7 Swoole \u81f3\u5c11\u4e3a4.6.7\u3002 E00005 \u5728\u6846\u67b6\u547d\u4ee4\u884c\u89e3\u6790\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e86\u81f4\u547d\u9519\u8bef \u8bf7\u6839\u636e\u63d0\u793a\u7684\u9519\u8bef\u4f4d\u7f6e\u8fdb\u884c\u8c03\u8bd5\u548c\u4fee\u590d\uff0c\u5982\u679c\u672a\u89e3\u51b3\u8bf7\u5c06\u95ee\u9898\u53cd\u9988\u7ed9\u4f5c\u8005\u3002 E00006 \u70b8\u6bdb\u6846\u67b6\u5728\u6e90\u7801\u6a21\u5f0f\u542f\u52a8\u65f6\u672a\u80fd\u4fee\u6539 composer.json \u6587\u4ef6 \u68c0\u67e5\u6e90\u7801\u6a21\u5f0f\u4e0b composer.json \u6587\u4ef6\u662f\u5426\u6b63\u5e38\u53ef\u5199\u53ef\u8bfb\u3002 E00007 \u6846\u67b6\u5728\u542f\u52a8\u65f6\u672a\u627e\u5230 global.php \u5168\u5c40\u914d\u7f6e\u6587\u4ef6 \u5982\u679c\u662f\u4f7f\u7528 composer create-project \u6216\u7528 git \u6765\u514b\u9686 starter \u4ed3\u5e93\u7684\uff0c\u9700\u8981\u5148\u4f7f\u7528 vendor/bin/start init \u6307\u4ee4\uff0c\u518d\u542f\u52a8\u670d\u52a1\u5668\u3002 E00008 \u6846\u67b6\u5728\u542f\u52a8\u65f6\u7ed9\u7528\u4e8e\u5b58\u50a8\u8fde\u63a5\u6570\u636e\u7684\u5171\u4eab\u5185\u5b58\u8868\u521d\u59cb\u5316\u5931\u8d25 \u8bf7\u68c0\u67e5\u7cfb\u7edf\u5185\u5b58\u662f\u5426\u8fc7\u5c0f\uff0c\u5982\u679c\u4e00\u5207\u6b63\u5e38\uff0c\u6b64\u95ee\u9898\u4e00\u822c\u662f\u6846\u67b6\u5185\u90e8\u5bfc\u81f4\u7684\u95ee\u9898\uff0c\u8bf7\u5c06\u9519\u8bef\u65e5\u5fd7\u53cd\u9988\u7ed9\u5f00\u53d1\u8005\u3002 E00009 \u4f7f\u7528 --remote-terminal \u65f6\u8fdc\u7a0b\u7ec8\u7aef\u5904\u7406\u547d\u4ee4\u51fa\u73b0\u5f02\u5e38\u6216\u81f4\u547d\u9519\u8bef \u68c0\u67e5\u81ea\u8eab\u7684\u8fdc\u7a0b\u7ec8\u7aef\u662f\u5426\u6b63\u786e\u914d\u7f6e\u548c\u4f7f\u7528\uff0c\u81ea\u5b9a\u4e49\u7684 @TerminalCommand \u6ce8\u89e3\u662f\u5426\u629b\u51fa\u4e86\u81f4\u547d\u9519\u8bef\u3002 E00010 \u6846\u67b6\u5728\u7b2c\u4e00\u6b65\u7684\u542f\u52a8\u9636\u6bb5\u629b\u51fa\u5f02\u5e38\u6216\u81f4\u547d\u9519\u8bef\uff0c\u5bfc\u81f4\u6846\u67b6\u4e0d\u80fd\u7ee7\u7eed\u8fd0\u884c \u6b64\u9519\u8bef\u6db5\u76d6\u7684\u9519\u8bef\u5185\u5bb9\u8f83\u591a\uff0c\u8bf7\u6839\u636e\u5b9e\u9645\u629b\u51fa\u7684\u5f02\u5e38\u5185\u5bb9\u8fdb\u884c\u5904\u7406\u6216\u53cd\u9988\u7ed9\u5f00\u53d1\u8005\u3002 \u5982\u679c\u4f60\u4f7f\u7528\u4e86 @SwooleHandler \u6216 @OnSetup \u6ce8\u89e3\uff0c\u90a3\u4e48\u53ef\u4ee5\u81ea\u884c\u68c0\u67e5\u4e00\u4e0b\u6ce8\u89e3\u7ed1\u5b9a\u7684\u51fd\u6570\u6709\u6ca1\u6709\u51fa\u9519\u3002 E00011 \u6846\u67b6\u5728\u8c03\u7528 Swoole \u670d\u52a1\u5668\u542f\u52a8 $server->start() \u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e86\u5f02\u5e38 \u6b64\u95ee\u9898\u672a\u7ecf\u6d4b\u8bd5\uff0c\u6682\u65e0\u89e3\u51b3\u65b9\u6848\uff0c\u4e5f\u6ca1\u6709\u9047\u5230\u8fc7\uff0c\u5982\u679c\u6709\u53d1\u751f\uff0c\u8bf7\u5c06\u9519\u8bef\u53cd\u9988\u5f00\u53d1\u8005\u3002 E00012 \u6846\u67b6\u5728\u542f\u52a8\u65f6\u8c03\u7528\u811a\u672c\u89e3\u6790 @SwooleHandler \u548c @OnSetup \u65f6\u51fa\u73b0\u4e86\u5f02\u5e38 \u7559\u4e2a\u5751\uff0c\u4e0b\u6b21\u5199\uff0cTODO\u3002 E00013 \u4f7f\u7528\u547d\u4ee4\u884c\u53c2\u6570\u52a8\u6001\u8bbe\u7f6e\u542f\u52a8\u7684 Worker/TaskWorker \u8fdb\u7a0b\u6570\u65f6\u8f93\u5165\u4e86\u975e\u6cd5\u7684\u6570\u5b57 \u586b\u5199\u5408\u6cd5\u7684\u6570\u5b57\u6216\u4e0d\u4f7f\u7528\u6b64\u529f\u80fd\u3002 E00014 \u70b8\u6bdb\u6846\u67b6\u7684\u542f\u52a8\u547d\u4ee4\u62a5\u9519\uff0c\u63d0\u793a\u6ca1\u6709\u627e\u5230 PHP \u73af\u5883 \u4f7f\u7528 ./install-runtime.sh \u547d\u4ee4\u5b89\u88c5\u4fbf\u643a\u7684\u9759\u6001 PHP \u73af\u5883\u6216\u6839\u636e\u6559\u7a0b\u548c Linux \u53d1\u884c\u7248\u5b89\u88c5\u73af\u5883\u3002 E00015 \u542f\u52a8\u547d\u4ee4\u542f\u52a8\u6846\u67b6\u627e\u4e0d\u5230\u6846\u67b6\u672c\u4f53\u7684\u5165\u53e3\u6587\u4ef6 \u8bf7\u68c0\u67e5 Composer \u62c9\u53d6\u7684\u6846\u67b6\u4ee3\u7801\u662f\u5426\u5b8c\u6574\u3002 E00016 \u8fde\u63a5\u4e2d\u65ad\u540e @OnCloseEvent \u4e8b\u4ef6\u629b\u51fa\u5f02\u5e38 \u68c0\u67e5 @OnCloseEvent \u6216 @OnSwooleEvent(\"close\") \u6ce8\u89e3\u4e8b\u4ef6\u3002 E00017 \u6846\u67b6\u4f5c\u4e3a WebSocket \u670d\u52a1\u5668\u6536\u5230\u5ba2\u6237\u7aef\u6570\u636e\u540e @OnMessageEvent \u3001 @OnSwooleEvent(\"message\") \u6216 OneBot \u76f8\u5173\u4e8b\u4ef6\u629b\u51fa\u4e86\u672a\u88ab\u6355\u83b7\u7684\u5f02\u5e38\u6216\u9519\u8bef \u68c0\u67e5 @OnSwooleEvent(\"message\") \u3001 @OnMessageEvent \u6216 OneBot \u76f8\u5173\u6ce8\u89e3\u4e8b\u4ef6\u3002 E00018 \u6846\u67b6\u8bbe\u7f6e access_token \u53c2\u6570\u4e3a\u81ea\u5b9a\u4e49\u95ed\u5305\u51fd\u6570\uff0c\u6709\u65b0 WebSocket \u8fde\u63a5\u63a5\u5165\u4f46\u662f\u95ed\u5305\u51fd\u6570\u8fd4\u56de\u5931\u8d25 \u8bf4\u767d\u4e86\u5c31\u662f\u81ea\u5b9a\u4e49\u7684 access_token \u9a8c\u8bc1\u5931\u8d25\u3002\u5982\u679c\u662f\u81ea\u5df1\u7684 OneBot \u5ba2\u6237\u7aef\u8fde\u63a5\uff0c\u90a3\u4e48\u8bf7\u68c0\u67e5\u4f60\u7684\u51fd\u6570\u6216 OneBot \u5ba2\u6237\u7aef\u90a3\u8fb9\u548c\u6846\u67b6\u7ea6\u5b9a\u7684 token \u662f\u5426\u4e00\u81f4\uff0c\u5982\u679c\u5c06\u6846\u67b6\u5f00\u5230\u4e86\u516c\u7f51\u5e76\u6709\u4eba\u5c1d\u8bd5\u8fde\u63a5\u4f46\u5931\u8d25\u4e86\u8bf4\u660e\u662f\u6b63\u5e38\u73b0\u8c61\u3002 E00019 \u6846\u67b6\u8bbe\u7f6e\u4e86 access_token \u4e3a\u56fa\u5b9a\u5b57\u7b26\u4e32\uff0c\u4f46\u662f WebSocket \u65b0\u8fde\u63a5\u9a8c\u8bc1 Token \u5931\u8d25 \u5982\u679c\u662f\u81ea\u8eab\u884c\u4e3a\uff0c\u6bd4\u5982 OneBot \u5ba2\u6237\u7aef\u63a5\u5165\uff0c\u8bf7\u68c0\u67e5 Token \u662f\u5426\u4e00\u81f4\u3002\u5982\u679c\u4e0d\u9700\u8981\u8bbe\u7f6e Token\uff0c\u8bf7\u68c0\u67e5\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u7684 access_token \u9879\u662f\u5426\u4e3a\u7a7a\u5b57\u7b26\u4e32\u3002 E00020 \u6846\u67b6\u5728\u6536\u5230 WebSocket \u8fde\u63a5\u540e\u89e6\u53d1 @OnOpenEvent \u6ce8\u89e3\u4e8b\u4ef6\u8fc7\u7a0b\u4e2d\u629b\u51fa\u4e86\u5f02\u5e38 \u68c0\u67e5\u7528\u6237\u4ee3\u7801\u4e2d @OnOpenEvent \u3001 @OnSwooleEvent(\"open\") \u6ce8\u89e3\u4e8b\u4ef6\u4e0b\u7684\u4ee3\u7801\u662f\u5426\u6709\u95ee\u9898\u3002 E00021 \u6846\u67b6\u5728\u5904\u7406 pipeMessage \u4e8b\u4ef6\u65f6\u51fa\u73b0\u4e86\u5f02\u5e38 \u5982\u679c\u5199\u4e86 @OnPipeMessageEvent \u6ce8\u89e3\u4e8b\u4ef6\uff0c\u8bf7\u68c0\u67e5\u5bf9\u5e94\u6ce8\u89e3\u4e8b\u4ef6\u3002\u5982\u679c\u672a\u8bbe\u7f6e\uff0c\u53ef\u80fd\u662f\u6846\u67b6\u5185\u90e8\u9519\u8bef\uff0c\u8bf7\u5c06\u62a5\u9519\u4fe1\u606f\u53cd\u9988\u5f00\u53d1\u8005\u3002 E00022 \u8c03\u7528 ProcessManager::sendActionToWorker() \u65b9\u6cd5\u65f6\uff0c\u8c03\u7528\u6b64\u65b9\u6cd5\u7684\u8fdb\u7a0b\u4e0d\u662f Worker \u6216 Manager \u8fdb\u7a0b \u5982\u679c\u4f60\u5728 Master \u8fdb\u7a0b\u8c03\u7528\u6b64\u65b9\u6cd5\u4f1a\u76f4\u63a5\u62a5\u6b64\u9519\u8bef\uff0c\u6846\u67b6\u4e0d\u652f\u6301\u4ece Master \u8fdb\u7a0b\u8c03\u7528\u6b64\u65b9\u6cd5\u3002 E00023 \u6846\u67b6\u5728\u6536\u5230 HTTP \u8bf7\u6c42\u540e\u5904\u7406\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u4e86\u672a\u6355\u83b7\u7684\u5f02\u5e38 \u68c0\u67e5 HTTP \u8bf7\u6c42\u76f8\u5173\u7684\u6ce8\u89e3\u89e3\u6790\u4ee3\u7801\uff0c\u5982\u679c\u8c03\u7528\u6808\u663e\u793a\u975e\u7528\u6237\u4ee3\u7801\u6240\u81f4\uff0c\u8bf7\u5c06\u9519\u8bef\u4fe1\u606f\u53cd\u9988\u5f00\u53d1\u8005\u3002 E00024 \u6846\u67b6\u4f7f\u7528 --watch \u65f6\u65e0\u6cd5\u4f7f\u7528\u70ed\u66f4\u65b0\u5e76\u62a5\u9519 PHP \u672a\u5b89\u88c5 inotify \u6269\u5c55\uff0c\u8bf7\u4f7f\u7528 pecl \u5b89\u88c5 inotify \u6269\u5c55\u5e76\u542f\u7528\u540e\u518d\u8bd5\u3002 E00025 \u6846\u67b6\u4f7f\u7528\u7ec8\u7aef\u8f93\u5165\u65f6\u4ea7\u751f\u4e86\u672a\u6355\u83b7\u7684\u5f02\u5e38\u6216\u81f4\u547d\u9519\u8bef \u68c0\u67e5 @TerminalCommand \u6ce8\u89e3\u4e8b\u4ef6\u6216\u68c0\u67e5\u4f7f\u7528\u52a8\u6001\u547d\u4ee4\u7684\u5185\u5bb9\uff08\u4f8b\u5982 bc \u6216 call \u8fd0\u884c\u7684\u4ee3\u7801\u6216\u51fd\u6570\u6709\u6ca1\u6709\u9519\u8bef\uff09\u3002 E00026 \u6846\u67b6\u4f7f\u7528 @OnTask \u6ce8\u89e3\u5728 TaskWorker \u8fdb\u7a0b\u4e2d\u6267\u884c\u51fd\u6570\u629b\u51fa\u4e86\u5f02\u5e38 \u68c0\u67e5 TaskWorker \u8fd0\u884c\u7684\u4efb\u52a1\u4ee3\u7801\u662f\u5426\u4f1a\u629b\u51fa\u672a\u6355\u83b7\u7684\u5f02\u5e38\u3002 E00027 \u6846\u67b6\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d Worker \u8fdb\u7a0b\u53d1\u751f\u672a\u6355\u83b7\u7684\u5f02\u5e38\u5bfc\u81f4\u5d29\u6e83\u9000\u51fa \u89c1 Issue #38 \u3002 E00028 PHP \u672a\u5b89\u88c5 pdo_mysql\uff08mysqlnd+PDO\uff09\u6269\u5c55 \u5b89\u88c5 php-mysql\uff08\u4ee5 ubuntu \u4e3a\u4f8b\uff0capt install php-pdo php-mysql\uff09\u3002 E00029 PHP \u672a\u5b89\u88c5 redis \u6269\u5c55 \u5b89\u88c5 redis \u6269\u5c55\u3002 E00030 \u6846\u67b6\u5728 Worker \u8fdb\u7a0b\u542f\u52a8\u65f6\u51fa\u73b0\u9519\u8bef \u68c0\u67e5 @OnStart \u76f8\u5173\u4e8b\u4ef6\u7684\u95ee\u9898\uff0c\u6216\u6839\u636e\u62a5\u9519\u4fe1\u606f\u5b9a\u4f4d\u95ee\u9898\u6240\u5728\u3002\u6b64\u95ee\u9898\u53ef\u80fd\u8f83\u5e38\u89c1\uff0c\u4e00\u822c\u5728\u542f\u52a8\u65f6\u5bfc\u81f4\u7684\u3002 E00031 \u6846\u67b6\u5728\u542f\u52a8\u524d\u89e3\u6790\u4ee3\u7801\u51fa\u73b0\u9519\u8bef \u68c0\u67e5\u6a21\u5757\u4ee3\u7801\u4e2d\u662f\u5426\u6709 PHP \u8bed\u6cd5\u9519\u8bef\u3002 E00032 \u4e0a\u4e0b\u6587\u7684 class \u6ca1\u6709 implements ContextInterface \u63a5\u53e3 \u5982\u679c\u4ece global.php \u8bbe\u7f6e\u4e86\u81ea\u5b9a\u4e49\u4e0a\u4e0b\u6587\u7c7b\uff0c\u90a3\u4e48\u8bf7\u68c0\u67e5\u4e0a\u4e0b\u6587\u7c7b\u6709\u6ca1\u6709\u6839\u636e\u6587\u6863\u6807\u51c6\u6765\u7f16\u5199\u63a5\u53e3\u3002 E00033 Worker \u8fdb\u7a0b\u8fd0\u884c\u8fc7\u7a0b\u4f7f\u7528 zm_* \u65b9\u6cd5\u8fc7\u7a0b\u4e2d\u629b\u51fa\u4e86\u672a\u88ab\u6355\u83b7\u7684\u5f02\u5e38 \u4e00\u822c\u662f\u7531 zm_go() \u6216 zm_timer_tik() \u9020\u6210\u7684\uff0c\u534f\u7a0b\u6216\u8ba1\u65f6\u5668\u5185\u629b\u51fa\u4e86\u5f02\u5e38\u672a\u88ab\u6355\u83b7\u3002\u5efa\u8bae\u6839\u636e trace \u68c0\u67e5\u662f\u4ec0\u4e48\u5730\u65b9\u629b\u51fa\u7684\u5f02\u5e38\u3002 E00034 \u7531\u5e26\u4e2d\u95f4\u4ef6\u7684 @OnTick \u8ba1\u65f6\u5668\u4ea7\u751f\u4e86\u672a\u88ab\u6355\u83b7\u7684\u5f02\u5e38 \u5efa\u8bae\u68c0\u67e5\u8ba1\u65f6\u5668\u5185\u7684\u4ee3\u7801\u629b\u51fa\u5f02\u5e38\u4f4d\u7f6e\uff0c\u5982\u679c\u9519\u8bef\u5904\u7406\u4e5f\u662f\u4e00\u90e8\u5206\u529f\u80fd\uff0c\u5efa\u8bae\u4f7f\u7528 try catch \u81ea\u884c\u6355\u83b7\u3002 E00035 CQ \u7801\u76f8\u5173\u9519\u8bef \u6839\u636e\u63d0\u793a\u68c0\u67e5\u8c03\u7528 CQ \u7801\u7684\u4ee3\u7801\u5373\u53ef\u3002 E00036 OneBot WebSocket API \u63a8\u9001\u5931\u8d25\uff0c\u53ef\u80fd\u662f WebSocket \u5ba2\u6237\u7aef\u51fa\u73b0\u4e86\u95ee\u9898 \u5efa\u8bae\u68c0\u67e5 OneBot \u5ba2\u6237\u7aef\u548c\u6846\u67b6\u7684\u8fde\u63a5\u662f\u5426\u6b63\u5e38\u3002 E00037 OneBot \u673a\u5668\u4eba\u7aef\u8fde\u63a5\u672a\u627e\u5230\uff0c\u6216\u5355\u4f8b\u6a21\u5f0f\u8fde\u63a5\u4e86\u591a\u4e2a\u673a\u5668\u4eba \u6839\u636e\u63d0\u793a\u4fe1\u606f\u8fdb\u884c\u4fee\u590d\uff0c\u6bd4\u5982\u673a\u5668\u4eba xxx \u672a\u8fde\u63a5\u5230\u6846\u67b6\uff0c\u5c31\u770b\u4e00\u4e0b OneBot \u5ba2\u6237\u7aef\u662f\u5426\u542f\u7528\u548c\u914d\u7f6e\u6b63\u5e38\u3002 E00038 \u56fe\u7075\u673a\u5668\u4eba API \u8c03\u7528\u51fa\u9519 \u6839\u636e\u63d0\u793a\u548c\u56fe\u7075\u9519\u8bef\u7801\u8fdb\u884c\u68c0\u67e5\u3002 E00039 \u4f7f\u7528 build \u547d\u4ee4\u65f6\u68c0\u6d4b\u5230\u76ee\u6807\u76ee\u5f55\u4e0d\u5b58\u5728 \u91cd\u65b0\u6307\u5b9a\u4e00\u4e2a\u5b58\u5728\u7684\u76ee\u5f55\u5373\u53ef\u3002 E00040 \u4f7f\u7528 build \u547d\u4ee4\u65f6\u68c0\u6d4b\u5230 PHP \u672a\u8bbe\u7f6e phar.readonly=Off \u4fee\u6539 php.ini \u5c06\u6b64\u9879\u8bbe\u7f6e\u4e3a Off\u3002 E00041 \u4f7f\u7528 init \u547d\u4ee4\u65f6\u672a\u68c0\u6d4b\u5230 composer.json \u6587\u4ef6 \u68c0\u67e5\u5f15\u7528\u6846\u67b6\u7684 composer.json \u6587\u4ef6\u4f4d\u7f6e\u3002 E00042 \u6846\u67b6\u4f7f\u7528 init \u547d\u4ee4\u65f6\u542f\u52a8\u6a21\u5f0f\u4e0d\u662f Composer \u6a21\u5f0f \u5982\u679c\u4f60\u662f\u4f7f\u7528 git \u4e14\u4e0b\u8f7d\u7684\u4ed3\u5e93\u662f zhamao-robot/zhamao-framework.git \uff0c\u90a3\u4e48\u4ee3\u8868\u5176\u4ee5\u6e90\u7801\u6a21\u5f0f\u542f\u52a8\uff0c\u8be6\u89c1 \u6846\u67b6\u542f\u52a8\u6a21\u5f0f - \u70b8\u6bdb\u6846\u67b6 v2 (zhamao.xin) \u3002 E00043 MySQL \u6570\u636e\u5e93\u51fa\u9519\uff0c\u629b\u51fa\u5f02\u5e38 \u6839\u636e\u63d0\u793a\u4fe1\u606f\u68c0\u67e5 MySQL \u8bed\u53e5\u662f\u5426\u6b63\u786e\uff0c\u6570\u636e\u5e93\u662f\u5426\u8fde\u63a5\u6b63\u5e38\u7b49\uff0c\u5176\u4ed6\u4e0d\u80fd\u89e3\u51b3\u7684\u95ee\u9898\u5efa\u8bae\u53cd\u9988\u5f00\u53d1\u8005\u3002 E00044 \u6253\u5305\u6a21\u5757\u8fc7\u7a0b\u4e2d\u629b\u51fa\u4e86\u5f02\u5e38 \u6839\u636e\u63d0\u793a\u6587\u672c\u8fdb\u884c\u4fee\u590d\u9519\u8bef\u7684\u6307\u4ee4\u548c\u4ee3\u7801\u5373\u53ef\u3002 E00045 \u6253\u5305\u6a21\u5757\u8fc7\u7a0b\u4e2d\u65e0\u6cd5\u50a8\u5b58 light-cache-store \u9879\u6307\u5b9a\u7684\u7f13\u5b58\u6570\u636e \u6839\u636e\u63d0\u793a\u8fdb\u884c\u4fee\u590d\u5373\u53ef\u3002 E00046 Redis \u8fde\u63a5\u6c60\u5728\u4f7f\u7528\u8fc7\u7a0b\u4e2d\u672a\u63d0\u524d\u521d\u59cb\u5316\uff0c\u53ef\u80fd\u662f\u672a\u8bbe\u7f6e\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u542f\u7528 Redis \u8fde\u63a5\u6c60 \u68c0\u67e5 global.php \u662f\u5426\u8bbe\u7f6e Redis \u670d\u52a1\u5668\u3002 E00047 Redis \u8fde\u63a5\u6c60\u521d\u59cb\u5316\u5931\u8d25 \u6839\u636e\u63d0\u793a\u62a5\u9519\u4fe1\u606f\u8fdb\u884c\u4fee\u590d\uff0c\u5148\u68c0\u67e5 global.php \u662f\u5426\u8bbe\u7f6e Redis \u670d\u52a1\u5668\u3002 E00048 LightCache \u672a\u521d\u59cb\u5316 LightCache \u4f1a\u6839\u636e global.php \u521d\u59cb\u5316\u7533\u8bf7\u5185\u5b58\uff0c\u5982\u679c\u7533\u8bf7\u51fa\u9519\u8bf7\u6839\u636e\u542f\u52a8\u65f6\u7684\u62a5\u9519\u4fe1\u606f\u8c03\u6574\u914d\u7f6e\u3002 E00049 LightCache \u4e0d\u80fd\u63a5\u6536\u5b57\u7b26\u4e32\u3001\u6570\u7ec4\u3001int \u4e4b\u5916\u7684\u53d8\u91cf\u6570\u636e \u68c0\u67e5\u4f20\u5165\u7684\u6570\u636e\u7c7b\u578b\u3002 E00050 \u7cfb\u7edf\u5185\u5b58\u4e0d\u8db3\uff0cLightCache \u7533\u8bf7\u5185\u5b58\u5931\u8d25 \u8ba9 PHP \u53ef\u4f7f\u7528\u7684\u5185\u5b58\u6216\u7cfb\u7edf\u5185\u5b58\u53d8\u5927\uff0c\u4e5f\u53ef\u4ee5\u8c03\u5c0f\u5168\u5c40\u914d\u7f6e\u4e2d\u8bbe\u7f6e\u7684 LightCache \u914d\u7f6e\u9879\u3002 E00051 LightCache \u7684 Hash \u51b2\u7a81\u8fc7\u591a\uff0c\u5bfc\u81f4\u65e0\u6cd5\u52a8\u6001\u7a7a\u95f4\u5206\u914d\u5185\u5b58 \u8bbe\u7f6e hash_conflict_proportion \u5927\u4e00\u4e9b\uff08\u8303\u56f4 0-1\uff0c\u9ed8\u8ba4\u662f 0.6\uff09\u3002 E00052 \u5728 /src/ \u76ee\u5f55\u4e0b\u4e0d\u53ef\u4ee5\u76f4\u63a5\u6807\u8bb0\u4e3a\u6a21\u5757(zm.json)\uff0c\u56e0\u4e3a\u547d\u540d\u7a7a\u95f4\u4e0d\u80fd\u4e3a\u6839\u7a7a\u95f4 \u5c06\u6a21\u5757\u6807\u8bb0\u6587\u4ef6 zm.json \u653e\u5230\u5b50\u76ee\u5f55\u4e0b\uff0c\u4e0d\u80fd\u76f4\u63a5\u653e\u5728 src \u76ee\u5f55\u4e0b\u3002 E00053 \u6846\u67b6\u68c0\u6d4b\u5230\u4e86\u91cd\u540d\u6a21\u5757 \u66f4\u6539\u6a21\u5757\u540d\u79f0\u3002 E00054 \u6253\u5305\u597d\u7684\u6a21\u5757\u6587\u4ef6\uff08phar\uff09\u5185\u68c0\u6d4b\u4e0d\u5230 zm.json \u539f\u59cb\u6a21\u5757\u6807\u8bb0\u6587\u4ef6\u5b58\u5728 \u68c0\u67e5 phar \u6a21\u5757\u662f\u5426\u5b8c\u6574\u3002 E00055 \u6253\u5305\u597d\u7684\u6a21\u5757\u6587\u4ef6\uff08phar\uff09\u4e0d\u80fd\u6b63\u5e38\u8bfb\u53d6\u6a21\u5757\u6807\u8bb0\u6587\u4ef6\uff08zm.json\uff09 \u68c0\u67e5 phar \u6a21\u5757\u662f\u5426\u5b8c\u6574\u3002 E00056 \u672a\u5f00\u542f TaskWorker \u8fdb\u7a0b \u8bf7\u5148\u4fee\u6539 global \u914d\u7f6e\u6587\u4ef6\u542f\u7528\u3002 E00057 \u8c03\u7528 DataProvider::saveToJson() \u5931\u8d25\uff0c\u56e0\u4e3a\u4f20\u5165\u4e86\u591a\u7ea7\u76ee\u5f55 saveToJson() \u65b9\u6cd5\u7684 $filename \u53c2\u6570\u53ea\u80fd\u6700\u591a\u5230\u7b2c\u4e8c\u7ea7\u5b50\u76ee\u5f55\uff0c\u4e0d\u80fd\u6709\u4e09\u7ea7\uff0c\u4f8b\u5982 foo/bar \u3002 E00058 \u8c03\u7528 DataProvider::scanDirFiles() \u5931\u8d25\uff0c\u56e0\u4e3a\u4f20\u5165\u7684 $relative \u9519\u8bef $relative \u53c2\u6570\u53ea\u80fd\u4f20\u5165 string/false \u4e24\u79cd\u7c7b\u578b\u3002 E00059 \u4f7f\u7528 MessageUtil::downloadCQImage() \u5931\u8d25\uff0c\u56e0\u4e3a\u6307\u5b9a\u4e0b\u8f7d\u7684\u76ee\u5f55\u4e0d\u5b58\u5728 \u65b0\u5efa\u76ee\u5f55\uff0c\u68c0\u67e5\u76ee\u5f55\u5730\u5740\u662f\u5426\u662f\u7edd\u5bf9\u8def\u5f84\uff0c\u5982\u679c\u624b\u52a8\u6307\u5b9a\u4e86\u76ee\u5f55\uff0c\u6700\u597d\u4e3a\u7edd\u5bf9\u8def\u5f84\u3002 E00060 \u4f7f\u7528 MessageUtil::downloadCQImage() \u5931\u8d25\uff0c\u56e0\u4e3a\u56fe\u7247\u4e0b\u8f7d\u5931\u8d25 \u68c0\u67e5\u4e0b\u8f7d\u56fe\u7247\u7684\u94fe\u63a5\u5730\u5740\u662f\u5426\u80fd\u6b63\u5e38\u7684\u8bbf\u95ee\u3002 E00061 \u4f7f\u7528 set_coroutine_params() \u5931\u8d25\uff0c\u56e0\u4e3a\u4e0d\u80fd\u5728\u975e\u534f\u7a0b\u73af\u5883\u4f7f\u7528\u6b64\u51fd\u6570 \u68c0\u67e5\u8c03\u7528\u6b64\u51fd\u6570\u7684\u4f4d\u7f6e\uff0c\u6ce8\u610f\u4e0d\u80fd\u5728\u975e\u534f\u7a0b\u73af\u5883\uff08\u6bd4\u5982 Master \u8fdb\u7a0b\uff09\u4e0b\u8c03\u7528\u3002 E00062 \u6ce8\u89e3\u4e8b\u4ef6\u975e\u6cd5\u6216\u4e0d\u53ef\u56de\u6eaf \u4e0d\u80fd\u5728\u975e\u6ce8\u89e3\u8c03\u7528\u7684\u7c7b\u4e2d\u7684\u65b9\u6cd5\u8c03\u7528 EventTracer \u65b9\u6cd5\u3002 E00063 \u6a21\u5757\u68c0\u6d4b\u5230\u4f9d\u8d56\u7248\u672c\u95ee\u9898 \u68c0\u67e5\u662f\u5426\u90e8\u7f72\u6216\u6b63\u786e\u914d\u7f6e\u4f9d\u8d56\u7684\u6a21\u5757/\u63d2\u4ef6\u7248\u672c\u3002 E00064 \u6a21\u5757\u7cfb\u7edf\u68c0\u6d4b\u5230\u4f9d\u8d56\u7684\u6a21\u5757\u4e0d\u5b58\u5728\u6216\u672a\u5b89\u88c5\u90e8\u7f72 \u68c0\u67e5\u4f9d\u8d56\u7684\u6a21\u5757\u662f\u5426\u6b63\u786e\u5b58\u5728\u4e8e\u6e90\u7801\u76ee\u5f55\u3002 E00065 \u6a21\u5757\u7cfb\u7edf\u68c0\u6d4b\u5230\u6253\u5305\u7684\u6a21\u5757\u6587\u4ef6\u4e2d\u672a\u542b\u6709 light_cache_store.json \u6587\u4ef6 \u53ef\u80fd\u662f\u6253\u5305\u6b64\u6a21\u5757\u540e\u6253\u5305\u7684\u6587\u4ef6\u635f\u574f\uff0c\u8bf7\u8be2\u95ee\u539f\u5f00\u53d1\u8005\u6253\u5305\u4e00\u4e2a\u65b0\u7684\u6ca1\u6709\u635f\u574f\u7684 phar \u6587\u4ef6\u3002 E00066 \u6a21\u5757\u6253\u5305\u65f6 zmdata-store \u6307\u5b9a\u7684\u6587\u4ef6\u6216\u76ee\u5f55\u4e0d\u5b58\u5728 \u68c0\u67e5\u662f\u5426\u5b58\u5728\uff0c\u68c0\u67e5\u5199\u7684\u76f8\u5bf9\u8def\u5f84\u662f\u5426\u6709\u8bef\uff08\u76f8\u5bf9\u8def\u5f84\u7684\u521d\u59cb\u8def\u5f84\u4e3a\u6846\u67b6\u5f53\u524d\u7684 zm_data \u914d\u7f6e\u7684\u76ee\u5f55\u3002 E00067 \u6a21\u5757\u89e3\u5305\u5408\u5e76 composer.json \u65f6\u6ca1\u6709\u627e\u5230\u9879\u76ee\u539f\u6587\u4ef6 \u68c0\u67e5\u9879\u76ee\u7684\u5de5\u4f5c\u76ee\u5f55\u4e0b\u662f\u5426\u6709 composer.json \u6587\u4ef6\u5b58\u5728\u3002 E00068 \u6a21\u5757\u89e3\u5305\u65f6\u65e0\u6cd5\u6b63\u5e38\u62f7\u8d1d\u6587\u4ef6 \u68c0\u67e5\u6587\u4ef6\u5939\u662f\u5426\u6b63\u5e38\u53ef\u4ee5\u521b\u5efa\u548c\u5199\u5165\u3002 E00069 \u6846\u67b6\u4e0d\u80fd\u542f\u52a8\u4e24\u4e2a ConsoleApplication \u5b9e\u4f8b \u4e0d\u8981\u91cd\u590d\u4f7f\u7528 new ConsoleApplication() \u3002 E99999 \u672a\u77e5\u9519\u8bef","title":"\u9519\u8bef\u7801\u5bf9\u7167\u8868"},{"location":"guide/installation/","text":"\u5b89\u88c5 \u8fd9\u7bc7\u4e3a\u70b8\u6bdb\u6846\u67b6\u4ee5\u53ca\u73af\u5883\u7684\u90e8\u7f72\u6559\u7a0b\u3002 \u6846\u67b6\u90e8\u7f72\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u4e00\u90e8\u5206\u662f\u5b89\u88c5 PHP \u73af\u5883\uff0c\u53e6\u4e00\u90e8\u5206\u662f\u901a\u8fc7 Composer \u6216 GitHub \u62c9\u53d6\u6846\u67b6\u7684\u811a\u624b\u67b6\u3002 \u4e00\u952e\u4e0b\u8f7d\u9759\u6001 PHP \u73af\u5883\u548c\u6846\u67b6\u811a\u624b\u67b6 \u4ece 2.4.4 \u7248\u672c\u8d77\uff0c\u70b8\u6bdb\u6846\u67b6\u652f\u6301\u4e00\u952e\u62c9\u53d6\u4e00\u4e2a\u9759\u6001\u7684 PHP \u8fd0\u884c\u65f6\u548c\u811a\u624b\u67b6\uff0c\u53ea\u9700\u8fd0\u884c\u4e0b\u9762\u7684\u811a\u672c\u5373\u53ef\u3002\uff08\u5f00\u53d1\u73af\u5883\u63a8\u8350\u6b64\u65b9\u6cd5\uff09 1 2 3 4 5 6 7 8 9 10 11 12 # \u5c06\u4f1a\u628a PHP\u3001\u6846\u67b6\u90fd\u5b89\u88c5\u5728\u6b64\u76ee\u5f55\u4e0b mkdir zhamao-app/ # \u8fd9\u91cc\u53ef\u4ee5\u53d6\u81ea\u5df1\u7684\u9879\u76ee\u540d\u5b57 cd zhamao-app/ bash -c \" $( curl -fsSL https://api.zhamao.xin/go.sh ) \" # \u5b89\u88c5\u5b8c\u6210\u540e\u7684\u542f\u52a8\u6846\u67b6\u547d\u4ee4\uff082.5.0 \u7248\u672c\u540e\u53ef\u7701\u7565\u6389 runtime/php \u524d\u7f00\uff09 vendor/bin/start server # \u6269\u5c55\u7528\u6cd5\uff1a\u4f7f\u7528\u9759\u6001 PHP \u7248\u672c\u7684 Composer update runtime/composer update # \u6269\u5c55\u7528\u6cd5\uff1a\u4f7f\u7528\u9759\u6001 PHP \u8fd0\u884c\u522b\u7684 CLI \u811a\u672c runtime/php path/to/your/script.php \u6709\u5173\u9759\u6001 PHP \u7684\u591a\u79cd\u7528\u6cd5\uff08\u5982 Composer\uff09\uff0c\u89c1 \u8fdb\u9636 - PHP \u73af\u5883\u9ad8\u7ea7 \u4f7f\u7528 Docker \u90e8\u7f72 PHP \u548c\u6846\u67b6 \u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 Docker \u8fdb\u884c\u62c9\u53d6 PHP \u73af\u5883\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 # \u62c9\u53d6 Docker \u955c\u50cf docker pull zmbot/swoole # \u518d\u901a\u8fc7 GitHub \u6216\u5176\u4ed6\u65b9\u5f0f\u62c9\u53d6\u6846\u67b6\u811a\u624b\u67b6 git clone --depth = 1 https://github.com/zhamao-robot/zhamao-framework-starter.git cd zhamao-framework-starter/ # Docker \u5185\u4f7f\u7528 Composer \u66f4\u65b0\u4f9d\u8d56 docker run -it --rm -v $( pwd ) :/app/ -p 20001 :20001 zmbot/swoole composer update docker run -it --rm -v $( pwd ) :/app/ -p 20001 :20001 zmbot/swoole vendor/bin/start init # \u4f7f\u7528 Docker \u542f\u52a8\u6846\u67b6 docker run -it --rm -v $( pwd ) :/app/ -p 20001 :20001 zmbot/swoole vendor/bin/start server \u542f\u52a8\u540e\u4f60\u4f1a\u770b\u5230\u548c\u4e0b\u65b9\u7c7b\u4f3c\u7684\u521d\u59cb\u5316\u5185\u5bb9\uff0c\u8868\u660e\u542f\u52a8\u6210\u529f\u4e86 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ vendor / bin / start server host: 0.0.0.0 | port: 20001 log_level: 2 | version: 2.0.0 config: global . php | worker_num: 4 working_dir: / app / zhamao - framework ______ | __ / | __ __ _ _ __ ___ __ _ ___ / /| ' _ \\ / _ ` | ' _ ` _ \\ / _ ` |/ _ \\ / / _ | | | | ( _ | | | | | | | ( _ | | ( _ ) | / ____ | _ | | _ | \\__,_|_| | _ | | _ | \\__,_|\\___/ [ 14 : 27 : 31 ] [ S ] [# 3 ] Worker # 3 \u5df2\u542f\u52a8 [ 14 : 27 : 31 ] [ S ] [# 0 ] Worker # 0 \u5df2\u542f\u52a8 [ 14 : 27 : 31 ] [ S ] [# 2 ] Worker # 2 \u5df2\u542f\u52a8 [ 14 : 27 : 31 ] [ S ] [# 1 ] Worker # 1 \u5df2\u542f\u52a8 \u5355\u7eaf\u8fd0\u884c \u70b8\u6bdb\u6846\u67b6 \u540e\uff0c\u5982\u679c\u4e0d\u90e8\u7f72\u6216\u5b89\u88c5\u542f\u52a8\u4efb\u4f55\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u7684\u8bdd\uff0c\u4ec5\u4ec5\u76f8\u5f53\u4e8e\u542f\u52a8\u4e86\u4e00\u4e2a \u76d1\u542c 20001 \u7aef\u53e3\u7684WebSoket + HTTP \u670d\u52a1\u5668\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee\uff1ahttp://127.0.0.1:20001 \uff0c\u6216\u8005\u4f60\u90e8\u7f72\u5230\u4e86\u670d\u52a1\u5668\u540e\u9700\u8981\u8f93\u5165\u670d\u52a1\u5668\u5730\u5740\u3002 \u547d\u4ee4\u603b\u7ed3 \u5bf9\u4e8e\u6846\u67b6\u7684\u542f\u52a8\uff0c\u5fc5\u987b cd \u5230\u9879\u76ee\u7684\u8ddf\u76ee\u5f55\uff0c\u6bd4\u5982 cd zhamao-app/ \u8fdb\u5165\u5230\u9879\u76ee\u6839\u76ee\u5f55\u3002 \u65e0\u8bba\u4f55\u79cd\u65b9\u5f0f\u542f\u52a8\uff0c\u542f\u52a8\u6846\u67b6\u7684\u547d\u4ee4\u683c\u5f0f\u90fd\u4e3a\u8fd9\u4e2a\u683c\u5f0f\uff1a {php\u4e8c\u8fdb\u5236\u8def\u5f84} vendor/bin/start server {--\u5982\u679c\u9700\u8981\u53c2\u6570\u7684\u8bdd\u8fd9\u6837\u8ddf} \u7b2c\u4e8c\u6761\u7684 php \u4e8c\u8fdb\u5236\u8def\u5f84 \u6307\u7684\u662f\uff0c\u6bd4\u5982\u4f7f\u7528\u7b2c\u4e00\u79cd\u9759\u6001 PHP \u73af\u5883\uff0c\u8fd9\u91cc\u5199 runtime/php \u5c31\u597d\u4e86\uff0c\u5982\u679c\u662f\u5b89\u88c5\u5230\u7cfb\u7edf\u7684 PHP \u7684\u8bdd\uff0c\u8fd9\u91cc\u4e3a\u7a7a\uff0c\u5982\u679c\u662f Docker \u90e8\u7f72\u7684\u73af\u5883\uff0c\u5219\u8fd9\u91cc\u586b docker run -it --rm -v $(pwd):/app/ -p 20001:20001 zmbot/swoole \u4f7f\u7528 IDE \u7b49\u5de5\u5177\u5f00\u53d1\u4ee3\u7801 \u6211\u4eec\u4f7f\u7528\u6587\u672c\u7f16\u8f91\u5668\u8fdb\u884c\u70b8\u6bdb\u6846\u67b6\u5f00\u53d1\uff0c\u5728\u4f7f\u7528\u96c6\u6210\u5f00\u53d1\u73af\u5883 IDEA \u6216 PhpStorm \u65f6\uff0c\u63a8\u8350\u901a\u8fc7\u63d2\u4ef6\u5e02\u573a\u641c\u7d22\u5e76\u5b89\u88c5 PHP Annotations \u63d2\u4ef6\u4ee5\u63d0\u4f9b\u6ce8\u89e3\u547d\u540d\u7a7a\u95f4\u81ea\u52a8\u8865\u5168\u3001\u6ce8\u89e3\u5c5e\u6027\u4ee3\u7801\u63d0\u9192\u3001\u6ce8\u89e3\u7c7b\u8df3\u8f6c\u7b49\uff0c\u975e\u5e38\u6709\u52a9\u4e8e\u63d0\u5347\u5f00\u53d1\u6548\u7387\u7684\u529f\u80fd\u3002 \u8fdb\u9636\u73af\u5883\u90e8\u7f72\u548c\u5f00\u53d1 \u70b8\u6bdb\u6846\u67b6\u8fd8\u652f\u6301\u66f4\u591a\u79cd\u542f\u52a8\u65b9\u5f0f\uff0c\u5982\u6e90\u7801\u6a21\u5f0f\u3001\u5b88\u62a4\u8fdb\u7a0b\u6a21\u5f0f\uff0c\u5177\u4f53\u540e\u7eed\u6709\u5173\u73af\u5883\u548c\u90e8\u7f72\u7684\u8fdb\u9636\u6559\u7a0b\uff0c\u8bf7\u67e5\u770b \u8fdb\u9636\u5f00\u53d1 \u90e8\u5206\uff01","title":"\u5b89\u88c5\u6846\u67b6"},{"location":"guide/installation/#_1","text":"\u8fd9\u7bc7\u4e3a\u70b8\u6bdb\u6846\u67b6\u4ee5\u53ca\u73af\u5883\u7684\u90e8\u7f72\u6559\u7a0b\u3002 \u6846\u67b6\u90e8\u7f72\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u4e00\u90e8\u5206\u662f\u5b89\u88c5 PHP \u73af\u5883\uff0c\u53e6\u4e00\u90e8\u5206\u662f\u901a\u8fc7 Composer \u6216 GitHub \u62c9\u53d6\u6846\u67b6\u7684\u811a\u624b\u67b6\u3002","title":"\u5b89\u88c5"},{"location":"guide/installation/#php","text":"\u4ece 2.4.4 \u7248\u672c\u8d77\uff0c\u70b8\u6bdb\u6846\u67b6\u652f\u6301\u4e00\u952e\u62c9\u53d6\u4e00\u4e2a\u9759\u6001\u7684 PHP \u8fd0\u884c\u65f6\u548c\u811a\u624b\u67b6\uff0c\u53ea\u9700\u8fd0\u884c\u4e0b\u9762\u7684\u811a\u672c\u5373\u53ef\u3002\uff08\u5f00\u53d1\u73af\u5883\u63a8\u8350\u6b64\u65b9\u6cd5\uff09 1 2 3 4 5 6 7 8 9 10 11 12 # \u5c06\u4f1a\u628a PHP\u3001\u6846\u67b6\u90fd\u5b89\u88c5\u5728\u6b64\u76ee\u5f55\u4e0b mkdir zhamao-app/ # \u8fd9\u91cc\u53ef\u4ee5\u53d6\u81ea\u5df1\u7684\u9879\u76ee\u540d\u5b57 cd zhamao-app/ bash -c \" $( curl -fsSL https://api.zhamao.xin/go.sh ) \" # \u5b89\u88c5\u5b8c\u6210\u540e\u7684\u542f\u52a8\u6846\u67b6\u547d\u4ee4\uff082.5.0 \u7248\u672c\u540e\u53ef\u7701\u7565\u6389 runtime/php \u524d\u7f00\uff09 vendor/bin/start server # \u6269\u5c55\u7528\u6cd5\uff1a\u4f7f\u7528\u9759\u6001 PHP \u7248\u672c\u7684 Composer update runtime/composer update # \u6269\u5c55\u7528\u6cd5\uff1a\u4f7f\u7528\u9759\u6001 PHP \u8fd0\u884c\u522b\u7684 CLI \u811a\u672c runtime/php path/to/your/script.php \u6709\u5173\u9759\u6001 PHP \u7684\u591a\u79cd\u7528\u6cd5\uff08\u5982 Composer\uff09\uff0c\u89c1 \u8fdb\u9636 - PHP \u73af\u5883\u9ad8\u7ea7","title":"\u4e00\u952e\u4e0b\u8f7d\u9759\u6001 PHP \u73af\u5883\u548c\u6846\u67b6\u811a\u624b\u67b6"},{"location":"guide/installation/#docker-php","text":"\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 Docker \u8fdb\u884c\u62c9\u53d6 PHP \u73af\u5883\u3002 1 2 3 4 5 6 7 8 9 10 11 12 13 # \u62c9\u53d6 Docker \u955c\u50cf docker pull zmbot/swoole # \u518d\u901a\u8fc7 GitHub \u6216\u5176\u4ed6\u65b9\u5f0f\u62c9\u53d6\u6846\u67b6\u811a\u624b\u67b6 git clone --depth = 1 https://github.com/zhamao-robot/zhamao-framework-starter.git cd zhamao-framework-starter/ # Docker \u5185\u4f7f\u7528 Composer \u66f4\u65b0\u4f9d\u8d56 docker run -it --rm -v $( pwd ) :/app/ -p 20001 :20001 zmbot/swoole composer update docker run -it --rm -v $( pwd ) :/app/ -p 20001 :20001 zmbot/swoole vendor/bin/start init # \u4f7f\u7528 Docker \u542f\u52a8\u6846\u67b6 docker run -it --rm -v $( pwd ) :/app/ -p 20001 :20001 zmbot/swoole vendor/bin/start server \u542f\u52a8\u540e\u4f60\u4f1a\u770b\u5230\u548c\u4e0b\u65b9\u7c7b\u4f3c\u7684\u521d\u59cb\u5316\u5185\u5bb9\uff0c\u8868\u660e\u542f\u52a8\u6210\u529f\u4e86 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 $ vendor / bin / start server host: 0.0.0.0 | port: 20001 log_level: 2 | version: 2.0.0 config: global . php | worker_num: 4 working_dir: / app / zhamao - framework ______ | __ / | __ __ _ _ __ ___ __ _ ___ / /| ' _ \\ / _ ` | ' _ ` _ \\ / _ ` |/ _ \\ / / _ | | | | ( _ | | | | | | | ( _ | | ( _ ) | / ____ | _ | | _ | \\__,_|_| | _ | | _ | \\__,_|\\___/ [ 14 : 27 : 31 ] [ S ] [# 3 ] Worker # 3 \u5df2\u542f\u52a8 [ 14 : 27 : 31 ] [ S ] [# 0 ] Worker # 0 \u5df2\u542f\u52a8 [ 14 : 27 : 31 ] [ S ] [# 2 ] Worker # 2 \u5df2\u542f\u52a8 [ 14 : 27 : 31 ] [ S ] [# 1 ] Worker # 1 \u5df2\u542f\u52a8 \u5355\u7eaf\u8fd0\u884c \u70b8\u6bdb\u6846\u67b6 \u540e\uff0c\u5982\u679c\u4e0d\u90e8\u7f72\u6216\u5b89\u88c5\u542f\u52a8\u4efb\u4f55\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u7684\u8bdd\uff0c\u4ec5\u4ec5\u76f8\u5f53\u4e8e\u542f\u52a8\u4e86\u4e00\u4e2a \u76d1\u542c 20001 \u7aef\u53e3\u7684WebSoket + HTTP \u670d\u52a1\u5668\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee\uff1ahttp://127.0.0.1:20001 \uff0c\u6216\u8005\u4f60\u90e8\u7f72\u5230\u4e86\u670d\u52a1\u5668\u540e\u9700\u8981\u8f93\u5165\u670d\u52a1\u5668\u5730\u5740\u3002","title":"\u4f7f\u7528 Docker \u90e8\u7f72 PHP \u548c\u6846\u67b6"},{"location":"guide/installation/#_2","text":"\u5bf9\u4e8e\u6846\u67b6\u7684\u542f\u52a8\uff0c\u5fc5\u987b cd \u5230\u9879\u76ee\u7684\u8ddf\u76ee\u5f55\uff0c\u6bd4\u5982 cd zhamao-app/ \u8fdb\u5165\u5230\u9879\u76ee\u6839\u76ee\u5f55\u3002 \u65e0\u8bba\u4f55\u79cd\u65b9\u5f0f\u542f\u52a8\uff0c\u542f\u52a8\u6846\u67b6\u7684\u547d\u4ee4\u683c\u5f0f\u90fd\u4e3a\u8fd9\u4e2a\u683c\u5f0f\uff1a {php\u4e8c\u8fdb\u5236\u8def\u5f84} vendor/bin/start server {--\u5982\u679c\u9700\u8981\u53c2\u6570\u7684\u8bdd\u8fd9\u6837\u8ddf} \u7b2c\u4e8c\u6761\u7684 php \u4e8c\u8fdb\u5236\u8def\u5f84 \u6307\u7684\u662f\uff0c\u6bd4\u5982\u4f7f\u7528\u7b2c\u4e00\u79cd\u9759\u6001 PHP \u73af\u5883\uff0c\u8fd9\u91cc\u5199 runtime/php \u5c31\u597d\u4e86\uff0c\u5982\u679c\u662f\u5b89\u88c5\u5230\u7cfb\u7edf\u7684 PHP \u7684\u8bdd\uff0c\u8fd9\u91cc\u4e3a\u7a7a\uff0c\u5982\u679c\u662f Docker \u90e8\u7f72\u7684\u73af\u5883\uff0c\u5219\u8fd9\u91cc\u586b docker run -it --rm -v $(pwd):/app/ -p 20001:20001 zmbot/swoole","title":"\u547d\u4ee4\u603b\u7ed3"},{"location":"guide/installation/#ide","text":"\u6211\u4eec\u4f7f\u7528\u6587\u672c\u7f16\u8f91\u5668\u8fdb\u884c\u70b8\u6bdb\u6846\u67b6\u5f00\u53d1\uff0c\u5728\u4f7f\u7528\u96c6\u6210\u5f00\u53d1\u73af\u5883 IDEA \u6216 PhpStorm \u65f6\uff0c\u63a8\u8350\u901a\u8fc7\u63d2\u4ef6\u5e02\u573a\u641c\u7d22\u5e76\u5b89\u88c5 PHP Annotations \u63d2\u4ef6\u4ee5\u63d0\u4f9b\u6ce8\u89e3\u547d\u540d\u7a7a\u95f4\u81ea\u52a8\u8865\u5168\u3001\u6ce8\u89e3\u5c5e\u6027\u4ee3\u7801\u63d0\u9192\u3001\u6ce8\u89e3\u7c7b\u8df3\u8f6c\u7b49\uff0c\u975e\u5e38\u6709\u52a9\u4e8e\u63d0\u5347\u5f00\u53d1\u6548\u7387\u7684\u529f\u80fd\u3002","title":"\u4f7f\u7528 IDE \u7b49\u5de5\u5177\u5f00\u53d1\u4ee3\u7801"},{"location":"guide/installation/#_3","text":"\u70b8\u6bdb\u6846\u67b6\u8fd8\u652f\u6301\u66f4\u591a\u79cd\u542f\u52a8\u65b9\u5f0f\uff0c\u5982\u6e90\u7801\u6a21\u5f0f\u3001\u5b88\u62a4\u8fdb\u7a0b\u6a21\u5f0f\uff0c\u5177\u4f53\u540e\u7eed\u6709\u5173\u73af\u5883\u548c\u90e8\u7f72\u7684\u8fdb\u9636\u6559\u7a0b\uff0c\u8bf7\u67e5\u770b \u8fdb\u9636\u5f00\u53d1 \u90e8\u5206\uff01","title":"\u8fdb\u9636\u73af\u5883\u90e8\u7f72\u548c\u5f00\u53d1"},{"location":"guide/onebot-choose/","text":"OneBot \u5b9e\u4f8b \u4ec0\u4e48\u662f OneBot OneBot \u662f\u4e00\u4e2a\u804a\u5929\u673a\u5668\u4eba\u5e94\u7528\u63a5\u53e3\u6807\u51c6\uff0c\u8be6\u60c5\u6233 \u8fd9\u91cc \u3002 OneBot \u5b9e\u73b0\u9009\u62e9 \u5982\u679c\u4f60\u4f7f\u7528\u70b8\u6bdb\u6846\u67b6\u4f5c\u4e3a\u804a\u5929\u673a\u5668\u4eba\u7684\u5f00\u53d1\u6846\u67b6\uff0c\u8bf7\u5148\u9009\u62e9\u4e00\u79cd\u517c\u5bb9 OneBot \u6807\u51c6\u7684\u673a\u5668\u4eba\u63a5\u53e3\u3002\u7406\u8bba\u4e0a\uff0c\u57fa\u4e8e OneBot \u6807\u51c6\u5f00\u53d1\u7684 \u4efb\u4f55 SDK\u3001\u6846\u67b6\u548c\u673a\u5668\u4eba\u5e94\u7528\uff0c\u90fd\u53ef\u4ee5\u65e0\u7f1d\u5730\u5728\u4e0b\u9762\u7684\u4e0d\u540c\u5b9e\u73b0\u4e2d\u5207\u6362\u3002\u5f53\u7136\uff0c\u5728\u4e00\u5c0f\u90e8\u5206\u7ec6\u8282\u4e0a\u5404\u5b9e\u73b0\u53ef\u80fd\u6709\u4e00\u4e9b\u4e0d\u540c\u3002 \u9879\u76ee\u5730\u5740 \u5e73\u53f0 \u6838\u5fc3\u4f5c\u8005 \u5907\u6ce8 richardchien/coolq-http-api CKYU richardchien \u53ef\u5728 Mirai \u5e73\u53f0\u4f7f\u7528 mirai-native \u52a0\u8f7d Mrs4s/go-cqhttp MiraiGo Mrs4s \u70b8\u6bdb\u6846\u67b6\u63a8\u8350\u4f7f\u7528\u6b64\u9879\u76ee\u673a\u5668\u4eba\u5e94\u7528 yyuueexxiinngg/cqhttp-mirai Mirai yyuueexxiinngg takayama-lily/onebot OICQ takayama ProtobufBot Mirai lz1998 \u4e8b\u4ef6\u548c API \u6570\u636e\u5185\u5bb9\u548c OneBot \u4e00\u81f4\uff0c\u901a\u4fe1\u65b9\u5f0f\u4e0d\u517c\u5bb9 \u6ce8\u610f \u56e0\u4e3a\u76ee\u524d\u70b8\u6bdb\u6846\u67b6 2.0 \u53ea\u652f\u6301 WebSocket \u65b9\u5f0f\u7684 OneBot \u5b9e\u73b0\uff0c\u6240\u4ee5\u76ee\u524d\u4e0a\u8ff0\u9879\u76ee\u7684\u8fde\u63a5\u65b9\u5f0f\u5747\u53ea\u53ef\u9009\u652f\u6301\u53cd\u5411 WebSocket \u901a\u4fe1\u7684\u3002\u540e\u671f\u4f1a\u517c\u5bb9 HTTP \u548c\u6b63\u5411 WebSocket \u901a\u4fe1\u65b9\u5f0f\u3002 \u5982\u679c\u4f60\u8fd8\u6ca1\u6709\u81ea\u5df1\u7684 QQ\uff0c\u6216\u8005\u662f\u5176\u4ed6\u539f\u56e0\u5bfc\u81f4\u7684\u6682\u65f6\u65e0\u6cd5\u4f7f\u7528\u4e0a\u8ff0 OneBot \u5b9e\u4f8b\uff0c\u53ef\u4ee5\u4f7f\u7528\u70b8\u6bdb\u9879\u76ee\u4e2d\u7684 OneBot \u534f\u8bae\u804a\u5929\u6a21\u62df\u5668\u3002\u4f46\u76ee\u524d\u8fd8\u5904\u5728\u5f00\u53d1\u4e2d\uff0c\u6682\u4e0d\u53ef\u7528\u3002","title":"\u9009\u62e9\u804a\u5929\u673a\u5668\u4eba\u5b9e\u4f8b"},{"location":"guide/onebot-choose/#onebot","text":"","title":"OneBot \u5b9e\u4f8b"},{"location":"guide/onebot-choose/#onebot_1","text":"OneBot \u662f\u4e00\u4e2a\u804a\u5929\u673a\u5668\u4eba\u5e94\u7528\u63a5\u53e3\u6807\u51c6\uff0c\u8be6\u60c5\u6233 \u8fd9\u91cc \u3002","title":"\u4ec0\u4e48\u662f OneBot"},{"location":"guide/onebot-choose/#onebot_2","text":"\u5982\u679c\u4f60\u4f7f\u7528\u70b8\u6bdb\u6846\u67b6\u4f5c\u4e3a\u804a\u5929\u673a\u5668\u4eba\u7684\u5f00\u53d1\u6846\u67b6\uff0c\u8bf7\u5148\u9009\u62e9\u4e00\u79cd\u517c\u5bb9 OneBot \u6807\u51c6\u7684\u673a\u5668\u4eba\u63a5\u53e3\u3002\u7406\u8bba\u4e0a\uff0c\u57fa\u4e8e OneBot \u6807\u51c6\u5f00\u53d1\u7684 \u4efb\u4f55 SDK\u3001\u6846\u67b6\u548c\u673a\u5668\u4eba\u5e94\u7528\uff0c\u90fd\u53ef\u4ee5\u65e0\u7f1d\u5730\u5728\u4e0b\u9762\u7684\u4e0d\u540c\u5b9e\u73b0\u4e2d\u5207\u6362\u3002\u5f53\u7136\uff0c\u5728\u4e00\u5c0f\u90e8\u5206\u7ec6\u8282\u4e0a\u5404\u5b9e\u73b0\u53ef\u80fd\u6709\u4e00\u4e9b\u4e0d\u540c\u3002 \u9879\u76ee\u5730\u5740 \u5e73\u53f0 \u6838\u5fc3\u4f5c\u8005 \u5907\u6ce8 richardchien/coolq-http-api CKYU richardchien \u53ef\u5728 Mirai \u5e73\u53f0\u4f7f\u7528 mirai-native \u52a0\u8f7d Mrs4s/go-cqhttp MiraiGo Mrs4s \u70b8\u6bdb\u6846\u67b6\u63a8\u8350\u4f7f\u7528\u6b64\u9879\u76ee\u673a\u5668\u4eba\u5e94\u7528 yyuueexxiinngg/cqhttp-mirai Mirai yyuueexxiinngg takayama-lily/onebot OICQ takayama ProtobufBot Mirai lz1998 \u4e8b\u4ef6\u548c API \u6570\u636e\u5185\u5bb9\u548c OneBot \u4e00\u81f4\uff0c\u901a\u4fe1\u65b9\u5f0f\u4e0d\u517c\u5bb9 \u6ce8\u610f \u56e0\u4e3a\u76ee\u524d\u70b8\u6bdb\u6846\u67b6 2.0 \u53ea\u652f\u6301 WebSocket \u65b9\u5f0f\u7684 OneBot \u5b9e\u73b0\uff0c\u6240\u4ee5\u76ee\u524d\u4e0a\u8ff0\u9879\u76ee\u7684\u8fde\u63a5\u65b9\u5f0f\u5747\u53ea\u53ef\u9009\u652f\u6301\u53cd\u5411 WebSocket \u901a\u4fe1\u7684\u3002\u540e\u671f\u4f1a\u517c\u5bb9 HTTP \u548c\u6b63\u5411 WebSocket \u901a\u4fe1\u65b9\u5f0f\u3002 \u5982\u679c\u4f60\u8fd8\u6ca1\u6709\u81ea\u5df1\u7684 QQ\uff0c\u6216\u8005\u662f\u5176\u4ed6\u539f\u56e0\u5bfc\u81f4\u7684\u6682\u65f6\u65e0\u6cd5\u4f7f\u7528\u4e0a\u8ff0 OneBot \u5b9e\u4f8b\uff0c\u53ef\u4ee5\u4f7f\u7528\u70b8\u6bdb\u9879\u76ee\u4e2d\u7684 OneBot \u534f\u8bae\u804a\u5929\u6a21\u62df\u5668\u3002\u4f46\u76ee\u524d\u8fd8\u5904\u5728\u5f00\u53d1\u4e2d\uff0c\u6682\u4e0d\u53ef\u7528\u3002","title":"OneBot \u5b9e\u73b0\u9009\u62e9"},{"location":"guide/quickstart-http/","text":"\u5feb\u901f\u4e0a\u624b - HTTP \u670d\u52a1\u5668\u7bc7 HTTP \u670d\u52a1\u5668\u7bc7\u4e3b\u8981\u8bb2\u89e3\u5982\u4f55\u901a\u8fc7\u70b8\u6bdb\u6846\u67b6\u6765\u5b9e\u73b0\u5fae\u670d\u52a1\u3001API \u901a\u7528\u63a5\u53e3\u7b49\u7b49\u8fd9\u4e9b\u4e1c\u897f\u7684\u3002 HTTP \u670d\u52a1\u5668 - \u8def\u7531\u548c\u9759\u6001\u6587\u4ef6\u7bc7 HTTP \u670d\u52a1\u5668 - \u5b58\u50a8 - LightCache \u8f7b\u91cf\u7f13\u5b58 HTTP \u670d\u52a1\u5668 - \u5b58\u50a8 - Redis HTTP \u670d\u52a1\u5668 - \u5b58\u50a8 - MySQL HTTP \u5ba2\u6237\u7aef","title":"\u5feb\u901f\u4e0a\u624b\uff08HTTP\u7bc7\uff09"},{"location":"guide/quickstart-http/#-http","text":"HTTP \u670d\u52a1\u5668\u7bc7\u4e3b\u8981\u8bb2\u89e3\u5982\u4f55\u901a\u8fc7\u70b8\u6bdb\u6846\u67b6\u6765\u5b9e\u73b0\u5fae\u670d\u52a1\u3001API \u901a\u7528\u63a5\u53e3\u7b49\u7b49\u8fd9\u4e9b\u4e1c\u897f\u7684\u3002 HTTP \u670d\u52a1\u5668 - \u8def\u7531\u548c\u9759\u6001\u6587\u4ef6\u7bc7 HTTP \u670d\u52a1\u5668 - \u5b58\u50a8 - LightCache \u8f7b\u91cf\u7f13\u5b58 HTTP \u670d\u52a1\u5668 - \u5b58\u50a8 - Redis HTTP \u670d\u52a1\u5668 - \u5b58\u50a8 - MySQL HTTP \u5ba2\u6237\u7aef","title":"\u5feb\u901f\u4e0a\u624b - HTTP \u670d\u52a1\u5668\u7bc7"},{"location":"guide/quickstart-robot/","text":"\u5feb\u901f\u4e0a\u624b - \u673a\u5668\u4eba\u7bc7 \u7b80\u4ecb \u770b\u5230\u8fd9\u91cc\uff0c\u4f60\u5df2\u7ecf\u5b8c\u6210\u4e86\u524d\u9762\u7684\u73af\u5883\u90e8\u7f72\uff0c\u5230\u4e86\u6700\u5173\u952e\u7684\u7b2c\u4e00\u6b65\u4e86\uff01 \u4e00\u5207\u90fd\u5b89\u88c5\u6210\u529f\u540e\uff0c\u4f60\u5c31\u5df2\u7ecf\u505a\u597d\u4e86\u8fdb\u884c\u7b80\u5355\u914d\u7f6e\u4ee5\u8fd0\u884c\u4e00\u4e2a\u6700\u5c0f\u7684 \u673a\u5668\u4eba\u95ee\u7b54\u6a21\u5757 \u7684\u51c6\u5907\u3002 \u70b8\u6bdb\u6846\u67b6\u548c\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u662f\u4ec0\u4e48\u5173\u7cfb\u5462\uff1f\u70b8\u6bdb\u6846\u67b6\u5c31\u597d\u6bd4\u6211\u4eec\u4f20\u7edf\u7684\u4e00\u7cfb\u5217\u4f8b\u5982 Spring \u6846\u67b6\u3001ThinkPHP \u6846\u67b6\u7b49\uff0c\u662f\u670d\u52a1\u7aef\uff0c\u800c\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u662f\u4e00\u4e2a HTTP / WebSocket \u5ba2\u6237\u7aef\uff0c\u65f6\u523b\u51c6\u5907\u7740\u8fde\u63a5\u5230\u70b8\u6bdb\u6846\u67b6\u3002 \u673a\u5668\u4eba\u5ba2\u6237\u7aef \u5f00\u53d1\u4e4b\u524d\u8bf7\u6ce8\u610f\uff0c \u673a\u5668\u4eba\u5ba2\u6237\u7aef\u548c\u6846\u67b6\u76f8\u4e92\u72ec\u7acb\uff01 \u6545\u6709\u5173 \u673a\u5668\u4eba\u5ba2\u6237\u7aef \u51fa\u73b0\u7684\u95ee\u9898\u8bf7\u5230\u5bf9\u5e94\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u5f00\u53d1\u8005\u6216 GitHub \u9879\u76ee\u4e2d\u54a8\u8be2\u548c\u8ba8\u8bba\uff0c\u70b8\u6bdb\u6846\u67b6\u4e3a\u5bf9\u63a5\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u7684\u4e00\u4e2a\u5feb\u901f\u5f00\u53d1\u7684\u6846\u67b6\u3002 \u673a\u5668\u4eba\u5ba2\u6237\u7aef\u662f\u70b8\u6bdb\u6846\u67b6\u4ee5\u5916\u7684\u7a0b\u5e8f\u6216\u8f6f\u4ef6\uff0c\u76ee\u524d\u70b8\u6bdb\u6846\u67b6\u652f\u6301\u7684\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u901a\u4fe1\u6807\u51c6\u4e3a OneBot \u6807\u51c6\uff08\u539f CQHTTP\uff09\uff0c\u53ea\u8981\u4f60\u7684\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u662f OneBot \u6807\u51c6\u7684\uff0c\u5c31\u53ef\u4ee5\u548c\u70b8\u6bdb\u6846\u67b6\u8fdb\u884c\u65e0\u7f1d\u5bf9\u63a5\u3002 OneBot \u673a\u5668\u4eba\u90e8\u5206\u7684\u9009\u62e9\u8be6\u60c5\u89c1 OneBot \u5b9e\u4f8b \u3002 \u8fd9\u91cc\u4ee5\u70b8\u6bdb\u6846\u67b6\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u7684 go-cqhttp \u6765\u4e3e\u4f8b\u8fdb\u884c\u7b2c\u4e00\u4e2a\u673a\u5668\u4eba\u7684\u914d\u7f6e\u5de5\u4f5c\u3002 \u7b80\u8981\u6b65\u9aa4\u63cf\u8ff0\u4e3a\uff1a \u4e0b\u8f7d go-cqhttp \u5bf9\u5e94\u5e73\u53f0\u7684 release \u6587\u4ef6 \u53cc\u51fb exe \u6587\u4ef6\u6216\u8005\u4f7f\u7528 ./go-cqhttp \u542f\u52a8 \u751f\u6210\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u5e76\u4fee\u6539\u9ed8\u8ba4\u914d\u7f6e \u6ce8\u610f \u7531\u4e8e go-cqhttp \u9879\u76ee\u8fd8\u5904\u4e8e\u5f00\u53d1\u671f\uff0c\u800c\u4e14\u914d\u7f6e\u6587\u4ef6\u683c\u5f0f\u4e5f\u53d1\u751f\u4e86\u591a\u6b21\u53d8\u5316\uff0c\u4f46\u5927\u4f53\u5185\u5bb9\u6ca1\u6709\u53d8\uff08\u6bd4\u5982\u7f16\u5199\u6b64\u6587\u6863\u65f6\u53d1\u5e03\u7684\u7248\u672c\u4e2d\u914d\u7f6e\u6587\u4ef6\u683c\u5f0f\u53d8\u6210\u4e86 hjson \u53d6\u4ee3\u4e86\u539f\u6765\u7684 json \u3002 config.yml\uff08\u6700\u65b0\u683c\u5f0f\uff09 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 account : # \u8d26\u53f7\u76f8\u5173 uin : 1233456 # QQ\u8d26\u53f7 password : '' # \u5bc6\u7801\u4e3a\u7a7a\u65f6\u4f7f\u7528\u626b\u7801\u767b\u5f55 encrypt : false # \u662f\u5426\u5f00\u542f\u5bc6\u7801\u52a0\u5bc6 status : 0 # \u5728\u7ebf\u72b6\u6001 \u8bf7\u53c2\u8003 https://github.com/Mrs4s/go-cqhttp/blob/dev/docs/config.md#\u5728\u7ebf\u72b6\u6001 relogin : # \u91cd\u8fde\u8bbe\u7f6e delay : 3 # \u9996\u6b21\u91cd\u8fde\u5ef6\u8fdf, \u5355\u4f4d\u79d2 interval : 3 # \u91cd\u8fde\u95f4\u9694 max-times : 0 # \u6700\u5927\u91cd\u8fde\u6b21\u6570, 0\u4e3a\u65e0\u9650\u5236 # \u662f\u5426\u4f7f\u7528\u670d\u52a1\u5668\u4e0b\u53d1\u7684\u65b0\u5730\u5740\u8fdb\u884c\u91cd\u8fde # \u6ce8\u610f, \u6b64\u8bbe\u7f6e\u53ef\u80fd\u5bfc\u81f4\u5728\u6d77\u5916\u670d\u52a1\u5668\u4e0a\u8fde\u63a5\u60c5\u51b5\u66f4\u5dee use-sso-address : true heartbeat : # \u5fc3\u8df3\u9891\u7387, \u5355\u4f4d\u79d2 # -1 \u4e3a\u5173\u95ed\u5fc3\u8df3 interval : 5 message : # \u4e0a\u62a5\u6570\u636e\u7c7b\u578b # \u53ef\u9009: string,array post-format : string # \u662f\u5426\u5ffd\u7565\u65e0\u6548\u7684CQ\u7801, \u5982\u679c\u4e3a\u5047\u5c06\u539f\u6837\u53d1\u9001 ignore-invalid-cqcode : false # \u662f\u5426\u5f3a\u5236\u5206\u7247\u53d1\u9001\u6d88\u606f # \u5206\u7247\u53d1\u9001\u5c06\u4f1a\u5e26\u6765\u66f4\u5feb\u7684\u901f\u5ea6 # \u4f46\u662f\u517c\u5bb9\u6027\u4f1a\u6709\u4e9b\u95ee\u9898 force-fragment : false # \u662f\u5426\u5c06url\u5206\u7247\u53d1\u9001 fix-url : false # \u4e0b\u8f7d\u56fe\u7247\u7b49\u8bf7\u6c42\u7f51\u7edc\u4ee3\u7406 proxy-rewrite : '' # \u662f\u5426\u4e0a\u62a5\u81ea\u8eab\u6d88\u606f report-self-message : false # \u79fb\u9664\u670d\u52a1\u7aef\u7684Reply\u9644\u5e26\u7684At remove-reply-at : false # \u4e3aReply\u9644\u52a0\u66f4\u591a\u4fe1\u606f extra-reply-data : false output : # \u65e5\u5fd7\u7b49\u7ea7 trace,debug,info,warn,error log-level : warn # \u662f\u5426\u542f\u7528 DEBUG debug : false # \u5f00\u542f\u8c03\u8bd5\u6a21\u5f0f # \u9ed8\u8ba4\u4e2d\u95f4\u4ef6\u951a\u70b9 default-middlewares : &default # \u8bbf\u95ee\u5bc6\u94a5, \u5f3a\u70c8\u63a8\u8350\u5728\u516c\u7f51\u7684\u670d\u52a1\u5668\u8bbe\u7f6e access-token : '' # \u4e8b\u4ef6\u8fc7\u6ee4\u5668\u6587\u4ef6\u76ee\u5f55 filter : '' # API\u9650\u901f\u8bbe\u7f6e # \u8be5\u8bbe\u7f6e\u4e3a\u5168\u5c40\u751f\u6548 # \u539f cqhttp \u867d\u7136\u542f\u7528\u4e86 rate_limit \u540e\u7f00, \u4f46\u662f\u57fa\u672c\u6ca1\u63d2\u4ef6\u9002\u914d # \u76ee\u524d\u8be5\u9650\u901f\u8bbe\u7f6e\u4e3a\u4ee4\u724c\u6876\u7b97\u6cd5, \u8bf7\u53c2\u8003: # https://baike.baidu.com/item/%E4%BB%A4%E7%89%8C%E6%A1%B6%E7%AE%97%E6%B3%95/6597000?fr=aladdin rate-limit : enabled : false # \u662f\u5426\u542f\u7528\u9650\u901f frequency : 1 # \u4ee4\u724c\u56de\u590d\u9891\u7387, \u5355\u4f4d\u79d2 bucket : 1 # \u4ee4\u724c\u6876\u5927\u5c0f database : # \u6570\u636e\u5e93\u76f8\u5173\u8bbe\u7f6e leveldb : # \u662f\u5426\u542f\u7528\u5185\u7f6eleveldb\u6570\u636e\u5e93 # \u542f\u7528\u5c06\u4f1a\u589e\u52a010-20MB\u7684\u5185\u5b58\u5360\u7528\u548c\u4e00\u5b9a\u7684\u78c1\u76d8\u7a7a\u95f4 # \u5173\u95ed\u5c06\u65e0\u6cd5\u4f7f\u7528 \u64a4\u56de \u56de\u590d get_msg \u7b49\u4e0a\u4e0b\u6587\u76f8\u5173\u529f\u80fd enable : true # \u8fde\u63a5\u670d\u52a1\u5217\u8868 servers : # \u6dfb\u52a0\u65b9\u5f0f\uff0c\u540c\u4e00\u8fde\u63a5\u65b9\u5f0f\u53ef\u6dfb\u52a0\u591a\u4e2a\uff0c\u5177\u4f53\u914d\u7f6e\u8bf4\u660e\u8bf7\u67e5\u770b\u6587\u6863 #- http: # http \u901a\u4fe1 #- ws: # \u6b63\u5411 Websocket #- ws-reverse: # \u53cd\u5411 Websocket #- pprof: #\u6027\u80fd\u5206\u6790\u670d\u52a1\u5668 # Zhamao Framework \u6240\u9700\u8981\u7684\u670d\u52a1\u5668\u914d\u7f6e - ws-reverse : # \u662f\u5426\u7981\u7528\u5f53\u524d\u53cd\u5411WS\u670d\u52a1 disabled : false # \u53cd\u5411WS Universal \u5730\u5740 # \u6ce8\u610f \u8bbe\u7f6e\u4e86\u6b64\u9879\u5730\u5740\u540e\u4e0b\u9762\u4e24\u9879\u5c06\u4f1a\u88ab\u5ffd\u7565 universal : ws://127.0.0.1:20001/ # \u53cd\u5411WS API \u5730\u5740 api : ws://your_websocket_api.server # \u53cd\u5411WS Event \u5730\u5740 event : ws://your_websocket_event.server # \u91cd\u8fde\u95f4\u9694 \u5355\u4f4d\u6beb\u79d2 reconnect-interval : 3000 middlewares : << : *default # \u5f15\u7528\u9ed8\u8ba4\u4e2d\u95f4\u4ef6 config.hjson\uff08v1.0.0-beta2\u6216\u66f4\u65e9\u7248\u672c\u6240\u7528\u683c\u5f0f\uff09 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 { // QQ\u53f7 ui n : \u4f60\u7684\u673a\u5668\u4ebaQQ // QQ\u5bc6\u7801 password : \"\u4f60\u7684QQ\u5bc6\u7801\" // \u662f\u5426\u542f\u7528\u5bc6\u7801\u52a0\u5bc6 e n cryp t _password : false // \u52a0\u5bc6\u540e\u7684\u5bc6\u7801 , \u5982\u672a\u542f\u7528\u5bc6\u7801\u52a0\u5bc6\u5c06\u4e3a\u7a7a , \u8bf7\u52ff\u968f\u610f\u4fee\u6539. password_e n cryp te d : \"\" // \u662f\u5426\u542f\u7528\u5185\u7f6e\u6570\u636e\u5e93 // \u542f\u7528\u5c06\u4f1a\u589e\u52a0 10-20 MB\u7684\u5185\u5b58\u5360\u7528\u548c\u4e00\u5b9a\u7684\u78c1\u76d8\u7a7a\u95f4 // \u5173\u95ed\u5c06\u65e0\u6cd5\u4f7f\u7528 \u64a4\u56de \u56de\u590d ge t _msg \u7b49\u4e0a\u4e0b\u6587\u76f8\u5173\u529f\u80fd e na ble_db : true // \u8bbf\u95ee\u5bc6\u94a5 , \u5f3a\u70c8\u63a8\u8350\u5728\u516c\u7f51\u7684\u670d\u52a1\u5668\u8bbe\u7f6e access_ t oke n : \"\" // \u91cd\u8fde\u8bbe\u7f6e relogi n : { // \u662f\u5426\u542f\u7528\u81ea\u52a8\u91cd\u8fde // \u5982\u4e0d\u542f\u7528\u6389\u7ebf\u540e\u5c06\u4e0d\u4f1a\u81ea\u52a8\u91cd\u8fde e na bled : true // \u91cd\u8fde\u5ef6\u8fdf , \u5355\u4f4d\u79d2 relogi n _delay : 3 // \u6700\u5927\u91cd\u8fde\u6b21\u6570 , 0 \u4e3a\u65e0\u9650\u5236 max_relogi n _ t imes : 0 } // API\u9650\u901f\u8bbe\u7f6e // \u8be5\u8bbe\u7f6e\u4e3a\u5168\u5c40\u751f\u6548 // \u539f cqh tt p \u867d\u7136\u542f\u7528\u4e86 ra te _limi t \u540e\u7f00 , \u4f46\u662f\u57fa\u672c\u6ca1\u63d2\u4ef6\u9002\u914d // \u76ee\u524d\u8be5\u9650\u901f\u8bbe\u7f6e\u4e3a\u4ee4\u724c\u6876\u7b97\u6cd5 , \u8bf7\u53c2\u8003 : //h tt ps : //baike.baidu.com/i te m/%E 4 %BB%A 4 %E 7 % 89 % 8 C%E 6 %A 1 %B 6 %E 7 %AE% 97 %E 6 %B 3 % 95 / 6597000 ? fr =aladdi n _ra te _limi t : { // \u662f\u5426\u542f\u7528\u9650\u901f e na bled : false // \u4ee4\u724c\u56de\u590d\u9891\u7387 , \u5355\u4f4d\u79d2 fre que n cy : 1 // \u4ee4\u724c\u6876\u5927\u5c0f bucke t _size : 1 } // \u662f\u5426\u5ffd\u7565\u65e0\u6548\u7684CQ\u7801 // \u5982\u679c\u4e3a\u5047\u5c06\u539f\u6837\u53d1\u9001 ig n ore_i n valid_cqcode : false // \u662f\u5426\u5f3a\u5236\u5206\u7247\u53d1\u9001\u6d88\u606f // \u5206\u7247\u53d1\u9001\u5c06\u4f1a\u5e26\u6765\u66f4\u5feb\u7684\u901f\u5ea6 // \u4f46\u662f\u517c\u5bb9\u6027\u4f1a\u6709\u4e9b\u95ee\u9898 f orce_ fra gme nte d : false // \u5fc3\u8df3\u9891\u7387 , \u5355\u4f4d\u79d2 // -1 \u4e3a\u5173\u95ed\u5fc3\u8df3 hear t bea t _i nter val : 0 // HTTP\u8bbe\u7f6e h tt p_co nf ig : { // \u662f\u5426\u542f\u7528\u6b63\u5411HTTP\u670d\u52a1\u5668 e na bled : true // \u670d\u52a1\u7aef\u76d1\u542c\u5730\u5740 hos t : 0.0.0.0 // \u670d\u52a1\u7aef\u76d1\u542c\u7aef\u53e3 por t : 5700 // \u53cd\u5411HTTP\u8d85\u65f6\u65f6\u95f4 , \u5355\u4f4d\u79d2 // \u6700\u5c0f\u503c\u4e3a 5 \uff0c\u5c0f\u4e8e 5 \u5c06\u4f1a\u5ffd\u7565\u672c\u9879\u8bbe\u7f6e t imeou t : 0 // \u53cd\u5411HTTP POST\u5730\u5740\u5217\u8868 // \u683c\u5f0f : // { // \u5730\u5740 : secre t // } pos t _urls : {} } // \u6b63\u5411WS\u8bbe\u7f6e ws_co nf ig : { // \u662f\u5426\u542f\u7528\u6b63\u5411WS\u670d\u52a1\u5668 e na bled : true // \u6b63\u5411WS\u670d\u52a1\u5668\u76d1\u542c\u5730\u5740 hos t : 0.0.0.0 // \u6b63\u5411WS\u670d\u52a1\u5668\u76d1\u542c\u7aef\u53e3 por t : 6700 } // \u53cd\u5411WS\u8bbe\u7f6e ws_reverse_servers : [ // \u53ef\u4ee5\u6dfb\u52a0\u591a\u4e2a\u53cd\u5411WS\u63a8\u9001 { // \u662f\u5426\u542f\u7528\u8be5\u63a8\u9001 e na bled : true // \u53cd\u5411WS U n iversal \u5730\u5740 // \u6ce8\u610f \u8bbe\u7f6e\u4e86\u6b64\u9879\u5730\u5740\u540e\u4e0b\u9762\u4e24\u9879\u5c06\u4f1a\u88ab\u5ffd\u7565 reverse_url : ws : // 127.0.0.1 : 20001 / // \u53cd\u5411WS API \u5730\u5740 reverse_api_url : \"\" // \u53cd\u5411WS Eve nt \u5730\u5740 reverse_eve nt _url : \"\" // \u91cd\u8fde\u95f4\u9694 \u5355\u4f4d\u6beb\u79d2 reverse_reco nne c t _i nter val : 3000 } ] // \u4e0a\u62a5\u6570\u636e\u7c7b\u578b // \u53ef\u9009 : s tr i n g array pos t _message_ f orma t : s tr i n g // \u662f\u5426\u4f7f\u7528\u670d\u52a1\u5668\u4e0b\u53d1\u7684\u65b0\u5730\u5740\u8fdb\u884c\u91cd\u8fde // \u6ce8\u610f , \u6b64\u8bbe\u7f6e\u53ef\u80fd\u5bfc\u81f4\u5728\u6d77\u5916\u670d\u52a1\u5668\u4e0a\u8fde\u63a5\u60c5\u51b5\u66f4\u5dee use_sso_address : false // \u662f\u5426\u542f\u7528 DEBUG debug : false // \u65e5\u5fd7\u7b49\u7ea7 // WebUi \u8bbe\u7f6e web_ui : { // \u662f\u5426\u542f\u7528 WebUi e na bled : true // \u76d1\u542c\u5730\u5740 hos t : 127.0.0.1 // \u76d1\u542c\u7aef\u53e3 web_ui_por t : 9999 // \u662f\u5426\u63a5\u6536\u6765\u81eaweb\u7684\u8f93\u5165 web_i n pu t : false } } config.json\uff08\u65e7\u683c\u5f0f\uff09 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 { \"uin\" : \u4f60\u7684QQ\u53f7 , \"password\" : \"\u4f60\u7684\u5bc6\u7801\" , \"encrypt_password\" : false , \"password_encrypted\" : \"\" , \"enable_db\" : true , \"access_token\" : \"\" , \"relogin\" : { \"enabled\" : true , \"relogin_delay\" : 3 , \"max_relogin_times\" : 0 }, \"ignore_invalid_cqcode\" : false , \"force_fragmented\" : true , \"heartbeat_interval\" : 0 , \"http_config\" : { \"enabled\" : false , \"host\" : \"0.0.0.0\" , \"port\" : 5700 , \"timeout\" : 0 , \"post_urls\" : {} }, \"ws_config\" : { \"enabled\" : false , \"host\" : \"0.0.0.0\" , \"port\" : 6700 }, \"ws_reverse_servers\" : [ { \"enabled\" : true , \"reverse_url\" : \"ws://127.0.0.1:20001/\" , \"reverse_api_url\" : \"\" , \"reverse_event_url\" : \"\" , \"reverse_reconnect_interval\" : 3000 } ], \"post_message_format\" : \"string\" , \"debug\" : false , \"log_level\" : \"\" } \u5176\u4e2d ws://127.0.0.1:20001/ \u4e2d\u7684 127.0.0.1 \u548c 20001 \u5e94\u5206\u522b\u5bf9\u5e94\u70b8\u6bdb\u6846\u67b6\u914d\u7f6e\u7684 HOST \u548c PORT \u7b2c\u4e00\u6b21\u5bf9\u8bdd \u4e00\u65e6\u65b0\u7684\u914d\u7f6e\u6587\u4ef6\u6b63\u786e\u751f\u6548\u4e4b\u540e\uff0c\u6240\u5728\u7684\u63a7\u5236\u53f0\uff08\u5982\u679c\u6b63\u5728\u8fd0\u884c\u7684\u8bdd\uff09\u5e94\u8be5\u4f1a\u8f93\u51fa\u7c7b\u4f3c\u4e0b\u9762\u7684\u5185\u5bb9\uff1a 1 [ 15 : 26 : 34 ] [ I ] [# 2 ] \u673a\u5668\u4eba \u4f60\u7684 QQ\u53f7 \u5df2\u8fde\u63a5\uff01 \u8868\u660e\u673a\u5668\u4eba\u5df2\u6210\u529f\u8fde\u63a5\u5230\u70b8\u6bdb\u6846\u67b6\u4e86\uff01 \u8fd9\u65f6\uff0c\u5982\u679c\u4f60\u662f\u6839\u636e\u5b89\u88c5\u6559\u7a0b\u8d70\u4e0b\u6765\u5e76\u4e14\u672a\u7f16\u5199\u4efb\u4f55\u6a21\u5757\uff0c\u70b8\u6bdb\u81ea\u5e26\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\uff0c\u91cc\u9762\u542b\u6709\u547d\u4ee4\uff1a \u4f60\u597d \uff0c \u968f\u673a\u6570 \u3002\u5982\u679c\u4f60\u5bf9\u673a\u5668\u4eba\u56de\u590d\uff1a \u4f60\u597d \uff0c\u5b83\u4f1a\u56de\u590d\u4f60 \u4f60\u597d\u554a\uff0c\u6211\u662f\u7531\u70b8\u6bdb\u6846\u67b6\u6784\u5efa\u7684\u673a\u5668\u4eba\uff01 \u3002\u8fd9\u4e00\u5386\u53f2\u6027\u7684\u5bf9\u8bdd\u6807\u5fd7\u7740\u4f60\u5df2\u7ecf\u6210\u529f\u5730\u8fd0\u884c\u4e86\u70b8\u6bdb\u6846\u67b6\uff0c\u5f00\u59cb\u4e86\u7f16\u5199\u66f4\u5f3a\u5927\u7684 QQ \u673a\u5668\u4eba\u7684\u521b\u610f\u4e4b\u65c5\uff01 \u7f16\u5199\u4e00\u4e2a\u547d\u4ee4 \u8ba9\u6211\u4eec\u8f6c\u5230\u6846\u67b6\u7684\u6a21\u5757\u6e90\u4ee3\u7801\u90e8\u5206\uff0c\u76ee\u5f55\u662f src/Module/Example \uff0c\u6587\u4ef6\u662f Hello.php \u3002\u6211\u4eec\u63d2\u5165\u4e00\u6bb5\u8fd9\u6837\u7684\u4ee3\u7801\uff1a 1 2 3 4 5 6 7 8 /** * @CQCommand(\"echo\") */ public function repeat() { $repeat = ctx()->getFullArg(\"\u8bf7\u8f93\u5165\u4f60\u8981\u56de\u590d\u7684\u5185\u5bb9\"); ctx()->reply($repeat); //return $repeat; // \u8fd9\u6837\u7684\u6548\u679c\u7b49\u540c\u4e8e ctx()->reply() } \u8fd9\u6837\uff0c\u4e00\u4e2a\u7b80\u6613\u7684\u590d\u8bfb\u673a\u5c31\u505a\u597d\u4e86\uff01\u56de\u5230 QQ \u673a\u5668\u4eba\u804a\u5929\uff0c\u5411\u673a\u5668\u4eba\u53d1\u9001 echo \u4f60\u597d\u554a \uff0c\u5b83\u4f1a\u56de\u590d\u4f60 \u4f60\u597d\u554a \u3002 ) echo \u4f60\u597d\u554a ( \u4f60\u597d\u554a ) echo ( \u8bf7\u8f93\u5165\u4f60\u8981\u56de\u590d\u7684\u5185\u5bb9 ) \u54e6\u8c41 ( \u54e6\u8c41 \u5982\u679c\u4f60\u53ea\u56de\u590d echo \u7684\u8bdd\uff0c\u5b83\u4f1a\u5148\u548c\u4f60\u8fdb\u5165\u4e00\u4e2a\u4f1a\u8bdd\u72b6\u6001\uff0c\u5e76\u95ee\u4f60 \u8bf7\u8f93\u5165\u4f60\u8981\u56de\u590d\u7684\u5185\u5bb9 \uff0c\u8fd9\u65f6\u4f60\u518d\u6b21\u8bf4\u4e00\u4e9b\u5185\u5bb9\u4f8b\u5982 \u54e6\u8c41 \uff0c\u4f1a\u56de\u590d\u4f60 \u54e6\u8c41 \u3002\u6548\u679c\u548c\u76f4\u63a5\u8f93\u5165 echo \u54e6\u8c41 \u662f\u4e00\u81f4\u7684\uff0c\u8fd9\u662f\u70b8\u6bdb\u6846\u67b6\u5185\u7684\u4e00\u4e2a\u5c01\u88c5\u597d\u7684\u547d\u4ee4\u53c2\u6570\u5bf9\u8bdd\u8be2\u95ee\u529f\u80fd\u3002\u6709\u5173\u53c2\u6570\u8be2\u95ee\u529f\u80fd\uff0c\u8bf7\u770b\u540e\u9762\u7684\u8fdb\u9636\u6a21\u5757\u3002 \u4f7f\u7528\u673a\u5668\u4eba API \u548c\u4e8b\u4ef6 \u5982\u679c\u4f60\u60f3\u4e0d\u53ea\u662f\u56de\u590d\u6d88\u606f\uff0c\u8fd8\u8981\u505a\u5176\u4ed6\u590d\u6742\u7684\u52a8\u4f5c\uff08Action\uff09\uff0c\u4f7f\u7528 OneBot Action\uff08\u53c8\u540d OneBot API\uff09\u8fdb\u884c\u53d1\u9001\u5373\u53ef\uff0c\u89c1 \u673a\u5668\u4eba API \u3002 \u5982\u679c\u60f3\u5904\u7406\u5176\u4ed6\u7c7b\u578b\u7684\u4e8b\u4ef6\uff0c\u6bd4\u5982 QQ \u7fa4\u901a\u77e5\u4e8b\u4ef6\u7b49\uff0c\u89c1 \u673a\u5668\u4eba\u6ce8\u89e3\u4e8b\u4ef6 \u3002","title":"\u5feb\u901f\u4e0a\u624b\uff08\u673a\u5668\u4eba\u7bc7\uff09"},{"location":"guide/quickstart-robot/#-","text":"","title":"\u5feb\u901f\u4e0a\u624b - \u673a\u5668\u4eba\u7bc7"},{"location":"guide/quickstart-robot/#_1","text":"\u770b\u5230\u8fd9\u91cc\uff0c\u4f60\u5df2\u7ecf\u5b8c\u6210\u4e86\u524d\u9762\u7684\u73af\u5883\u90e8\u7f72\uff0c\u5230\u4e86\u6700\u5173\u952e\u7684\u7b2c\u4e00\u6b65\u4e86\uff01 \u4e00\u5207\u90fd\u5b89\u88c5\u6210\u529f\u540e\uff0c\u4f60\u5c31\u5df2\u7ecf\u505a\u597d\u4e86\u8fdb\u884c\u7b80\u5355\u914d\u7f6e\u4ee5\u8fd0\u884c\u4e00\u4e2a\u6700\u5c0f\u7684 \u673a\u5668\u4eba\u95ee\u7b54\u6a21\u5757 \u7684\u51c6\u5907\u3002 \u70b8\u6bdb\u6846\u67b6\u548c\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u662f\u4ec0\u4e48\u5173\u7cfb\u5462\uff1f\u70b8\u6bdb\u6846\u67b6\u5c31\u597d\u6bd4\u6211\u4eec\u4f20\u7edf\u7684\u4e00\u7cfb\u5217\u4f8b\u5982 Spring \u6846\u67b6\u3001ThinkPHP \u6846\u67b6\u7b49\uff0c\u662f\u670d\u52a1\u7aef\uff0c\u800c\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u662f\u4e00\u4e2a HTTP / WebSocket \u5ba2\u6237\u7aef\uff0c\u65f6\u523b\u51c6\u5907\u7740\u8fde\u63a5\u5230\u70b8\u6bdb\u6846\u67b6\u3002","title":"\u7b80\u4ecb"},{"location":"guide/quickstart-robot/#_2","text":"\u5f00\u53d1\u4e4b\u524d\u8bf7\u6ce8\u610f\uff0c \u673a\u5668\u4eba\u5ba2\u6237\u7aef\u548c\u6846\u67b6\u76f8\u4e92\u72ec\u7acb\uff01 \u6545\u6709\u5173 \u673a\u5668\u4eba\u5ba2\u6237\u7aef \u51fa\u73b0\u7684\u95ee\u9898\u8bf7\u5230\u5bf9\u5e94\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u5f00\u53d1\u8005\u6216 GitHub \u9879\u76ee\u4e2d\u54a8\u8be2\u548c\u8ba8\u8bba\uff0c\u70b8\u6bdb\u6846\u67b6\u4e3a\u5bf9\u63a5\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u7684\u4e00\u4e2a\u5feb\u901f\u5f00\u53d1\u7684\u6846\u67b6\u3002 \u673a\u5668\u4eba\u5ba2\u6237\u7aef\u662f\u70b8\u6bdb\u6846\u67b6\u4ee5\u5916\u7684\u7a0b\u5e8f\u6216\u8f6f\u4ef6\uff0c\u76ee\u524d\u70b8\u6bdb\u6846\u67b6\u652f\u6301\u7684\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u901a\u4fe1\u6807\u51c6\u4e3a OneBot \u6807\u51c6\uff08\u539f CQHTTP\uff09\uff0c\u53ea\u8981\u4f60\u7684\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u662f OneBot \u6807\u51c6\u7684\uff0c\u5c31\u53ef\u4ee5\u548c\u70b8\u6bdb\u6846\u67b6\u8fdb\u884c\u65e0\u7f1d\u5bf9\u63a5\u3002 OneBot \u673a\u5668\u4eba\u90e8\u5206\u7684\u9009\u62e9\u8be6\u60c5\u89c1 OneBot \u5b9e\u4f8b \u3002 \u8fd9\u91cc\u4ee5\u70b8\u6bdb\u6846\u67b6\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u7684 go-cqhttp \u6765\u4e3e\u4f8b\u8fdb\u884c\u7b2c\u4e00\u4e2a\u673a\u5668\u4eba\u7684\u914d\u7f6e\u5de5\u4f5c\u3002 \u7b80\u8981\u6b65\u9aa4\u63cf\u8ff0\u4e3a\uff1a \u4e0b\u8f7d go-cqhttp \u5bf9\u5e94\u5e73\u53f0\u7684 release \u6587\u4ef6 \u53cc\u51fb exe \u6587\u4ef6\u6216\u8005\u4f7f\u7528 ./go-cqhttp \u542f\u52a8 \u751f\u6210\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u5e76\u4fee\u6539\u9ed8\u8ba4\u914d\u7f6e \u6ce8\u610f \u7531\u4e8e go-cqhttp \u9879\u76ee\u8fd8\u5904\u4e8e\u5f00\u53d1\u671f\uff0c\u800c\u4e14\u914d\u7f6e\u6587\u4ef6\u683c\u5f0f\u4e5f\u53d1\u751f\u4e86\u591a\u6b21\u53d8\u5316\uff0c\u4f46\u5927\u4f53\u5185\u5bb9\u6ca1\u6709\u53d8\uff08\u6bd4\u5982\u7f16\u5199\u6b64\u6587\u6863\u65f6\u53d1\u5e03\u7684\u7248\u672c\u4e2d\u914d\u7f6e\u6587\u4ef6\u683c\u5f0f\u53d8\u6210\u4e86 hjson \u53d6\u4ee3\u4e86\u539f\u6765\u7684 json \u3002 config.yml\uff08\u6700\u65b0\u683c\u5f0f\uff09 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 account : # \u8d26\u53f7\u76f8\u5173 uin : 1233456 # QQ\u8d26\u53f7 password : '' # \u5bc6\u7801\u4e3a\u7a7a\u65f6\u4f7f\u7528\u626b\u7801\u767b\u5f55 encrypt : false # \u662f\u5426\u5f00\u542f\u5bc6\u7801\u52a0\u5bc6 status : 0 # \u5728\u7ebf\u72b6\u6001 \u8bf7\u53c2\u8003 https://github.com/Mrs4s/go-cqhttp/blob/dev/docs/config.md#\u5728\u7ebf\u72b6\u6001 relogin : # \u91cd\u8fde\u8bbe\u7f6e delay : 3 # \u9996\u6b21\u91cd\u8fde\u5ef6\u8fdf, \u5355\u4f4d\u79d2 interval : 3 # \u91cd\u8fde\u95f4\u9694 max-times : 0 # \u6700\u5927\u91cd\u8fde\u6b21\u6570, 0\u4e3a\u65e0\u9650\u5236 # \u662f\u5426\u4f7f\u7528\u670d\u52a1\u5668\u4e0b\u53d1\u7684\u65b0\u5730\u5740\u8fdb\u884c\u91cd\u8fde # \u6ce8\u610f, \u6b64\u8bbe\u7f6e\u53ef\u80fd\u5bfc\u81f4\u5728\u6d77\u5916\u670d\u52a1\u5668\u4e0a\u8fde\u63a5\u60c5\u51b5\u66f4\u5dee use-sso-address : true heartbeat : # \u5fc3\u8df3\u9891\u7387, \u5355\u4f4d\u79d2 # -1 \u4e3a\u5173\u95ed\u5fc3\u8df3 interval : 5 message : # \u4e0a\u62a5\u6570\u636e\u7c7b\u578b # \u53ef\u9009: string,array post-format : string # \u662f\u5426\u5ffd\u7565\u65e0\u6548\u7684CQ\u7801, \u5982\u679c\u4e3a\u5047\u5c06\u539f\u6837\u53d1\u9001 ignore-invalid-cqcode : false # \u662f\u5426\u5f3a\u5236\u5206\u7247\u53d1\u9001\u6d88\u606f # \u5206\u7247\u53d1\u9001\u5c06\u4f1a\u5e26\u6765\u66f4\u5feb\u7684\u901f\u5ea6 # \u4f46\u662f\u517c\u5bb9\u6027\u4f1a\u6709\u4e9b\u95ee\u9898 force-fragment : false # \u662f\u5426\u5c06url\u5206\u7247\u53d1\u9001 fix-url : false # \u4e0b\u8f7d\u56fe\u7247\u7b49\u8bf7\u6c42\u7f51\u7edc\u4ee3\u7406 proxy-rewrite : '' # \u662f\u5426\u4e0a\u62a5\u81ea\u8eab\u6d88\u606f report-self-message : false # \u79fb\u9664\u670d\u52a1\u7aef\u7684Reply\u9644\u5e26\u7684At remove-reply-at : false # \u4e3aReply\u9644\u52a0\u66f4\u591a\u4fe1\u606f extra-reply-data : false output : # \u65e5\u5fd7\u7b49\u7ea7 trace,debug,info,warn,error log-level : warn # \u662f\u5426\u542f\u7528 DEBUG debug : false # \u5f00\u542f\u8c03\u8bd5\u6a21\u5f0f # \u9ed8\u8ba4\u4e2d\u95f4\u4ef6\u951a\u70b9 default-middlewares : &default # \u8bbf\u95ee\u5bc6\u94a5, \u5f3a\u70c8\u63a8\u8350\u5728\u516c\u7f51\u7684\u670d\u52a1\u5668\u8bbe\u7f6e access-token : '' # \u4e8b\u4ef6\u8fc7\u6ee4\u5668\u6587\u4ef6\u76ee\u5f55 filter : '' # API\u9650\u901f\u8bbe\u7f6e # \u8be5\u8bbe\u7f6e\u4e3a\u5168\u5c40\u751f\u6548 # \u539f cqhttp \u867d\u7136\u542f\u7528\u4e86 rate_limit \u540e\u7f00, \u4f46\u662f\u57fa\u672c\u6ca1\u63d2\u4ef6\u9002\u914d # \u76ee\u524d\u8be5\u9650\u901f\u8bbe\u7f6e\u4e3a\u4ee4\u724c\u6876\u7b97\u6cd5, \u8bf7\u53c2\u8003: # https://baike.baidu.com/item/%E4%BB%A4%E7%89%8C%E6%A1%B6%E7%AE%97%E6%B3%95/6597000?fr=aladdin rate-limit : enabled : false # \u662f\u5426\u542f\u7528\u9650\u901f frequency : 1 # \u4ee4\u724c\u56de\u590d\u9891\u7387, \u5355\u4f4d\u79d2 bucket : 1 # \u4ee4\u724c\u6876\u5927\u5c0f database : # \u6570\u636e\u5e93\u76f8\u5173\u8bbe\u7f6e leveldb : # \u662f\u5426\u542f\u7528\u5185\u7f6eleveldb\u6570\u636e\u5e93 # \u542f\u7528\u5c06\u4f1a\u589e\u52a010-20MB\u7684\u5185\u5b58\u5360\u7528\u548c\u4e00\u5b9a\u7684\u78c1\u76d8\u7a7a\u95f4 # \u5173\u95ed\u5c06\u65e0\u6cd5\u4f7f\u7528 \u64a4\u56de \u56de\u590d get_msg \u7b49\u4e0a\u4e0b\u6587\u76f8\u5173\u529f\u80fd enable : true # \u8fde\u63a5\u670d\u52a1\u5217\u8868 servers : # \u6dfb\u52a0\u65b9\u5f0f\uff0c\u540c\u4e00\u8fde\u63a5\u65b9\u5f0f\u53ef\u6dfb\u52a0\u591a\u4e2a\uff0c\u5177\u4f53\u914d\u7f6e\u8bf4\u660e\u8bf7\u67e5\u770b\u6587\u6863 #- http: # http \u901a\u4fe1 #- ws: # \u6b63\u5411 Websocket #- ws-reverse: # \u53cd\u5411 Websocket #- pprof: #\u6027\u80fd\u5206\u6790\u670d\u52a1\u5668 # Zhamao Framework \u6240\u9700\u8981\u7684\u670d\u52a1\u5668\u914d\u7f6e - ws-reverse : # \u662f\u5426\u7981\u7528\u5f53\u524d\u53cd\u5411WS\u670d\u52a1 disabled : false # \u53cd\u5411WS Universal \u5730\u5740 # \u6ce8\u610f \u8bbe\u7f6e\u4e86\u6b64\u9879\u5730\u5740\u540e\u4e0b\u9762\u4e24\u9879\u5c06\u4f1a\u88ab\u5ffd\u7565 universal : ws://127.0.0.1:20001/ # \u53cd\u5411WS API \u5730\u5740 api : ws://your_websocket_api.server # \u53cd\u5411WS Event \u5730\u5740 event : ws://your_websocket_event.server # \u91cd\u8fde\u95f4\u9694 \u5355\u4f4d\u6beb\u79d2 reconnect-interval : 3000 middlewares : << : *default # \u5f15\u7528\u9ed8\u8ba4\u4e2d\u95f4\u4ef6 config.hjson\uff08v1.0.0-beta2\u6216\u66f4\u65e9\u7248\u672c\u6240\u7528\u683c\u5f0f\uff09 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 { // QQ\u53f7 ui n : \u4f60\u7684\u673a\u5668\u4ebaQQ // QQ\u5bc6\u7801 password : \"\u4f60\u7684QQ\u5bc6\u7801\" // \u662f\u5426\u542f\u7528\u5bc6\u7801\u52a0\u5bc6 e n cryp t _password : false // \u52a0\u5bc6\u540e\u7684\u5bc6\u7801 , \u5982\u672a\u542f\u7528\u5bc6\u7801\u52a0\u5bc6\u5c06\u4e3a\u7a7a , \u8bf7\u52ff\u968f\u610f\u4fee\u6539. password_e n cryp te d : \"\" // \u662f\u5426\u542f\u7528\u5185\u7f6e\u6570\u636e\u5e93 // \u542f\u7528\u5c06\u4f1a\u589e\u52a0 10-20 MB\u7684\u5185\u5b58\u5360\u7528\u548c\u4e00\u5b9a\u7684\u78c1\u76d8\u7a7a\u95f4 // \u5173\u95ed\u5c06\u65e0\u6cd5\u4f7f\u7528 \u64a4\u56de \u56de\u590d ge t _msg \u7b49\u4e0a\u4e0b\u6587\u76f8\u5173\u529f\u80fd e na ble_db : true // \u8bbf\u95ee\u5bc6\u94a5 , \u5f3a\u70c8\u63a8\u8350\u5728\u516c\u7f51\u7684\u670d\u52a1\u5668\u8bbe\u7f6e access_ t oke n : \"\" // \u91cd\u8fde\u8bbe\u7f6e relogi n : { // \u662f\u5426\u542f\u7528\u81ea\u52a8\u91cd\u8fde // \u5982\u4e0d\u542f\u7528\u6389\u7ebf\u540e\u5c06\u4e0d\u4f1a\u81ea\u52a8\u91cd\u8fde e na bled : true // \u91cd\u8fde\u5ef6\u8fdf , \u5355\u4f4d\u79d2 relogi n _delay : 3 // \u6700\u5927\u91cd\u8fde\u6b21\u6570 , 0 \u4e3a\u65e0\u9650\u5236 max_relogi n _ t imes : 0 } // API\u9650\u901f\u8bbe\u7f6e // \u8be5\u8bbe\u7f6e\u4e3a\u5168\u5c40\u751f\u6548 // \u539f cqh tt p \u867d\u7136\u542f\u7528\u4e86 ra te _limi t \u540e\u7f00 , \u4f46\u662f\u57fa\u672c\u6ca1\u63d2\u4ef6\u9002\u914d // \u76ee\u524d\u8be5\u9650\u901f\u8bbe\u7f6e\u4e3a\u4ee4\u724c\u6876\u7b97\u6cd5 , \u8bf7\u53c2\u8003 : //h tt ps : //baike.baidu.com/i te m/%E 4 %BB%A 4 %E 7 % 89 % 8 C%E 6 %A 1 %B 6 %E 7 %AE% 97 %E 6 %B 3 % 95 / 6597000 ? fr =aladdi n _ra te _limi t : { // \u662f\u5426\u542f\u7528\u9650\u901f e na bled : false // \u4ee4\u724c\u56de\u590d\u9891\u7387 , \u5355\u4f4d\u79d2 fre que n cy : 1 // \u4ee4\u724c\u6876\u5927\u5c0f bucke t _size : 1 } // \u662f\u5426\u5ffd\u7565\u65e0\u6548\u7684CQ\u7801 // \u5982\u679c\u4e3a\u5047\u5c06\u539f\u6837\u53d1\u9001 ig n ore_i n valid_cqcode : false // \u662f\u5426\u5f3a\u5236\u5206\u7247\u53d1\u9001\u6d88\u606f // \u5206\u7247\u53d1\u9001\u5c06\u4f1a\u5e26\u6765\u66f4\u5feb\u7684\u901f\u5ea6 // \u4f46\u662f\u517c\u5bb9\u6027\u4f1a\u6709\u4e9b\u95ee\u9898 f orce_ fra gme nte d : false // \u5fc3\u8df3\u9891\u7387 , \u5355\u4f4d\u79d2 // -1 \u4e3a\u5173\u95ed\u5fc3\u8df3 hear t bea t _i nter val : 0 // HTTP\u8bbe\u7f6e h tt p_co nf ig : { // \u662f\u5426\u542f\u7528\u6b63\u5411HTTP\u670d\u52a1\u5668 e na bled : true // \u670d\u52a1\u7aef\u76d1\u542c\u5730\u5740 hos t : 0.0.0.0 // \u670d\u52a1\u7aef\u76d1\u542c\u7aef\u53e3 por t : 5700 // \u53cd\u5411HTTP\u8d85\u65f6\u65f6\u95f4 , \u5355\u4f4d\u79d2 // \u6700\u5c0f\u503c\u4e3a 5 \uff0c\u5c0f\u4e8e 5 \u5c06\u4f1a\u5ffd\u7565\u672c\u9879\u8bbe\u7f6e t imeou t : 0 // \u53cd\u5411HTTP POST\u5730\u5740\u5217\u8868 // \u683c\u5f0f : // { // \u5730\u5740 : secre t // } pos t _urls : {} } // \u6b63\u5411WS\u8bbe\u7f6e ws_co nf ig : { // \u662f\u5426\u542f\u7528\u6b63\u5411WS\u670d\u52a1\u5668 e na bled : true // \u6b63\u5411WS\u670d\u52a1\u5668\u76d1\u542c\u5730\u5740 hos t : 0.0.0.0 // \u6b63\u5411WS\u670d\u52a1\u5668\u76d1\u542c\u7aef\u53e3 por t : 6700 } // \u53cd\u5411WS\u8bbe\u7f6e ws_reverse_servers : [ // \u53ef\u4ee5\u6dfb\u52a0\u591a\u4e2a\u53cd\u5411WS\u63a8\u9001 { // \u662f\u5426\u542f\u7528\u8be5\u63a8\u9001 e na bled : true // \u53cd\u5411WS U n iversal \u5730\u5740 // \u6ce8\u610f \u8bbe\u7f6e\u4e86\u6b64\u9879\u5730\u5740\u540e\u4e0b\u9762\u4e24\u9879\u5c06\u4f1a\u88ab\u5ffd\u7565 reverse_url : ws : // 127.0.0.1 : 20001 / // \u53cd\u5411WS API \u5730\u5740 reverse_api_url : \"\" // \u53cd\u5411WS Eve nt \u5730\u5740 reverse_eve nt _url : \"\" // \u91cd\u8fde\u95f4\u9694 \u5355\u4f4d\u6beb\u79d2 reverse_reco nne c t _i nter val : 3000 } ] // \u4e0a\u62a5\u6570\u636e\u7c7b\u578b // \u53ef\u9009 : s tr i n g array pos t _message_ f orma t : s tr i n g // \u662f\u5426\u4f7f\u7528\u670d\u52a1\u5668\u4e0b\u53d1\u7684\u65b0\u5730\u5740\u8fdb\u884c\u91cd\u8fde // \u6ce8\u610f , \u6b64\u8bbe\u7f6e\u53ef\u80fd\u5bfc\u81f4\u5728\u6d77\u5916\u670d\u52a1\u5668\u4e0a\u8fde\u63a5\u60c5\u51b5\u66f4\u5dee use_sso_address : false // \u662f\u5426\u542f\u7528 DEBUG debug : false // \u65e5\u5fd7\u7b49\u7ea7 // WebUi \u8bbe\u7f6e web_ui : { // \u662f\u5426\u542f\u7528 WebUi e na bled : true // \u76d1\u542c\u5730\u5740 hos t : 127.0.0.1 // \u76d1\u542c\u7aef\u53e3 web_ui_por t : 9999 // \u662f\u5426\u63a5\u6536\u6765\u81eaweb\u7684\u8f93\u5165 web_i n pu t : false } } config.json\uff08\u65e7\u683c\u5f0f\uff09 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 { \"uin\" : \u4f60\u7684QQ\u53f7 , \"password\" : \"\u4f60\u7684\u5bc6\u7801\" , \"encrypt_password\" : false , \"password_encrypted\" : \"\" , \"enable_db\" : true , \"access_token\" : \"\" , \"relogin\" : { \"enabled\" : true , \"relogin_delay\" : 3 , \"max_relogin_times\" : 0 }, \"ignore_invalid_cqcode\" : false , \"force_fragmented\" : true , \"heartbeat_interval\" : 0 , \"http_config\" : { \"enabled\" : false , \"host\" : \"0.0.0.0\" , \"port\" : 5700 , \"timeout\" : 0 , \"post_urls\" : {} }, \"ws_config\" : { \"enabled\" : false , \"host\" : \"0.0.0.0\" , \"port\" : 6700 }, \"ws_reverse_servers\" : [ { \"enabled\" : true , \"reverse_url\" : \"ws://127.0.0.1:20001/\" , \"reverse_api_url\" : \"\" , \"reverse_event_url\" : \"\" , \"reverse_reconnect_interval\" : 3000 } ], \"post_message_format\" : \"string\" , \"debug\" : false , \"log_level\" : \"\" } \u5176\u4e2d ws://127.0.0.1:20001/ \u4e2d\u7684 127.0.0.1 \u548c 20001 \u5e94\u5206\u522b\u5bf9\u5e94\u70b8\u6bdb\u6846\u67b6\u914d\u7f6e\u7684 HOST \u548c PORT","title":"\u673a\u5668\u4eba\u5ba2\u6237\u7aef"},{"location":"guide/quickstart-robot/#_3","text":"\u4e00\u65e6\u65b0\u7684\u914d\u7f6e\u6587\u4ef6\u6b63\u786e\u751f\u6548\u4e4b\u540e\uff0c\u6240\u5728\u7684\u63a7\u5236\u53f0\uff08\u5982\u679c\u6b63\u5728\u8fd0\u884c\u7684\u8bdd\uff09\u5e94\u8be5\u4f1a\u8f93\u51fa\u7c7b\u4f3c\u4e0b\u9762\u7684\u5185\u5bb9\uff1a 1 [ 15 : 26 : 34 ] [ I ] [# 2 ] \u673a\u5668\u4eba \u4f60\u7684 QQ\u53f7 \u5df2\u8fde\u63a5\uff01 \u8868\u660e\u673a\u5668\u4eba\u5df2\u6210\u529f\u8fde\u63a5\u5230\u70b8\u6bdb\u6846\u67b6\u4e86\uff01 \u8fd9\u65f6\uff0c\u5982\u679c\u4f60\u662f\u6839\u636e\u5b89\u88c5\u6559\u7a0b\u8d70\u4e0b\u6765\u5e76\u4e14\u672a\u7f16\u5199\u4efb\u4f55\u6a21\u5757\uff0c\u70b8\u6bdb\u81ea\u5e26\u4e00\u4e2a\u793a\u4f8b\u6a21\u5757\uff0c\u91cc\u9762\u542b\u6709\u547d\u4ee4\uff1a \u4f60\u597d \uff0c \u968f\u673a\u6570 \u3002\u5982\u679c\u4f60\u5bf9\u673a\u5668\u4eba\u56de\u590d\uff1a \u4f60\u597d \uff0c\u5b83\u4f1a\u56de\u590d\u4f60 \u4f60\u597d\u554a\uff0c\u6211\u662f\u7531\u70b8\u6bdb\u6846\u67b6\u6784\u5efa\u7684\u673a\u5668\u4eba\uff01 \u3002\u8fd9\u4e00\u5386\u53f2\u6027\u7684\u5bf9\u8bdd\u6807\u5fd7\u7740\u4f60\u5df2\u7ecf\u6210\u529f\u5730\u8fd0\u884c\u4e86\u70b8\u6bdb\u6846\u67b6\uff0c\u5f00\u59cb\u4e86\u7f16\u5199\u66f4\u5f3a\u5927\u7684 QQ \u673a\u5668\u4eba\u7684\u521b\u610f\u4e4b\u65c5\uff01","title":"\u7b2c\u4e00\u6b21\u5bf9\u8bdd"},{"location":"guide/quickstart-robot/#_4","text":"\u8ba9\u6211\u4eec\u8f6c\u5230\u6846\u67b6\u7684\u6a21\u5757\u6e90\u4ee3\u7801\u90e8\u5206\uff0c\u76ee\u5f55\u662f src/Module/Example \uff0c\u6587\u4ef6\u662f Hello.php \u3002\u6211\u4eec\u63d2\u5165\u4e00\u6bb5\u8fd9\u6837\u7684\u4ee3\u7801\uff1a 1 2 3 4 5 6 7 8 /** * @CQCommand(\"echo\") */ public function repeat() { $repeat = ctx()->getFullArg(\"\u8bf7\u8f93\u5165\u4f60\u8981\u56de\u590d\u7684\u5185\u5bb9\"); ctx()->reply($repeat); //return $repeat; // \u8fd9\u6837\u7684\u6548\u679c\u7b49\u540c\u4e8e ctx()->reply() } \u8fd9\u6837\uff0c\u4e00\u4e2a\u7b80\u6613\u7684\u590d\u8bfb\u673a\u5c31\u505a\u597d\u4e86\uff01\u56de\u5230 QQ \u673a\u5668\u4eba\u804a\u5929\uff0c\u5411\u673a\u5668\u4eba\u53d1\u9001 echo \u4f60\u597d\u554a \uff0c\u5b83\u4f1a\u56de\u590d\u4f60 \u4f60\u597d\u554a \u3002 ) echo \u4f60\u597d\u554a ( \u4f60\u597d\u554a ) echo ( \u8bf7\u8f93\u5165\u4f60\u8981\u56de\u590d\u7684\u5185\u5bb9 ) \u54e6\u8c41 ( \u54e6\u8c41 \u5982\u679c\u4f60\u53ea\u56de\u590d echo \u7684\u8bdd\uff0c\u5b83\u4f1a\u5148\u548c\u4f60\u8fdb\u5165\u4e00\u4e2a\u4f1a\u8bdd\u72b6\u6001\uff0c\u5e76\u95ee\u4f60 \u8bf7\u8f93\u5165\u4f60\u8981\u56de\u590d\u7684\u5185\u5bb9 \uff0c\u8fd9\u65f6\u4f60\u518d\u6b21\u8bf4\u4e00\u4e9b\u5185\u5bb9\u4f8b\u5982 \u54e6\u8c41 \uff0c\u4f1a\u56de\u590d\u4f60 \u54e6\u8c41 \u3002\u6548\u679c\u548c\u76f4\u63a5\u8f93\u5165 echo \u54e6\u8c41 \u662f\u4e00\u81f4\u7684\uff0c\u8fd9\u662f\u70b8\u6bdb\u6846\u67b6\u5185\u7684\u4e00\u4e2a\u5c01\u88c5\u597d\u7684\u547d\u4ee4\u53c2\u6570\u5bf9\u8bdd\u8be2\u95ee\u529f\u80fd\u3002\u6709\u5173\u53c2\u6570\u8be2\u95ee\u529f\u80fd\uff0c\u8bf7\u770b\u540e\u9762\u7684\u8fdb\u9636\u6a21\u5757\u3002","title":"\u7f16\u5199\u4e00\u4e2a\u547d\u4ee4"},{"location":"guide/quickstart-robot/#api","text":"\u5982\u679c\u4f60\u60f3\u4e0d\u53ea\u662f\u56de\u590d\u6d88\u606f\uff0c\u8fd8\u8981\u505a\u5176\u4ed6\u590d\u6742\u7684\u52a8\u4f5c\uff08Action\uff09\uff0c\u4f7f\u7528 OneBot Action\uff08\u53c8\u540d OneBot API\uff09\u8fdb\u884c\u53d1\u9001\u5373\u53ef\uff0c\u89c1 \u673a\u5668\u4eba API \u3002 \u5982\u679c\u60f3\u5904\u7406\u5176\u4ed6\u7c7b\u578b\u7684\u4e8b\u4ef6\uff0c\u6bd4\u5982 QQ \u7fa4\u901a\u77e5\u4e8b\u4ef6\u7b49\uff0c\u89c1 \u673a\u5668\u4eba\u6ce8\u89e3\u4e8b\u4ef6 \u3002","title":"\u4f7f\u7528\u673a\u5668\u4eba API \u548c\u4e8b\u4ef6"},{"location":"guide/register-event/","text":"\u6ce8\u518c\u4e8b\u4ef6\u54cd\u5e94\uff08\u673a\u5668\u4eba\u7bc7\uff09 \u73b0\u5728\u6a21\u5757\u5df2\u7ecf\u521b\u5efa\u5b8c\u6bd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5f00\u59cb\u7f16\u5199\u5b9e\u9645\u4ee3\u7801\u4e86\u3002\u672c\u6bb5\u4ee5\u673a\u5668\u4eba\u4f1a\u8bdd\u4e3a\u4f8b\u5b50\u6765\u8bb2\u8ff0\u4e8b\u4ef6\u6ce8\u518c\u548c\u54cd\u5e94\uff0c\u6709\u5173 HTTP \u670d\u52a1\u5668\u7b49\u6ce8\u518c\u4e8b\u4ef6\u54cd\u5e94\u8bf7\u770b\u540e\u9762\u4e8b\u4ef6\u548c\u6ce8\u89e3\u7ae0\u8282\u3002 \u673a\u5668\u4eba\u804a\u5929\u4e8b\u4ef6\u5904\u7406 \u9996\u5148\u77e5\u9053\uff0cQQ \u7b49\u804a\u5929\u673a\u5668\u4eba\u7684\u6d88\u606f\u6211\u4eec\u7684\u5904\u7406\u903b\u8f91\u4e3a\u5982\u4e0b\u7b80\u5355\u7684\u6a21\u5f0f\uff1a QQ \u7528\u6237\u6d88\u606f -> \u673a\u5668\u4eba\u5ba2\u6237\u7aef -> \u8fde\u63a5\u5ba2\u6237\u7aef\u7684\u6846\u67b6\uff08\u70b8\u6bdb\u6846\u67b6\uff09 \u6846\u67b6\u5904\u7406\u903b\u8f91\u540e\u8fd4\u56de\u7ed9\u7528\u6237\u7684\u6d88\u606f -> \u673a\u5668\u4eba\u5ba2\u6237\u7aef -> QQ\u7528\u6237 \u7b2c\u4e00\u6b65\uff0c\u6211\u4eec\u4ee5\u6846\u67b6\u8fd9\u8fb9\u7684\u89d2\u5ea6\u8003\u8651\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u201c\u4e8b\u4ef6\u201d\uff0c\u6211\u4eec\u7f16\u5199\u4ee3\u7801\u6240\u505a\u7684\u5c31\u662f\u8981\u54cd\u5e94\u8fd9\u4e00\u4e8b\u4ef6\u3002 \u9996\u5148\u6211\u4eec\u4ee5\u4e00\u53e5\u7b80\u5355\u7684\u529f\u80fd\u2014\u2014\u67e5\u5929\u6c14\uff0c\u6211\u4eec\u8981\u4ece\u96f6\u5b9e\u73b0\u4e00\u4e2a\u67e5\u5929\u6c14\u7684\u529f\u80fd\u8fdb\u884c\u793a\u8303\u5982\u4f55\u5feb\u6377\u6709\u6548\u5730\u5f00\u53d1\u4e00\u4e2a\u529f\u80fd\u3002 \u786e\u5b9a\u95ee\u6cd5 \u6211\u4eec\u9996\u5148\u8981\u786e\u5b9a\u7684\u7528\u6237\u95ee\u6cd5\u662f\u4e00\u822c\u7531\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\uff0c\u4f46\u6700\u597d\u8d34\u5408\u7528\u6237\u7684\u81ea\u7136\u8bed\u8a00\u6765\u8fdb\u884c\u5b9a\u4e49\u3002\u6bd4\u5982\u6211\u4eec\u8fd9\u91cc\u63d0\u5230\u7684\u5929\u6c14\u529f\u80fd\uff0c\u7528\u6237\u4e00\u822c\u5c31\u4f1a\u8be2\u95ee\u201c\u5317\u4eac\u5929\u6c14\u201d\uff0c\u201c\u5317\u4eac\u5929\u6c14\u600e\u4e48\u6837\u201d\uff0c\u201c\u5929\u6c14 \u5317\u4eac\u201d\u3002 \u6ce8\u518c\u6d88\u606f\u4e8b\u4ef6 \u6211\u4eec\u4ee5\u6700\u7b80\u5355\u7684\u547d\u4ee4\u65b9\u5f0f\u201c\u5929\u6c14 \u5317\u4eac\u201d\u8fdb\u884c\u5904\u7406\u3002\u95ee\u6cd5\u4e3a\u53c2\u6570\u5316\u7684\uff0c\u901a\u8fc7\u7a7a\u683c\u6765\u5206\u5f00\uff0c\u8fd9\u4e5f\u662f\u70b8\u6bdb\u6846\u67b6\u9ed8\u8ba4\u652f\u6301\u6700\u57fa\u672c\u7684\u804a\u5929\u4e8b\u4ef6\u4e4b\u4e00\u3002\u6211\u4eec\u901a\u8fc7\u4e0a\u4e00\u90e8\u5206\u7684\u65b9\u5f0f\u65b0\u5efa\u4e00\u4e2a\u5355\u6587\u4ef6\u6a21\u5757 Weather.php \u5728 src/Module \u76ee\u5f55\u4e0b\uff0c\u5e76\u7f16\u5199\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php namespace Module ; use ZM\\Annotation\\CQ\\CQCommand ; class Weather { /** * @CQCommand(\"\u5929\u6c14\") * @return string */ public function searchWeather () { $city = ctx () -> getNextArg ( \"\u8bf7\u544a\u8bc9\u6211\u4f60\u8981\u67e5\u8be2\u7684\u57ce\u5e02\" ); // \u53d1\u9001 \u201c\u5929\u6c14 \u5317\u4eac\u201d\u65f6\uff0c\u53d8\u91cf\u4e3a\u201c\u5317\u4eac\u201d // \u8fd9\u91cc\u5047\u8bbe\u662f\u5929\u6c14API\u63a5\u53e3\u7684\u5bf9\u63a5\uff0c\u8fd4\u56de\u4e86\u5929\u6c14\u7684\u6570\u636e $weather = \"2020\u5e7412\u670822\u65e5\uff0c\u6674\uff0c-2~9\u2103 blablabla\" ; return \" $city \u5929\u6c14\u60c5\u51b5\uff1a\" . $weather ; } } \u63d0\u793a \u4e3a\u4e86\u7b80\u5355\u8d77\u89c1\uff0c\u6211\u4eec\u5728\u8fd9\u91cc\u7684\u4f8b\u5b50\u4e2d\u6ca1\u6709\u63a5\u5165\u771f\u5b9e\u7684\u5929\u6c14\u6570\u636e\uff0c\u4f46\u8981\u63a5\u5165\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e2d\u56fd\u5929\u6c14\u7f51\u3001\u548c\u98ce\u5929\u6c14\u7b49\u7f51\u7ad9\u63d0\u4f9b\u7684 API\uff0c\u672c\u6559\u7a0b\u7684\u8fdb\u9636\u4e00\u680f\u540e\u671f\u4f1a\u8be6\u7ec6\u7f16\u5199\u5982\u4f55\u5bf9\u63a5\u4e00\u4e2a\u5929\u6c14 API \u63a5\u53e3\u3002 \u5728\u4e0a\u65b9\u4ee3\u7801\u7f16\u5199\u5b8c\u6bd5\u540e\uff0c\u8fd0\u884c\u6846\u67b6\uff08\u6216\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7ec8\u7aef\u8f93\u5165 reload \uff09\uff0c\u7136\u540e\u4f7f\u7528\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u8fde\u63a5\u5230\u70b8\u6bdb\u6846\u67b6\uff0c\u5373\u53ef\u5b9e\u73b0\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a\u529f\u80fd\u3002\u6211\u4eec\u5728\u4ee3\u7801\u4e2d\u7f16\u5199\u4e86\u4e00\u4e2a \u6ce8\u89e3\u4e8b\u4ef6 \uff1a @CQCommand \uff0c\u6b64\u6ce8\u89e3\u4e8b\u4ef6\u662f\u7528\u4e8e\u63a5\u6536\u7528\u6237\u7684\u666e\u901a\u6d88\u606f\u5e76\u5207\u5206\u6210\u5404\u7c7b\u547d\u4ee4\u89c4\u5219\u7684\u4e00\u4e2a\u6ce8\u89e3\u4e8b\u4ef6\u7ed1\u5b9a\u3002\u4ee3\u7801\u4e2d\u7684\u6ce8\u89e3\u4e8b\u4ef6\u7701\u53bb\u4e86\u6ce8\u89e3\u4e2d\u7684\u952e\u540d\uff0c\u4e5f\u53ef\u4ee5\u5199\u4f5c @CQCommand(match=\"\u5929\u6c14\") \u3002 \u8fd9\u91cc\u6ce8\u89e3\u4e8b\u4ef6\u7684\u6982\u5ff5\u8bf7\u770b \u4e8b\u4ef6\u548c\u6ce8\u89e3 \u4e00\u680f\u63cf\u8ff0\u7684\u6982\u5ff5\u5373\u53ef\u3002\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u5b8c\u6210\u4e00\u4e2a\u53ef\u4ee5\u5904\u7406\u547d\u4ee4 \u5929\u6c14 xxx \u7684\u65b9\u6cd5\u4e86\uff01 \u5904\u7406\u6d88\u606f\u4e8b\u4ef6 \u7b2c\u4e00\u884c ctx() \u662f\u70b8\u6bdb\u6846\u67b6\u5185\u7684\u4e0a\u4e0b\u6587\u83b7\u53d6\u65b9\u5f0f\uff0c\u6bcf\u6761\u7528\u6237\u804a\u5929\u4fe1\u606f\u53d1\u8fc7\u6765\uff0c\u88ab\u70b8\u6bdb\u6846\u67b6\u6536\u5230\uff0c\u90fd\u4f1a\u521b\u5efa\u4e00\u6b21\u4e0a\u4e0b\u6587\uff0c\u540c\u65f6\u8fd9\u6b21\u804a\u5929\u7684\u5168\u90e8\u4fe1\u606f\uff0c\u6bd4\u5982\u7528\u6237\u7684 ID\uff08QQ \u53f7\u7801\uff09\uff0c\u53d1\u6d88\u606f\u7684\u65f6\u95f4\uff0c\u5982\u679c\u662f\u7fa4\u6d88\u606f\u7684\u8bdd\u6240\u5728\u7684\u7fa4\u53f7\u7b49\u7b49\uff0c\u90fd\u88ab\u5b58\u5230\u4e86\u4e0a\u4e0b\u6587\u4e2d\u3002 ctx() \u83b7\u53d6\u7684\u662f\u4e00\u4e2a\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff0c\u5185\u90e8\u6709\u8bb8\u591a\u53ef\u64cd\u4f5c\u4e0a\u4e0b\u6587\u7684\u65b9\u6cd5\uff0c\u5176\u4e2d\u4ee3\u7801\u7684 getNextArg() \uff0c\u4f5c\u7528\u662f\u6839\u636e\u7a7a\u683c\u5206\u9694\u83b7\u53d6\u547d\u4ee4\u4e2d\u7684\u4e0b\u4e00\u4e2a\u53c2\u6570\u3002 \u5728\u4e4b\u524d\u6211\u4eec\u77e5\u9053\uff1a \u5929\u6c14 \u5317\u4eac \u662f\u6211\u4eec\u53d1\u9001\u7684\u6d88\u606f\uff0c\u6211\u4eec\u8981\u83b7\u53d6\u5230\u7528\u6237\u53d1\u9001\u7684\u53c2\u6570 \u5317\u4eac \u3002 getNextArg() \u662f\u6846\u67b6\u5c01\u88c5\u597d\u7684\u4e00\u4e2a\u5feb\u901f\u83b7\u53d6\u4e0b\u4e00\u4e2a\u53c2\u6570\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u8fd9\u91cc\u76f4\u63a5\u4f7f\u7528\u5b83\u6765\u83b7\u53d6\u3002 \u5bf9\u4e8e getNextArg() \u4e2d\u7684\u6587\u672c\uff0c\u53ef\u4e3a\u7a7a\uff0c\u4e0d\u4e3a\u7a7a\u7684\u65f6\u5019\u5982\u679c\u7528\u6237\u53ea\u53d1\u9001\u5929\u6c14\u4e24\u4e2a\u5b57\uff0c\u673a\u5668\u4eba\u8fd8\u662f\u4f1a\u54cd\u5e94\uff0c\u4f46\u662f\u5b83\u4f1a\u8be2\u95ee\u4f60\u8fd9\u53e5\u8bdd\uff0c\u7136\u540e\u4f60\u56de\u590d\u673a\u5668\u4eba\u201c\u5317\u4eac\u201d\uff0c\u8fd9\u91cc $city \u53d8\u91cf\u5c31\u63a5\u53d7\u5230\u5e76\u8d4b\u503c\u4e3a\u201c\u5317\u4eac\u201d\u4e86\uff0c\u4ee3\u7801\u4f1a\u7ee7\u7eed\u6267\u884c\uff0c\u548c\u76f4\u63a5\u4e00\u6b21\u6027\u53d1\u9001\u673a\u5668\u4eba\u201c\u5929\u6c14 \u5317\u4eac\u201d\u662f\u4e00\u4e2a\u6548\u679c\uff0c\u6b64\u4e3a\u6846\u67b6\u5c01\u88c5\u7684\u6d88\u606f\u4f1a\u8bdd\u673a\u5236\uff0c\u4ee5\u8d34\u8fd1\u81ea\u7136\u4f1a\u8bdd\u7684\u65b9\u5f0f\u6765\u7f16\u5199\u4ee3\u7801\u903b\u8f91\u3002 \u6700\u540e\uff0c\u51fd\u6570\u76f4\u63a5\u8fd4\u56de\u4e86\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4f5c\u4e3a\u4e8b\u4ef6\u7684\u54cd\u5e94\uff0c\u70b8\u6bdb\u6846\u67b6\u4f1a\u81ea\u52a8\u5904\u7406\u5e76\u8c03\u7528\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u7684\u63a5\u53e3\uff0c\u6700\u540e\u8fd4\u56de\u7ed9\u7528\u6237\u6d88\u606f\u3002\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e0a\u4e0b\u6587\u7684 ctx()->reply(\"xxx\") \u65b9\u6cd5\u66ff\u4ee3\uff0c\u4e0d\u8fd4\u56de\u5b57\u7b26\u4e32\u3002\u6ce8\u610f\u4e24\u8005\u53ea\u80fd\u9009\u62e9\u4e00\u79cd\u65b9\u5f0f\uff0c\u53d6\u51b3\u4e8e\u5f00\u53d1\u8005\u7684\u5f00\u53d1\u4e60\u60ef\u3002 ) \u5929\u6c14 \u5317\u4eac ( \u5317\u4eac \u5929\u6c14\u60c5\u51b5\uff1a2020\u5e7412\u670822\u65e5\uff0c\u6674\uff0c-2~9\u2103 blablabla ) \u5929\u6c14 ( \u8bf7\u544a\u8bc9\u6211\u4f60\u8981\u67e5\u8be2\u7684\u57ce\u5e02 ) \u5317\u4eac ( \u5317\u4eac \u5929\u6c14\u60c5\u51b5\uff1a2020\u5e7412\u670822\u65e5\uff0c\u6674\uff0c-2~9\u2103 blablabla","title":"\u6ce8\u518c\u4e8b\u4ef6\u54cd\u5e94"},{"location":"guide/register-event/#_1","text":"\u73b0\u5728\u6a21\u5757\u5df2\u7ecf\u521b\u5efa\u5b8c\u6bd5\uff0c\u6211\u4eec\u53ef\u4ee5\u5f00\u59cb\u7f16\u5199\u5b9e\u9645\u4ee3\u7801\u4e86\u3002\u672c\u6bb5\u4ee5\u673a\u5668\u4eba\u4f1a\u8bdd\u4e3a\u4f8b\u5b50\u6765\u8bb2\u8ff0\u4e8b\u4ef6\u6ce8\u518c\u548c\u54cd\u5e94\uff0c\u6709\u5173 HTTP \u670d\u52a1\u5668\u7b49\u6ce8\u518c\u4e8b\u4ef6\u54cd\u5e94\u8bf7\u770b\u540e\u9762\u4e8b\u4ef6\u548c\u6ce8\u89e3\u7ae0\u8282\u3002","title":"\u6ce8\u518c\u4e8b\u4ef6\u54cd\u5e94\uff08\u673a\u5668\u4eba\u7bc7\uff09"},{"location":"guide/register-event/#_2","text":"\u9996\u5148\u77e5\u9053\uff0cQQ \u7b49\u804a\u5929\u673a\u5668\u4eba\u7684\u6d88\u606f\u6211\u4eec\u7684\u5904\u7406\u903b\u8f91\u4e3a\u5982\u4e0b\u7b80\u5355\u7684\u6a21\u5f0f\uff1a QQ \u7528\u6237\u6d88\u606f -> \u673a\u5668\u4eba\u5ba2\u6237\u7aef -> \u8fde\u63a5\u5ba2\u6237\u7aef\u7684\u6846\u67b6\uff08\u70b8\u6bdb\u6846\u67b6\uff09 \u6846\u67b6\u5904\u7406\u903b\u8f91\u540e\u8fd4\u56de\u7ed9\u7528\u6237\u7684\u6d88\u606f -> \u673a\u5668\u4eba\u5ba2\u6237\u7aef -> QQ\u7528\u6237 \u7b2c\u4e00\u6b65\uff0c\u6211\u4eec\u4ee5\u6846\u67b6\u8fd9\u8fb9\u7684\u89d2\u5ea6\u8003\u8651\uff0c\u6211\u4eec\u79f0\u4e4b\u4e3a\u201c\u4e8b\u4ef6\u201d\uff0c\u6211\u4eec\u7f16\u5199\u4ee3\u7801\u6240\u505a\u7684\u5c31\u662f\u8981\u54cd\u5e94\u8fd9\u4e00\u4e8b\u4ef6\u3002 \u9996\u5148\u6211\u4eec\u4ee5\u4e00\u53e5\u7b80\u5355\u7684\u529f\u80fd\u2014\u2014\u67e5\u5929\u6c14\uff0c\u6211\u4eec\u8981\u4ece\u96f6\u5b9e\u73b0\u4e00\u4e2a\u67e5\u5929\u6c14\u7684\u529f\u80fd\u8fdb\u884c\u793a\u8303\u5982\u4f55\u5feb\u6377\u6709\u6548\u5730\u5f00\u53d1\u4e00\u4e2a\u529f\u80fd\u3002","title":"\u673a\u5668\u4eba\u804a\u5929\u4e8b\u4ef6\u5904\u7406"},{"location":"guide/register-event/#_3","text":"\u6211\u4eec\u9996\u5148\u8981\u786e\u5b9a\u7684\u7528\u6237\u95ee\u6cd5\u662f\u4e00\u822c\u7531\u6211\u4eec\u81ea\u5df1\u5b9a\u4e49\uff0c\u4f46\u6700\u597d\u8d34\u5408\u7528\u6237\u7684\u81ea\u7136\u8bed\u8a00\u6765\u8fdb\u884c\u5b9a\u4e49\u3002\u6bd4\u5982\u6211\u4eec\u8fd9\u91cc\u63d0\u5230\u7684\u5929\u6c14\u529f\u80fd\uff0c\u7528\u6237\u4e00\u822c\u5c31\u4f1a\u8be2\u95ee\u201c\u5317\u4eac\u5929\u6c14\u201d\uff0c\u201c\u5317\u4eac\u5929\u6c14\u600e\u4e48\u6837\u201d\uff0c\u201c\u5929\u6c14 \u5317\u4eac\u201d\u3002","title":"\u786e\u5b9a\u95ee\u6cd5"},{"location":"guide/register-event/#_4","text":"\u6211\u4eec\u4ee5\u6700\u7b80\u5355\u7684\u547d\u4ee4\u65b9\u5f0f\u201c\u5929\u6c14 \u5317\u4eac\u201d\u8fdb\u884c\u5904\u7406\u3002\u95ee\u6cd5\u4e3a\u53c2\u6570\u5316\u7684\uff0c\u901a\u8fc7\u7a7a\u683c\u6765\u5206\u5f00\uff0c\u8fd9\u4e5f\u662f\u70b8\u6bdb\u6846\u67b6\u9ed8\u8ba4\u652f\u6301\u6700\u57fa\u672c\u7684\u804a\u5929\u4e8b\u4ef6\u4e4b\u4e00\u3002\u6211\u4eec\u901a\u8fc7\u4e0a\u4e00\u90e8\u5206\u7684\u65b9\u5f0f\u65b0\u5efa\u4e00\u4e2a\u5355\u6587\u4ef6\u6a21\u5757 Weather.php \u5728 src/Module \u76ee\u5f55\u4e0b\uff0c\u5e76\u7f16\u5199\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 <?php namespace Module ; use ZM\\Annotation\\CQ\\CQCommand ; class Weather { /** * @CQCommand(\"\u5929\u6c14\") * @return string */ public function searchWeather () { $city = ctx () -> getNextArg ( \"\u8bf7\u544a\u8bc9\u6211\u4f60\u8981\u67e5\u8be2\u7684\u57ce\u5e02\" ); // \u53d1\u9001 \u201c\u5929\u6c14 \u5317\u4eac\u201d\u65f6\uff0c\u53d8\u91cf\u4e3a\u201c\u5317\u4eac\u201d // \u8fd9\u91cc\u5047\u8bbe\u662f\u5929\u6c14API\u63a5\u53e3\u7684\u5bf9\u63a5\uff0c\u8fd4\u56de\u4e86\u5929\u6c14\u7684\u6570\u636e $weather = \"2020\u5e7412\u670822\u65e5\uff0c\u6674\uff0c-2~9\u2103 blablabla\" ; return \" $city \u5929\u6c14\u60c5\u51b5\uff1a\" . $weather ; } } \u63d0\u793a \u4e3a\u4e86\u7b80\u5355\u8d77\u89c1\uff0c\u6211\u4eec\u5728\u8fd9\u91cc\u7684\u4f8b\u5b50\u4e2d\u6ca1\u6709\u63a5\u5165\u771f\u5b9e\u7684\u5929\u6c14\u6570\u636e\uff0c\u4f46\u8981\u63a5\u5165\u4e5f\u975e\u5e38\u7b80\u5355\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e2d\u56fd\u5929\u6c14\u7f51\u3001\u548c\u98ce\u5929\u6c14\u7b49\u7f51\u7ad9\u63d0\u4f9b\u7684 API\uff0c\u672c\u6559\u7a0b\u7684\u8fdb\u9636\u4e00\u680f\u540e\u671f\u4f1a\u8be6\u7ec6\u7f16\u5199\u5982\u4f55\u5bf9\u63a5\u4e00\u4e2a\u5929\u6c14 API \u63a5\u53e3\u3002 \u5728\u4e0a\u65b9\u4ee3\u7801\u7f16\u5199\u5b8c\u6bd5\u540e\uff0c\u8fd0\u884c\u6846\u67b6\uff08\u6216\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7ec8\u7aef\u8f93\u5165 reload \uff09\uff0c\u7136\u540e\u4f7f\u7528\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u8fde\u63a5\u5230\u70b8\u6bdb\u6846\u67b6\uff0c\u5373\u53ef\u5b9e\u73b0\u6211\u4eec\u7684\u7b2c\u4e00\u4e2a\u529f\u80fd\u3002\u6211\u4eec\u5728\u4ee3\u7801\u4e2d\u7f16\u5199\u4e86\u4e00\u4e2a \u6ce8\u89e3\u4e8b\u4ef6 \uff1a @CQCommand \uff0c\u6b64\u6ce8\u89e3\u4e8b\u4ef6\u662f\u7528\u4e8e\u63a5\u6536\u7528\u6237\u7684\u666e\u901a\u6d88\u606f\u5e76\u5207\u5206\u6210\u5404\u7c7b\u547d\u4ee4\u89c4\u5219\u7684\u4e00\u4e2a\u6ce8\u89e3\u4e8b\u4ef6\u7ed1\u5b9a\u3002\u4ee3\u7801\u4e2d\u7684\u6ce8\u89e3\u4e8b\u4ef6\u7701\u53bb\u4e86\u6ce8\u89e3\u4e2d\u7684\u952e\u540d\uff0c\u4e5f\u53ef\u4ee5\u5199\u4f5c @CQCommand(match=\"\u5929\u6c14\") \u3002 \u8fd9\u91cc\u6ce8\u89e3\u4e8b\u4ef6\u7684\u6982\u5ff5\u8bf7\u770b \u4e8b\u4ef6\u548c\u6ce8\u89e3 \u4e00\u680f\u63cf\u8ff0\u7684\u6982\u5ff5\u5373\u53ef\u3002\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u5b8c\u6210\u4e00\u4e2a\u53ef\u4ee5\u5904\u7406\u547d\u4ee4 \u5929\u6c14 xxx \u7684\u65b9\u6cd5\u4e86\uff01","title":"\u6ce8\u518c\u6d88\u606f\u4e8b\u4ef6"},{"location":"guide/register-event/#_5","text":"\u7b2c\u4e00\u884c ctx() \u662f\u70b8\u6bdb\u6846\u67b6\u5185\u7684\u4e0a\u4e0b\u6587\u83b7\u53d6\u65b9\u5f0f\uff0c\u6bcf\u6761\u7528\u6237\u804a\u5929\u4fe1\u606f\u53d1\u8fc7\u6765\uff0c\u88ab\u70b8\u6bdb\u6846\u67b6\u6536\u5230\uff0c\u90fd\u4f1a\u521b\u5efa\u4e00\u6b21\u4e0a\u4e0b\u6587\uff0c\u540c\u65f6\u8fd9\u6b21\u804a\u5929\u7684\u5168\u90e8\u4fe1\u606f\uff0c\u6bd4\u5982\u7528\u6237\u7684 ID\uff08QQ \u53f7\u7801\uff09\uff0c\u53d1\u6d88\u606f\u7684\u65f6\u95f4\uff0c\u5982\u679c\u662f\u7fa4\u6d88\u606f\u7684\u8bdd\u6240\u5728\u7684\u7fa4\u53f7\u7b49\u7b49\uff0c\u90fd\u88ab\u5b58\u5230\u4e86\u4e0a\u4e0b\u6587\u4e2d\u3002 ctx() \u83b7\u53d6\u7684\u662f\u4e00\u4e2a\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff0c\u5185\u90e8\u6709\u8bb8\u591a\u53ef\u64cd\u4f5c\u4e0a\u4e0b\u6587\u7684\u65b9\u6cd5\uff0c\u5176\u4e2d\u4ee3\u7801\u7684 getNextArg() \uff0c\u4f5c\u7528\u662f\u6839\u636e\u7a7a\u683c\u5206\u9694\u83b7\u53d6\u547d\u4ee4\u4e2d\u7684\u4e0b\u4e00\u4e2a\u53c2\u6570\u3002 \u5728\u4e4b\u524d\u6211\u4eec\u77e5\u9053\uff1a \u5929\u6c14 \u5317\u4eac \u662f\u6211\u4eec\u53d1\u9001\u7684\u6d88\u606f\uff0c\u6211\u4eec\u8981\u83b7\u53d6\u5230\u7528\u6237\u53d1\u9001\u7684\u53c2\u6570 \u5317\u4eac \u3002 getNextArg() \u662f\u6846\u67b6\u5c01\u88c5\u597d\u7684\u4e00\u4e2a\u5feb\u901f\u83b7\u53d6\u4e0b\u4e00\u4e2a\u53c2\u6570\u7684\u65b9\u6cd5\uff0c\u6211\u4eec\u8fd9\u91cc\u76f4\u63a5\u4f7f\u7528\u5b83\u6765\u83b7\u53d6\u3002 \u5bf9\u4e8e getNextArg() \u4e2d\u7684\u6587\u672c\uff0c\u53ef\u4e3a\u7a7a\uff0c\u4e0d\u4e3a\u7a7a\u7684\u65f6\u5019\u5982\u679c\u7528\u6237\u53ea\u53d1\u9001\u5929\u6c14\u4e24\u4e2a\u5b57\uff0c\u673a\u5668\u4eba\u8fd8\u662f\u4f1a\u54cd\u5e94\uff0c\u4f46\u662f\u5b83\u4f1a\u8be2\u95ee\u4f60\u8fd9\u53e5\u8bdd\uff0c\u7136\u540e\u4f60\u56de\u590d\u673a\u5668\u4eba\u201c\u5317\u4eac\u201d\uff0c\u8fd9\u91cc $city \u53d8\u91cf\u5c31\u63a5\u53d7\u5230\u5e76\u8d4b\u503c\u4e3a\u201c\u5317\u4eac\u201d\u4e86\uff0c\u4ee3\u7801\u4f1a\u7ee7\u7eed\u6267\u884c\uff0c\u548c\u76f4\u63a5\u4e00\u6b21\u6027\u53d1\u9001\u673a\u5668\u4eba\u201c\u5929\u6c14 \u5317\u4eac\u201d\u662f\u4e00\u4e2a\u6548\u679c\uff0c\u6b64\u4e3a\u6846\u67b6\u5c01\u88c5\u7684\u6d88\u606f\u4f1a\u8bdd\u673a\u5236\uff0c\u4ee5\u8d34\u8fd1\u81ea\u7136\u4f1a\u8bdd\u7684\u65b9\u5f0f\u6765\u7f16\u5199\u4ee3\u7801\u903b\u8f91\u3002 \u6700\u540e\uff0c\u51fd\u6570\u76f4\u63a5\u8fd4\u56de\u4e86\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u4f5c\u4e3a\u4e8b\u4ef6\u7684\u54cd\u5e94\uff0c\u70b8\u6bdb\u6846\u67b6\u4f1a\u81ea\u52a8\u5904\u7406\u5e76\u8c03\u7528\u673a\u5668\u4eba\u5ba2\u6237\u7aef\u7684\u63a5\u53e3\uff0c\u6700\u540e\u8fd4\u56de\u7ed9\u7528\u6237\u6d88\u606f\u3002\u8fd9\u91cc\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4e0a\u4e0b\u6587\u7684 ctx()->reply(\"xxx\") \u65b9\u6cd5\u66ff\u4ee3\uff0c\u4e0d\u8fd4\u56de\u5b57\u7b26\u4e32\u3002\u6ce8\u610f\u4e24\u8005\u53ea\u80fd\u9009\u62e9\u4e00\u79cd\u65b9\u5f0f\uff0c\u53d6\u51b3\u4e8e\u5f00\u53d1\u8005\u7684\u5f00\u53d1\u4e60\u60ef\u3002 ) \u5929\u6c14 \u5317\u4eac ( \u5317\u4eac \u5929\u6c14\u60c5\u51b5\uff1a2020\u5e7412\u670822\u65e5\uff0c\u6674\uff0c-2~9\u2103 blablabla ) \u5929\u6c14 ( \u8bf7\u544a\u8bc9\u6211\u4f60\u8981\u67e5\u8be2\u7684\u57ce\u5e02 ) \u5317\u4eac ( \u5317\u4eac \u5929\u6c14\u60c5\u51b5\uff1a2020\u5e7412\u670822\u65e5\uff0c\u6674\uff0c-2~9\u2103 blablabla","title":"\u5904\u7406\u6d88\u606f\u4e8b\u4ef6"},{"location":"guide/write-module/","text":"\u7f16\u5199\u6a21\u5757 \u5230\u73b0\u5728\u4e3a\u6b62\uff0c\u6211\u4eec\u8fd8\u5728\u4f7f\u7528\u6846\u67b6\u7684\u9ed8\u8ba4\u6a21\u5757 Example/Hello.php \uff0c\u5728\u5f00\u59cb\u7f16\u5199\u81ea\u5df1\u7684\u6a21\u5757\u5e94\u7528\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u8bf4\u660e\u4e00\u4e9b\u7f16\u5199\u4ee3\u7801\u7684\u7ea6\u5b9a\u3002 \u52a0\u8f7d\u6a21\u5757 \u6846\u67b6\u9ed8\u8ba4\u4f7f\u7528\u811a\u624b\u67b6\u6784\u5efa\u597d\u540e\uff0c\u76ee\u5f55\u7ed3\u6784\u5927\u81f4\u4e3a\u4e0b\u9762\u8fd9\u6837\uff1a 1 2 3 4 5 6 7 8 9 zhamao-framework-starter/ \u251c\u2500\u2500 config/ # \u9879\u76ee\u7684\u914d\u7f6e\u6587\u4ef6\u6587\u4ef6\u5939\uff0c\u5982 global.php \u251c\u2500\u2500 src/ # \u9879\u76ee\u7684\u4e3b\u8981\u6e90\u7801\u76ee\u5f55 \u2502 \u251c\u2500\u2500 Module/ # \u7528\u6237\u7f16\u5199\u7684\u6a21\u5757\u76ee\u5f55 \u2502 \u2502 \u2514\u2500\u2500 Example/ # \u6a21\u5757\u6587\u4ef6\u5939\u540d\u79f0 \u2502 \u2502 \u2514\u2500\u2500 Hello.php # \u6a21\u5757\u5185\u7684\u7c7b \u2502 \u2514\u2500\u2500 Custom/ # \u7528\u6237\u81ea\u5b9a\u4e49\u7684\u5168\u5c40\u65b9\u6cd5\u3001\u5168\u5c40\u6ce8\u89e3\u7c7b\u7b49\u5b58\u653e\u7684\u76ee\u5f55 \u251c\u2500\u2500 vendor/ # Composer \u4f9d\u8d56\u52a0\u8f7d\u76ee\u5f55 \u2514\u2500\u2500 composer.json # Composer \u914d\u7f6e\u6587\u4ef6 \u5176\u4e2d\u6211\u4eec\u811a\u624b\u67b6\u5305\u542b\u7684\u9ed8\u8ba4\u6a21\u5757 Example \u4e0b\u7684 Hello \u7c7b\uff0c\u5c31\u662f\u7528\u6237\u5199\u6a21\u5757\u7684\u4f4d\u7f6e\u3002\u4f60\u4e5f\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\uff0c\u81ea\u884c\u6dfb\u52a0\u66f4\u591a\u7684\u6a21\u5757\u6587\u4ef6\u5939\u751a\u81f3\u5355\u6587\u4ef6\u6a21\u5757\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6240\u6709\u6587\u4ef6\u5939\u540d\u79f0\u548c .php \u6587\u4ef6\u5fc5\u987b\u9075\u5faa psr-4 \u89c4\u8303 \uff0c\u7b80\u5355\u6765\u8bf4\uff0c src/ \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5939\uff0c\u5b50\u6587\u4ef6\u5939\u8981\u5199\u6210\u547d\u540d\u7a7a\u95f4\uff0c\u6bd4\u5982\u9ed8\u8ba4\u6846\u67b6\u4e2d Example/ \u4e0b\u7684 .php \u6587\u4ef6\u7684\u547d\u540d\u7a7a\u95f4\u4e3a namespace Module\\Example; \uff0c\u4e14\u4e00\u4e2a .php \u6587\u4ef6\u63a8\u8350\u53ea\u5305\u542b\u4e00\u4e2a class \u3001 trait \u6216 interface \u3002 1 2 3 <?php namespace Module\\ < your - module - dir > ; class ModuleA {} \u8b66\u544a \u5982\u679c\u6ca1\u6709\u9075\u5b88\u4e0a\u65b9\u7684\u7c7b\u548c\u6587\u4ef6\u547d\u540d\u89c4\u5219\u7684\u8bdd\uff08\u6587\u4ef6\u540d\u3001\u6587\u4ef6\u5939\u540d\u548c\u547d\u540d\u7a7a\u95f4\u7684\u7edf\u4e00\u6027\uff09\uff0c\u5728\u52a0\u8f7d\u6846\u67b6\u65f6\u5c31\u4f1a\u62a5\u9519\uff0c\u65e0\u6cd5\u627e\u5230\u5bf9\u5e94\u7684\u7c7b\u3002\u56e0\u4e3a\u6846\u67b6\u7684\u6ce8\u89e3\u89e3\u6790\u4f9d\u8d56\u4e8e Composer \u4e2d psr-4 \u89c4\u5219\u7684\u81ea\u52a8\u52a0\u8f7d\u3002 \u521b\u5efa\u6a21\u5757 \u6807\u51c6\u5f62\u5f0f \u6211\u4eec\u8fd9\u91cc\u4ee5 Entertain \u5a31\u4e50\u6a21\u5757\u7684\u521b\u5efa\u4e3a\u4f8b\uff0c\u65b0\u5efa\u4e00\u4e2a\u5185\u6709 Dice.php \u63b7\u9ab0\u5b50\u529f\u80fd\u7684\u6a21\u5757\uff0c\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff0c\u5728 Module/ \u4e0b\u65b0\u5efa\u6587\u4ef6\u5939 Entertain/ \uff0c\u518d\u5728\u6b64\u5b50\u76ee\u5f55\u4e0b\u65b0\u5efa Dice.php \u6587\u4ef6\u3002 1 2 3 4 5 zhamao-framework-starter/ \u2514\u2500\u2500 src/ \u2514\u2500\u2500 Module/ \u2514\u2500\u2500 Entertain/ \u2514\u2500\u2500 Dice.php \u65b0\u5efa\u7684 PHP \u6587\u4ef6\u6309\u7167\u5982\u4e0b\u65b9\u5f0f\u7f16\u5199\uff1a 1 2 3 4 <?php namespace Module\\Entertain ; class Dice { } \u8fd9\u4e2a\u65f6\u5019\u5b83\u5df2\u7ecf\u53ef\u4ee5\u88ab\u79f0\u4e3a\u4e00\u4e2a\u6a21\u5757\u4e86\uff0c\u5c3d\u7ba1\u5b83\u8fd8\u4ec0\u4e48\u90fd\u6ca1\u505a\u3002 \u5355\u6587\u4ef6\u5f62\u5f0f \u5982\u679c\u4f60\u53ea\u5f00\u53d1\u5f88\u7b80\u5355\u7684\u4e00\u4e9b\u529f\u80fd\uff0c\u5982\u4e00\u4e2a PHP \u6587\u4ef6\u5c31\u53ef\u4ee5\u5b9e\u73b0\u7684\uff0c\u53ef\u4ee5\u5c11\u53bb\u521b\u5efa\u6a21\u5757\u6587\u4ef6\u5939\u7684\u4e00\u6b65\uff0c\u76f4\u63a5\u5c06 .php \u6587\u4ef6\u65b0\u5efa\u5230 Module/ \u6587\u4ef6\u5939\u4e0b\uff0c\u8fd9\u65f6\u6b64\u6587\u4ef6\u7684\u547d\u540d\u7a7a\u95f4\u9700\u8981\u66f4\u6b63\u4e3a namespace Module; \u5373\u53ef\uff0c\u800c\u6587\u4ef6\u5939\u7ed3\u6784\u4e5f\u66f4\u52a0\u7b80\u5355\uff1a 1 2 3 4 zhamao-framework-starter/ \u2514\u2500\u2500 src/ \u2514\u2500\u2500 Module/ \u2514\u2500\u2500 Dice.php Composer \u5916\u90e8\u5f15\u5165\u5f62\u5f0f \uff08\u6682\u672a\u652f\u6301\uff0c\u656c\u8bf7\u671f\u5f85\uff09","title":"\u7f16\u5199\u6a21\u5757"},{"location":"guide/write-module/#_1","text":"\u5230\u73b0\u5728\u4e3a\u6b62\uff0c\u6211\u4eec\u8fd8\u5728\u4f7f\u7528\u6846\u67b6\u7684\u9ed8\u8ba4\u6a21\u5757 Example/Hello.php \uff0c\u5728\u5f00\u59cb\u7f16\u5199\u81ea\u5df1\u7684\u6a21\u5757\u5e94\u7528\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u8bf4\u660e\u4e00\u4e9b\u7f16\u5199\u4ee3\u7801\u7684\u7ea6\u5b9a\u3002","title":"\u7f16\u5199\u6a21\u5757"},{"location":"guide/write-module/#_2","text":"\u6846\u67b6\u9ed8\u8ba4\u4f7f\u7528\u811a\u624b\u67b6\u6784\u5efa\u597d\u540e\uff0c\u76ee\u5f55\u7ed3\u6784\u5927\u81f4\u4e3a\u4e0b\u9762\u8fd9\u6837\uff1a 1 2 3 4 5 6 7 8 9 zhamao-framework-starter/ \u251c\u2500\u2500 config/ # \u9879\u76ee\u7684\u914d\u7f6e\u6587\u4ef6\u6587\u4ef6\u5939\uff0c\u5982 global.php \u251c\u2500\u2500 src/ # \u9879\u76ee\u7684\u4e3b\u8981\u6e90\u7801\u76ee\u5f55 \u2502 \u251c\u2500\u2500 Module/ # \u7528\u6237\u7f16\u5199\u7684\u6a21\u5757\u76ee\u5f55 \u2502 \u2502 \u2514\u2500\u2500 Example/ # \u6a21\u5757\u6587\u4ef6\u5939\u540d\u79f0 \u2502 \u2502 \u2514\u2500\u2500 Hello.php # \u6a21\u5757\u5185\u7684\u7c7b \u2502 \u2514\u2500\u2500 Custom/ # \u7528\u6237\u81ea\u5b9a\u4e49\u7684\u5168\u5c40\u65b9\u6cd5\u3001\u5168\u5c40\u6ce8\u89e3\u7c7b\u7b49\u5b58\u653e\u7684\u76ee\u5f55 \u251c\u2500\u2500 vendor/ # Composer \u4f9d\u8d56\u52a0\u8f7d\u76ee\u5f55 \u2514\u2500\u2500 composer.json # Composer \u914d\u7f6e\u6587\u4ef6 \u5176\u4e2d\u6211\u4eec\u811a\u624b\u67b6\u5305\u542b\u7684\u9ed8\u8ba4\u6a21\u5757 Example \u4e0b\u7684 Hello \u7c7b\uff0c\u5c31\u662f\u7528\u6237\u5199\u6a21\u5757\u7684\u4f4d\u7f6e\u3002\u4f60\u4e5f\u53ef\u4ee5\u6839\u636e\u5b9e\u9645\u60c5\u51b5\uff0c\u81ea\u884c\u6dfb\u52a0\u66f4\u591a\u7684\u6a21\u5757\u6587\u4ef6\u5939\u751a\u81f3\u5355\u6587\u4ef6\u6a21\u5757\u3002 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u6240\u6709\u6587\u4ef6\u5939\u540d\u79f0\u548c .php \u6587\u4ef6\u5fc5\u987b\u9075\u5faa psr-4 \u89c4\u8303 \uff0c\u7b80\u5355\u6765\u8bf4\uff0c src/ \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5939\uff0c\u5b50\u6587\u4ef6\u5939\u8981\u5199\u6210\u547d\u540d\u7a7a\u95f4\uff0c\u6bd4\u5982\u9ed8\u8ba4\u6846\u67b6\u4e2d Example/ \u4e0b\u7684 .php \u6587\u4ef6\u7684\u547d\u540d\u7a7a\u95f4\u4e3a namespace Module\\Example; \uff0c\u4e14\u4e00\u4e2a .php \u6587\u4ef6\u63a8\u8350\u53ea\u5305\u542b\u4e00\u4e2a class \u3001 trait \u6216 interface \u3002 1 2 3 <?php namespace Module\\ < your - module - dir > ; class ModuleA {} \u8b66\u544a \u5982\u679c\u6ca1\u6709\u9075\u5b88\u4e0a\u65b9\u7684\u7c7b\u548c\u6587\u4ef6\u547d\u540d\u89c4\u5219\u7684\u8bdd\uff08\u6587\u4ef6\u540d\u3001\u6587\u4ef6\u5939\u540d\u548c\u547d\u540d\u7a7a\u95f4\u7684\u7edf\u4e00\u6027\uff09\uff0c\u5728\u52a0\u8f7d\u6846\u67b6\u65f6\u5c31\u4f1a\u62a5\u9519\uff0c\u65e0\u6cd5\u627e\u5230\u5bf9\u5e94\u7684\u7c7b\u3002\u56e0\u4e3a\u6846\u67b6\u7684\u6ce8\u89e3\u89e3\u6790\u4f9d\u8d56\u4e8e Composer \u4e2d psr-4 \u89c4\u5219\u7684\u81ea\u52a8\u52a0\u8f7d\u3002","title":"\u52a0\u8f7d\u6a21\u5757"},{"location":"guide/write-module/#_3","text":"","title":"\u521b\u5efa\u6a21\u5757"},{"location":"guide/write-module/#_4","text":"\u6211\u4eec\u8fd9\u91cc\u4ee5 Entertain \u5a31\u4e50\u6a21\u5757\u7684\u521b\u5efa\u4e3a\u4f8b\uff0c\u65b0\u5efa\u4e00\u4e2a\u5185\u6709 Dice.php \u63b7\u9ab0\u5b50\u529f\u80fd\u7684\u6a21\u5757\uff0c\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff0c\u5728 Module/ \u4e0b\u65b0\u5efa\u6587\u4ef6\u5939 Entertain/ \uff0c\u518d\u5728\u6b64\u5b50\u76ee\u5f55\u4e0b\u65b0\u5efa Dice.php \u6587\u4ef6\u3002 1 2 3 4 5 zhamao-framework-starter/ \u2514\u2500\u2500 src/ \u2514\u2500\u2500 Module/ \u2514\u2500\u2500 Entertain/ \u2514\u2500\u2500 Dice.php \u65b0\u5efa\u7684 PHP \u6587\u4ef6\u6309\u7167\u5982\u4e0b\u65b9\u5f0f\u7f16\u5199\uff1a 1 2 3 4 <?php namespace Module\\Entertain ; class Dice { } \u8fd9\u4e2a\u65f6\u5019\u5b83\u5df2\u7ecf\u53ef\u4ee5\u88ab\u79f0\u4e3a\u4e00\u4e2a\u6a21\u5757\u4e86\uff0c\u5c3d\u7ba1\u5b83\u8fd8\u4ec0\u4e48\u90fd\u6ca1\u505a\u3002","title":"\u6807\u51c6\u5f62\u5f0f"},{"location":"guide/write-module/#_5","text":"\u5982\u679c\u4f60\u53ea\u5f00\u53d1\u5f88\u7b80\u5355\u7684\u4e00\u4e9b\u529f\u80fd\uff0c\u5982\u4e00\u4e2a PHP \u6587\u4ef6\u5c31\u53ef\u4ee5\u5b9e\u73b0\u7684\uff0c\u53ef\u4ee5\u5c11\u53bb\u521b\u5efa\u6a21\u5757\u6587\u4ef6\u5939\u7684\u4e00\u6b65\uff0c\u76f4\u63a5\u5c06 .php \u6587\u4ef6\u65b0\u5efa\u5230 Module/ \u6587\u4ef6\u5939\u4e0b\uff0c\u8fd9\u65f6\u6b64\u6587\u4ef6\u7684\u547d\u540d\u7a7a\u95f4\u9700\u8981\u66f4\u6b63\u4e3a namespace Module; \u5373\u53ef\uff0c\u800c\u6587\u4ef6\u5939\u7ed3\u6784\u4e5f\u66f4\u52a0\u7b80\u5355\uff1a 1 2 3 4 zhamao-framework-starter/ \u2514\u2500\u2500 src/ \u2514\u2500\u2500 Module/ \u2514\u2500\u2500 Dice.php","title":"\u5355\u6587\u4ef6\u5f62\u5f0f"},{"location":"guide/write-module/#composer","text":"\uff08\u6682\u672a\u652f\u6301\uff0c\u656c\u8bf7\u671f\u5f85\uff09","title":"Composer \u5916\u90e8\u5f15\u5165\u5f62\u5f0f"},{"location":"update/config/","text":"\u914d\u7f6e\u6587\u4ef6\u53d8\u66f4\u8bb0\u5f55 \u8fd9\u91cc\u5c06\u4f1a\u8bb0\u5f55\u5404\u4e2a\u4e3b\u7248\u672c\u7684\u6846\u67b6\u5347\u7ea7\u540e\uff0c\u6d89\u53ca global.php \u7684\u66f4\u65b0\u65e5\u5fd7\uff0c\u4f60\u53ef\u4ee5\u6839\u636e\u8fd9\u91cc\u63cf\u8ff0\u7684\u5185\u5bb9\u4e0e\u4f60\u7684\u65e7\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\u3002 v2.5.0 (build 413) \u65b0\u589e $config['runtime'] \u8fd0\u884c\u65f6\u8bbe\u7f6e\u3002 \u5220\u9664 $config['server_event_handler_class'] \uff0c\u9ed8\u8ba4\u5728\u542f\u52a8\u65f6\u5168\u5c40\u626b\u63cf\u3002 \u65b0\u589e $config['module_loader'] \u6a21\u5757/\u63d2\u4ef6 \u6253\u5305\u914d\u7f6e\u9009\u9879\u3002 \u65b0\u589e $config['mysql_config'] \uff0c\u53d6\u4ee3\u539f\u5148\u7684 $config['sql_config'] \uff0c\u6b64\u5916\u5e9f\u5f03\u539f\u5148\u7684MySQL \u67e5\u8be2\u5668 \\ZM\\DB\\DB \u7c7b\u3002 \u66f4\u65b0\u90e8\u5206\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 /** \u4e00\u4e9b\u6846\u67b6\u4e0eSwoole\u8fd0\u884c\u65f6\u8bbe\u7f6e\u7684\u8c03\u6574 */ $config['runtime'] = [ 'swoole_coroutine_hook_flags' => SWOOLE_HOOK_ALL & (~SWOOLE_HOOK_CURL), 'swoole_server_mode' => SWOOLE_PROCESS ]; /** MySQL\u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f\uff0chost\u7559\u7a7a\u5219\u542f\u52a8\u65f6\u4e0d\u521b\u5efasql\u8fde\u63a5\u6c60 */ $config['mysql_config'] = [ 'host' => '', 'port' => 3306, 'unix_socket' => null, 'username' => 'root', 'password' => '123456', 'dbname' => 'adb', 'charset' => 'utf8mb4', 'pool_size' => 64, 'options' => [ PDO::ATTR_STRINGIFY_FETCHES => false, PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC ] ]; /** \u6ce8\u518c Swoole Server \u4e8b\u4ef6\u6ce8\u89e3\u7684\u7c7b\u5217\u8868(deleted) */ // \u5220\u9664 v2.4.0 (build 400) \u8c03\u6574 $config['modules']['onebot'] \u914d\u7f6e\u9879\u5230 $config['onebot'] \uff0c\u65e7\u7248\u672c\u7684\u6b64\u6bb5\u4f1a\u5411\u4e0b\u517c\u5bb9\uff0c\u5efa\u8bae\u66f4\u65b0\uff0c \u65b0\u589e $config['remote_terminal'] \u8fdc\u7a0b\u7ec8\u7aef\u7684\u914d\u7f6e\u9879\uff0c\u65b0\u589e\u6b64\u6bb5\u5373\u53ef\u3002 \u66f4\u65b0\u90e8\u5206\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 /** \u673a\u5668\u4eba\u89e3\u6790\u6a21\u5757\uff0c\u5173\u95ed\u540e\u65e0\u6cd5\u4f7f\u7528\u5982CQCommand\u7b49\u6ce8\u89e3(\u4e0a\u9762\u7684modules\u5373\u5c06\u5e9f\u5f03) */ $config['onebot'] = [ 'status' => true, 'single_bot_mode' => false, 'message_level' => 99999 ]; /** \u4e00\u4e2a\u8fdc\u7a0b\u7b80\u6613\u7ec8\u7aef\uff0c\u4f7f\u7528nc\u76f4\u63a5\u8fde\u63a5\u5373\u53ef\uff0c\u4f46\u662f\u4e0d\u5efa\u8bae\u5f00\u653ehost\u4e3a0.0.0.0(\u8fdc\u7a0b\u8fde\u63a5) */ $config['remote_terminal'] = [ 'status' => false, 'host' => '127.0.0.1', 'port' => 20002, 'token' => '' ];","title":"\u914d\u7f6e\u6587\u4ef6\u66f4\u65b0\u65e5\u5fd7"},{"location":"update/config/#_1","text":"\u8fd9\u91cc\u5c06\u4f1a\u8bb0\u5f55\u5404\u4e2a\u4e3b\u7248\u672c\u7684\u6846\u67b6\u5347\u7ea7\u540e\uff0c\u6d89\u53ca global.php \u7684\u66f4\u65b0\u65e5\u5fd7\uff0c\u4f60\u53ef\u4ee5\u6839\u636e\u8fd9\u91cc\u63cf\u8ff0\u7684\u5185\u5bb9\u4e0e\u4f60\u7684\u65e7\u914d\u7f6e\u6587\u4ef6\u8fdb\u884c\u5408\u5e76\u3002","title":"\u914d\u7f6e\u6587\u4ef6\u53d8\u66f4\u8bb0\u5f55"},{"location":"update/config/#v250-build-413","text":"\u65b0\u589e $config['runtime'] \u8fd0\u884c\u65f6\u8bbe\u7f6e\u3002 \u5220\u9664 $config['server_event_handler_class'] \uff0c\u9ed8\u8ba4\u5728\u542f\u52a8\u65f6\u5168\u5c40\u626b\u63cf\u3002 \u65b0\u589e $config['module_loader'] \u6a21\u5757/\u63d2\u4ef6 \u6253\u5305\u914d\u7f6e\u9009\u9879\u3002 \u65b0\u589e $config['mysql_config'] \uff0c\u53d6\u4ee3\u539f\u5148\u7684 $config['sql_config'] \uff0c\u6b64\u5916\u5e9f\u5f03\u539f\u5148\u7684MySQL \u67e5\u8be2\u5668 \\ZM\\DB\\DB \u7c7b\u3002 \u66f4\u65b0\u90e8\u5206\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 /** \u4e00\u4e9b\u6846\u67b6\u4e0eSwoole\u8fd0\u884c\u65f6\u8bbe\u7f6e\u7684\u8c03\u6574 */ $config['runtime'] = [ 'swoole_coroutine_hook_flags' => SWOOLE_HOOK_ALL & (~SWOOLE_HOOK_CURL), 'swoole_server_mode' => SWOOLE_PROCESS ]; /** MySQL\u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f\uff0chost\u7559\u7a7a\u5219\u542f\u52a8\u65f6\u4e0d\u521b\u5efasql\u8fde\u63a5\u6c60 */ $config['mysql_config'] = [ 'host' => '', 'port' => 3306, 'unix_socket' => null, 'username' => 'root', 'password' => '123456', 'dbname' => 'adb', 'charset' => 'utf8mb4', 'pool_size' => 64, 'options' => [ PDO::ATTR_STRINGIFY_FETCHES => false, PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC ] ]; /** \u6ce8\u518c Swoole Server \u4e8b\u4ef6\u6ce8\u89e3\u7684\u7c7b\u5217\u8868(deleted) */ // \u5220\u9664","title":"v2.5.0 (build 413)"},{"location":"update/config/#v240-build-400","text":"\u8c03\u6574 $config['modules']['onebot'] \u914d\u7f6e\u9879\u5230 $config['onebot'] \uff0c\u65e7\u7248\u672c\u7684\u6b64\u6bb5\u4f1a\u5411\u4e0b\u517c\u5bb9\uff0c\u5efa\u8bae\u66f4\u65b0\uff0c \u65b0\u589e $config['remote_terminal'] \u8fdc\u7a0b\u7ec8\u7aef\u7684\u914d\u7f6e\u9879\uff0c\u65b0\u589e\u6b64\u6bb5\u5373\u53ef\u3002 \u66f4\u65b0\u90e8\u5206\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 /** \u673a\u5668\u4eba\u89e3\u6790\u6a21\u5757\uff0c\u5173\u95ed\u540e\u65e0\u6cd5\u4f7f\u7528\u5982CQCommand\u7b49\u6ce8\u89e3(\u4e0a\u9762\u7684modules\u5373\u5c06\u5e9f\u5f03) */ $config['onebot'] = [ 'status' => true, 'single_bot_mode' => false, 'message_level' => 99999 ]; /** \u4e00\u4e2a\u8fdc\u7a0b\u7b80\u6613\u7ec8\u7aef\uff0c\u4f7f\u7528nc\u76f4\u63a5\u8fde\u63a5\u5373\u53ef\uff0c\u4f46\u662f\u4e0d\u5efa\u8bae\u5f00\u653ehost\u4e3a0.0.0.0(\u8fdc\u7a0b\u8fde\u63a5) */ $config['remote_terminal'] = [ 'status' => false, 'host' => '127.0.0.1', 'port' => 20002, 'token' => '' ];","title":"v2.4.0 (build 400)"},{"location":"update/v1/","text":"\u66f4\u65b0\u65e5\u5fd7\uff08v1 \u7248\u672c\uff09 v1.6.5 \u66f4\u65b0\u65f6\u95f4\uff1a2020.12.9 \u4fee\u590d\uff1a\u7248\u672c\u53f7\u663e\u793a \u4f18\u5316\uff1a\u4f9d\u8d56\u95ee\u9898\uff0c\u51cf\u5c11\u5bf9 PHP \u6269\u5c55\u7684\u4f9d\u8d56\uff0c\u8f6c\u53d8\u4e3a\u53ef\u9009 v1.6.4 \u66f4\u65b0\u65f6\u95f4\uff1a2020.12.9 \u4fee\u590d\uff1acomposer require\u6a21\u5f0f\u4e0b\u81ea\u52a8\u52a0\u8f7d\u7684\u95ee\u9898 \u4f18\u5316\uff1a\u51cf\u5c11\u4e0d\u662f\u5fc5\u9700\u7684\u4f9d\u8d56\u95ee\u9898 v1.6.3 \u66f4\u65b0\u65f6\u95f4\uff1a2020.11.15 \u4fee\u590d\uff1aResponse \u5bf9\u8c61\u4f7f\u7528 redirect \u9020\u6210\u7684\u9012\u5f52\u62a5\u9519 \u4fee\u590d\uff1a document_index \u914d\u7f6e\u9879\u5728 / \u8def\u5f84\u4e0b\u65e0\u6cd5\u4f7f\u7528\u7684 bug v1.6.2 \u66f4\u65b0\u65f6\u95f4\uff1a2020.7.27 \u4fee\u590d\uff1a\u4e0d\u5199\u914d\u7f6e server_event_handler_class \u9879\u65e0\u6cd5\u542f\u52a8\u7684 bug v1.6.1 \u66f4\u65b0\u65f6\u95f4\uff1a2020.7.26 \u65b0\u589e\uff1a ZMRequest::downloadFile($url, $dst) \u65b9\u6cd5\uff0c\u53ef\u76f4\u63a5\u5c06\u6587\u4ef6\u4e0b\u8f7d\u5230\u672c\u5730 v1.6 \u66f4\u65b0\u65f6\u95f4\uff1a2020.7.14 \u65b0\u589e\uff1a\u73b0\u5728\u53ef\u4ee5\u5bf9\u7c7b\u4fee\u9970\u81ea\u5b9a\u4e49\u7684\u6ce8\u89e3\u4e86 \u4fee\u590d\uff1a\u6570\u636e\u5e93\u64cd\u4f5c where \u5bf9\u8c61\u65f6\u4ea7\u751f\u7684\u6b67\u4e49 \u65b0\u589e\uff1a\u652f\u6301\u81ea\u5b9a\u4e49\u4efb\u4f55 Swoole Server \u4e8b\u4ef6\u7684\u6ce8\u89e3\u7ed1\u5b9a\uff0c\u8be6\u89c1\u6587\u6863 \u4fee\u590d\uff1a\u591a\u4e2a\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u5bf9\u7c7b\u53ea\u751f\u6548\u6700\u540e\u4e00\u4e2a\u7684 bug \u2757 \u4e0b\u9762\u662f\u6846\u67b6\u5347\u7ea7\u9700\u8981\u624b\u52a8\u8fdb\u884c\u7684\u53d8\u66f4\uff1a \u65b0\u7248\u672c\u7531\u4e8e\u5f15\u8fdb\u4e86\u81ea\u5b9a\u4e49 Swoole Server \u4e8b\u4ef6\u7684\u673a\u5236\uff0c\u5bf9 global.php \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u6709\u4e86\u53d8\u52a8\uff0c\u9700\u8981\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\u624d\u80fd\u6b63\u5e38\u542f\u52a8\uff08\u65e7\u7248\u672c\u5347\u7ea7\u65b0\u7248\u672c\u7528\u6237\uff0c\u65b0\u7528\u6237\u65e0\u9700\u64cd\u4f5c\uff09\uff1a 1 2 3 4 /** \u6ce8\u518c Swoole Server \u4e8b\u4ef6\u6ce8\u89e3\u7684\u7c7b\u5217\u8868 */ $config['server_event_handler_class'] = [ \\Framework\\ServerEventHandler::class, //\u9ed8\u8ba4\u4e0d\u53ef\u5220\u9664\uff0c\u5426\u5219\u4f1a\u4e0d\u80fd\u4f7f\u7528\u6846\u67b6 ]; v1.5.8 \u66f4\u65b0\u65f6\u95f4\uff1a2020.6.26 \u65b0\u589e\uff1a @CQCommand \u6ce8\u89e3\u7684 fullMatch \u53c2\u6570\uff08\u5168\u91cf\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\uff09 v1.5.7 \u66f4\u65b0\u65f6\u95f4\uff1a2020.6.20 \u65b0\u589e\uff1aZM_BREAKPOINT \u7684\u77ed\u540d\u79f0\uff1aBP \u4f18\u5316\uff1a\u7ec8\u7aef\u8fde\u63a5\u5668\u81ea\u52a8\u91cd\u8fde \u4fee\u590d\uff1a\u8bed\u6cd5\u9519\u8bef\u65f6\u9632\u6b62\u5faa\u73af\u62a5\u9519 v1.5.6 \u66f4\u65b0\u65f6\u95f4\uff1a2020.6.15 \u65b0\u589e\uff1a @CQCommand \u6ce8\u89e3\u652f\u6301 message_type \uff0c user_id \uff0c group_id \uff0c discuss_id \u9650\u5b9a\u6761\u4ef6 \u65b0\u589e\uff1aPDO \u6570\u636e\u5e93\u652f\u6301\u81ea\u5b9a\u4e49 fetch_mode\uff0c\u53ef\u5728 global.php \u4e2d\u7684 sql_config[\"sql_default_fetch_mode\"] \u5b57\u6bb5\u8bbe\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u8c03\u7528\u65f6 DB::rawQuery(\"\u8bed\u53e5\", [], PDO::FETCH_ASSOC); \u7b2c\u4e09\u4e2a\u53c2\u6570\u53ef\u9009 \ud83d\udd34 \u5e9f\u5f03\uff1a ModBase \u57fa\u7c7b\uff0c\u57fa\u7c7b\u7ee7\u627f\u673a\u5236\u5c06\u5728 1.6 \u7248\u672c\u8d77\u5b8c\u5168\u5220\u9664 v1.5.5 \u66f4\u65b0\u65f6\u95f4\uff1a2020.6.13 \u4fee\u590d\uff1a @SwooleEventAt(\"close\") \u4e0b\u4e0d\u80fd\u4f7f\u7528 ctx()->getConnection() \u83b7\u53d6\u94fe\u63a5\u5bf9\u8c61\u7684 bug \u65b0\u589e\uff1ainit \u547d\u4ee4\uff0c\u53ef\u5728 composer require zhamao/framework \u540e\u4f7f\u7528 vendor/bin/start init \u521d\u59cb\u5316\u9879\u76ee\u76ee\u5f55\u7ed3\u6784\u548c\u914d\u7f6e\u6587\u4ef6 \u66f4\u65b0\uff1a\u9ed8\u8ba4\u6a21\u5757\u65b0\u589e\u673a\u5668\u4eba\u65ad\u5f00\u8fde\u63a5\u7684\u56de\u8c03\u4e8b\u4ef6 v1.5.4 \u66f4\u65b0\u65f6\u95f4\uff1a2020.6.13 \u65b0\u589e\uff1a @CQCommand \u4e0b\u652f\u6301 alias \u53c2\u6570 \u66f4\u65b0\uff1a\u5c06 autoload \u53d8\u4e3a composer autoload\uff08\u9700\u8981\u91cd\u65b0 composer update\uff09 v1.5.3 \u66f4\u65b0\u65f6\u95f4\uff1a2020.6.10 \u4fee\u590d\uff1a\u5728 Linux \u7cfb\u7edf\u4e0b Terminal \u65e0\u6cd5\u6b63\u5e38\u4f7f\u7528\u7684 bug v1.5.2 \u66f4\u65b0\u65f6\u95f4\uff1a2020.6.8 \u65b0\u589e\uff1a ZM_VERSION \u5e38\u91cf\uff0c\u5bf9\u5e94\u4e3a\u5f53\u524d\u6846\u67b6\u7248\u672c \u4fee\u590d\uff1a\u90e8\u5206\u94fe\u63a5\u4e0d\u5e26 / \u4f1a\u5bfc\u81f4 ZMRequest \u6a21\u5757\u62a5\u9519\u7684 bug v1.5.1 \u66f4\u65b0\u65f6\u95f4\uff1a2020.6.5 \u65b0\u589e\uff1aZMRequest::request() \u81ea\u5b9a\u4e49\u6784\u5efa HTTP \u8bf7\u6c42\u65b9\u6cd5 \u4fee\u590d\uff1a\u4e00\u4e2a\u4e0d\u4f1a\u5bfc\u81f4\u5d29\u6e83\u7684 warning \u63d0\u793a v1.5 \u66f4\u65b0\u65f6\u95f4\uff1a2020.6.5 \u91cd\u8981\u53d8\u66f4\uff1a\u652f\u6301\u4ece composer \u4f7f\u7528\u6846\u67b6 \u65b0\u589e\uff1a\u6570\u636e\u5e93 Select \u9009\u62e9\u5668\u652f\u6301 count() \u65b9\u6cd5 \u4fee\u590d\uff1aZMRequest \u4e2d https \u548c\u7aef\u53e3\u7684\u6307\u5b9a\u987a\u5e8f\u95ee\u9898 \u65b0\u589e\uff1aZMWebSocket \u521b\u5efa WS \u94fe\u63a5\u7684\u8f7b\u91cf\u7ea7\u5ba2\u6237\u7aef \u4fee\u590d\uff1a\u6570\u636e\u5e93\u5f02\u5e38\u7684\u6355\u83b7\u66f4\u6539\u4e3a PDOException v1.4 \u66f4\u65b0\u65f6\u95f4\uff1a2020.5.23 \u65b0\u589e\uff1a\u81ea\u5b9a\u4e49 motd \u65b0\u589e\uff1adebug_mode \u4e0b\u65ad\u70b9\u8c03\u8bd5\u529f\u80fd \u65b0\u589e\uff1a @OnSave \u6ce8\u89e3\uff0c\u50a8\u5b58\u81ea\u52a8\u4fdd\u5b58\u7684\u53d8\u91cf\u65f6\u4e8b\u4ef6\u6fc0\u6d3b \u65b0\u589e\uff1aSwoole \u7248\u672c\u68c0\u6d4b \u65b0\u589e\uff1a\u5168\u5c40\u51fd\u6570\uff0c\u4ee5 zm_ \u5f00\u5934\u7684\uff0c\u8be6\u60c5\u89c1\u6587\u6863 \u65b0\u589e\uff1a @LoadBuffer \u6ce8\u89e3\uff0c\u53ea\u52a0\u8f7d\u5185\u5b58\u4e0d\u81ea\u52a8\u4fdd\u5b58\u7684\u53d8\u91cf \u65b0\u589e\uff1a\u5c40\u90e8\u9759\u6001\u6587\u4ef6\u670d\u52a1 \u65b0\u589e\uff1amysqlnd \u6269\u5c55\u72b6\u6001\u68c0\u6d4b \u66f4\u65b0\uff1a\u5c06\u7ec8\u7aef\u8f93\u5165\u66f4\u6362\u4e3a\u591a\u8fdb\u7a0b \u66f4\u65b0\uff1a\u5c06\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u53d8\u66f4\u4e3a Swoole \u5b98\u65b9\u7684\u8fde\u63a5\u6c60\uff0c\u9700\u8981 Swoole \u7248\u672c >= 4.4.13 \u66f4\u65b0\uff1a\u63d0\u5347\u6ce8\u89e3\u7ed1\u5b9a\u7684\u4e8b\u4ef6\u51fd\u6570\u7684\u6267\u884c\u6548\u7387 \u4fee\u590d\uff1a\u4e0a\u4e0b\u6587 getConnection() \u7684 fd \u65e0\u6cd5\u83b7\u53d6\u7684 bug \u4fee\u590d\uff1aMySQL \u957f\u94fe\u63a5 gone away \u81ea\u52a8\u91cd\u8fde\u7684\u95ee\u9898 \u4fee\u590d\uff1aMySQL \u67e5\u8be2\u6784\u9020\u5668\u65e0 WHERE \u8bed\u53e5\u65f6\u4f1a\u9020\u6210\u7684 bug \u4fee\u590d\uff1a\u8c03\u6574\u5404\u9879\u8d44\u6e90\u521d\u59cb\u5316\u524d\u540e\u987a\u5e8f \u4e0d\u53ef\u9006\u4fee\u6539\uff1a\u4f60\u9700\u8981\u91cd\u65b0\u6267\u884c\u4e00\u6b21 composer update \u6216\u91cd\u65b0\u62c9\u53d6\u4e00\u6b21 Docker Image\uff0c\u56e0\u4e3a composer \u4f9d\u8d56\u53d1\u751f\u4e86\u53d8\u5316\u3002 v1.3.1 \u66f4\u65b0\u65f6\u95f4\uff1a2020.5.10 \u4fee\u590d\uff1aDataProvider \u4e0b setJsonData \u65b0\u5efa\u6587\u4ef6\u5939\u7684\u95ee\u9898 \u4f18\u5316\uff1a\u9ed8\u8ba4 / \u9875\u9762\u663e\u793a Hello Zhamao! \u6587\u5b57 \u4f18\u5316\uff1aException \u548c Fatal error \u62a5\u9519\u673a\u5236\u7684\u6539\u8fdb \u4fee\u590d\uff1a\u8ba1\u65f6\u5668\u6ca1\u6709\u4e0a\u4e0b\u6587\u73af\u5883\uff0c\u53d1\u4e0d\u4e86 API \u7684 bug \u2757 \u4e0b\u9762\u662f\u6846\u67b6\u5347\u7ea7\u9700\u8981\u624b\u52a8\u8fdb\u884c\u7684\u53d8\u66f4\uff1a \u66f4\u6539 MySQL \u5ba2\u6237\u7aef\u4e3a\u539f\u751f PDO mysqlnd\uff0c\u5982\u679c\u4e4b\u524d\u4f7f\u7528 Docker \u542f\u52a8\uff0c\u5219\u9700\u4f7f\u7528\u65b0\u7684 Dockerfile \u6784\u5efa\u3002\u5982\u679c\u5b89\u88c5\u5728\u672c\u673a\uff0c\u9700\u5b89\u88c5 php-mysql \u6269\u5c55\u3002\u672c\u6b21\u66f4\u65b0\u4e0d\u5f71\u54cd\u6846\u67b6\u5185\u7684 API\uff0c\u4e0d\u9700\u8981\u66f4\u6539\u4efb\u4f55\u4ee3\u7801\u3002 v1.3.0 \u66f4\u65b0\u65f6\u95f4\uff1a2020.5.8 \u65b0\u589e\uff1a\u4e0a\u4e0b\u6587\uff0c\u5177\u4f53\u66f4\u65b0\u90fd\u5199\u5230\u4e86\u6587\u6863\u91cc\u4e86\uff01 \u4fee\u590d\uff1aZMRobot \u7684 setPrefix() \u7684\u4e25\u91cd\u9519\u8bef \u4f18\u5316\uff1a\u4f18\u5316\u90e8\u5206\u4ee3\u7801 \u6539\u52a8\uff1a\u73b0\u5728\u4f60\u53ef\u4ee5\u548c\u4efb\u610f\u4e8b\u4ef6\u7684\u6ce8\u89e3\u4f7f\u7528\u4efb\u610f\u4e2d\u95f4\u4ef6\u5566\uff0c\u800c\u4e14\u8fd8\u652f\u6301\u591a\u4e2d\u95f4\u4ef6 \u65b0\u589e\uff1aCQHTTP + \u9177Q + \u70b8\u6bdb\u6846\u67b6 \u7684 Dockerfile \u65b0\u589e\u6ce8\u89e3\uff1a @CQAPISend \uff0c @CQAPIResponse \uff0c\u662f API \u8c03\u7528\u540e\u89e6\u53d1\u7684\u4e8b\u4ef6\uff0c\u5177\u4f53\u89c1\u6587\u6863\u8bf4\u660e v1.2.1 \u66f4\u65b0\u65f6\u95f4\uff1a2020.5.2 \u65b0\u589e\uff1aphar \u542f\u52a8\u6a21\u5f0f\u6784\u5efa\u811a\u672c\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u62c9\u53d6 phar \u8fd0\u884c\u6846\u67b6\u4e86\uff01 \u4f18\u5316\uff1a\u4f18\u5316\u90e8\u5206\u4ee3\u7801 v1.2 \u66f4\u65b0\u65f6\u95f4\uff1a2020.4.29 \u65b0\u589e\uff1asystemd \u751f\u6210\u811a\u672c\u3001\u4e00\u952e daemonize \u5b88\u62a4\u8fdb\u7a0b\u65b9\u5f0f\u5e38\u9a7b\u540e\u53f0 \u65b0\u589e\uff1a\u793a\u4f8b\u6a21\u5757\u7684\u6ce8\u91ca \u91cd\u6784\uff1aConsole \u6a21\u5757\uff0c\u73b0\u5728\u6709\u51c6\u786e\u7684\u63a7\u5236\u53f0\u8f93\u51fa\u5206\u7ea7\u529f\u80fd\u4e86 \u65b0\u589e\uff1a @OnTick \u6ce8\u89e3\uff0c\u7528\u4e8e\u7ed1\u5b9a\u5b9a\u65f6\u5668\uff08\u6beb\u79d2\u7ea7\uff09 \u65b0\u589e\uff1a ZMRobot \u7c7b\uff0c\u6bd4\u8c03\u7528 CQAPI \u7c7b\u53d1\u9001 API \u66f4\u65b9\u4fbf\uff0c\u540c\u65f6\u517c\u5bb9\u6700\u65b0\u7248\u672c\u7684 CQHTTP \u63d2\u4ef6 \u4f18\u5316\uff1a\u4f7f\u7528\u952e\u76d8\u4e2d\u65ad Ctrl+C \uff0c\u4e0d\u4f1a\u4e22\u5931\u672a\u4fdd\u5b58\u7684\u7f13\u5b58\u6570\u636e\u4e86 \u4f18\u5316\uff1a\u5b8c\u5584\u4e0a\u4e0b\u6587\u5bf9\u8c61\u7684\u65b9\u6cd5 \u65b0\u589e\uff1a\u7ec8\u7aef\u547d\u4ee4\uff1a logtest \uff0c\u6d4b\u8bd5\u8f93\u51fa\u7684 log \u7c7b\u578b :exclamation:\u4e0b\u9762\u662f\u6846\u67b6\u6a21\u5757\u5f00\u53d1\u4e2d\u9700\u8981\u6ce8\u610f\u7684\u6216\u6709\u4e0d\u517c\u5bb9\u7684\u4fee\u6539\u5185\u5bb9\uff1a \u4fee\u6539\uff1a global.php \u4e2d\u539f\u6765\u7684 info_level \u9ed8\u8ba4\u6570\u503c\u9700\u8981\u6539\u4e3a 2 \uff0c\u4fdd\u8bc1\u7ec8\u7aef\u8f93\u51fa\u548c\u539f\u6765\u4e00\u81f4 v1.1.2 \u66f4\u65b0\u65f6\u95f4\uff1a2020.4.26 \u65b0\u589e\uff1a\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668 \u4fee\u590d\uff1a / \u8def\u5f84\u7684 Mapping \u65e0\u6cd5\u6b63\u5e38\u7ed1\u5b9a\u7684 bug v1.1.1 \u66f4\u65b0\u65f6\u95f4\uff1a2020.4.26 \u65b0\u589e\uff1a\u4e2d\u95f4\u4ef6\u5bf9\u7c7b\u7684\u4fee\u9970 \u65b0\u589e\uff1a\u4e0a\u4e0b\u6587\u5bf9\u8c61\u5bf9 IDE \u7684\u652f\u6301 \u4fee\u590d\uff1a\u6570\u636e\u5e93\u63d2\u5165\u67e5\u8be2\u7684\u611a\u8822\u9519\u8bef \u4fee\u590d\uff1a\u6570\u636e\u5e93\u67e5\u8be2\u7684 value() \u4e0d\u652f\u6301\u6307\u5b9a\u53c2\u6570\u7684 bug v1.1.0 \u66f4\u65b0\u65f6\u95f4\uff1a2020.3.29 \u65b0\u589e\uff1a\u4e2d\u95f4\u4ef6 @Middleware \u529f\u80fd \u4fee\u590d\uff1aWebsocket \u94fe\u63a5\u5173\u95ed\u540e\u672a\u81ea\u52a8\u5220\u9664\u8fde\u63a5\u5bf9\u8c61\u7684bug v1.0.0 \u66f4\u65b0\u65f6\u95f4\uff1a2020.3.19 \u6b63\u5f0f\u7248\u53d1\u5e03\u3002","title":"\u66f4\u65b0\u65e5\u5fd7\uff08v1\uff09"},{"location":"update/v1/#v1","text":"","title":"\u66f4\u65b0\u65e5\u5fd7\uff08v1 \u7248\u672c\uff09"},{"location":"update/v1/#v165","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.12.9 \u4fee\u590d\uff1a\u7248\u672c\u53f7\u663e\u793a \u4f18\u5316\uff1a\u4f9d\u8d56\u95ee\u9898\uff0c\u51cf\u5c11\u5bf9 PHP \u6269\u5c55\u7684\u4f9d\u8d56\uff0c\u8f6c\u53d8\u4e3a\u53ef\u9009","title":"v1.6.5"},{"location":"update/v1/#v164","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.12.9 \u4fee\u590d\uff1acomposer require\u6a21\u5f0f\u4e0b\u81ea\u52a8\u52a0\u8f7d\u7684\u95ee\u9898 \u4f18\u5316\uff1a\u51cf\u5c11\u4e0d\u662f\u5fc5\u9700\u7684\u4f9d\u8d56\u95ee\u9898","title":"v1.6.4"},{"location":"update/v1/#v163","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.11.15 \u4fee\u590d\uff1aResponse \u5bf9\u8c61\u4f7f\u7528 redirect \u9020\u6210\u7684\u9012\u5f52\u62a5\u9519 \u4fee\u590d\uff1a document_index \u914d\u7f6e\u9879\u5728 / \u8def\u5f84\u4e0b\u65e0\u6cd5\u4f7f\u7528\u7684 bug","title":"v1.6.3"},{"location":"update/v1/#v162","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.7.27 \u4fee\u590d\uff1a\u4e0d\u5199\u914d\u7f6e server_event_handler_class \u9879\u65e0\u6cd5\u542f\u52a8\u7684 bug","title":"v1.6.2"},{"location":"update/v1/#v161","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.7.26 \u65b0\u589e\uff1a ZMRequest::downloadFile($url, $dst) \u65b9\u6cd5\uff0c\u53ef\u76f4\u63a5\u5c06\u6587\u4ef6\u4e0b\u8f7d\u5230\u672c\u5730","title":"v1.6.1"},{"location":"update/v1/#v16","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.7.14 \u65b0\u589e\uff1a\u73b0\u5728\u53ef\u4ee5\u5bf9\u7c7b\u4fee\u9970\u81ea\u5b9a\u4e49\u7684\u6ce8\u89e3\u4e86 \u4fee\u590d\uff1a\u6570\u636e\u5e93\u64cd\u4f5c where \u5bf9\u8c61\u65f6\u4ea7\u751f\u7684\u6b67\u4e49 \u65b0\u589e\uff1a\u652f\u6301\u81ea\u5b9a\u4e49\u4efb\u4f55 Swoole Server \u4e8b\u4ef6\u7684\u6ce8\u89e3\u7ed1\u5b9a\uff0c\u8be6\u89c1\u6587\u6863 \u4fee\u590d\uff1a\u591a\u4e2a\u4e2d\u95f4\u4ef6\u6ce8\u89e3\u5bf9\u7c7b\u53ea\u751f\u6548\u6700\u540e\u4e00\u4e2a\u7684 bug \u2757 \u4e0b\u9762\u662f\u6846\u67b6\u5347\u7ea7\u9700\u8981\u624b\u52a8\u8fdb\u884c\u7684\u53d8\u66f4\uff1a \u65b0\u7248\u672c\u7531\u4e8e\u5f15\u8fdb\u4e86\u81ea\u5b9a\u4e49 Swoole Server \u4e8b\u4ef6\u7684\u673a\u5236\uff0c\u5bf9 global.php \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u6709\u4e86\u53d8\u52a8\uff0c\u9700\u8981\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\u624d\u80fd\u6b63\u5e38\u542f\u52a8\uff08\u65e7\u7248\u672c\u5347\u7ea7\u65b0\u7248\u672c\u7528\u6237\uff0c\u65b0\u7528\u6237\u65e0\u9700\u64cd\u4f5c\uff09\uff1a 1 2 3 4 /** \u6ce8\u518c Swoole Server \u4e8b\u4ef6\u6ce8\u89e3\u7684\u7c7b\u5217\u8868 */ $config['server_event_handler_class'] = [ \\Framework\\ServerEventHandler::class, //\u9ed8\u8ba4\u4e0d\u53ef\u5220\u9664\uff0c\u5426\u5219\u4f1a\u4e0d\u80fd\u4f7f\u7528\u6846\u67b6 ];","title":"v1.6"},{"location":"update/v1/#v158","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.6.26 \u65b0\u589e\uff1a @CQCommand \u6ce8\u89e3\u7684 fullMatch \u53c2\u6570\uff08\u5168\u91cf\u6b63\u5219\u8868\u8fbe\u5f0f\u5339\u914d\uff09","title":"v1.5.8"},{"location":"update/v1/#v157","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.6.20 \u65b0\u589e\uff1aZM_BREAKPOINT \u7684\u77ed\u540d\u79f0\uff1aBP \u4f18\u5316\uff1a\u7ec8\u7aef\u8fde\u63a5\u5668\u81ea\u52a8\u91cd\u8fde \u4fee\u590d\uff1a\u8bed\u6cd5\u9519\u8bef\u65f6\u9632\u6b62\u5faa\u73af\u62a5\u9519","title":"v1.5.7"},{"location":"update/v1/#v156","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.6.15 \u65b0\u589e\uff1a @CQCommand \u6ce8\u89e3\u652f\u6301 message_type \uff0c user_id \uff0c group_id \uff0c discuss_id \u9650\u5b9a\u6761\u4ef6 \u65b0\u589e\uff1aPDO \u6570\u636e\u5e93\u652f\u6301\u81ea\u5b9a\u4e49 fetch_mode\uff0c\u53ef\u5728 global.php \u4e2d\u7684 sql_config[\"sql_default_fetch_mode\"] \u5b57\u6bb5\u8bbe\u7f6e\uff0c\u4e5f\u53ef\u4ee5\u8c03\u7528\u65f6 DB::rawQuery(\"\u8bed\u53e5\", [], PDO::FETCH_ASSOC); \u7b2c\u4e09\u4e2a\u53c2\u6570\u53ef\u9009 \ud83d\udd34 \u5e9f\u5f03\uff1a ModBase \u57fa\u7c7b\uff0c\u57fa\u7c7b\u7ee7\u627f\u673a\u5236\u5c06\u5728 1.6 \u7248\u672c\u8d77\u5b8c\u5168\u5220\u9664","title":"v1.5.6"},{"location":"update/v1/#v155","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.6.13 \u4fee\u590d\uff1a @SwooleEventAt(\"close\") \u4e0b\u4e0d\u80fd\u4f7f\u7528 ctx()->getConnection() \u83b7\u53d6\u94fe\u63a5\u5bf9\u8c61\u7684 bug \u65b0\u589e\uff1ainit \u547d\u4ee4\uff0c\u53ef\u5728 composer require zhamao/framework \u540e\u4f7f\u7528 vendor/bin/start init \u521d\u59cb\u5316\u9879\u76ee\u76ee\u5f55\u7ed3\u6784\u548c\u914d\u7f6e\u6587\u4ef6 \u66f4\u65b0\uff1a\u9ed8\u8ba4\u6a21\u5757\u65b0\u589e\u673a\u5668\u4eba\u65ad\u5f00\u8fde\u63a5\u7684\u56de\u8c03\u4e8b\u4ef6","title":"v1.5.5"},{"location":"update/v1/#v154","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.6.13 \u65b0\u589e\uff1a @CQCommand \u4e0b\u652f\u6301 alias \u53c2\u6570 \u66f4\u65b0\uff1a\u5c06 autoload \u53d8\u4e3a composer autoload\uff08\u9700\u8981\u91cd\u65b0 composer update\uff09","title":"v1.5.4"},{"location":"update/v1/#v153","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.6.10 \u4fee\u590d\uff1a\u5728 Linux \u7cfb\u7edf\u4e0b Terminal \u65e0\u6cd5\u6b63\u5e38\u4f7f\u7528\u7684 bug","title":"v1.5.3"},{"location":"update/v1/#v152","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.6.8 \u65b0\u589e\uff1a ZM_VERSION \u5e38\u91cf\uff0c\u5bf9\u5e94\u4e3a\u5f53\u524d\u6846\u67b6\u7248\u672c \u4fee\u590d\uff1a\u90e8\u5206\u94fe\u63a5\u4e0d\u5e26 / \u4f1a\u5bfc\u81f4 ZMRequest \u6a21\u5757\u62a5\u9519\u7684 bug","title":"v1.5.2"},{"location":"update/v1/#v151","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.6.5 \u65b0\u589e\uff1aZMRequest::request() \u81ea\u5b9a\u4e49\u6784\u5efa HTTP \u8bf7\u6c42\u65b9\u6cd5 \u4fee\u590d\uff1a\u4e00\u4e2a\u4e0d\u4f1a\u5bfc\u81f4\u5d29\u6e83\u7684 warning \u63d0\u793a","title":"v1.5.1"},{"location":"update/v1/#v15","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.6.5 \u91cd\u8981\u53d8\u66f4\uff1a\u652f\u6301\u4ece composer \u4f7f\u7528\u6846\u67b6 \u65b0\u589e\uff1a\u6570\u636e\u5e93 Select \u9009\u62e9\u5668\u652f\u6301 count() \u65b9\u6cd5 \u4fee\u590d\uff1aZMRequest \u4e2d https \u548c\u7aef\u53e3\u7684\u6307\u5b9a\u987a\u5e8f\u95ee\u9898 \u65b0\u589e\uff1aZMWebSocket \u521b\u5efa WS \u94fe\u63a5\u7684\u8f7b\u91cf\u7ea7\u5ba2\u6237\u7aef \u4fee\u590d\uff1a\u6570\u636e\u5e93\u5f02\u5e38\u7684\u6355\u83b7\u66f4\u6539\u4e3a PDOException","title":"v1.5"},{"location":"update/v1/#v14","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.5.23 \u65b0\u589e\uff1a\u81ea\u5b9a\u4e49 motd \u65b0\u589e\uff1adebug_mode \u4e0b\u65ad\u70b9\u8c03\u8bd5\u529f\u80fd \u65b0\u589e\uff1a @OnSave \u6ce8\u89e3\uff0c\u50a8\u5b58\u81ea\u52a8\u4fdd\u5b58\u7684\u53d8\u91cf\u65f6\u4e8b\u4ef6\u6fc0\u6d3b \u65b0\u589e\uff1aSwoole \u7248\u672c\u68c0\u6d4b \u65b0\u589e\uff1a\u5168\u5c40\u51fd\u6570\uff0c\u4ee5 zm_ \u5f00\u5934\u7684\uff0c\u8be6\u60c5\u89c1\u6587\u6863 \u65b0\u589e\uff1a @LoadBuffer \u6ce8\u89e3\uff0c\u53ea\u52a0\u8f7d\u5185\u5b58\u4e0d\u81ea\u52a8\u4fdd\u5b58\u7684\u53d8\u91cf \u65b0\u589e\uff1a\u5c40\u90e8\u9759\u6001\u6587\u4ef6\u670d\u52a1 \u65b0\u589e\uff1amysqlnd \u6269\u5c55\u72b6\u6001\u68c0\u6d4b \u66f4\u65b0\uff1a\u5c06\u7ec8\u7aef\u8f93\u5165\u66f4\u6362\u4e3a\u591a\u8fdb\u7a0b \u66f4\u65b0\uff1a\u5c06\u6570\u636e\u5e93\u8fde\u63a5\u6c60\u53d8\u66f4\u4e3a Swoole \u5b98\u65b9\u7684\u8fde\u63a5\u6c60\uff0c\u9700\u8981 Swoole \u7248\u672c >= 4.4.13 \u66f4\u65b0\uff1a\u63d0\u5347\u6ce8\u89e3\u7ed1\u5b9a\u7684\u4e8b\u4ef6\u51fd\u6570\u7684\u6267\u884c\u6548\u7387 \u4fee\u590d\uff1a\u4e0a\u4e0b\u6587 getConnection() \u7684 fd \u65e0\u6cd5\u83b7\u53d6\u7684 bug \u4fee\u590d\uff1aMySQL \u957f\u94fe\u63a5 gone away \u81ea\u52a8\u91cd\u8fde\u7684\u95ee\u9898 \u4fee\u590d\uff1aMySQL \u67e5\u8be2\u6784\u9020\u5668\u65e0 WHERE \u8bed\u53e5\u65f6\u4f1a\u9020\u6210\u7684 bug \u4fee\u590d\uff1a\u8c03\u6574\u5404\u9879\u8d44\u6e90\u521d\u59cb\u5316\u524d\u540e\u987a\u5e8f \u4e0d\u53ef\u9006\u4fee\u6539\uff1a\u4f60\u9700\u8981\u91cd\u65b0\u6267\u884c\u4e00\u6b21 composer update \u6216\u91cd\u65b0\u62c9\u53d6\u4e00\u6b21 Docker Image\uff0c\u56e0\u4e3a composer \u4f9d\u8d56\u53d1\u751f\u4e86\u53d8\u5316\u3002","title":"v1.4"},{"location":"update/v1/#v131","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.5.10 \u4fee\u590d\uff1aDataProvider \u4e0b setJsonData \u65b0\u5efa\u6587\u4ef6\u5939\u7684\u95ee\u9898 \u4f18\u5316\uff1a\u9ed8\u8ba4 / \u9875\u9762\u663e\u793a Hello Zhamao! \u6587\u5b57 \u4f18\u5316\uff1aException \u548c Fatal error \u62a5\u9519\u673a\u5236\u7684\u6539\u8fdb \u4fee\u590d\uff1a\u8ba1\u65f6\u5668\u6ca1\u6709\u4e0a\u4e0b\u6587\u73af\u5883\uff0c\u53d1\u4e0d\u4e86 API \u7684 bug \u2757 \u4e0b\u9762\u662f\u6846\u67b6\u5347\u7ea7\u9700\u8981\u624b\u52a8\u8fdb\u884c\u7684\u53d8\u66f4\uff1a \u66f4\u6539 MySQL \u5ba2\u6237\u7aef\u4e3a\u539f\u751f PDO mysqlnd\uff0c\u5982\u679c\u4e4b\u524d\u4f7f\u7528 Docker \u542f\u52a8\uff0c\u5219\u9700\u4f7f\u7528\u65b0\u7684 Dockerfile \u6784\u5efa\u3002\u5982\u679c\u5b89\u88c5\u5728\u672c\u673a\uff0c\u9700\u5b89\u88c5 php-mysql \u6269\u5c55\u3002\u672c\u6b21\u66f4\u65b0\u4e0d\u5f71\u54cd\u6846\u67b6\u5185\u7684 API\uff0c\u4e0d\u9700\u8981\u66f4\u6539\u4efb\u4f55\u4ee3\u7801\u3002","title":"v1.3.1"},{"location":"update/v1/#v130","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.5.8 \u65b0\u589e\uff1a\u4e0a\u4e0b\u6587\uff0c\u5177\u4f53\u66f4\u65b0\u90fd\u5199\u5230\u4e86\u6587\u6863\u91cc\u4e86\uff01 \u4fee\u590d\uff1aZMRobot \u7684 setPrefix() \u7684\u4e25\u91cd\u9519\u8bef \u4f18\u5316\uff1a\u4f18\u5316\u90e8\u5206\u4ee3\u7801 \u6539\u52a8\uff1a\u73b0\u5728\u4f60\u53ef\u4ee5\u548c\u4efb\u610f\u4e8b\u4ef6\u7684\u6ce8\u89e3\u4f7f\u7528\u4efb\u610f\u4e2d\u95f4\u4ef6\u5566\uff0c\u800c\u4e14\u8fd8\u652f\u6301\u591a\u4e2d\u95f4\u4ef6 \u65b0\u589e\uff1aCQHTTP + \u9177Q + \u70b8\u6bdb\u6846\u67b6 \u7684 Dockerfile \u65b0\u589e\u6ce8\u89e3\uff1a @CQAPISend \uff0c @CQAPIResponse \uff0c\u662f API \u8c03\u7528\u540e\u89e6\u53d1\u7684\u4e8b\u4ef6\uff0c\u5177\u4f53\u89c1\u6587\u6863\u8bf4\u660e","title":"v1.3.0"},{"location":"update/v1/#v121","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.5.2 \u65b0\u589e\uff1aphar \u542f\u52a8\u6a21\u5f0f\u6784\u5efa\u811a\u672c\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u62c9\u53d6 phar \u8fd0\u884c\u6846\u67b6\u4e86\uff01 \u4f18\u5316\uff1a\u4f18\u5316\u90e8\u5206\u4ee3\u7801","title":"v1.2.1"},{"location":"update/v1/#v12","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.4.29 \u65b0\u589e\uff1asystemd \u751f\u6210\u811a\u672c\u3001\u4e00\u952e daemonize \u5b88\u62a4\u8fdb\u7a0b\u65b9\u5f0f\u5e38\u9a7b\u540e\u53f0 \u65b0\u589e\uff1a\u793a\u4f8b\u6a21\u5757\u7684\u6ce8\u91ca \u91cd\u6784\uff1aConsole \u6a21\u5757\uff0c\u73b0\u5728\u6709\u51c6\u786e\u7684\u63a7\u5236\u53f0\u8f93\u51fa\u5206\u7ea7\u529f\u80fd\u4e86 \u65b0\u589e\uff1a @OnTick \u6ce8\u89e3\uff0c\u7528\u4e8e\u7ed1\u5b9a\u5b9a\u65f6\u5668\uff08\u6beb\u79d2\u7ea7\uff09 \u65b0\u589e\uff1a ZMRobot \u7c7b\uff0c\u6bd4\u8c03\u7528 CQAPI \u7c7b\u53d1\u9001 API \u66f4\u65b9\u4fbf\uff0c\u540c\u65f6\u517c\u5bb9\u6700\u65b0\u7248\u672c\u7684 CQHTTP \u63d2\u4ef6 \u4f18\u5316\uff1a\u4f7f\u7528\u952e\u76d8\u4e2d\u65ad Ctrl+C \uff0c\u4e0d\u4f1a\u4e22\u5931\u672a\u4fdd\u5b58\u7684\u7f13\u5b58\u6570\u636e\u4e86 \u4f18\u5316\uff1a\u5b8c\u5584\u4e0a\u4e0b\u6587\u5bf9\u8c61\u7684\u65b9\u6cd5 \u65b0\u589e\uff1a\u7ec8\u7aef\u547d\u4ee4\uff1a logtest \uff0c\u6d4b\u8bd5\u8f93\u51fa\u7684 log \u7c7b\u578b :exclamation:\u4e0b\u9762\u662f\u6846\u67b6\u6a21\u5757\u5f00\u53d1\u4e2d\u9700\u8981\u6ce8\u610f\u7684\u6216\u6709\u4e0d\u517c\u5bb9\u7684\u4fee\u6539\u5185\u5bb9\uff1a \u4fee\u6539\uff1a global.php \u4e2d\u539f\u6765\u7684 info_level \u9ed8\u8ba4\u6570\u503c\u9700\u8981\u6539\u4e3a 2 \uff0c\u4fdd\u8bc1\u7ec8\u7aef\u8f93\u51fa\u548c\u539f\u6765\u4e00\u81f4","title":"v1.2"},{"location":"update/v1/#v112","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.4.26 \u65b0\u589e\uff1a\u9759\u6001\u6587\u4ef6\u670d\u52a1\u5668 \u4fee\u590d\uff1a / \u8def\u5f84\u7684 Mapping \u65e0\u6cd5\u6b63\u5e38\u7ed1\u5b9a\u7684 bug","title":"v1.1.2"},{"location":"update/v1/#v111","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.4.26 \u65b0\u589e\uff1a\u4e2d\u95f4\u4ef6\u5bf9\u7c7b\u7684\u4fee\u9970 \u65b0\u589e\uff1a\u4e0a\u4e0b\u6587\u5bf9\u8c61\u5bf9 IDE \u7684\u652f\u6301 \u4fee\u590d\uff1a\u6570\u636e\u5e93\u63d2\u5165\u67e5\u8be2\u7684\u611a\u8822\u9519\u8bef \u4fee\u590d\uff1a\u6570\u636e\u5e93\u67e5\u8be2\u7684 value() \u4e0d\u652f\u6301\u6307\u5b9a\u53c2\u6570\u7684 bug","title":"v1.1.1"},{"location":"update/v1/#v110","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.3.29 \u65b0\u589e\uff1a\u4e2d\u95f4\u4ef6 @Middleware \u529f\u80fd \u4fee\u590d\uff1aWebsocket \u94fe\u63a5\u5173\u95ed\u540e\u672a\u81ea\u52a8\u5220\u9664\u8fde\u63a5\u5bf9\u8c61\u7684bug","title":"v1.1.0"},{"location":"update/v1/#v100","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.3.19 \u6b63\u5f0f\u7248\u53d1\u5e03\u3002","title":"v1.0.0"},{"location":"update/v2/","text":"\u66f4\u65b0\u65e5\u5fd7\uff08v2 \u7248\u672c\uff09 v2.5.1 (build 416) \u66f4\u65b0\u65f6\u95f4\uff1a2021.7.9 \u4fee\u590d\uff1a\u811a\u624b\u67b6\u65e0\u6cd5\u6b63\u5e38\u4f7f\u7528 init \u547d\u4ee4\u7684 bug\u3002 v2.5.0 (build 415) \u66f4\u65b0\u65f6\u95f4\uff1a2021.7.9 \u4ee5\u4e0b\u662f\u7248\u672c \u65b0\u589e\u5185\u5bb9 \uff1a \u65b0\u589e\u5168\u65b0\u7684\u6a21\u5757\u7cfb\u7edf\uff0c\u53ef\u6253\u5305\u6a21\u5757\uff08src \u76ee\u5f55\u4e0b\u7684\u5b50\u76ee\u5f55\u7528\u6237\u903b\u8f91\u4ee3\u7801\uff09\u4e3a phar \u683c\u5f0f\u8fdb\u884c\u5206\u53d1\u548c\u7248\u672c\u5907\u4efd\u3002 \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u65b0\u589e module_loader \u9879\uff0c\u7528\u4e8e\u914d\u7f6e\u5916\u90e8\u6a21\u5757\u52a0\u8f7d\u7684\u4e00\u4e9b\u8bbe\u7f6e\u3002 \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u65b0\u589e runtime \u914d\u7f6e\u9879\uff0c\u53ef\u81ea\u5b9a\u4e49\u914d\u7f6e Swoole \u7684\u4e00\u4e9b\u8fd0\u884c\u65f6\u53c2\u6570\uff0c\u76ee\u524d\u53ef\u914d\u7f6e\u4e00\u952e\u534f\u7a0b\u5316\u7684 Hook \u53c2\u6570\u548c Swoole Server \u7684\u542f\u52a8\u6a21\u5f0f\u3002 \u65b0\u589e module:list \u547d\u4ee4\uff0c\u7528\u4e8e\u67e5\u770b\u672a\u6253\u5305\u548c\u5df2\u6253\u5305\u7684\u6a21\u5757\u5217\u8868\u3002 \u65b0\u589e module:pack \u547d\u4ee4\uff0c\u7528\u4e8e\u6253\u5305\u73b0\u6709 src \u76ee\u5f55\u4e0b\u7684\u6a21\u5757\u3002 \u65b0\u589e module:unpack \u547d\u4ee4\uff0c\u7528\u4e8e\u89e3\u5305\u73b0\u6709\u7684 phar \u6a21\u5757\u5305\u3002 \u65b0\u589e\u6253\u5305\u6846\u67b6\u529f\u80fd\uff0c\u652f\u6301\u5c06\u7528\u6237\u7684\u6574\u4e2a\u9879\u76ee\u8fde\u540c\u70b8\u6bdb\u6846\u67b6\u6253\u5305\u4e3a\u4e00\u4e2a phar \u4fbf\u643a\u8fd0\u884c\uff0c\u4f7f\u7528\u547d\u4ee4 build \u3002 \u65b0\u589e\u5feb\u6377\u811a\u672c ./zhamao \uff0c\u6548\u679c\u540c vendor/bin/start \u6216 bin/start \u3002 \u65b0\u589e\u542f\u52a8\u53c2\u6570 --interact \uff1a\u53c8\u91cd\u65b0\u652f\u6301\u4ea4\u4e92\u7ec8\u7aef\u4e86\uff0c\u4f46\u8fd8\u662f\u6709\u70b9\u95ee\u9898\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\u3002 \u65b0\u589e\u542f\u52a8\u53c2\u6570 --disable-safe-exit \uff1a\u5982\u679c\u4f60\u7684\u9879\u76ee\u5728 Ctrl+C \u65f6\u603b\u662f\u5361\u4f4f\u4e14\u9879\u76ee\u5185\u6ca1\u6709\u4ec0\u4e48\u4f7f\u7528 LightCache \u7b49\u7f13\u5b58\u5728\u5185\u5b58\u7684\u6570\u636e\u53ef\u5f00\u542f\u9632\u6b62\u5173\u4e0d\u6389\u6846\u67b6\u3002 \u65b0\u589e\u542f\u52a8\u53c2\u6570 --preview \uff1a\u53ea\u663e\u793a\u53c2\u6570\uff0c\u4e0d\u542f\u52a8\u70b8\u6bdb\u6846\u67b6\u7684\u670d\u52a1\u5668\u3002 \u65b0\u589e\u542f\u52a8\u53c2\u6570 --force-load-module \uff1a\u5f3a\u5236\u6253\u5305\u72b6\u6001\u4e0b\u52a0\u8f7d\u7684\u6a21\u5757\uff08\u4f7f\u7528\u82f1\u6587\u9017\u53f7\u5206\u9694\u591a\u4e2a\u6a21\u5757\u540d\u79f0\uff09\u3002 CoroutinePool \u534f\u7a0b\u6c60\u65b0\u589e getRunningCoroutineCount \u65b9\u6cd5\uff0c\u7528\u4e8e\u67e5\u770b\u534f\u7a0b\u6c60\u4e2d\u7684\u534f\u7a0b\u6570\u91cf\u3002 DataProvider \u65b0\u589e getFrameworkRootDir() \u3001 getSourceRootDir() \uff0c\u5206\u522b\u4ee3\u8868\u83b7\u53d6\u6846\u67b6\u7684\u6839\u76ee\u5f55\u548c\u7528\u6237\u6e90\u7801\u6839\u76ee\u5f55\u3002\uff08\u8be6\u89c1\u4e0b\u65b9\u5bf9\u76ee\u5f55\u7684\u5b9a\u4e49\u89e3\u91ca\uff09 DataProvider \u4e2d getDataFolder \u65b0\u589e\u53c2\u6570 $second = '' \uff0c\u5982\u679c\u7ed9\u5b9a\uff0c\u5219\u81ea\u52a8\u521b\u5efa\u5b50\u76ee\u5f55 $second \u5e76\u8fd4\u56de\u3002 DataProvider \u65b0\u589e scanDirFiles() \u65b9\u6cd5\uff0c\u7528\u4e8e\u626b\u63cf\u76ee\u5f55\uff0c\u53ef\u9009\u62e9\u662f\u5426\u9012\u5f52\u3001\u662f\u5426\u8fd4\u56de\u76f8\u5bf9\u8def\u5f84\uff0c\u4e5f\u652f\u6301\u626b\u63cf Phar \u6587\u4ef6\u5185\u7684\u8def\u5f84\uff0c\u975e\u5e38\u597d\u7528\u3002 DataProvider \u65b0\u589e isRelativePath() \u65b9\u6cd5\uff0c\u68c0\u67e5\u8def\u5f84\u662f\u5426\u4e3a\u76f8\u5bf9\u8def\u5f84\uff08\u6839\u636e\u7b2c\u4e00\u4e2a\u5b57\u7b26\u662f\u5426\u662f '/' \u6765\u5224\u65ad\uff09\u3002 ZMUtil \u65b0\u589e getClassesPsr4() \u65b9\u6cd5\uff0c\u7528\u4e8e\u6839\u636e Psr-4 \u6807\u51c6\u6765\u83b7\u53d6\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u7c7b\u6587\u4ef6\u3002 \u65b0\u589e\u5168\u5c40\u9519\u8bef\u7801\uff0c\u53ef\u4ee5\u6839\u636e\u9519\u8bef\u7801\u5728\u6587\u6863\u5185\u5feb\u901f\u5b9a\u4f4d\u548c\u89e3\u51b3\u95ee\u9898\u3002 \u4e2d\u95f4\u4ef6\u548c\u6ce8\u89e3\u4e8b\u4ef6\u652f\u6301\u56de\u6eaf\uff0c\u53ef\u4ee5\u5feb\u901f\u67e5\u770b\u8c03\u7528\u6808\uff08\u6bd4\u5982\u4e2d\u95f4\u4ef6\u53ef\u4ee5\u77e5\u9053\u81ea\u5df1\u662f\u5728\u54ea\u4e2a\u6ce8\u89e3\u4e8b\u4ef6\u4e2d\u88ab\u8c03\u7528\uff09\u3002 \u4f7f\u7528 ./zhamao build \u6765\u6784\u5efa\u6846\u67b6\u7684 phar \u5305\u65f6\u589e\u52a0\u663e\u793a\u8fdb\u5ea6\u6761\u3002 EventDispatcher \u65b0\u589e\u65b9\u6cd5 getEid() \u548c getClass() \uff0c\u5206\u522b\u7528\u4e8e\u83b7\u53d6\u4e8b\u4ef6\u5206\u53d1 ID \u548c\u6ce8\u89e3\u4e8b\u4ef6\u7684\u6ce8\u89e3\u7c7b\u540d\u79f0\u3002 \u65b0\u589e EventTracer\uff0c\u7528\u4e8e\u8ffd\u8e2a\u4e8b\u4ef6\u7684\u8c03\u7528\u6808\u3002 \u4e2d\u95f4\u4ef6\u652f\u6301\u4f20\u53c2\u3002 MySQL \u6570\u636e\u5e93\u67e5\u8be2\u5668\u6539\u4e3a\u4f7f\u7528 doctrine/dbal \u7ec4\u4ef6\uff0c\u66f4\u7075\u6d3b\u548c\u7a33\u5b9a\u3002 \u65b0\u589e\u5bf9 SWOOLE_BASE \u6a21\u5f0f\u7684\u652f\u6301\uff08\u652f\u6301\u53ea\u542f\u52a8\u4e00\u4e2a\u8fdb\u7a0b\u7684 Server\uff09\u3002 \u4ee5\u4e0b\u662f\u7248\u672c \u4fee\u6539\u5185\u5bb9 \uff1a \u542f\u52a8\u6587\u4ef6 vendor/bin/start \u4fee\u6539\u4e3a shell \u811a\u672c\uff0c\u53ef\u81ea\u52a8\u5bfb\u627e PHP \u73af\u5883\u3002 \u5168\u5c40\u5f3a\u5236\u4f9d\u8d56 league/climate \u7ec4\u4ef6\u3002 \u4fee\u590d\u6846\u67b6\u542f\u52a8\u65f6\u7684\u4fe1\u606f\u663e\u793a\u6362\u884c\u95ee\u9898\u3002 \u4fee\u590d\u6846\u67b6\u4f7f\u7528 Phar \u65b9\u5f0f\u542f\u52a8\u65f6\u5bfc\u81f4\u7684\u62a5\u9519\u3002 \u4fee\u590d\u4f7f\u7528 Ctrl+C \u7ed3\u675f\u65f6\u4e00\u90e8\u5206\u7528\u6237\u5361\u4f4f\u7684 bug\u3002 \u8fdc\u7a0b\u548c\u672c\u5730\u7ec8\u7aef\u53bb\u6389 stop \u547d\u4ee4\uff0c\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528\u53d1 SIGTERM \u65b9\u5f0f\u7ed3\u675f\u6846\u67b6\u3002 \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u7684 zm_data \u6839\u76ee\u5f55\u9ed8\u8ba4\u4fee\u6539\u4e3a WORKING_DIR \u3002 \u547d\u4ee4 systemd:generate \u4fee\u6539\u4e3a generate:systemd \u3002 \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u5220\u9664 server_event_handler_class \u9879\uff0c\u6b64\u9879\u5e9f\u5f03\u3002 \u4fee\u590d\u90e8\u5206 CQ \u7801\u89e3\u6790\u8fc7\u7a0b\u4e2d\u6ca1\u6709\u8f6c\u4e49\u7684\u95ee\u9898\u3002 \u5c06 ZMRobot \u7c7b\u8f6c\u79fb\u4e3a OneBotV11 \u7c7b\uff0c\u4f46\u63d0\u4f9b\u517c\u5bb9\u3002 \u4fee\u590d\u5728\u5b88\u62a4\u8fdb\u7a0b\u6a21\u5f0f\u4e0b\u4f7f\u7528 daemon:reload \u548c daemon:stop \u547d\u4ee4\u53ef\u80fd\u5931\u6548\u7684\u95ee\u9898\u3002 \u4fee\u590d systemd \u751f\u6210\u65f6\u811a\u672c\u76ee\u5f55\u9519\u8bef\u7684 bug\u3002 \u4fee\u590d PipeMessage \u7b49\u4e8b\u4ef6\u672a\u6355\u83b7\u9519\u8bef\u5bfc\u81f4\u5d29\u6e83\u7684\u95ee\u9898\u3002 ZM\\Http\\RouteManager \u79fb\u52a8\u5230 ZM\\Utils\\Manager\\RouteManager \uff0c\u4f46\u539f\u5730\u5740\u517c\u5bb9\u3002 \u4fee\u590d Terminal \u7c7b\u4f7f\u7528\u7684\u4e00\u4e9b\u95ee\u9898\u3002 \u5bf9 pcntl \u6269\u5c55\u6539\u4e3a\u53ef\u9009\u4f9d\u8d56\uff0c\u5f53 Swoole \u7248\u672c\u5927\u4e8e\u7b49\u4e8e 4.6.7 \u65f6\u4e0d\u9700\u8981\u5b89\u88c5 pcntl \u6269\u5c55\u3002 \u4fee\u6b63\u542f\u52a8\u65f6\u6846\u67b6\u5bf9\u7f3a\u7701\u914d\u7f6e\u9879\u7684\u4e00\u4e9b\u9ed8\u8ba4\u53c2\u6570\u3002 \u6ce8\u89e3 @OnSetup \u548c @SwooleHandler \u53ef\u76f4\u63a5\u4f7f\u7528\uff0c\u65e0\u9700\u8bbe\u7f6e server_event_handler_class \u5373\u53ef\u3002 \u4fee\u590d\u6846\u67b6\u5728\u4e00\u4e9b\u975e\u6b63\u5e38\u7ec8\u7aef\u4e2d\u8fd0\u884c\u65f6\u5bfc\u81f4\u9519\u8bef\u7684\u95ee\u9898\u3002 \u4f7f\u7528 --debug-mode \u53c2\u6570\u65f6\uff0c\u81ea\u52a8\u5f00\u542f\u70ed\u66f4\u65b0\u3002 \u4fee\u590d\u811a\u624b\u67b6\u5728\u4f7f\u7528 composer \u66f4\u65b0\u540e\u68c0\u67e5\u5168\u5c40\u914d\u7f6e\u529f\u80fd\u7684 bug\u3002 \u4fee\u590d\u91cd\u542f\u548c\u5173\u95ed\u6846\u67b6\u65f6\u9020\u6210\u7684\u975e\u6b63\u5e38\u8fde\u63a5\u65ad\u5f00\u3002 \u6539\u7528\u72ec\u7acb\u8fdb\u7a0b\u76d1\u542c\u6587\u4ef6\u53d8\u5316\u548c\u7ec8\u7aef\u8f93\u5165\u3002 \u4fee\u590d\u6709\u534f\u7a0b\u4e2d\u65ad\u7684\u4efb\u52a1\u65f6\u505c\u6b62\u670d\u52a1\u5668\u4f1a\u62a5 Swoole \u8b66\u544a\u7684 bug\u3002 \u4fee\u590d\u8fde\u63a5\u88ab\u53cd\u590d\u65ad\u5f00\u7684\u95ee\u9898\u3002 \u5bf9\u76ee\u5f55\u7684\u5b9a\u4e49\u89e3\u91ca \uff1a \u5728 2.4.4 \u7248\u672c\u4e4b\u524d\uff0c\u4f7f\u7528\u70b8\u6bdb\u6846\u67b6\u4e2d\uff0c\u53ea\u542b\u6709\u4e24\u79cd\u76ee\u5f55\uff0c getWorkingDir \u548c getDataFolder \uff0c\u5206\u522b\u4ee3\u8868\u83b7\u53d6\u5de5\u4f5c\u76ee\u5f55\u548c\u6570\u636e\u76ee\u5f55\u3002\u5728 2.5 \u7248\u672c\u4e2d\uff0c\u53c8\u65b0\u589e\u4e86 getFrameworkRootDir \u4ee3\u8868\u83b7\u53d6\u6846\u67b6\u7684\u6839\u76ee\u5f55\uff0c getSourceRootDir \u4ee3\u8868\u83b7\u53d6\u6e90\u7801\u7684\u6839\u76ee\u5f55\u3002 \u4ee5 Composer \u8fd0\u884c\u6a21\u5f0f\u4e3e\u4f8b\uff0c\u5982\u679c\u4f60\u4f7f\u7528 composer create-project zhamao/framework-starter \u547d\u4ee4\u65b0\u5efa\u7684\u6846\u67b6\uff0c\u90a3\u4e48\u5047\u8bbe\u6211\u4eec\u4ece /app \u76ee\u5f55\u4e0b\u8fd0\u884c\u6b64\u547d\u4ee4\uff0c\u7136\u540e\u4f7f\u7528 cd framework-starter/ \u8fdb\u5165\u9879\u76ee\u76ee\u5f55\uff0c\u6b64\u65f6\u6211\u4eec\u4f7f\u7528 vendor/bin/start server \u547d\u4ee4\u8fd0\u884c\u670d\u52a1\u5668\uff0c\u5bf9\u5e94\u7684\u76ee\u5f55\u4e3a\uff1a WorkingDir \uff1a /app/framework-starter/ SourceRootDir \uff1a /app/framework-starter/ FrameworkRootDir \uff1a /app/framework-starter/vendor/zhamao/framework/ \u5982\u679c\u4ee5\u6e90\u7801\u6a21\u5f0f\uff08\u76f4\u63a5\u514b\u9686 zhamao-framework.git \u4ed3\u5e93\uff09\uff0c\u542f\u52a8\u6846\u67b6\uff0c\u90a3\u4e48\u4f7f\u7528\u547d\u4ee4 bin/start server \u542f\u52a8\u6846\u67b6\u540e\uff0c\u4ee5\u4e0a\u4e09\u4e2a\u8fd4\u56de\u7684\u76ee\u5f55\u5219\u5b8c\u5168\u76f8\u540c\u3002 \u5982\u679c\u4ee5 2.5 \u7248\u672c\u65b0\u7684\u9879\u76ee\u5f52\u6863\u6a21\u5f0f\uff08build\uff09\u542f\u52a8\u6846\u67b6\uff0c\u5047\u8bbe\u6211\u4eec\u7684\u9879\u76ee\u4ee3\u7801\u6253\u5305\u4e3a server.phar \uff0c\u5728 /app/ \u76ee\u5f55\uff0c\u6211\u4eec\u4f7f\u7528\u547d\u4ee4 php server.phar server \u542f\u52a8\u70b8\u6bdb\u6846\u67b6\uff0c\u90a3\u4e48\u5b83\u5bf9\u5e94\u7684\u76ee\u5f55\u4e3a\uff1a WorkingDir \uff1a /app/ SourceRootDir \uff1a phar:///app/server.phar/ FrameworkRootDir \uff1a phar:///app/server.phar/vendor/zhamao/framework/ \u5982\u679c\u6700\u540e\u4e00\u79cd\u5f52\u6863\u65b9\u5f0f\u542f\u52a8\u7684\u6846\u67b6\u662f\u4ece\u6e90\u7801\u6a21\u5f0f\u6253\u5305\u800c\u6765\uff0c\u90a3\u4e48 FrameworkRootDir \u5c31\u4e0e SourceRootDir \u76f8\u540c\u3002 \u7248\u672c\u90e8\u5206\u517c\u5bb9\u95ee\u9898\u53d8\u5316 \uff1a \u7406\u8bba\u4e0a\u5982\u679c\u4e0d\u4f7f\u7528\u6846\u67b6\u5185\u90e8\u672a\u5f00\u653e\u7684\u63a5\u53e3\u65b9\u6cd5\u7684\u8bdd\uff0c\u4ece 2.4 \u5347\u7ea7\u5230 2.5 \u662f\u975e\u5e38\u81ea\u7136\u7684\uff0c\u4f46\u662f\u4e5f\u6709\u4e00\u90e8\u5206\u53ef\u80fd\u4f1a\u9020\u6210\u4e0d\u517c\u5bb9\u7684\u95ee\u9898\u3002 \u751f\u6210 systemd \u914d\u7f6e\u6587\u4ef6\u7684\u547d\u4ee4 systemd:generate \u53d8\u6210 generate:systemd \u3002 \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 zm_data \u7684\u7236\u76ee\u5f55\u7531 __DIR__ . \"/../\" \u6539\u4e3a WORKING_DIR \u3002 2.5 \u7248\u672c\u5c06 ZMRobot \u7c7b\u4e2d\u7684\u6240\u6709\u51fd\u6570\u65b9\u6cd5\u90fd\u79fb\u52a8\u5230\u4e86 OneBotV11 \u7c7b\u4e2d\uff0c\u4f46\u539f\u5148\u7684 ZMRobot \u8fd8\u53ef\u4ee5\u4f7f\u7528\u3002 v2.4.4 (build 405) \u66f4\u65b0\u65f6\u95f4\uff1a2021.3.29 \u4ee5\u4e0b\u662f\u53ef\u80fd\u4e0d\u517c\u5bb9\u7684\u53d8\u66f4\uff1a \u65b0\u589e\u4f9d\u8d56\uff1a\u6846\u67b6\u9700\u8981 PHP \u5b89\u88c5 pcntl \u6269\u5c55\u4ee5\u53ca\u5f00\u542f pcntl_signal \u51fd\u6570\uff08\u4e00\u822c\u60c5\u51b5\u4e0b\u7f16\u8bd1\u5b89\u88c5\u7684\u90fd\u4f1a\u6709\uff0c\u5b9d\u5854\u9762\u677f\u8bf7\u624b\u52a8\u89e3\u9664\u51fd\u6570\u7981\u7528\uff09 v2.4.3 (build 403) \u66f4\u65b0\u65f6\u95f4\uff1a2021.3.29 \u65b0\u589e\uff1aswoole \u8bbe\u7f6e\u914d\u7f6e\u65b0\u589e max_wait_time \u9879\uff0c\u8bbe\u7f6e\u7b49\u5f85\u8fdb\u7a0b\u5173\u95ed\u6d41\u7a0b\u6700\u5927\u65f6\u95f4\uff08\u79d2\uff09 \u65b0\u589e\uff1a\u5e38\u91cf MAIN_WORKER \uff0c\u503c\u7b49\u540c\u4e8e worker_cache \u9879\u4e2d\u7684 worker \u53c2\u6570\uff08WorkerCache \u6240\u5728\u7684\u8fdb\u7a0b\uff09 \u65b0\u589e\uff1a LightCache \u65b0\u589e getExpireTS() \u65b9\u6cd5\uff0c\u7528\u4e8e\u8fd4\u56de\u9879\u76ee\u8fc7\u671f\u7684\u65f6\u95f4\u6233 \u4fee\u590d\uff1a savePersistence() \u7684\u90e8\u5206\u4e22\u5931\u6570\u636e\u7684 bug \u65b0\u589e\uff1a\u5168\u5c40\u65b9\u6cd5 zm_go() \u4fee\u590d\uff1a2.4.2 \u7248\u672c\u4e0b\u7684\u5237\u5c4f\u62a5\u9519 \u4f18\u5316\uff1aCtrl+C \u54cd\u5e94\u673a\u5236\uff0c\u542f\u7528\u5f02\u6b65 \u91cd\u542f/\u5173\u95ed \u63aa\u65bd\uff0c\u9632\u6b62\u6b8b\u7559\u50f5\u5c38\u8fdb\u7a0b\u548c\u4e22\u5931\u6570\u636e v2.4.2 (build 402) \u66f4\u65b0\u65f6\u95f4\uff1a2021.3.27 \u66f4\u6539\uff1a WORKING_DIR \u5e38\u91cf\u7684\u542b\u4e49 \u4fee\u590d\uff1a\u672a\u6307\u5b9a --remote-terminal \u53c2\u6570\u65f6\u8fd8\u4f9d\u65e7\u5f00\u542f\u8fdc\u7a0b\u7ec8\u7aef\u7684 bug \u5220\u9664\uff1a phar_classloader() \u5168\u5c40\u65b9\u6cd5 \u66f4\u6539\uff1a\u6301\u4e45\u5316\u5b58\u50a8 LightCache \u7684\u903b\u8f91\uff0c\u4fee\u590d\u4e00\u4e2a\u611a\u8822\u7684\u5bb9\u6613\u9020\u6210\u8bef\u7528\u7684\u65b9\u5f0f \u65b0\u589e\uff1aLightCache \u65b9\u6cd5 addPersistence() \u548c removePersistence() \u65b0\u589e\uff1a\u6846\u67b6\u542f\u52a8\u77ed\u6307\u4ee4 ./zhamao \u6216 php zhamao v2.4.1 (build 401) \u66f4\u65b0\u65f6\u95f4\uff1a2021.3.25 \u4fee\u590d\uff1a\u5f00\u542f\u6846\u67b6\u65f6\u5bfc\u81f4\u7684\u62a5\u9519 v2.4.0\uff08build 400\uff09 \u66f4\u65b0\u65f6\u95f4\uff1a2021.3.25 \u65b0\u589e\uff1a\u68c0\u67e5\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u7684\u547d\u4ee4 \u65b0\u589e\uff1a\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u66f4\u65b0\u8bb0\u5f55 \u4f9d\u8d56\u53d8\u66f4\uff1a Swoole \u6700\u4f4e\u7248\u672c\u9700\u8981 4.5.0 \u4f18\u5316\uff1areload \u548c stop \u547d\u4ee4\u91cd\u8f7d\u548c\u505c\u6b62\u6846\u67b6\u7684\u903b\u8f91 \u65b0\u589e\uff1a $_running_annotation \u53d8\u91cf\uff0c\u53ef\u5728\u6ce8\u89e3\u4e8b\u4ef6\u4e2d\u7684\u7c7b\u4f7f\u7528 \u65b0\u589e\uff1a\u8fdc\u7a0b\u7ec8\u7aef\uff08Remote Terminal\uff09\uff0c\u5f25\u8865\u539f\u6765\u5220\u6389\u7684\u672c\u5730\u7ec8\u7aef\uff0c\u901a\u8fc7 nc \u547d\u4ee4\u8fde\u63a5\u5373\u53ef \u65b0\u589e\uff1a\u542f\u52a8\u53c2\u6570 --worker-num \uff0c --task-worker-num \uff0c --remote-terminal \u66f4\u65b0\uff1a\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u7ed3\u6784 \u65b0\u589e\uff1aSwoole \u8ba1\u65f6\u5668\u62a5\u9519\u5904\u7406 \u65b0\u589e\uff1a\u5168\u5c40\u65b9\u6cd5\uff08 zm_dump() \uff0c zm_error() \uff0c zm_warning() \uff0c zm_info() \uff0c zm_success() \uff0c zm_verbose() \uff0c zm_debug() \uff0c zm_config() \uff09 \u65b0\u589e\uff1a\u793a\u4f8b\u6a21\u5757\u7684\u56fe\u7075\u673a\u5668\u4eba\u548c at \u673a\u5668\u4eba\u7684\u5904\u7406\u51fd\u6570 \u65b0\u589e\uff1aMessageUtil \u5de5\u5177\u7c7b\u65b0\u589e isAtMe(), splitCommand(), matchCommand() \u65b9\u6cd5 \u65b0\u589e\uff1aProcessManager \u8fdb\u7a0b\u7ba1\u7406\u7c7b\u65b0\u589e workerAction(), sendActionToWorker(), resumeAllWorkerCoroutines() \u65b9\u6cd5 \u4f18\u5316\uff1aCQCommand \u7684\u5339\u914d\u903b\u8f91 \u65b0\u589e\uff1a\u652f\u6301\u6dfb\u52a0\u81ea\u5b9a\u4e49\u8fdc\u7a0b\u7ec8\u7aef\u6307\u4ee4\u7684 @TerminalCommand \u6ce8\u89e3 \u65b0\u589e\uff1a\u56fe\u7075\u673a\u5668\u4eba API \u5c01\u88c5\u51fd\u6570 \u65b0\u589e\uff1aZMUtil \u5de5\u5177\u6742\u9879\u7c7b getReloadableFiles() \u51fd\u6570 \u65b0\u589e\uff1a vendor/bin/start systemd:generate \u751f\u6210 systemd \u914d\u7f6e\u6587\u4ef6\u7684\u529f\u80fd \u65b0\u589e\uff1a vendor/bin/start check:config \u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u66f4\u65b0\u7684\u547d\u4ee4 \u65b0\u589e\uff1a vendor/bin/start init \u65b0\u589e --force \u53c2\u6570\uff0c\u8986\u76d6\u73b0\u6709\u6587\u4ef6\u91cd\u65b0\u751f\u6210 \u65b0\u589e\uff1aMessageUtil \u65b0\u589e\u65b9\u6cd5\uff1a addShortCommand() \uff0c\u7528\u4e8e\u5feb\u901f\u6dfb\u52a0\u9759\u6001\u6587\u672c\u95ee\u7b54\u56de\u590d\u7684 \u4ee5\u4e0b\u662f\u9700\u8981 \u624b\u52a8\u66f4\u65b0 \u6216 \u66f4\u6362\u65b0\u5199\u6cd5 \u7684\u90e8\u5206\uff1a \u914d\u7f6e\u6587\u4ef6 global.php \u4e2d\u7684 modules \u5b57\u6bb5\u5c55\u5f00\uff0c\u5185\u7f6e\u6a21\u5757\u7684\u914d\u7f6e\u4e00\u5f8b\u5e73\u94fa\u5230\u5916\u9762\u3002\u8be6\u89c1 \u66f4\u65b0\u65e5\u5fd7 - \u914d\u7f6e\u6587\u4ef6\u53d8\u66f4 \u3002 \u4ee5\u4e0b\u662f\u9ed8\u8ba4\u673a\u5668\u4eba\u76f4\u63a5\u8fde\u63a5\u4ea7\u751f\u7684\u53d8\u66f4\uff1a 2.4.0 \u65b0\u589e\u4e86\u9ed8\u8ba4\u56de\u590d\u5176\u4ed6\u4eba at \u7684\u6d88\u606f\uff0c\u5982\u679c\u4e0d\u9700\u8981\uff0c\u8bf7\u5c06 Hello.php \u4e2d\u7684 changeAt() \u548c turingAPI() \u65b9\u6cd5\u5220\u9664\u3002 v2.3.5 (build 398) \u66f4\u65b0\u65f6\u95f4\uff1a2021.3.23 \u4fee\u590d\uff1aMySQL \u6570\u636e\u5e93\u67e5\u8be2\u5bfc\u81f4\u7684\u4e00\u7cfb\u5217\u95ee\u9898 \u4fee\u590d\uff1a\u5185\u5b58\u6cc4\u9732\u95ee\u9898 2.3.2-2.3.4 \u7248\u672c\u7531\u4e8e\u64cd\u4f5c\u5931\u8bef\u5bfc\u81f4\u4ee3\u7801\u4e0d\u5b8c\u6574\uff0c\u8bf7\u76f4\u63a5\u4f7f\u7528 2.3.5 \u5373\u53ef\u3002 v2.3.1 \u66f4\u65b0\u65f6\u95f4\uff1a2021.3.18 \u89c4\u8303\u4ee3\u7801\uff0c\u4fee\u590d\u4e00\u4e2a\u5c0f\u62a5\u9519\u7684 bug v2.3.0 \u66f4\u65b0\u65f6\u95f4\uff1a2021.3.16 \u65b0\u589e\uff1aMessageUtil \u6d88\u606f\u5904\u7406\u5de5\u5177\u7c7b \u65b0\u589e\uff1aTaskManager\uff0c\u5c01\u88c5\u4e86 TaskWorker \u8fdb\u7a0b\u7684\u5e94\u7528 \u65b0\u589e\uff1aCQObject\uff0c\u4f7f\u7528 CQ::getCQ() \u53ef\u83b7\u53d6\u5bf9\u8c61\u5f62\u5f0f\u7684 CQ \u7801\u89e3\u6790\u7ed3\u679c \u65b0\u589e\uff1a @OnTask \u6ce8\u89e3\uff0c\u7ed1\u5b9a\u4efb\u52a1\u51fd\u6570 \u65b0\u589e\uff1aRouteManager \u8def\u7531\u7ba1\u7406\u7c7b\uff0c\u53ef\u5feb\u901f\u6dfb\u52a0\u8def\u7531 \u4fee\u590d\uff1a ZM_DATA \u548c DataProvider::getDataFolder() \u8fd4\u56de false \u7684\u95ee\u9898 \u4f18\u5316\uff1a\u5173\u95ed\u663e\u793a\u505c\u6b62\u6846\u67b6\u540e\u591a\u4f59\u7684\u8f93\u51fa\u4fe1\u606f \u6ce8\uff1a\u672c\u6b21\u5347\u7ea7\u5efa\u8bae\u5347\u7ea7\u540e\u5408\u5e76\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\uff0c\u6709\u4e00\u4e9b\u65b0\u52a0\u7684\u5185\u5bb9\u3002 v2.2.11 \u66f4\u65b0\u65f6\u95f4\uff1a2021.3.13 \u65b0\u589e\uff1a\u5185\u90e8 ID \u7248\u672c\u53f7\uff08ZM_VERSION_ID\uff09 \u4f18\u5316\uff1a\u542f\u52a8\u65f6 log \u7684\u7b49\u7ea7 \u79fb\u9664\uff1a\u7ec8\u7aef\u8f93\u5165\u547d\u4ee4 \u4fee\u590d\uff1a\u7eaf HTTP \u670d\u52a1\u5668\u7684\u542f\u52a8 bug \u65b0\u589e\uff1a zm_timer \u7684\u62a5\u9519\u5904\u7406\uff0c\u9632\u6b62\u670d\u52a1\u5668\u76f4\u63a5\u5d29\u6389 v2.2.10 \u66f4\u65b0\u65f6\u95f4\uff1a2021.3.8 \u65b0\u589e\uff1a\u7528\u6237\u6001 php \u7f16\u8bd1\u811a\u672c build-runtime.sh \u79fb\u9664\uff1a\u65e0\u7528\u7684\u8c03\u8bd5\u4fe1\u606f \u65b0\u589e\uff1a --show-php-ver \u542f\u52a8\u53c2\u6570 v2.2.9 \u66f4\u65b0\u65f6\u95f4\uff1a2021.3.6 \u66f4\u65b0\uff1a reply() \u65b9\u6cd5\u4f20\u5165\u6570\u7ec4\u5219\u53d8\u4e3a\u5feb\u901f\u76f8\u5e94\u7684 API \u64cd\u4f5c \u4fee\u590d\uff1a\u5728 Worker \u8fdb\u7a0b\u4e0b\u8c03\u7528 ZMUtil::reload() \u4f1a\u5bfc\u81f4\u4e00\u4e9b\u5947\u602a\u7684 bug \u4fee\u590d\uff1a reply() \u65f6\u4f1a at \u79c1\u804a\u6210\u5458\u7684 bug\uff08\u7531 go-cqhttp \u5bfc\u81f4\uff09 v2.2.8 \u66f4\u65b0\u65f6\u95f4\uff1a2021.3.2 \u66f4\u65b0\uff1aMOTD \u663e\u793a\u7684\u65b9\u5f0f\uff0c\u66f4\u52a0\u76f4\u89c2\u548c\u70ab\u9177 v2.2.7 \u66f4\u65b0\u65f6\u95f4\uff1a2021.2.27 \u4fee\u590d\uff1a2.2.6 \u7248\u672c\u4e0b reply() \u65b9\u6cd5\u5728\u7fa4\u91cc\u8c03\u7528\u4f1a at \u6210\u5458\u7684 bug \u4fee\u590d\uff1a\u7a7a access_token \u7684\u60c5\u51b5\u4e0b\u4f1a\u65e0\u6cd5\u8fde\u5165\u7684 bug \u4fee\u590d\uff1a\u4f7f\u7528 Closure \u95ed\u5305\u51fd\u6570\u81ea\u884c\u7f16\u5199\u903b\u8f91\u7684\u5224\u65ad\u8fd4\u56de false \u65e0\u6cd5\u963b\u65ad\u8fde\u63a5\u7684 bug v2.2.6 \u66f4\u65b0\u65f6\u95f4\uff1a2021.2.26 \u65b0\u589e\uff1a uuidgen() \u5168\u5c40\u51fd\u6570\uff0c\u5feb\u901f\u751f\u6210 uuid \u4fee\u590d\uff1aMySQL rawQuery() \u5728\u53c2\u6570\u4e3a\u975e\u6570\u7ec4\u65f6\u4f1a\u62a5 Warning \u7684 bug \u65b0\u589e\uff1a\u793a\u4f8b\u6a21\u5757\u7684 API \u793a\u4f8b\uff1a\u4e00\u8a00\u67e5\u8be2 \u4f18\u5316\uff1a\u5220\u51cf\u90e8\u5206\u65e0\u7528\u4ee3\u7801 \u66f4\u6539\uff1a ctx()->reply() \u65b9\u6cd5\u6539\u4e3a\u8c03\u7528\u9690\u85cf\u65b9\u6cd5\uff1a .handle_quick_operation \u4fee\u590d\uff1a ctx()->finalReply() \u4e00\u76f4\u4ee5\u6765\u7684 bug\uff08\u672a\u963b\u65ad\u4e8b\u4ef6\uff09 \u65b0\u589e\uff1a access_token \u914d\u7f6e\u9879\u652f\u6301\u95ed\u5305\u51fd\u6570\u81ea\u884c\u8bbe\u8ba1\u5224\u65ad\u65b9\u5f0f\u548c\u903b\u8f91 \u65b0\u589e\uff1a\u5168\u5c40\u51fd\u6570 working_dir() v2.2.5 \u66f4\u65b0\u65f6\u95f4\uff1a2021.2.20 \u65b0\u589e\uff1a saveToJson() \u548c loadFromJson() \u65b9\u6cd5\uff08DataProvider \u7c7b\uff09 \u4fee\u590d\uff1a @OnSave \u6ce8\u89e3\u4e8b\u4ef6\u65e0\u6cd5\u5de5\u4f5c\u7684 bug \u8c03\u6574\uff1a\u81ea\u5b9a\u4e49\u8ba1\u65f6\u5668\u521b\u5efa\u65f6\u7684\u6027\u80fd\u8c03\u4f18 \u65b0\u589e\uff1aWorkerCache \u65b9\u6cd5\uff1a hasKey() \u65b0\u589e\uff1aSpinLock \u65b9\u6cd5\uff1a transaction() \uff08\u76f4\u63a5\u5728\u4e8b\u52a1\u4e2d\u4e0a\u9501\uff09 \u65b0\u589e\uff1aCQ \u65b9\u6cd5\uff1a getAllCQ() \uff0c _custom() \uff08\u83b7\u53d6\u6d88\u606f\u4e2d\u7684\u6240\u6709 CQ \u7801\uff09 \u4fee\u590d\uff1aCQ \u7c7b\u4e2d\u7684\u90e8\u5206 bug v2.2.4 \u66f4\u65b0\u65f6\u95f4\uff1a2021.2.7 \u4fee\u590d\uff1a\u7ec8\u7aef\u4ea4\u4e92\u5bfc\u81f4\u7684 ssh \u65ad\u6389\u540e CPU \u5360\u7528\u8fc7\u9ad8\u7684\u95ee\u9898 \u4fee\u590d\uff1aWorkerCache \u5728\u7f3a\u5c11\u914d\u7f6e\u6587\u4ef6\u4e0b\u5de5\u4f5c\u5f02\u5e38\u7684\u95ee\u9898 \u65b0\u589e\uff1a\u5168\u5c40\u51fd\u6570\uff1a zm_atomic() v2.2.3 \u66f4\u65b0\u65f6\u95f4\uff1a2021.1.30 \u4fee\u590d\uff1awaitMessage() \u5728 v2.2.2 \u7248\u672c\u4e2d\u4e0d\u53ef\u7528\u7684 bug \u4fee\u590d\uff1aaccess_token \u65e0\u6548\u7684\u95ee\u9898 v2.2.2 \u66f4\u65b0\u65f6\u95f4\uff1a2021.1.29 \u4fee\u590d\uff1a\u6a21\u5757\u6587\u4ef6\u9519\u8bef\u65f6\u907f\u514d\u5faa\u73af\u62a5\u9519 \u4f18\u5316\uff1a\u4ee3\u7801\u7ed3\u6784 \u4fee\u590d\uff1a\u5728\u4e0d\u540c\u8fdb\u7a0b\u65f6\u8c03\u7528\u673a\u5668\u4eba API \u65e0\u6cd5\u8fd4\u56de\u4e14\u62a5\u9519\u7684 bug \u4fee\u590d\uff1a\u673a\u5668\u4eba\u65e0\u6cd5\u8fde\u63a5\u7684\u95ee\u9898\uff082.1.6 ~ 2.2.1 \u53d7\u5f71\u54cd\uff09 v2.2.1 \u66f4\u65b0\u65f6\u95f4\uff1a2021.1.29 \u4fee\u590d\uff1a\u914d\u7f6e\u6587\u4ef6\u517c\u5bb9\u6027\u95ee\u9898 v2.2.0 \u66f4\u65b0\u65f6\u95f4\uff1a2021.1.29 \u65b0\u589e\uff1a @OnPipeMessageEvent \u6ce8\u89e3 \u65b0\u589e\uff1a\u8fdb\u7a0b\u7ba1\u7406\u5668 \u65b0\u589e\uff1a --daemon \u5b88\u62a4\u8fdb\u7a0b\u5316\u540e\u67e5\u770b\u72b6\u6001\u4ee5\u53ca\u4e00\u7cfb\u5217\u64cd\u4f5c\u7684\u547d\u4ee4\u884c \u65b0\u589e\uff1aWorkerCache \u4fee\u590d\uff1a\u8def\u7531\u95ee\u9898 \u4fee\u590d\uff1a http_header \u914d\u7f6e\u9879\u4e0d\u751f\u6548\u7684 bug \u4f18\u5316\uff1a\u6846\u67b6\u5185\u90e8\u6240\u6709\u5f02\u5e38\u5168\u90e8\u57fa\u4e8e ZMException \u4f18\u5316\uff1aSingletonTrait \u652f\u6301\u6269\u5c55 v2.1.6 \u66f4\u65b0\u65f6\u95f4\uff1a2021.1.18 \u4f18\u5316\uff1a\u4ee3\u7801\u7ed3\u6784 \u589e\u52a0\uff1a\u66f4\u591a\u63d0\u793a\u8bed \u4fee\u590d\uff1a\u5904\u7406\u7a7a\u683c\u6d88\u606f\u65f6\u7684\u62a5\u9519 \u4fee\u590d\uff1a\u4e0a\u4e0b\u6587\u7684bug v2.1.5 \u66f4\u65b0\u65f6\u95f4\uff1a2021.1.13 \u4f18\u5316\uff1a\u7ec8\u7aef\u5bf9 PHP Warning \u548c PHP Notice \u7684\u62a5\u9519\u4fe1\u606f\u663e\u793a\uff0c\u7edf\u4e00\u683c\u5f0f \u65b0\u589e\uff1a ctx()->getNumArg() \u4e0a\u4e0b\u6587\u4e2d\u5feb\u901f\u83b7\u53d6\u6570\u5b57\u7c7b\u578b\u7684\u53c2\u6570\u7684\u65b9\u6cd5 \u4f18\u5316\uff1a\u5220\u9664\u4e0d\u5fc5\u8981\u7684\u8c03\u8bd5\u4fe1\u606f \u4f18\u5316\uff1a\u8def\u7531\u7ec4\u4ef6\u5168\u9762\u66ff\u6362\u4e3a symfony/routing \uff0c\u517c\u5bb9\u6027\u548c\u7a33\u5b9a\u6027 up\uff01 v2.1.4 \u66f4\u65b0\u65f6\u95f4\uff1a2021.1.3 \u4fee\u590d\uff1a\u542f\u52a8\u65f6\u4f1a\u63d0\u793a\u4e22\u5931\u7c7b\u7684 bug \u4f18\u5316\uff1aHTTP \u54cd\u5e94\u7c7b\u5982\u679c\u88ab\u4f7f\u7528\u4e86\u5219\u4e00\u5f8b\u8fd4\u56de false \u4f18\u5316\uff1aPHP Warning \u7b49\u62a5\u9519\u7edf\u4e00\u6837\u5f0f v2.1.3 \u66f4\u65b0\u65f6\u95f4\uff1a2021.1.2 \u4fee\u590d\uff1a\u6ce8\u89e3\u89e3\u6790\u5668\u5728\u67d0\u79cd\u7279\u6b8a\u60c5\u51b5\u4e0b\u5bfc\u81f4\u7684 bug v2.1.2 \u66f4\u65b0\u65f6\u95f4\uff1a2021.1.2 \u4fee\u590d\uff1a\u5f15\u5165\u5305\u6a21\u5f0f\u542f\u52a8\u65f6\u4f1a\u5bfc\u81f4\u7684\u6ee1\u5c4f\u62a5\u9519 v2.1.1 \u66f4\u65b0\u65f6\u95f4\uff1a2021.1.2 \u4fee\u590d\uff1a\u81ea\u5b9a\u4e49\u52a0\u8f7d\u6ce8\u89e3\u9009\u5b9a composer.json \u6587\u4ef6\u9519\u8bef\u7684 bug v2.1.0 \u66f4\u65b0\u65f6\u95f4\uff1a2021.1.2 \u65b0\u589e\uff1a @OnOpenEvent \uff0c @OnCloseEvent \uff0c @OnMessageEvent \uff0c @OnRequestEvent \u4f18\u5316\u4e8b\u4ef6\u5206\u53d1\u5668\uff0c\u4fee\u590d\u4e00\u4e9b\u4e8b\u4ef6\u5206\u53d1\u8fc7\u7a0b\u4e2d\u7684 bug \u4fee\u590d @CQBefore \u4e8b\u4ef6\u7684 bug v2.0.3 \u66f4\u65b0\u65f6\u95f4\uff1a2020.12.31 \u4fee\u590d\uff1aCQBefore \u6ce8\u89e3\u4e8b\u4ef6\u5728 level \u4f4e\u4e8e 200 \u65f6\u65e0\u6cd5\u8c03\u7528\u7684 bug \u4fee\u590d\uff1aCQMetaEvent \u6ce8\u89e3\u4e8b\u4ef6\u8c03\u7528\u65f6\u62a5\u9519\u7684 bug v2.0.2 \u66f4\u65b0\u65f6\u95f4\uff1a2020.12.31 \u66f4\u65b0\uff1a\u5c06 CQ \u7801\u8c03\u7528\u7c7b\u66f4\u65b0\u5230\u4e0e\u6700\u65b0 OneBot \u6807\u51c6\u76f8\u517c\u5bb9\u7684\u72b6\u6001 v2.0.1 \u66f4\u65b0\u65f6\u95f4\uff1a2020.12.23 \u4fee\u590d\uff1a\u5f00\u5c4f\u62a5\u9519\u6587\u4ef6\u5939\u4e0d\u5b58\u5728 v2.0 \u66f4\u65b0\u65f6\u95f4\uff1a2020.12.23 \u5df2\u53d1\u5e03\u6b63\u5f0f\u7248\u3002","title":"\u66f4\u65b0\u65e5\u5fd7\uff08v2\uff09"},{"location":"update/v2/#v2","text":"","title":"\u66f4\u65b0\u65e5\u5fd7\uff08v2 \u7248\u672c\uff09"},{"location":"update/v2/#v251-build-416","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.7.9 \u4fee\u590d\uff1a\u811a\u624b\u67b6\u65e0\u6cd5\u6b63\u5e38\u4f7f\u7528 init \u547d\u4ee4\u7684 bug\u3002","title":"v2.5.1 (build 416)"},{"location":"update/v2/#v250-build-415","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.7.9 \u4ee5\u4e0b\u662f\u7248\u672c \u65b0\u589e\u5185\u5bb9 \uff1a \u65b0\u589e\u5168\u65b0\u7684\u6a21\u5757\u7cfb\u7edf\uff0c\u53ef\u6253\u5305\u6a21\u5757\uff08src \u76ee\u5f55\u4e0b\u7684\u5b50\u76ee\u5f55\u7528\u6237\u903b\u8f91\u4ee3\u7801\uff09\u4e3a phar \u683c\u5f0f\u8fdb\u884c\u5206\u53d1\u548c\u7248\u672c\u5907\u4efd\u3002 \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u65b0\u589e module_loader \u9879\uff0c\u7528\u4e8e\u914d\u7f6e\u5916\u90e8\u6a21\u5757\u52a0\u8f7d\u7684\u4e00\u4e9b\u8bbe\u7f6e\u3002 \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u65b0\u589e runtime \u914d\u7f6e\u9879\uff0c\u53ef\u81ea\u5b9a\u4e49\u914d\u7f6e Swoole \u7684\u4e00\u4e9b\u8fd0\u884c\u65f6\u53c2\u6570\uff0c\u76ee\u524d\u53ef\u914d\u7f6e\u4e00\u952e\u534f\u7a0b\u5316\u7684 Hook \u53c2\u6570\u548c Swoole Server \u7684\u542f\u52a8\u6a21\u5f0f\u3002 \u65b0\u589e module:list \u547d\u4ee4\uff0c\u7528\u4e8e\u67e5\u770b\u672a\u6253\u5305\u548c\u5df2\u6253\u5305\u7684\u6a21\u5757\u5217\u8868\u3002 \u65b0\u589e module:pack \u547d\u4ee4\uff0c\u7528\u4e8e\u6253\u5305\u73b0\u6709 src \u76ee\u5f55\u4e0b\u7684\u6a21\u5757\u3002 \u65b0\u589e module:unpack \u547d\u4ee4\uff0c\u7528\u4e8e\u89e3\u5305\u73b0\u6709\u7684 phar \u6a21\u5757\u5305\u3002 \u65b0\u589e\u6253\u5305\u6846\u67b6\u529f\u80fd\uff0c\u652f\u6301\u5c06\u7528\u6237\u7684\u6574\u4e2a\u9879\u76ee\u8fde\u540c\u70b8\u6bdb\u6846\u67b6\u6253\u5305\u4e3a\u4e00\u4e2a phar \u4fbf\u643a\u8fd0\u884c\uff0c\u4f7f\u7528\u547d\u4ee4 build \u3002 \u65b0\u589e\u5feb\u6377\u811a\u672c ./zhamao \uff0c\u6548\u679c\u540c vendor/bin/start \u6216 bin/start \u3002 \u65b0\u589e\u542f\u52a8\u53c2\u6570 --interact \uff1a\u53c8\u91cd\u65b0\u652f\u6301\u4ea4\u4e92\u7ec8\u7aef\u4e86\uff0c\u4f46\u8fd8\u662f\u6709\u70b9\u95ee\u9898\uff0c\u4e0d\u63a8\u8350\u4f7f\u7528\u3002 \u65b0\u589e\u542f\u52a8\u53c2\u6570 --disable-safe-exit \uff1a\u5982\u679c\u4f60\u7684\u9879\u76ee\u5728 Ctrl+C \u65f6\u603b\u662f\u5361\u4f4f\u4e14\u9879\u76ee\u5185\u6ca1\u6709\u4ec0\u4e48\u4f7f\u7528 LightCache \u7b49\u7f13\u5b58\u5728\u5185\u5b58\u7684\u6570\u636e\u53ef\u5f00\u542f\u9632\u6b62\u5173\u4e0d\u6389\u6846\u67b6\u3002 \u65b0\u589e\u542f\u52a8\u53c2\u6570 --preview \uff1a\u53ea\u663e\u793a\u53c2\u6570\uff0c\u4e0d\u542f\u52a8\u70b8\u6bdb\u6846\u67b6\u7684\u670d\u52a1\u5668\u3002 \u65b0\u589e\u542f\u52a8\u53c2\u6570 --force-load-module \uff1a\u5f3a\u5236\u6253\u5305\u72b6\u6001\u4e0b\u52a0\u8f7d\u7684\u6a21\u5757\uff08\u4f7f\u7528\u82f1\u6587\u9017\u53f7\u5206\u9694\u591a\u4e2a\u6a21\u5757\u540d\u79f0\uff09\u3002 CoroutinePool \u534f\u7a0b\u6c60\u65b0\u589e getRunningCoroutineCount \u65b9\u6cd5\uff0c\u7528\u4e8e\u67e5\u770b\u534f\u7a0b\u6c60\u4e2d\u7684\u534f\u7a0b\u6570\u91cf\u3002 DataProvider \u65b0\u589e getFrameworkRootDir() \u3001 getSourceRootDir() \uff0c\u5206\u522b\u4ee3\u8868\u83b7\u53d6\u6846\u67b6\u7684\u6839\u76ee\u5f55\u548c\u7528\u6237\u6e90\u7801\u6839\u76ee\u5f55\u3002\uff08\u8be6\u89c1\u4e0b\u65b9\u5bf9\u76ee\u5f55\u7684\u5b9a\u4e49\u89e3\u91ca\uff09 DataProvider \u4e2d getDataFolder \u65b0\u589e\u53c2\u6570 $second = '' \uff0c\u5982\u679c\u7ed9\u5b9a\uff0c\u5219\u81ea\u52a8\u521b\u5efa\u5b50\u76ee\u5f55 $second \u5e76\u8fd4\u56de\u3002 DataProvider \u65b0\u589e scanDirFiles() \u65b9\u6cd5\uff0c\u7528\u4e8e\u626b\u63cf\u76ee\u5f55\uff0c\u53ef\u9009\u62e9\u662f\u5426\u9012\u5f52\u3001\u662f\u5426\u8fd4\u56de\u76f8\u5bf9\u8def\u5f84\uff0c\u4e5f\u652f\u6301\u626b\u63cf Phar \u6587\u4ef6\u5185\u7684\u8def\u5f84\uff0c\u975e\u5e38\u597d\u7528\u3002 DataProvider \u65b0\u589e isRelativePath() \u65b9\u6cd5\uff0c\u68c0\u67e5\u8def\u5f84\u662f\u5426\u4e3a\u76f8\u5bf9\u8def\u5f84\uff08\u6839\u636e\u7b2c\u4e00\u4e2a\u5b57\u7b26\u662f\u5426\u662f '/' \u6765\u5224\u65ad\uff09\u3002 ZMUtil \u65b0\u589e getClassesPsr4() \u65b9\u6cd5\uff0c\u7528\u4e8e\u6839\u636e Psr-4 \u6807\u51c6\u6765\u83b7\u53d6\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u7c7b\u6587\u4ef6\u3002 \u65b0\u589e\u5168\u5c40\u9519\u8bef\u7801\uff0c\u53ef\u4ee5\u6839\u636e\u9519\u8bef\u7801\u5728\u6587\u6863\u5185\u5feb\u901f\u5b9a\u4f4d\u548c\u89e3\u51b3\u95ee\u9898\u3002 \u4e2d\u95f4\u4ef6\u548c\u6ce8\u89e3\u4e8b\u4ef6\u652f\u6301\u56de\u6eaf\uff0c\u53ef\u4ee5\u5feb\u901f\u67e5\u770b\u8c03\u7528\u6808\uff08\u6bd4\u5982\u4e2d\u95f4\u4ef6\u53ef\u4ee5\u77e5\u9053\u81ea\u5df1\u662f\u5728\u54ea\u4e2a\u6ce8\u89e3\u4e8b\u4ef6\u4e2d\u88ab\u8c03\u7528\uff09\u3002 \u4f7f\u7528 ./zhamao build \u6765\u6784\u5efa\u6846\u67b6\u7684 phar \u5305\u65f6\u589e\u52a0\u663e\u793a\u8fdb\u5ea6\u6761\u3002 EventDispatcher \u65b0\u589e\u65b9\u6cd5 getEid() \u548c getClass() \uff0c\u5206\u522b\u7528\u4e8e\u83b7\u53d6\u4e8b\u4ef6\u5206\u53d1 ID \u548c\u6ce8\u89e3\u4e8b\u4ef6\u7684\u6ce8\u89e3\u7c7b\u540d\u79f0\u3002 \u65b0\u589e EventTracer\uff0c\u7528\u4e8e\u8ffd\u8e2a\u4e8b\u4ef6\u7684\u8c03\u7528\u6808\u3002 \u4e2d\u95f4\u4ef6\u652f\u6301\u4f20\u53c2\u3002 MySQL \u6570\u636e\u5e93\u67e5\u8be2\u5668\u6539\u4e3a\u4f7f\u7528 doctrine/dbal \u7ec4\u4ef6\uff0c\u66f4\u7075\u6d3b\u548c\u7a33\u5b9a\u3002 \u65b0\u589e\u5bf9 SWOOLE_BASE \u6a21\u5f0f\u7684\u652f\u6301\uff08\u652f\u6301\u53ea\u542f\u52a8\u4e00\u4e2a\u8fdb\u7a0b\u7684 Server\uff09\u3002 \u4ee5\u4e0b\u662f\u7248\u672c \u4fee\u6539\u5185\u5bb9 \uff1a \u542f\u52a8\u6587\u4ef6 vendor/bin/start \u4fee\u6539\u4e3a shell \u811a\u672c\uff0c\u53ef\u81ea\u52a8\u5bfb\u627e PHP \u73af\u5883\u3002 \u5168\u5c40\u5f3a\u5236\u4f9d\u8d56 league/climate \u7ec4\u4ef6\u3002 \u4fee\u590d\u6846\u67b6\u542f\u52a8\u65f6\u7684\u4fe1\u606f\u663e\u793a\u6362\u884c\u95ee\u9898\u3002 \u4fee\u590d\u6846\u67b6\u4f7f\u7528 Phar \u65b9\u5f0f\u542f\u52a8\u65f6\u5bfc\u81f4\u7684\u62a5\u9519\u3002 \u4fee\u590d\u4f7f\u7528 Ctrl+C \u7ed3\u675f\u65f6\u4e00\u90e8\u5206\u7528\u6237\u5361\u4f4f\u7684 bug\u3002 \u8fdc\u7a0b\u548c\u672c\u5730\u7ec8\u7aef\u53bb\u6389 stop \u547d\u4ee4\uff0c\u5efa\u8bae\u76f4\u63a5\u4f7f\u7528\u53d1 SIGTERM \u65b9\u5f0f\u7ed3\u675f\u6846\u67b6\u3002 \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u7684 zm_data \u6839\u76ee\u5f55\u9ed8\u8ba4\u4fee\u6539\u4e3a WORKING_DIR \u3002 \u547d\u4ee4 systemd:generate \u4fee\u6539\u4e3a generate:systemd \u3002 \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u5220\u9664 server_event_handler_class \u9879\uff0c\u6b64\u9879\u5e9f\u5f03\u3002 \u4fee\u590d\u90e8\u5206 CQ \u7801\u89e3\u6790\u8fc7\u7a0b\u4e2d\u6ca1\u6709\u8f6c\u4e49\u7684\u95ee\u9898\u3002 \u5c06 ZMRobot \u7c7b\u8f6c\u79fb\u4e3a OneBotV11 \u7c7b\uff0c\u4f46\u63d0\u4f9b\u517c\u5bb9\u3002 \u4fee\u590d\u5728\u5b88\u62a4\u8fdb\u7a0b\u6a21\u5f0f\u4e0b\u4f7f\u7528 daemon:reload \u548c daemon:stop \u547d\u4ee4\u53ef\u80fd\u5931\u6548\u7684\u95ee\u9898\u3002 \u4fee\u590d systemd \u751f\u6210\u65f6\u811a\u672c\u76ee\u5f55\u9519\u8bef\u7684 bug\u3002 \u4fee\u590d PipeMessage \u7b49\u4e8b\u4ef6\u672a\u6355\u83b7\u9519\u8bef\u5bfc\u81f4\u5d29\u6e83\u7684\u95ee\u9898\u3002 ZM\\Http\\RouteManager \u79fb\u52a8\u5230 ZM\\Utils\\Manager\\RouteManager \uff0c\u4f46\u539f\u5730\u5740\u517c\u5bb9\u3002 \u4fee\u590d Terminal \u7c7b\u4f7f\u7528\u7684\u4e00\u4e9b\u95ee\u9898\u3002 \u5bf9 pcntl \u6269\u5c55\u6539\u4e3a\u53ef\u9009\u4f9d\u8d56\uff0c\u5f53 Swoole \u7248\u672c\u5927\u4e8e\u7b49\u4e8e 4.6.7 \u65f6\u4e0d\u9700\u8981\u5b89\u88c5 pcntl \u6269\u5c55\u3002 \u4fee\u6b63\u542f\u52a8\u65f6\u6846\u67b6\u5bf9\u7f3a\u7701\u914d\u7f6e\u9879\u7684\u4e00\u4e9b\u9ed8\u8ba4\u53c2\u6570\u3002 \u6ce8\u89e3 @OnSetup \u548c @SwooleHandler \u53ef\u76f4\u63a5\u4f7f\u7528\uff0c\u65e0\u9700\u8bbe\u7f6e server_event_handler_class \u5373\u53ef\u3002 \u4fee\u590d\u6846\u67b6\u5728\u4e00\u4e9b\u975e\u6b63\u5e38\u7ec8\u7aef\u4e2d\u8fd0\u884c\u65f6\u5bfc\u81f4\u9519\u8bef\u7684\u95ee\u9898\u3002 \u4f7f\u7528 --debug-mode \u53c2\u6570\u65f6\uff0c\u81ea\u52a8\u5f00\u542f\u70ed\u66f4\u65b0\u3002 \u4fee\u590d\u811a\u624b\u67b6\u5728\u4f7f\u7528 composer \u66f4\u65b0\u540e\u68c0\u67e5\u5168\u5c40\u914d\u7f6e\u529f\u80fd\u7684 bug\u3002 \u4fee\u590d\u91cd\u542f\u548c\u5173\u95ed\u6846\u67b6\u65f6\u9020\u6210\u7684\u975e\u6b63\u5e38\u8fde\u63a5\u65ad\u5f00\u3002 \u6539\u7528\u72ec\u7acb\u8fdb\u7a0b\u76d1\u542c\u6587\u4ef6\u53d8\u5316\u548c\u7ec8\u7aef\u8f93\u5165\u3002 \u4fee\u590d\u6709\u534f\u7a0b\u4e2d\u65ad\u7684\u4efb\u52a1\u65f6\u505c\u6b62\u670d\u52a1\u5668\u4f1a\u62a5 Swoole \u8b66\u544a\u7684 bug\u3002 \u4fee\u590d\u8fde\u63a5\u88ab\u53cd\u590d\u65ad\u5f00\u7684\u95ee\u9898\u3002 \u5bf9\u76ee\u5f55\u7684\u5b9a\u4e49\u89e3\u91ca \uff1a \u5728 2.4.4 \u7248\u672c\u4e4b\u524d\uff0c\u4f7f\u7528\u70b8\u6bdb\u6846\u67b6\u4e2d\uff0c\u53ea\u542b\u6709\u4e24\u79cd\u76ee\u5f55\uff0c getWorkingDir \u548c getDataFolder \uff0c\u5206\u522b\u4ee3\u8868\u83b7\u53d6\u5de5\u4f5c\u76ee\u5f55\u548c\u6570\u636e\u76ee\u5f55\u3002\u5728 2.5 \u7248\u672c\u4e2d\uff0c\u53c8\u65b0\u589e\u4e86 getFrameworkRootDir \u4ee3\u8868\u83b7\u53d6\u6846\u67b6\u7684\u6839\u76ee\u5f55\uff0c getSourceRootDir \u4ee3\u8868\u83b7\u53d6\u6e90\u7801\u7684\u6839\u76ee\u5f55\u3002 \u4ee5 Composer \u8fd0\u884c\u6a21\u5f0f\u4e3e\u4f8b\uff0c\u5982\u679c\u4f60\u4f7f\u7528 composer create-project zhamao/framework-starter \u547d\u4ee4\u65b0\u5efa\u7684\u6846\u67b6\uff0c\u90a3\u4e48\u5047\u8bbe\u6211\u4eec\u4ece /app \u76ee\u5f55\u4e0b\u8fd0\u884c\u6b64\u547d\u4ee4\uff0c\u7136\u540e\u4f7f\u7528 cd framework-starter/ \u8fdb\u5165\u9879\u76ee\u76ee\u5f55\uff0c\u6b64\u65f6\u6211\u4eec\u4f7f\u7528 vendor/bin/start server \u547d\u4ee4\u8fd0\u884c\u670d\u52a1\u5668\uff0c\u5bf9\u5e94\u7684\u76ee\u5f55\u4e3a\uff1a WorkingDir \uff1a /app/framework-starter/ SourceRootDir \uff1a /app/framework-starter/ FrameworkRootDir \uff1a /app/framework-starter/vendor/zhamao/framework/ \u5982\u679c\u4ee5\u6e90\u7801\u6a21\u5f0f\uff08\u76f4\u63a5\u514b\u9686 zhamao-framework.git \u4ed3\u5e93\uff09\uff0c\u542f\u52a8\u6846\u67b6\uff0c\u90a3\u4e48\u4f7f\u7528\u547d\u4ee4 bin/start server \u542f\u52a8\u6846\u67b6\u540e\uff0c\u4ee5\u4e0a\u4e09\u4e2a\u8fd4\u56de\u7684\u76ee\u5f55\u5219\u5b8c\u5168\u76f8\u540c\u3002 \u5982\u679c\u4ee5 2.5 \u7248\u672c\u65b0\u7684\u9879\u76ee\u5f52\u6863\u6a21\u5f0f\uff08build\uff09\u542f\u52a8\u6846\u67b6\uff0c\u5047\u8bbe\u6211\u4eec\u7684\u9879\u76ee\u4ee3\u7801\u6253\u5305\u4e3a server.phar \uff0c\u5728 /app/ \u76ee\u5f55\uff0c\u6211\u4eec\u4f7f\u7528\u547d\u4ee4 php server.phar server \u542f\u52a8\u70b8\u6bdb\u6846\u67b6\uff0c\u90a3\u4e48\u5b83\u5bf9\u5e94\u7684\u76ee\u5f55\u4e3a\uff1a WorkingDir \uff1a /app/ SourceRootDir \uff1a phar:///app/server.phar/ FrameworkRootDir \uff1a phar:///app/server.phar/vendor/zhamao/framework/ \u5982\u679c\u6700\u540e\u4e00\u79cd\u5f52\u6863\u65b9\u5f0f\u542f\u52a8\u7684\u6846\u67b6\u662f\u4ece\u6e90\u7801\u6a21\u5f0f\u6253\u5305\u800c\u6765\uff0c\u90a3\u4e48 FrameworkRootDir \u5c31\u4e0e SourceRootDir \u76f8\u540c\u3002 \u7248\u672c\u90e8\u5206\u517c\u5bb9\u95ee\u9898\u53d8\u5316 \uff1a \u7406\u8bba\u4e0a\u5982\u679c\u4e0d\u4f7f\u7528\u6846\u67b6\u5185\u90e8\u672a\u5f00\u653e\u7684\u63a5\u53e3\u65b9\u6cd5\u7684\u8bdd\uff0c\u4ece 2.4 \u5347\u7ea7\u5230 2.5 \u662f\u975e\u5e38\u81ea\u7136\u7684\uff0c\u4f46\u662f\u4e5f\u6709\u4e00\u90e8\u5206\u53ef\u80fd\u4f1a\u9020\u6210\u4e0d\u517c\u5bb9\u7684\u95ee\u9898\u3002 \u751f\u6210 systemd \u914d\u7f6e\u6587\u4ef6\u7684\u547d\u4ee4 systemd:generate \u53d8\u6210 generate:systemd \u3002 \u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 zm_data \u7684\u7236\u76ee\u5f55\u7531 __DIR__ . \"/../\" \u6539\u4e3a WORKING_DIR \u3002 2.5 \u7248\u672c\u5c06 ZMRobot \u7c7b\u4e2d\u7684\u6240\u6709\u51fd\u6570\u65b9\u6cd5\u90fd\u79fb\u52a8\u5230\u4e86 OneBotV11 \u7c7b\u4e2d\uff0c\u4f46\u539f\u5148\u7684 ZMRobot \u8fd8\u53ef\u4ee5\u4f7f\u7528\u3002","title":"v2.5.0 (build 415)"},{"location":"update/v2/#v244-build-405","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.3.29 \u4ee5\u4e0b\u662f\u53ef\u80fd\u4e0d\u517c\u5bb9\u7684\u53d8\u66f4\uff1a \u65b0\u589e\u4f9d\u8d56\uff1a\u6846\u67b6\u9700\u8981 PHP \u5b89\u88c5 pcntl \u6269\u5c55\u4ee5\u53ca\u5f00\u542f pcntl_signal \u51fd\u6570\uff08\u4e00\u822c\u60c5\u51b5\u4e0b\u7f16\u8bd1\u5b89\u88c5\u7684\u90fd\u4f1a\u6709\uff0c\u5b9d\u5854\u9762\u677f\u8bf7\u624b\u52a8\u89e3\u9664\u51fd\u6570\u7981\u7528\uff09","title":"v2.4.4 (build 405)"},{"location":"update/v2/#v243-build-403","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.3.29 \u65b0\u589e\uff1aswoole \u8bbe\u7f6e\u914d\u7f6e\u65b0\u589e max_wait_time \u9879\uff0c\u8bbe\u7f6e\u7b49\u5f85\u8fdb\u7a0b\u5173\u95ed\u6d41\u7a0b\u6700\u5927\u65f6\u95f4\uff08\u79d2\uff09 \u65b0\u589e\uff1a\u5e38\u91cf MAIN_WORKER \uff0c\u503c\u7b49\u540c\u4e8e worker_cache \u9879\u4e2d\u7684 worker \u53c2\u6570\uff08WorkerCache \u6240\u5728\u7684\u8fdb\u7a0b\uff09 \u65b0\u589e\uff1a LightCache \u65b0\u589e getExpireTS() \u65b9\u6cd5\uff0c\u7528\u4e8e\u8fd4\u56de\u9879\u76ee\u8fc7\u671f\u7684\u65f6\u95f4\u6233 \u4fee\u590d\uff1a savePersistence() \u7684\u90e8\u5206\u4e22\u5931\u6570\u636e\u7684 bug \u65b0\u589e\uff1a\u5168\u5c40\u65b9\u6cd5 zm_go() \u4fee\u590d\uff1a2.4.2 \u7248\u672c\u4e0b\u7684\u5237\u5c4f\u62a5\u9519 \u4f18\u5316\uff1aCtrl+C \u54cd\u5e94\u673a\u5236\uff0c\u542f\u7528\u5f02\u6b65 \u91cd\u542f/\u5173\u95ed \u63aa\u65bd\uff0c\u9632\u6b62\u6b8b\u7559\u50f5\u5c38\u8fdb\u7a0b\u548c\u4e22\u5931\u6570\u636e","title":"v2.4.3 (build 403)"},{"location":"update/v2/#v242-build-402","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.3.27 \u66f4\u6539\uff1a WORKING_DIR \u5e38\u91cf\u7684\u542b\u4e49 \u4fee\u590d\uff1a\u672a\u6307\u5b9a --remote-terminal \u53c2\u6570\u65f6\u8fd8\u4f9d\u65e7\u5f00\u542f\u8fdc\u7a0b\u7ec8\u7aef\u7684 bug \u5220\u9664\uff1a phar_classloader() \u5168\u5c40\u65b9\u6cd5 \u66f4\u6539\uff1a\u6301\u4e45\u5316\u5b58\u50a8 LightCache \u7684\u903b\u8f91\uff0c\u4fee\u590d\u4e00\u4e2a\u611a\u8822\u7684\u5bb9\u6613\u9020\u6210\u8bef\u7528\u7684\u65b9\u5f0f \u65b0\u589e\uff1aLightCache \u65b9\u6cd5 addPersistence() \u548c removePersistence() \u65b0\u589e\uff1a\u6846\u67b6\u542f\u52a8\u77ed\u6307\u4ee4 ./zhamao \u6216 php zhamao","title":"v2.4.2 (build 402)"},{"location":"update/v2/#v241-build-401","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.3.25 \u4fee\u590d\uff1a\u5f00\u542f\u6846\u67b6\u65f6\u5bfc\u81f4\u7684\u62a5\u9519","title":"v2.4.1 (build 401)"},{"location":"update/v2/#v240build-400","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.3.25 \u65b0\u589e\uff1a\u68c0\u67e5\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u7684\u547d\u4ee4 \u65b0\u589e\uff1a\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u66f4\u65b0\u8bb0\u5f55 \u4f9d\u8d56\u53d8\u66f4\uff1a Swoole \u6700\u4f4e\u7248\u672c\u9700\u8981 4.5.0 \u4f18\u5316\uff1areload \u548c stop \u547d\u4ee4\u91cd\u8f7d\u548c\u505c\u6b62\u6846\u67b6\u7684\u903b\u8f91 \u65b0\u589e\uff1a $_running_annotation \u53d8\u91cf\uff0c\u53ef\u5728\u6ce8\u89e3\u4e8b\u4ef6\u4e2d\u7684\u7c7b\u4f7f\u7528 \u65b0\u589e\uff1a\u8fdc\u7a0b\u7ec8\u7aef\uff08Remote Terminal\uff09\uff0c\u5f25\u8865\u539f\u6765\u5220\u6389\u7684\u672c\u5730\u7ec8\u7aef\uff0c\u901a\u8fc7 nc \u547d\u4ee4\u8fde\u63a5\u5373\u53ef \u65b0\u589e\uff1a\u542f\u52a8\u53c2\u6570 --worker-num \uff0c --task-worker-num \uff0c --remote-terminal \u66f4\u65b0\uff1a\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\u7ed3\u6784 \u65b0\u589e\uff1aSwoole \u8ba1\u65f6\u5668\u62a5\u9519\u5904\u7406 \u65b0\u589e\uff1a\u5168\u5c40\u65b9\u6cd5\uff08 zm_dump() \uff0c zm_error() \uff0c zm_warning() \uff0c zm_info() \uff0c zm_success() \uff0c zm_verbose() \uff0c zm_debug() \uff0c zm_config() \uff09 \u65b0\u589e\uff1a\u793a\u4f8b\u6a21\u5757\u7684\u56fe\u7075\u673a\u5668\u4eba\u548c at \u673a\u5668\u4eba\u7684\u5904\u7406\u51fd\u6570 \u65b0\u589e\uff1aMessageUtil \u5de5\u5177\u7c7b\u65b0\u589e isAtMe(), splitCommand(), matchCommand() \u65b9\u6cd5 \u65b0\u589e\uff1aProcessManager \u8fdb\u7a0b\u7ba1\u7406\u7c7b\u65b0\u589e workerAction(), sendActionToWorker(), resumeAllWorkerCoroutines() \u65b9\u6cd5 \u4f18\u5316\uff1aCQCommand \u7684\u5339\u914d\u903b\u8f91 \u65b0\u589e\uff1a\u652f\u6301\u6dfb\u52a0\u81ea\u5b9a\u4e49\u8fdc\u7a0b\u7ec8\u7aef\u6307\u4ee4\u7684 @TerminalCommand \u6ce8\u89e3 \u65b0\u589e\uff1a\u56fe\u7075\u673a\u5668\u4eba API \u5c01\u88c5\u51fd\u6570 \u65b0\u589e\uff1aZMUtil \u5de5\u5177\u6742\u9879\u7c7b getReloadableFiles() \u51fd\u6570 \u65b0\u589e\uff1a vendor/bin/start systemd:generate \u751f\u6210 systemd \u914d\u7f6e\u6587\u4ef6\u7684\u529f\u80fd \u65b0\u589e\uff1a vendor/bin/start check:config \u68c0\u67e5\u914d\u7f6e\u6587\u4ef6\u66f4\u65b0\u7684\u547d\u4ee4 \u65b0\u589e\uff1a vendor/bin/start init \u65b0\u589e --force \u53c2\u6570\uff0c\u8986\u76d6\u73b0\u6709\u6587\u4ef6\u91cd\u65b0\u751f\u6210 \u65b0\u589e\uff1aMessageUtil \u65b0\u589e\u65b9\u6cd5\uff1a addShortCommand() \uff0c\u7528\u4e8e\u5feb\u901f\u6dfb\u52a0\u9759\u6001\u6587\u672c\u95ee\u7b54\u56de\u590d\u7684 \u4ee5\u4e0b\u662f\u9700\u8981 \u624b\u52a8\u66f4\u65b0 \u6216 \u66f4\u6362\u65b0\u5199\u6cd5 \u7684\u90e8\u5206\uff1a \u914d\u7f6e\u6587\u4ef6 global.php \u4e2d\u7684 modules \u5b57\u6bb5\u5c55\u5f00\uff0c\u5185\u7f6e\u6a21\u5757\u7684\u914d\u7f6e\u4e00\u5f8b\u5e73\u94fa\u5230\u5916\u9762\u3002\u8be6\u89c1 \u66f4\u65b0\u65e5\u5fd7 - \u914d\u7f6e\u6587\u4ef6\u53d8\u66f4 \u3002 \u4ee5\u4e0b\u662f\u9ed8\u8ba4\u673a\u5668\u4eba\u76f4\u63a5\u8fde\u63a5\u4ea7\u751f\u7684\u53d8\u66f4\uff1a 2.4.0 \u65b0\u589e\u4e86\u9ed8\u8ba4\u56de\u590d\u5176\u4ed6\u4eba at \u7684\u6d88\u606f\uff0c\u5982\u679c\u4e0d\u9700\u8981\uff0c\u8bf7\u5c06 Hello.php \u4e2d\u7684 changeAt() \u548c turingAPI() \u65b9\u6cd5\u5220\u9664\u3002","title":"v2.4.0\uff08build 400\uff09"},{"location":"update/v2/#v235-build-398","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.3.23 \u4fee\u590d\uff1aMySQL \u6570\u636e\u5e93\u67e5\u8be2\u5bfc\u81f4\u7684\u4e00\u7cfb\u5217\u95ee\u9898 \u4fee\u590d\uff1a\u5185\u5b58\u6cc4\u9732\u95ee\u9898 2.3.2-2.3.4 \u7248\u672c\u7531\u4e8e\u64cd\u4f5c\u5931\u8bef\u5bfc\u81f4\u4ee3\u7801\u4e0d\u5b8c\u6574\uff0c\u8bf7\u76f4\u63a5\u4f7f\u7528 2.3.5 \u5373\u53ef\u3002","title":"v2.3.5 (build 398)"},{"location":"update/v2/#v231","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.3.18 \u89c4\u8303\u4ee3\u7801\uff0c\u4fee\u590d\u4e00\u4e2a\u5c0f\u62a5\u9519\u7684 bug","title":"v2.3.1"},{"location":"update/v2/#v230","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.3.16 \u65b0\u589e\uff1aMessageUtil \u6d88\u606f\u5904\u7406\u5de5\u5177\u7c7b \u65b0\u589e\uff1aTaskManager\uff0c\u5c01\u88c5\u4e86 TaskWorker \u8fdb\u7a0b\u7684\u5e94\u7528 \u65b0\u589e\uff1aCQObject\uff0c\u4f7f\u7528 CQ::getCQ() \u53ef\u83b7\u53d6\u5bf9\u8c61\u5f62\u5f0f\u7684 CQ \u7801\u89e3\u6790\u7ed3\u679c \u65b0\u589e\uff1a @OnTask \u6ce8\u89e3\uff0c\u7ed1\u5b9a\u4efb\u52a1\u51fd\u6570 \u65b0\u589e\uff1aRouteManager \u8def\u7531\u7ba1\u7406\u7c7b\uff0c\u53ef\u5feb\u901f\u6dfb\u52a0\u8def\u7531 \u4fee\u590d\uff1a ZM_DATA \u548c DataProvider::getDataFolder() \u8fd4\u56de false \u7684\u95ee\u9898 \u4f18\u5316\uff1a\u5173\u95ed\u663e\u793a\u505c\u6b62\u6846\u67b6\u540e\u591a\u4f59\u7684\u8f93\u51fa\u4fe1\u606f \u6ce8\uff1a\u672c\u6b21\u5347\u7ea7\u5efa\u8bae\u5347\u7ea7\u540e\u5408\u5e76\u5168\u5c40\u914d\u7f6e\u6587\u4ef6\uff0c\u6709\u4e00\u4e9b\u65b0\u52a0\u7684\u5185\u5bb9\u3002","title":"v2.3.0"},{"location":"update/v2/#v2211","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.3.13 \u65b0\u589e\uff1a\u5185\u90e8 ID \u7248\u672c\u53f7\uff08ZM_VERSION_ID\uff09 \u4f18\u5316\uff1a\u542f\u52a8\u65f6 log \u7684\u7b49\u7ea7 \u79fb\u9664\uff1a\u7ec8\u7aef\u8f93\u5165\u547d\u4ee4 \u4fee\u590d\uff1a\u7eaf HTTP \u670d\u52a1\u5668\u7684\u542f\u52a8 bug \u65b0\u589e\uff1a zm_timer \u7684\u62a5\u9519\u5904\u7406\uff0c\u9632\u6b62\u670d\u52a1\u5668\u76f4\u63a5\u5d29\u6389","title":"v2.2.11"},{"location":"update/v2/#v2210","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.3.8 \u65b0\u589e\uff1a\u7528\u6237\u6001 php \u7f16\u8bd1\u811a\u672c build-runtime.sh \u79fb\u9664\uff1a\u65e0\u7528\u7684\u8c03\u8bd5\u4fe1\u606f \u65b0\u589e\uff1a --show-php-ver \u542f\u52a8\u53c2\u6570","title":"v2.2.10"},{"location":"update/v2/#v229","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.3.6 \u66f4\u65b0\uff1a reply() \u65b9\u6cd5\u4f20\u5165\u6570\u7ec4\u5219\u53d8\u4e3a\u5feb\u901f\u76f8\u5e94\u7684 API \u64cd\u4f5c \u4fee\u590d\uff1a\u5728 Worker \u8fdb\u7a0b\u4e0b\u8c03\u7528 ZMUtil::reload() \u4f1a\u5bfc\u81f4\u4e00\u4e9b\u5947\u602a\u7684 bug \u4fee\u590d\uff1a reply() \u65f6\u4f1a at \u79c1\u804a\u6210\u5458\u7684 bug\uff08\u7531 go-cqhttp \u5bfc\u81f4\uff09","title":"v2.2.9"},{"location":"update/v2/#v228","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.3.2 \u66f4\u65b0\uff1aMOTD \u663e\u793a\u7684\u65b9\u5f0f\uff0c\u66f4\u52a0\u76f4\u89c2\u548c\u70ab\u9177","title":"v2.2.8"},{"location":"update/v2/#v227","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.2.27 \u4fee\u590d\uff1a2.2.6 \u7248\u672c\u4e0b reply() \u65b9\u6cd5\u5728\u7fa4\u91cc\u8c03\u7528\u4f1a at \u6210\u5458\u7684 bug \u4fee\u590d\uff1a\u7a7a access_token \u7684\u60c5\u51b5\u4e0b\u4f1a\u65e0\u6cd5\u8fde\u5165\u7684 bug \u4fee\u590d\uff1a\u4f7f\u7528 Closure \u95ed\u5305\u51fd\u6570\u81ea\u884c\u7f16\u5199\u903b\u8f91\u7684\u5224\u65ad\u8fd4\u56de false \u65e0\u6cd5\u963b\u65ad\u8fde\u63a5\u7684 bug","title":"v2.2.7"},{"location":"update/v2/#v226","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.2.26 \u65b0\u589e\uff1a uuidgen() \u5168\u5c40\u51fd\u6570\uff0c\u5feb\u901f\u751f\u6210 uuid \u4fee\u590d\uff1aMySQL rawQuery() \u5728\u53c2\u6570\u4e3a\u975e\u6570\u7ec4\u65f6\u4f1a\u62a5 Warning \u7684 bug \u65b0\u589e\uff1a\u793a\u4f8b\u6a21\u5757\u7684 API \u793a\u4f8b\uff1a\u4e00\u8a00\u67e5\u8be2 \u4f18\u5316\uff1a\u5220\u51cf\u90e8\u5206\u65e0\u7528\u4ee3\u7801 \u66f4\u6539\uff1a ctx()->reply() \u65b9\u6cd5\u6539\u4e3a\u8c03\u7528\u9690\u85cf\u65b9\u6cd5\uff1a .handle_quick_operation \u4fee\u590d\uff1a ctx()->finalReply() \u4e00\u76f4\u4ee5\u6765\u7684 bug\uff08\u672a\u963b\u65ad\u4e8b\u4ef6\uff09 \u65b0\u589e\uff1a access_token \u914d\u7f6e\u9879\u652f\u6301\u95ed\u5305\u51fd\u6570\u81ea\u884c\u8bbe\u8ba1\u5224\u65ad\u65b9\u5f0f\u548c\u903b\u8f91 \u65b0\u589e\uff1a\u5168\u5c40\u51fd\u6570 working_dir()","title":"v2.2.6"},{"location":"update/v2/#v225","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.2.20 \u65b0\u589e\uff1a saveToJson() \u548c loadFromJson() \u65b9\u6cd5\uff08DataProvider \u7c7b\uff09 \u4fee\u590d\uff1a @OnSave \u6ce8\u89e3\u4e8b\u4ef6\u65e0\u6cd5\u5de5\u4f5c\u7684 bug \u8c03\u6574\uff1a\u81ea\u5b9a\u4e49\u8ba1\u65f6\u5668\u521b\u5efa\u65f6\u7684\u6027\u80fd\u8c03\u4f18 \u65b0\u589e\uff1aWorkerCache \u65b9\u6cd5\uff1a hasKey() \u65b0\u589e\uff1aSpinLock \u65b9\u6cd5\uff1a transaction() \uff08\u76f4\u63a5\u5728\u4e8b\u52a1\u4e2d\u4e0a\u9501\uff09 \u65b0\u589e\uff1aCQ \u65b9\u6cd5\uff1a getAllCQ() \uff0c _custom() \uff08\u83b7\u53d6\u6d88\u606f\u4e2d\u7684\u6240\u6709 CQ \u7801\uff09 \u4fee\u590d\uff1aCQ \u7c7b\u4e2d\u7684\u90e8\u5206 bug","title":"v2.2.5"},{"location":"update/v2/#v224","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.2.7 \u4fee\u590d\uff1a\u7ec8\u7aef\u4ea4\u4e92\u5bfc\u81f4\u7684 ssh \u65ad\u6389\u540e CPU \u5360\u7528\u8fc7\u9ad8\u7684\u95ee\u9898 \u4fee\u590d\uff1aWorkerCache \u5728\u7f3a\u5c11\u914d\u7f6e\u6587\u4ef6\u4e0b\u5de5\u4f5c\u5f02\u5e38\u7684\u95ee\u9898 \u65b0\u589e\uff1a\u5168\u5c40\u51fd\u6570\uff1a zm_atomic()","title":"v2.2.4"},{"location":"update/v2/#v223","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.1.30 \u4fee\u590d\uff1awaitMessage() \u5728 v2.2.2 \u7248\u672c\u4e2d\u4e0d\u53ef\u7528\u7684 bug \u4fee\u590d\uff1aaccess_token \u65e0\u6548\u7684\u95ee\u9898","title":"v2.2.3"},{"location":"update/v2/#v222","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.1.29 \u4fee\u590d\uff1a\u6a21\u5757\u6587\u4ef6\u9519\u8bef\u65f6\u907f\u514d\u5faa\u73af\u62a5\u9519 \u4f18\u5316\uff1a\u4ee3\u7801\u7ed3\u6784 \u4fee\u590d\uff1a\u5728\u4e0d\u540c\u8fdb\u7a0b\u65f6\u8c03\u7528\u673a\u5668\u4eba API \u65e0\u6cd5\u8fd4\u56de\u4e14\u62a5\u9519\u7684 bug \u4fee\u590d\uff1a\u673a\u5668\u4eba\u65e0\u6cd5\u8fde\u63a5\u7684\u95ee\u9898\uff082.1.6 ~ 2.2.1 \u53d7\u5f71\u54cd\uff09","title":"v2.2.2"},{"location":"update/v2/#v221","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.1.29 \u4fee\u590d\uff1a\u914d\u7f6e\u6587\u4ef6\u517c\u5bb9\u6027\u95ee\u9898","title":"v2.2.1"},{"location":"update/v2/#v220","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.1.29 \u65b0\u589e\uff1a @OnPipeMessageEvent \u6ce8\u89e3 \u65b0\u589e\uff1a\u8fdb\u7a0b\u7ba1\u7406\u5668 \u65b0\u589e\uff1a --daemon \u5b88\u62a4\u8fdb\u7a0b\u5316\u540e\u67e5\u770b\u72b6\u6001\u4ee5\u53ca\u4e00\u7cfb\u5217\u64cd\u4f5c\u7684\u547d\u4ee4\u884c \u65b0\u589e\uff1aWorkerCache \u4fee\u590d\uff1a\u8def\u7531\u95ee\u9898 \u4fee\u590d\uff1a http_header \u914d\u7f6e\u9879\u4e0d\u751f\u6548\u7684 bug \u4f18\u5316\uff1a\u6846\u67b6\u5185\u90e8\u6240\u6709\u5f02\u5e38\u5168\u90e8\u57fa\u4e8e ZMException \u4f18\u5316\uff1aSingletonTrait \u652f\u6301\u6269\u5c55","title":"v2.2.0"},{"location":"update/v2/#v216","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.1.18 \u4f18\u5316\uff1a\u4ee3\u7801\u7ed3\u6784 \u589e\u52a0\uff1a\u66f4\u591a\u63d0\u793a\u8bed \u4fee\u590d\uff1a\u5904\u7406\u7a7a\u683c\u6d88\u606f\u65f6\u7684\u62a5\u9519 \u4fee\u590d\uff1a\u4e0a\u4e0b\u6587\u7684bug","title":"v2.1.6"},{"location":"update/v2/#v215","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.1.13 \u4f18\u5316\uff1a\u7ec8\u7aef\u5bf9 PHP Warning \u548c PHP Notice \u7684\u62a5\u9519\u4fe1\u606f\u663e\u793a\uff0c\u7edf\u4e00\u683c\u5f0f \u65b0\u589e\uff1a ctx()->getNumArg() \u4e0a\u4e0b\u6587\u4e2d\u5feb\u901f\u83b7\u53d6\u6570\u5b57\u7c7b\u578b\u7684\u53c2\u6570\u7684\u65b9\u6cd5 \u4f18\u5316\uff1a\u5220\u9664\u4e0d\u5fc5\u8981\u7684\u8c03\u8bd5\u4fe1\u606f \u4f18\u5316\uff1a\u8def\u7531\u7ec4\u4ef6\u5168\u9762\u66ff\u6362\u4e3a symfony/routing \uff0c\u517c\u5bb9\u6027\u548c\u7a33\u5b9a\u6027 up\uff01","title":"v2.1.5"},{"location":"update/v2/#v214","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.1.3 \u4fee\u590d\uff1a\u542f\u52a8\u65f6\u4f1a\u63d0\u793a\u4e22\u5931\u7c7b\u7684 bug \u4f18\u5316\uff1aHTTP \u54cd\u5e94\u7c7b\u5982\u679c\u88ab\u4f7f\u7528\u4e86\u5219\u4e00\u5f8b\u8fd4\u56de false \u4f18\u5316\uff1aPHP Warning \u7b49\u62a5\u9519\u7edf\u4e00\u6837\u5f0f","title":"v2.1.4"},{"location":"update/v2/#v213","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.1.2 \u4fee\u590d\uff1a\u6ce8\u89e3\u89e3\u6790\u5668\u5728\u67d0\u79cd\u7279\u6b8a\u60c5\u51b5\u4e0b\u5bfc\u81f4\u7684 bug","title":"v2.1.3"},{"location":"update/v2/#v212","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.1.2 \u4fee\u590d\uff1a\u5f15\u5165\u5305\u6a21\u5f0f\u542f\u52a8\u65f6\u4f1a\u5bfc\u81f4\u7684\u6ee1\u5c4f\u62a5\u9519","title":"v2.1.2"},{"location":"update/v2/#v211","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.1.2 \u4fee\u590d\uff1a\u81ea\u5b9a\u4e49\u52a0\u8f7d\u6ce8\u89e3\u9009\u5b9a composer.json \u6587\u4ef6\u9519\u8bef\u7684 bug","title":"v2.1.1"},{"location":"update/v2/#v210","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2021.1.2 \u65b0\u589e\uff1a @OnOpenEvent \uff0c @OnCloseEvent \uff0c @OnMessageEvent \uff0c @OnRequestEvent \u4f18\u5316\u4e8b\u4ef6\u5206\u53d1\u5668\uff0c\u4fee\u590d\u4e00\u4e9b\u4e8b\u4ef6\u5206\u53d1\u8fc7\u7a0b\u4e2d\u7684 bug \u4fee\u590d @CQBefore \u4e8b\u4ef6\u7684 bug","title":"v2.1.0"},{"location":"update/v2/#v203","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.12.31 \u4fee\u590d\uff1aCQBefore \u6ce8\u89e3\u4e8b\u4ef6\u5728 level \u4f4e\u4e8e 200 \u65f6\u65e0\u6cd5\u8c03\u7528\u7684 bug \u4fee\u590d\uff1aCQMetaEvent \u6ce8\u89e3\u4e8b\u4ef6\u8c03\u7528\u65f6\u62a5\u9519\u7684 bug","title":"v2.0.3"},{"location":"update/v2/#v202","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.12.31 \u66f4\u65b0\uff1a\u5c06 CQ \u7801\u8c03\u7528\u7c7b\u66f4\u65b0\u5230\u4e0e\u6700\u65b0 OneBot \u6807\u51c6\u76f8\u517c\u5bb9\u7684\u72b6\u6001","title":"v2.0.2"},{"location":"update/v2/#v201","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.12.23 \u4fee\u590d\uff1a\u5f00\u5c4f\u62a5\u9519\u6587\u4ef6\u5939\u4e0d\u5b58\u5728","title":"v2.0.1"},{"location":"update/v2/#v20","text":"\u66f4\u65b0\u65f6\u95f4\uff1a2020.12.23 \u5df2\u53d1\u5e03\u6b63\u5f0f\u7248\u3002","title":"v2.0"}]}